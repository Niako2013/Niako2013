;/*FB_PKG_DELIM*/

__d("EBAPI",["requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h=(a=c("requireDeferred"))("EBGetContactMailboxPublicKeys").__setRef("EBAPI"),i=a("EBGetCurrentMailboxPublicKeys").__setRef("EBAPI"),j=a("EBIsEbEnabled").__setRef("EBAPI"),k=a("EBMessageBulkPointQuery").__setRef("EBAPI"),l=a("EBMessagePointQueryWithPersistence").__setRef("EBAPI"),m=a("EBMessageRangeQueryForIndexing").__setRef("EBAPI"),n=a("EBMessageRangeQueryWithPersistence").__setRef("EBAPI"),o=a("EBUploadDeletedMessage").__setRef("EBAPI"),p=a("EBUploadReceivedMessages").__setRef("EBAPI"),q=a("EBUploadReceivedMessagesProtobufOnly").__setRef("EBAPI"),r=a("EBUploadSentMessage").__setRef("EBAPI");b={getContactMailboxPublicKeys:function(){return h.load().then(function(a){return a.getContactMailboxPublicKeys()})},getCurrentMailboxPublicKeys:function(){return i.load().then(function(a){return a.getCurrentMailboxPublicKeys()})},isEbEnabledEbSwitch:function(){return j.load().then(function(a){return a.isEbEnabledEbSwitch()})},isEbEnabledLS:function(){for(var a=arguments.length,b=new Array(a),c=0;c<a;c++)b[c]=arguments[c];return j.load().then(function(a){return a.isEbEnabledLS.apply(a,b)})},messageBulkPointQuery:function(){for(var a=arguments.length,b=new Array(a),c=0;c<a;c++)b[c]=arguments[c];return k.load().then(function(a){return a.messageBulkPointQuery.apply(a,b)})},messagePointQueryWithPersistence:function(){for(var a=arguments.length,b=new Array(a),c=0;c<a;c++)b[c]=arguments[c];return l.load().then(function(a){return a.messagePointQueryWithPersistence.apply(a,b)})},messageRangeQueryForIndexing:function(){for(var a=arguments.length,b=new Array(a),c=0;c<a;c++)b[c]=arguments[c];return m.load().then(function(a){return a.messageRangeQueryForIndexing.apply(a,b)})},messageRangeQueryWithPersistence:function(){for(var a=arguments.length,b=new Array(a),c=0;c<a;c++)b[c]=arguments[c];return n.load().then(function(a){return a.messageRangeQueryWithPersistence.apply(a,b)})},uploadDeletedMessage:function(){for(var a=arguments.length,b=new Array(a),c=0;c<a;c++)b[c]=arguments[c];return o.load().then(function(a){return a.uploadDeletedMessage.apply(a,b)})},uploadReceivedMessages:function(){for(var a=arguments.length,b=new Array(a),c=0;c<a;c++)b[c]=arguments[c];return p.load().then(function(a){return a.uploadReceivedMessages.apply(a,b)})},uploadReceivedMessagesProtobufOnly:function(){for(var a=arguments.length,b=new Array(a),c=0;c<a;c++)b[c]=arguments[c];return q.load().then(function(a){return a.uploadReceivedMessagesProtobufOnly.apply(a,b)})},uploadSentMessage:function(){for(var a=arguments.length,b=new Array(a),c=0;c<a;c++)b[c]=arguments[c];return r.load().then(function(a){return a.uploadSentMessage.apply(a,b)})}};d=b;g["default"]=d}),98);
__d("EBGenerateMessageTags",["EncryptedBackupsUploadEntity","MSGDataclassTypes.flow"],(function(a,b,c,d,e,f,g){"use strict";function a(a){switch(a){case d("EncryptedBackupsUploadEntity").AttachmentContextMediaType.IMAGE:return d("MSGDataclassTypes.flow").MpsMessageTag.Photo;case d("EncryptedBackupsUploadEntity").AttachmentContextMediaType.VIDEO:return d("MSGDataclassTypes.flow").MpsMessageTag.Video;case d("EncryptedBackupsUploadEntity").AttachmentContextMediaType.GIF:return d("MSGDataclassTypes.flow").MpsMessageTag.Gif;case d("EncryptedBackupsUploadEntity").AttachmentContextMediaType.PTT:return d("MSGDataclassTypes.flow").MpsMessageTag.Audio;case d("EncryptedBackupsUploadEntity").AttachmentContextMediaType.DOCUMENT:return d("MSGDataclassTypes.flow").MpsMessageTag.File;default:return null}}g.generateEBMessageTags=a}),98);
__d("EphemeralMediaViewMode",[],(function(a,b,c,d,e,f){a=Object.freeze({READ_ONCE:0,REPLAYABLE:1,PERMANENT:2});f["default"]=a}),66);
__d("MAWAdminMsgTypesGrouped",["MAWLocalizationType"],(function(a,b,c,d,e,f,g){"use strict";b=[(a=d("MAWLocalizationType")).LOCALIZATION_TYPE.CUTOVER_IGD_THREAD_ADMIN_MESSAGE,a.LOCALIZATION_TYPE.CUTOVER_THREAD_ADMIN_MESSAGE,a.LOCALIZATION_TYPE.DUAL_THREAD_CUTOVER_ADMIN_MESSAGE];c=[a.LOCALIZATION_TYPE.CURRENT_USER_ADDED_DEVICE,a.LOCALIZATION_TYPE.CURRENT_USER_REMOVED_DEVICE,a.LOCALIZATION_TYPE.CURRENT_USER_UPDATED_DEVICE,a.LOCALIZATION_TYPE.PARTICIPANT_ADDED_DEVICE,a.LOCALIZATION_TYPE.PARTICIPANT_REMOVED_DEVICE,a.LOCALIZATION_TYPE.PARTICIPANT_UPDATED_DEVICE];e=[a.LOCALIZATION_TYPE.CURRENT_USER_ADDED_MORE_THAN_TWO_PARTICIPANTS,a.LOCALIZATION_TYPE.CURRENT_USER_ADDED_ONE_PARTICIPANT,a.LOCALIZATION_TYPE.CURRENT_USER_ADDED_TWO_PARTICIPANTS,a.LOCALIZATION_TYPE.CURRENT_USER_REMOVED_MORE_THAN_TWO_PARTICIPANTS,a.LOCALIZATION_TYPE.CURRENT_USER_REMOVED_ONE_PARTICIPANT,a.LOCALIZATION_TYPE.CURRENT_USER_REMOVED_TWO_PARTICIPANTS,a.LOCALIZATION_TYPE.PARTICIPANT_ADDED_MORE_THAN_TWO_USER,a.LOCALIZATION_TYPE.PARTICIPANT_ADDED_ONE_USER,a.LOCALIZATION_TYPE.PARTICIPANT_ADDED_TWO_USER,a.LOCALIZATION_TYPE.PARTICIPANT_ADDED_YOU,a.LOCALIZATION_TYPE.PARTICIPANT_ADDED_YOU_AND_MORE_THAN_ONE_USERS,a.LOCALIZATION_TYPE.PARTICIPANT_ADDED_YOU_AND_ONE_USER,a.LOCALIZATION_TYPE.PARTICIPANT_REMOVED_MORE_THAN_TWO_USER,a.LOCALIZATION_TYPE.PARTICIPANT_REMOVED_ONE_USER,a.LOCALIZATION_TYPE.PARTICIPANT_REMOVED_TWO_USER,a.LOCALIZATION_TYPE.PARTICIPANT_REMOVED_YOU,a.LOCALIZATION_TYPE.PARTICIPANT_REMOVED_YOU_AND_MORE_THAN_ONE_USERS,a.LOCALIZATION_TYPE.PARTICIPANT_REMOVED_YOU_AND_ONE_USER,a.LOCALIZATION_TYPE.UNKNOWN_USER_ADDED_MORE_THAN_TWO_USER,a.LOCALIZATION_TYPE.UNKNOWN_USER_ADDED_ONE_USER,a.LOCALIZATION_TYPE.UNKNOWN_USER_ADDED_TWO_USER,a.LOCALIZATION_TYPE.UNKNOWN_USER_ADDED_YOU,a.LOCALIZATION_TYPE.UNKNOWN_USER_ADDED_YOU_AND_MORE_THAN_ONE_USER,a.LOCALIZATION_TYPE.UNKNOWN_USER_ADDED_YOU_AND_ONE_USER,a.LOCALIZATION_TYPE.UNKNOWN_USER_REMOVED_MORE_THAN_TWO_USER,a.LOCALIZATION_TYPE.UNKNOWN_USER_REMOVED_ONE_USER,a.LOCALIZATION_TYPE.UNKNOWN_USER_REMOVED_TWO_USER,a.LOCALIZATION_TYPE.UNKNOWN_USER_REMOVED_YOU,a.LOCALIZATION_TYPE.UNKNOWN_USER_REMOVED_YOU_AND_MORE_THAN_ONE_USER,a.LOCALIZATION_TYPE.UNKNOWN_USER_REMOVED_YOU_AND_ONE_USER];f=[a.LOCALIZATION_TYPE.CURRENT_USER_DEMOTED_PARTICIPANT,a.LOCALIZATION_TYPE.CURRENT_USER_PROMOTED_PARTICIPANT,a.LOCALIZATION_TYPE.PARTICIPANT_DEMOTED_PARTICIPANT,a.LOCALIZATION_TYPE.PARTICIPANT_PROMOTED_PARTICIPANT,a.LOCALIZATION_TYPE.CURRENT_USER_GOT_DEMOTED,a.LOCALIZATION_TYPE.CURRENT_USER_GOT_PROMOTED,a.LOCALIZATION_TYPE.CURRENT_USER_SELF_DEMOTED,a.LOCALIZATION_TYPE.PARTICIPANT_GOT_DEMOTED,a.LOCALIZATION_TYPE.PARTICIPANT_GOT_PROMOTED,a.LOCALIZATION_TYPE.PARTICIPANT_PROMOTED_YOU,a.LOCALIZATION_TYPE.PARTICIPANT_DEMOTED_YOU,a.LOCALIZATION_TYPE.PARTICIPANT_SELF_DEMOTED,a.LOCALIZATION_TYPE.CURRENT_USER_SET_ADD_MODE_ADMIN_ONLY,a.LOCALIZATION_TYPE.CURRENT_USER_SET_ADD_MODE_ALL_MEMBERS,a.LOCALIZATION_TYPE.PARTICIPANT_SET_ADD_MODE_ADMIN_ONLY,a.LOCALIZATION_TYPE.PARTICIPANT_SET_ADD_MODE_ALL_MEMBERS,a.LOCALIZATION_TYPE.SERVER_SET_ADD_MODE_ADMIN_ONLY,a.LOCALIZATION_TYPE.SERVER_SET_ADD_MODE_ALL_MEMBERS];d=[a.LOCALIZATION_TYPE.CURRENT_USER_LEFT_GROUP,a.LOCALIZATION_TYPE.PARTICIPANT_LEFT_GROUP];var h=[a.LOCALIZATION_TYPE.CURRENT_USER_NAMED_GROUP,a.LOCALIZATION_TYPE.CURRENT_USER_CUSTOMIZE_HOTLIKE,a.LOCALIZATION_TYPE.CURRENT_USER_CUSTOMIZE_NICKNAME,a.LOCALIZATION_TYPE.CURRENT_USER_CUSTOMIZE_PHOTO,a.LOCALIZATION_TYPE.CURRENT_USER_CUSTOMIZE_THEME,a.LOCALIZATION_TYPE.CURRENT_USER_CLEAR_OWN_NICKNAME,a.LOCALIZATION_TYPE.CURRENT_USER_CLEAR_PARTICIPANT_NICKNAME,a.LOCALIZATION_TYPE.CURRENT_USER_SET_OWN_NICKNAME,a.LOCALIZATION_TYPE.CURRENT_USER_CUSTOMIZE_AI_THEME],i=[a.LOCALIZATION_TYPE.PARTICIPANT_NAMED_GROUP,a.LOCALIZATION_TYPE.PARTICIPANT_CUSTOMIZE_CURRENT_USER_NICKNAME,a.LOCALIZATION_TYPE.PARTICIPANT_CUSTOMIZE_HOTLIKE,a.LOCALIZATION_TYPE.PARTICIPANT_CUSTOMIZE_PARTICIPANT_NICKNAME,a.LOCALIZATION_TYPE.PARTICIPANT_CUSTOMIZE_PHOTO,a.LOCALIZATION_TYPE.PARTICIPANT_CUSTOMIZE_THEME,a.LOCALIZATION_TYPE.PARTICIPANT_CUSTOMIZE_AI_THEME,a.LOCALIZATION_TYPE.UNKNOWN_USER_NAMED_GROUP,a.LOCALIZATION_TYPE.PARTICIPANT_CLEAR_CURRENT_USER_NICKNAME,a.LOCALIZATION_TYPE.PARTICIPANT_CLEAR_OWN_NICKNAME,a.LOCALIZATION_TYPE.PARTICIPANT_CLEAR_PARTICIPANT_NICKNAME,a.LOCALIZATION_TYPE.PARTICIPANT_SET_OWN_NICKNAME],j=[a.LOCALIZATION_TYPE.CURRENT_USER_PINNED_MESSAGE,a.LOCALIZATION_TYPE.CURRENT_USER_UNPINNED_MESSAGE,a.LOCALIZATION_TYPE.PARTICIPANT_PINNED_MESSAGE,a.LOCALIZATION_TYPE.PARTICIPANT_UNPINNED_MESSAGE],k=[a.LOCALIZATION_TYPE.TWO_USERS_CONNECTED,a.LOCALIZATION_TYPE.TWO_USERS_CONNECTED_ONE_MSPLIT],l=[a.LOCALIZATION_TYPE.CURRENT_USER_SEND_UNRENDERABLE_MESSAGE_FALLBACK,a.LOCALIZATION_TYPE.CURRENT_USER_SEND_LIVE_LOCATION_FALLBACK,a.LOCALIZATION_TYPE.CURRENT_USER_SEND_LOCATION_FALLBACK,a.LOCALIZATION_TYPE.CURRENT_USER_SEND_POLL_CREATION_FALLBACK,a.LOCALIZATION_TYPE.CURRENT_USER_SEND_CONTACT_SHARE_FALLBACK,a.LOCALIZATION_TYPE.CURRENT_USER_SEND_STORY_MENTION_FALLBACK,a.LOCALIZATION_TYPE.CURRENT_USER_SEND_BUMP_MESSAGE_FALLBACK,a.LOCALIZATION_TYPE.CURRENT_USER_SEND_STICKER_RECEIVER_FETCH_MESSAGE_FALLBACK],m=[a.LOCALIZATION_TYPE.PARTICIPANT_SEND_UNRENDERABLE_MESSAGE_FALLBACK,a.LOCALIZATION_TYPE.PARTICIPANT_SEND_LIVE_LOCATION_FALLBACK,a.LOCALIZATION_TYPE.PARTICIPANT_SEND_LOCATION_FALLBACK,a.LOCALIZATION_TYPE.PARTICIPANT_SEND_POLL_CREATION_FALLBACK,a.LOCALIZATION_TYPE.PARTICIPANT_SEND_CONTACT_SHARE_FALLBACK,a.LOCALIZATION_TYPE.PARTICIPANT_SEND_STORY_MENTION_FALLBACK,a.LOCALIZATION_TYPE.PARTICIPANT_SEND_BUMP_MESSAGE,a.LOCALIZATION_TYPE.PARTICIPANT_SEND_STICKER_RECEIVER_FETCH_MESSAGE_FALLBACK,a.LOCALIZATION_TYPE.MESSENGER_MEMORY_ENCRYPTED_MESSAGE_FALLBACK,a.LOCALIZATION_TYPE.META_AI_SEND_MESSAGE_FALLBACK,a.LOCALIZATION_TYPE.USER_SEND_UNAVAILABLE_MESSAGE_FALLBACK,a.LOCALIZATION_TYPE.USER_SEND_ENCRYPTED_MESSAGE_FALLBACK,a.LOCALIZATION_TYPE.PARTICIPANT_SEND_BUMP_MESSAGE_ORIGINAL_UNAVAILABLE_FALLBACK],n=[a.LOCALIZATION_TYPE.CURRENT_USER_BUMPED_MESSAGE,a.LOCALIZATION_TYPE.CURRENT_USER_BUMPED_OWN_MESSAGE],o=[a.LOCALIZATION_TYPE.PARTICIPANT_BUMPED_CURRENT_USER_MESSAGE,a.LOCALIZATION_TYPE.PARTICIPANT_BUMPED_OWN_MESSAGE,a.LOCALIZATION_TYPE.PARTICIPANT_BUMPED_PARTICIPANT_MESSAGE],p=[a.LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_CHANGE_DAYS,a.LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_CHANGE_HOURS,a.LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_CHANGE_MINUTES,a.LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_CHANGE_SECONDS,a.LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_TURNED_OFF,a.LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_TURNED_ON_DAYS,a.LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_TURNED_ON_HOURS,a.LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_TURNED_ON_MINUTES,a.LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_TURNED_ON_SECONDS,a.LOCALIZATION_TYPE.UNKNOWN_USER_EPHEMERAL_SETTING_CHANGE_DAYS,a.LOCALIZATION_TYPE.UNKNOWN_USER_EPHEMERAL_SETTING_CHANGE_HOURS,a.LOCALIZATION_TYPE.UNKNOWN_USER_EPHEMERAL_SETTING_CHANGE_MINUTES,a.LOCALIZATION_TYPE.UNKNOWN_USER_EPHEMERAL_SETTING_CHANGE_SECONDS,a.LOCALIZATION_TYPE.UNKNOWN_USER_EPHEMERAL_SETTING_TURNED_OFF,a.LOCALIZATION_TYPE.UNKNOWN_USER_EPHEMERAL_SETTING_TURNED_ON_DAYS,a.LOCALIZATION_TYPE.UNKNOWN_USER_EPHEMERAL_SETTING_TURNED_ON_HOURS,a.LOCALIZATION_TYPE.UNKNOWN_USER_EPHEMERAL_SETTING_TURNED_ON_MINUTES,a.LOCALIZATION_TYPE.UNKNOWN_USER_EPHEMERAL_SETTING_TURNED_ON_SECONDS,a.LOCALIZATION_TYPE.YOU_EPHEMERAL_SETTING_CHANGE_DAYS,a.LOCALIZATION_TYPE.YOU_EPHEMERAL_SETTING_CHANGE_HOURS,a.LOCALIZATION_TYPE.YOU_EPHEMERAL_SETTING_CHANGE_MINUTES,a.LOCALIZATION_TYPE.YOU_EPHEMERAL_SETTING_CHANGE_SECONDS,a.LOCALIZATION_TYPE.YOU_EPHEMERAL_SETTING_TURNED_OFF,a.LOCALIZATION_TYPE.YOU_EPHEMERAL_SETTING_TURNED_ON_DAYS,a.LOCALIZATION_TYPE.YOU_EPHEMERAL_SETTING_TURNED_ON_HOURS,a.LOCALIZATION_TYPE.YOU_EPHEMERAL_SETTING_TURNED_ON_MINUTES,a.LOCALIZATION_TYPE.YOU_EPHEMERAL_SETTING_TURNED_ON_SECONDS,a.LOCALIZATION_TYPE.EPHEMERAL_SETTINGS_AUTO_RESET],q=[a.LOCALIZATION_TYPE.YOUR_DEVICE_ICDC_ALERT_ADMIN_MESSAGE,a.LOCALIZATION_TYPE.ICDC_ALERT_ADMIN_MESSAGE],r=[a.LOCALIZATION_TYPE.CURRENT_USER_MISSED_AUDIO_CALL,a.LOCALIZATION_TYPE.CURRENT_USER_MISSED_VIDEO_CALL,a.LOCALIZATION_TYPE.PARTICIPANT_STARTED_GROUP_AUDIO_CALL,a.LOCALIZATION_TYPE.PARTICIPANT_STARTED_GROUP_VIDEO_CALL],s=[a.LOCALIZATION_TYPE.CURRENT_USER_AUDIO_CALLED,a.LOCALIZATION_TYPE.CURRENT_USER_STARTED_GROUP_AUDIO_CALL,a.LOCALIZATION_TYPE.CURRENT_USER_STARTED_GROUP_VIDEO_CALL,a.LOCALIZATION_TYPE.CURRENT_USER_VIDEO_CALLED,a.LOCALIZATION_TYPE.PARTICIPANT_MISSED_AUDIO_CALL,a.LOCALIZATION_TYPE.PARTICIPANT_MISSED_VIDEO_CALL,a.LOCALIZATION_TYPE.PARTICIPANT_AUDIO_CALLED,a.LOCALIZATION_TYPE.PARTICIPANT_VIDEO_CALLED],t=[a.LOCALIZATION_TYPE.CURRENT_USER_CREATED_GROUP,a.LOCALIZATION_TYPE.CURRENT_USER_MENTIONED_STORY_IG,a.LOCALIZATION_TYPE.CURRENT_USER_SENT_EVENT,a.LOCALIZATION_TYPE.CURRENT_USER_SENT_POST,a.LOCALIZATION_TYPE.CURRENT_USER_SENT_REEL,a.LOCALIZATION_TYPE.CURRENT_USER_SENT_STORY,a.LOCALIZATION_TYPE.CURRENT_USER_SENT_STORY_HIGHLIGHT,a.LOCALIZATION_TYPE.CURRENT_USER_RECEIVED_STORY_MENTION_IG,a.LOCALIZATION_TYPE.UNAVAILABLE_SNIPPET,a.LOCALIZATION_TYPE.YOU_EPHEMERAL_RECORD_SCREEN,a.LOCALIZATION_TYPE.YOU_EPHEMERAL_TAKE_SCREENSHOT,a.LOCALIZATION_TYPE.CURRENT_USER_UNSENT_MESSAGE],u=[a.LOCALIZATION_TYPE.PARTICIPANT_CREATED_GROUP,a.LOCALIZATION_TYPE.UNKNOWN_USER_CREATED_GROUP,a.LOCALIZATION_TYPE.PARTICIPANT_SEND_ATTACHMENT,a.LOCALIZATION_TYPE.PARTICIPANT_SEND_AUDIO,a.LOCALIZATION_TYPE.PARTICIPANT_SEND_GIF,a.LOCALIZATION_TYPE.PARTICIPANT_SEND_IMAGE,a.LOCALIZATION_TYPE.PARTICIPANT_SEND_STICKER,a.LOCALIZATION_TYPE.PARTICIPANT_SEND_TEXT,a.LOCALIZATION_TYPE.PARTICIPANT_SEND_TEXT_IN_GROUP,a.LOCALIZATION_TYPE.PARTICIPANT_SEND_VIDEO,a.LOCALIZATION_TYPE.PARTICIPANT_SENT_EVENT,a.LOCALIZATION_TYPE.PARTICIPANT_SENT_POST,a.LOCALIZATION_TYPE.PARTICIPANT_SENT_REEL,a.LOCALIZATION_TYPE.PARTICIPANT_SENT_STORY,a.LOCALIZATION_TYPE.PARTICIPANT_SENT_STORY_HIGHLIGHT,a.LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_RECORD_SCREEN,a.LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_TAKE_SCREENSHOT,a.LOCALIZATION_TYPE.PARTICIPANT_REACT_MESSAGE,a.LOCALIZATION_TYPE.PARTICIPANT_REACT_MESSAGE_IN_GROUP,a.LOCALIZATION_TYPE.PARTICIPANT_UNSENT_MESSAGE,a.LOCALIZATION_TYPE.UNKNOWN_USER_EPHEMERAL_RECORD_SCREEN,a.LOCALIZATION_TYPE.UNKNOWN_USER_EPHEMERAL_TAKE_SCREENSHOT];a=[a.LOCALIZATION_TYPE.EMPTY_SNIPPET];g.cutoverAdminMsgs=b;g.deviceChanges=c;g.participantsAddedRemoved=e;g.groupPermissionsChanged=f;g.participantLeftGroup=d;g.chatCustomizedByCurrentUser=h;g.chatCustomizedByOtherUser=i;g.pinnedMessageUpdate=j;g.twoUsersConnected=k;g.fallbackMsgFromCurrentUser=l;g.fallbackMsgFromOtherUser=m;g.currentUserBumpsMessage=n;g.otherUserBumpsMessage=o;g.ephemeralSettingChanges=p;g.icdcAlerts=q;g.callActionToNotifyAbout=r;g.callActionNotToNotifyAbout=s;g.otherNonAdminMsgToBeBumped=t;g.otherNonAdminMsgToBeMarkedAsUnread=u;g.otherNonAdminMsgToNotTriggerUpdate=a}),98);
__d("MAWAuthor",["MAWUserJidWrapper","WAJids","isStringNullOrEmpty"],(function(a,b,c,d,e,f,g){"use strict";a=function(a){if(a==null||a===d("WAJids").AUTHOR_SYSTEM)return null;if(d("WAJids").isAuthorMe(a))return d("MAWUserJidWrapper").getMyUserJid();var b=d("WAJids").authorAsUserJid(a);if(b==null||c("isStringNullOrEmpty")(d("WAJids").userIdFromJid(b)))return null;else return d("WAJids").authorAsUserJid(a)};g.getAuthorUserJid=a}),98);
__d("MAWBridgeMsgCountdown",["MAWDbMsg","MAWLoggerUtils","WATagsLogger","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["createBridgeMsgsStartCountdown: msg ",", expiration ",", ms until countdown ",", duration ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Calling the messages starting countdown bridge event with remaning time less or equal to 0 (expired message)"]);i=function(){return a};return a}var j=d("WATagsLogger").TAGS([d("MAWLoggerUtils").Tag.Ephemeral,d("MAWLoggerUtils").Tag.Countdown]);function a(a){return{msgs:a.map(function(a){var b,c=a.messageExpirationTs;b=(b=a.ephemeralSetting)==null?void 0:b.ephemeralExpirationInSec;if(c==null||b==null)return;var e=d("WATimeUtils").cappedMillisecondsUntil(c);if(e<=0){j.LOG(i());return}var f=b*1e3;e>f&&(e=f);j.LOG(h(),a.msgId,c,e,b);return{countdownTs:c,millisecondsUntilCountdownTs:e,msgId:a.msgId,threadJid:a.threadJid,ts:d("MAWDbMsg").getCanonicalTsFromMsg(a)}}).filter(Boolean)}}function b(a,b){return{countdownTs:b,msgId:a}}g.createBridgeMsgsStartCountdown=a;g.createBridgeMsgClearCountdown=b}),98);
__d("MAWBridgeReceiverFetchInfo",["WALogger","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to cast previewUrlExpirationTimestampMs to millis time: ",""]);h=function(){return a};return a}function a(a,b){var c=b.accessibilitySummaryText,d=b.mimetype,e=b.previewHeight,f=b.previewUrl,g=b.previewUrlExpirationTimestampMs,h=b.previewWidth,k=b.receiverFetchId;b=b.type;return{accessibilitySummaryText:c,mimetype:d,msgId:a.msgId,previewHeight:e,previewUrl:f,previewUrlExpirationTimestampMs:j(g),previewWidth:h,receiverFetchId:k,sortOrderMs:i(a),threadJid:a.threadJid,type:b}}function b(a,b){var c=b.mimetype,d=b.previewHeight,e=b.previewWidth,f=b.receiverFetchId;b=b.type;return{mimetype:c,msgId:a.msgId,previewHeight:d,previewWidth:e,receiverFetchId:f,sortOrderMs:i(a),threadJid:a.threadJid,type:b}}function i(a){return d("WATimeUtils").castToMillisTime(a.sortOrderMs!=null?a.sortOrderMs:a.ts*1e3)}function j(a){if(a==null)return void 0;try{return d("WATimeUtils").castLongIntToMillisTime(a)}catch(a){d("WALogger").ERROR(h(),a);return void 0}}g.createBridgeReceiverFetchInfoPayloadFromDbInfo=a;g.createBridgeReceiverFetchInfoPayloadFromUnstoredInfo=b}),98);
__d("MAWThreadBumpType",[],(function(a,b,c,d,e,f){"use strict";a="NO_UPDATE";b="LOCAL_ONLY";c="LOCAL_AND_SERVER";d=Object.freeze({LOCAL_AND_SERVER:c,LOCAL_ONLY:b,NO_UPDATE:a});f.THREAD_BUMP_TYPE=d}),66);
__d("MAWBridgeTypesCreators",["I64","MAWDbMsg","MAWImageUtils","MAWMsgType","MAWThreadBumpType","MAWUserJidWrapper","WAJids","WAMediaUtils","WATimeUtils","err","gkx","justknobx"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a){return{threadJid:a}}function i(a){var b,c=a.ts;switch(a.type){case d("MAWMsgType").MSG_TYPE.REVOKED:c=(b=a.originalTs)!=null?b:a.ts;break;default:c=d("MAWDbMsg").getCanonicalTsFromMsg(a)}return{msgId:a.msgId,ts:c}}function b(a,b){b=b.map(i);return{messages:b,threadJid:a}}function e(a){return{ravenMsgId:a.msgId,threadJid:a.threadJid}}function f(a,b){return a.filter(function(a){return b===a.threadJid}).map(function(a){return a.msgId})}function j(a){var b,e=a.chatJid,f=a.filteredMsgIds,g=a.hasMediaForUI,h=a.hdTypes,i=a.media,j=a.offlineAttachmentId,k=a.ravenSettings,l=a.sortOrderMs;a=a.transportKey;switch(i.mediaType){case"Image":return{duration:null,ephemeralMediaState:k==null?void 0:k.ephemeralMediaState,ephemeralMediaViewMode:k==null?void 0:k.ephemeralMediaViewMode,filesize:i.size,hasMedia:g,hasPreviewMedia:((b=i.validatedImageInfo)==null?void 0:b.jpegThumbnail)!=null,hdTypes:h,mediaId:i.mediaId,mediaType:i.mediaType,msgIds:f,offlineAttachmentId:j,plaintextHash:i.plaintextHash,previewHeight:(b=i.validatedImageInfo)==null?void 0:b.jpegThumbnailHeight,previewHeightLarge:(h=i.validatedImageInfo)==null?void 0:h.height,previewWidth:(b=i.validatedImageInfo)==null?void 0:b.jpegThumbnailWidth,previewWidthLarge:(h=i.validatedImageInfo)==null?void 0:h.width,sortOrderMs:d("WATimeUtils").castToMillisTime(l!=null?l:i.ts*1e3),threadJid:e,transportKey:a,ts:d("WATimeUtils").castToUnixTime(l!=null?l/1e3:i.ts)};case"Video":return{duration:((b=i.validatedVideoInfo)==null?void 0:b.duration)!=null?((h=i.validatedVideoInfo)==null?void 0:h.duration)*1e3:0,ephemeralMediaState:k==null?void 0:k.ephemeralMediaState,ephemeralMediaViewMode:k==null?void 0:k.ephemeralMediaViewMode,filesize:i.size,hasMedia:g,hasPreviewMedia:((b=i.validatedVideoInfo)==null?void 0:b.jpegThumbnail)!=null,mediaId:i.mediaId,mediaType:i.mediaType,msgIds:f,offlineAttachmentId:j,plaintextHash:i.plaintextHash,previewHeight:(h=i.validatedVideoInfo)==null?void 0:h.jpegThumbnailHeight,previewHeightLarge:(k=i.validatedVideoInfo)==null?void 0:k.height,previewWidth:(b=i.validatedVideoInfo)==null?void 0:b.jpegThumbnailWidth,previewWidthLarge:(h=i.validatedVideoInfo)==null?void 0:h.width,sortOrderMs:d("WATimeUtils").castToMillisTime(l!=null?l:i.ts*1e3),threadJid:e,transportKey:a,ts:d("WATimeUtils").castToUnixTime(l!=null?l/1e3:i.ts)};case"Ptt":return{duration:((k=i.validatedAudioInfo)==null?void 0:k.duration)?i.validatedAudioInfo.duration*1e3:null,filesize:i.size,hasMedia:g,mediaId:i.mediaId,mediaType:i.mediaType,msgIds:f,offlineAttachmentId:j,plaintextHash:i.plaintextHash,previewHeight:null,previewHeightLarge:null,previewWidth:null,previewWidthLarge:null,sortOrderMs:d("WATimeUtils").castToMillisTime(l!=null?l:i.ts*1e3),threadJid:e,transportKey:a,ts:d("WATimeUtils").castToUnixTime(l!=null?l/1e3:i.ts)};case"Gif":return{accessibilitySummaryText:(b=i.accessibilitySummaryText)!=null?b:void 0,duration:null,filesize:i.size,hasMedia:g,mediaId:i.mediaId,mediaType:i.mediaType,msgIds:i.msgIds,offlineAttachmentId:j,plaintextHash:i.plaintextHash,previewHeight:(h=i.validatedImageInfo)==null?void 0:h.jpegThumbnailHeight,previewHeightLarge:(k=i.validatedImageInfo)==null?void 0:k.height,previewWidth:(b=i.validatedImageInfo)==null?void 0:b.jpegThumbnailWidth,previewWidthLarge:(h=i.validatedImageInfo)==null?void 0:h.width,sortOrderMs:d("WATimeUtils").castToMillisTime(l!=null?l:i.ts*1e3),threadJid:e,transportKey:a,ts:d("WATimeUtils").castToUnixTime(l!=null?l/1e3:i.ts)};case"Sticker":h=d("MAWImageUtils").boundHeightWidth((k=i.validatedImageInfo)==null?void 0:k.jpegThumbnailHeight,(b=i.validatedImageInfo)==null?void 0:b.jpegThumbnailWidth,d("MAWImageUtils").STICKER_THUMBNAIL_MAX_SIZE);k=h.height;b=h.width;return{accessibilitySummaryText:(h=i.accessibilitySummaryText)!=null?h:void 0,duration:null,filesize:i.size,hasMedia:g,mediaId:i.mediaId,mediaType:i.mediaType,msgIds:i.msgIds,offlineAttachmentId:j,plaintextHash:i.plaintextHash,previewHeight:k,previewHeightLarge:k,previewWidth:b,previewWidthLarge:b,sortOrderMs:d("WATimeUtils").castToMillisTime(l!=null?l:i.ts*1e3),threadJid:e,transportKey:a,ts:d("WATimeUtils").castToUnixTime(l!=null?l/1e3:i.ts)};case"DocumentFile":h={};for(var k=i.mediaEntries,b=Array.isArray(k),m=0,k=b?k:k[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var n;if(b){if(m>=k.length)break;n=k[m++]}else{m=k.next();if(m.done)break;n=m.value}n=n;var o=n[0];n=n[1];n=d("WAMediaUtils").mediaEntryDataToRawData(i.plaintextHash,n);n=n.filename;n!=null&&(h[o]=n)}return{defaultFilename:(o=i.validatedDocumentFileInfo)==null?void 0:o.filename,duration:null,filenames:h,filesize:i.size,hasMedia:g,mediaId:i.mediaId,mediaType:i.mediaType,msgIds:f,offlineAttachmentId:j,plaintextHash:i.plaintextHash,previewHeight:null,previewHeightLarge:null,previewWidth:null,previewWidthLarge:null,sortOrderMs:d("WATimeUtils").castToMillisTime(l!=null?l:i.ts*1e3),threadJid:e,transportKey:a,ts:d("WATimeUtils").castToUnixTime(l!=null?l/1e3:i.ts)};default:i.mediaType;throw c("err")("[createBridgeMedia] Unsupported media type: "+i.mediaType)}}function k(a,b,c,e,f){return{chatJid:a,deliveredWatermarkTs:(a=c)!=null?a:d("WATimeUtils").castToUnixTime(0),fbid:b,lastReadActionTs:(c=f)!=null?c:d("WATimeUtils").castToUnixTime(0),lastReadWatermarkTs:(a=e)!=null?a:d("WATimeUtils").castToUnixTime(0)}}function l(a){var b=a.cannotReplyReason,c=a.folder,d=a.snippetParams,e=a.snippetSenderContactId,f=a.snippetType;a=a.threadJid;return{cannotReplyReason:b,folder:c,snippetContactIDs:d==null?void 0:d.contactIDs,snippetMentionJIDs:d==null?void 0:d.mentionJIDs,snippetParams:d==null?void 0:d.strings,snippetSenderContactId:e,snippetType:f,threadJid:a}}function m(a){return{chatJid:a.groupJid,memberAddMode:a.memberAddMode,threadName:a.name}}var n={snippetContactIDs:[],snippetMentionJIDs:[],snippetParams:[],snippetSenderContactId:null,snippetType:null};function o(a){var b,c=a.bumpTimestampMs,d=a.description,e=a.isMessageAuthorMe,f=a.isUnbump,g=a.skipBumpTimestampValidation,h=a.skipServerThreadBump,i=a.snippetData;a=a.threadJid;b=i==null?n:{snippetContactIDs:i.params.contactIDs,snippetMentionJIDs:(b=i.params.mentionJIDs)!=null?b:[],snippetParams:i.params.strings,snippetSenderContactId:i.senderContactId,snippetType:i.type};return babelHelpers["extends"]({},b,{bumpTimestampMs:c,description:d,isMessageAuthorMe:e,isUnbump:f,skipBumpTimestampValidation:(i=g)!=null?i:!1,skipServerThreadBump:(b=h)!=null?b:!1,threadJid:a})}var p={author:d("WAJids").AUTHOR_ME,bumpedByLocalDeviceSend:!1,bumpTimestampMs:(h||(h=d("I64"))).zero,isThrottled:!1,isUnbump:!1,tableName:null,threadBumpType:d("MAWThreadBumpType").THREAD_BUMP_TYPE.NO_UPDATE};function q(a){var b=a.centralizedThreadBumpData,c=a.centralizedThreadSnippetData,d=a.description,e=a.jid;a=a.threadUpdateType;return babelHelpers["extends"]({},(b=b)!=null?b:p,{centralizedThreadSnippetData:c,description:d,jid:e,threadUpdateType:a})}function r(a){var b;if(c("gkx")("239"))return 0;return!c("justknobx")._("2319")?d("MAWDbMsg").getOriginalTsFromMsg(a)*1e3:(b=a.sortOrderMs)!=null?b:d("MAWDbMsg").getOriginalTsFromMsg(a)*1e3}function s(a,b,d,e,f,g){g===void 0&&(g="before");b=b;if(b.length===0)return{chatJid:a,rangeExtensionType:null};if(d)return{chatJid:a,rangeExtensionType:{hasMoreBefore:e,maxMsgId:b[0].msgId,minMsgId:b[b.length-1].msgId,minMsgTs:r(b[b.length-1]),rangeKind:"initial"}};return c("gkx")("23927")?{chatJid:a,rangeExtensionType:{hasMoreAfter:f,hasMoreBefore:e,maxMsgId:b[0].msgId,maxMsgTs:r(b[0]),minMsgId:b[b.length-1].msgId,minMsgTs:r(b[b.length-1]),rangeKind:g==="before"?"before":"after"}}:{chatJid:a,rangeExtensionType:{hasMoreBefore:e,minMsgId:b[b.length-1].msgId,minMsgTs:r(b[b.length-1]),rangeKind:"extensionBefore"}}}function t(a){var b=a.author,c=a.chatJid,e=a.reaction,f=a.reactToMsgId;a=a.ts;return{actorId:d("WAJids").authorToUserId(b,d("WAJids").extractUserId(d("MAWUserJidWrapper").getMyUserJid())),chatJid:c,messageId:f,reaction:e,ts:a}}function u(a){var b=a.newestMsgId,c=a.newestMsgTs,e=a.oldestMsgId;a=a.thread;return{hasMoreAfter:!1,hasMoreBefore:!1,maxMsgId:b,maxMsgTs:c,minMsgId:e,minMsgTs:d("WATimeUtils").castToMillisTime(0),threadJid:a.jid}}function v(a){var b=d("WAJids").extractUserId(d("MAWUserJidWrapper").getMyUserJid()),c=a.author,e=a.chatJid;a=a.reactToMsgId;return{actorId:d("WAJids").authorToUserId(c,b),chatJid:e,messageId:a}}function w(a){return{creationTs:a.creationTs,creator:a.creator,groupJid:a.groupJid,msgExpiration:a.msgExpiration,name:a.name,nameOwner:a.nameOwner,nameTs:a.nameTs,participantVersion:a.participantVersion}}function x(a){var b=a.threadJid,c=a.inviteeJid;return{caption:a.caption,inviteCode:a.inviteCode,inviteeId:c,inviteExpireTs:a.inviteExpirationTs,inviterId:d("WAJids").extractUserId(a.inviterJid),threadJid:b}}function y(a){return{threadJid:a}}function z(a,b,c){return{senderId:d("WAJids").extractUserId(b),state:c,threadJid:a}}g.createBridgeUpdateE2EEMetadataParticipants=a;g.createBridgeDeleteMessages=b;g.createBridgeRavenAction=e;g.getMsgIdsFilteredByJid=f;g.createBridgeMedia=j;g.createBridgeReceivedReceipt=k;g.createBridgeUpdatedThread=l;g.createBridgeUpdatedGroupInfo=m;g.createBridgeBumpedThreadV2=o;g.createBridgeCentralizedThreadUpdate=q;g.createBridgeMsgsLoadedInfo=s;g.createBridgeUpsertReaction=t;g.createBridgeUpdateMessageRange=u;g.createBridgeDeleteReaction=v;g.createBridgeGroupInfo=w;g.createBridgeGroupInvite=x;g.createBridgeDeleteGroupInvite=y;g.createBridgeReceivedChatState=z}),98);
__d("MAWBridgeXMA",["MAWBridgeXMAUtils","MAWDbMedia","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["MAWBridge - createBridgeXMA received unexpected media type - ",""]);h=function(){return a};return a}function i(a){if(a==null)return void 0;switch(a){case"Image":case"Sticker":return"image/png";case"Gif":return"image/gif";case"Video":return"video/mp4";case"Ptt":return"audio/wav"}}function a(a,b,c){var e=b.author,f=b.contentRef,g=b.ctas,j=b.defaultCTA,k=b.defaultPreviewMediaId,l=b.defaultPreviewMediaPlaintextHash,m=b.faviconMediaId,n=b.faviconPlaintextHash,o=b.headerMediaId,p=b.headerMediaPlaintextHash,q=b.headerTitle,r=b.maxSubtitleNumOfLines,s=b.maxTitleNumOfLines,t=b.msgId,u=b.offlineAttachmentId,v=b.overlayIconGlyph,w=b.overlayTitle,x=b.subtitleText,y=b.targetId,z=b.targetType,A=b.targetUsername,B=b.threadJid,C=b.titleText,D=b.xmaDataclass,E=b.xmaId;b=b.xmaLayoutType;a!=null&&a.mediaType!==d("MAWDbMedia").IMAGE&&d("WALogger").WARN(h(),a.mediaType);y!=null&&d("MAWBridgeXMAUtils").maybeBridgeToLSTargetId(y,z);var F=c.hasMedia,G=c.hasXmaFaviconMedia;c=c.hasXmaHeaderMedia;return{author:e,contentRef:f,ctas:g==null?void 0:g.filter(function(a){return a.ctaType!=null}),defaultCTA:j,defaultPreviewMediaId:k,defaultPreviewMediaPlaintextHash:l,duration:null,faviconMediaId:m,faviconPlaintextHash:n,filesize:a==null?void 0:a.size,hasMedia:F,hasXmaFaviconMedia:G,hasXmaHeaderMedia:c,headerMediaId:o,headerMediaPlaintextHash:p,headerTitle:q,maxSubtitleNumOfLines:r,maxTitleNumOfLines:s,mediaType:a==null?void 0:a.mediaType,msgId:t,offlineAttachmentId:u,overlayIconGlyph:v,overlayTitle:w,playableUrlMimeType:i(a==null?void 0:a.mediaType),previewHeight:a==null?void 0:(e=a.validatedImageInfo)==null?void 0:e.jpegThumbnailHeight,previewHeightLarge:a==null?void 0:(f=a.validatedImageInfo)==null?void 0:f.height,previewUrlMimeType:i(a==null?void 0:a.mediaType),previewWidth:a==null?void 0:(g=a.validatedImageInfo)==null?void 0:g.jpegThumbnailWidth,previewWidthLarge:a==null?void 0:(j=a.validatedImageInfo)==null?void 0:j.width,subtitleText:x,targetId:y,targetType:z,targetUsername:A,threadJid:B,titleText:C,ts:a==null?void 0:a.ts,xmaDataclass:D,xmaId:E,xmaLayoutType:b}}function b(a,b){var c=a.msgId;a=a.threadJid;return{msgId:c,threadJid:a,xmaId:b}}function c(a,b){var c=a.msgId;a=a.threadJid;return{msgId:c,threadJid:a,xmaId:b}}g.createBridgeXMA=a;g.createBridgeXMAShareExpired=b;g.createBridgeXMAShareTombstoned=c}),98);
__d("MAWDexie",["cr:10766"],(function(a,b,c,d,e,f,g){"use strict";f.exports=b("cr:10766")}),34);
__d("MAWDexieTable",["MAWDexie","Promise","justknobx"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(a){return(h||(h=b("Promise"))).resolve(a)}function a(a){return a.reduce(function(a,b,c){return a.then(function(a){return b(c).then(function(b){a.push(b);return a})})},n([]))}function e(a){return c("MAWDexie").Promise.all(a)}function f(a){return c("MAWDexie").Promise.allSettled(a)}function j(a){return c("MAWDexie").Promise.PSD[a]}function k(a,b){c("MAWDexie").Promise.PSD[a]=b}function l(a){c("MAWDexie").Promise.PSD[a]=void 0}var m=function(){function a(a,b,d,e){d===void 0&&(d=!0);e=new(c("MAWDexie"))(a,babelHelpers["extends"]({},e,{chromeTransactionDurability:"relaxed",modifyChunkSize:c("justknobx")._("3166")}));b(e);this.name=a;this.stores=e;d&&this.open()}var b=a.prototype;b.open=function(){this.stores.open()};b.close=function(){this.stores.close()};b.transact=function(a,b,c){var d=this;return i(this.stores.transaction(a,b.map(function(a){return d.stores[a]}),function(){return c()}))};babelHelpers.createClass(a,[{key:"tables",get:function(){return this.stores.tables}}]);return a}();function n(a){return c("MAWDexie").Promise.resolve(a)}function o(a){return c("MAWDexie").waitFor(a)}g.DEXIE_MIN_KEY=d("MAWDexie").Dexie.minKey;g.DEXIE_MAX_KEY=d("MAWDexie").Dexie.maxKey;g.undexify=i;g.dexieSequentialAll=a;g.dexieAll=e;g.dexieAllSettled=f;g.getDexiePSDItem=j;g.setDexiePSDItem=k;g.clearDexiePSDItem=l;g.DexieTable=m;g.dexieResolve=n;g.dexieExpensiveAwait=o}),98);
__d("WASyncdKeyTypes",[],(function(a,b,c,d,e,f){"use strict";function a(a){return a}function b(a){return a}function c(a){return a}function d(a){return a}f.toSyncKeyId=a;f.fromSyncKeyId=b;f.toSyncKeyData=c;f.fromSyncKeyData=d}),66);
__d("WorkerScheduler",["$InternalEnum","Promise","WAGetSafeQPLError","WAPREList","WAPREMetrics","WAResolvable","WAShiftTimer","WATagsLogger","WATimeUtils","err"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Scheduler fatal: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Promoting task ",":"," to blocking priority"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Safeguard: Pending task without corresponding record: Task: ",", Scheduler: ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["Possibly stuck: ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["Safeguard: Active task without corresponding record: Task: ",", Scheduler: ",""]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["Safeguard: Active task without corresponding record: Task: ",", Scheduler: ",""]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["",". Debug params: "," failed: ",""]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed: ",""]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["Completed: ",""]);q=function(){return a};return a}function r(){var a=babelHelpers.taggedTemplateLiteralLoose(["Started: ",""]);r=function(){return a};return a}function s(){var a=babelHelpers.taggedTemplateLiteralLoose(["Safeguard: Task without corresponding record: Task: ",", Scheduler: ",""]);s=function(){return a};return a}function t(){var a=babelHelpers.taggedTemplateLiteralLoose(["Promoting "," from "," to ",""]);t=function(){return a};return a}var u=d("WATagsLogger").TAGS(["WorkerScheduler"]),v=0,w=2,x=1,y=0,z=100,A=3e4,B=10,C=6e4,D=b("$InternalEnum")({CREATED:0,SCHEDULED:1,RUNNING:2,COMPLETED:3,CANCELLED:-3,FAILED:-2,STUCK:-1}),E=function(){function a(a,b){var c;this.$3=!1;this.$4=new Map();this.$5=new Map();this.$6=new Map();this.$7=[new Set(),new Set(),new Set()];this.$8=[new((c=d("WAResolvable")).Resolvable)(),new c.Resolvable(),new c.Resolvable()];this.$9=new c.Resolvable();this.$1=a;this.config=b;this.$2=u.TAGS([a])}var e=a.prototype;e.waitUntilEndReached=function(){return this.$9.promise};e.waitUntilBlockingEnded=function(){return this.$8[y].promise};e.waitUntilRegularEnded=function(){return this.$8[x].promise};e.waitUntilBackgroundEnded=function(){return this.$8[w].promise};e.$10=function(){if(this.$6.size<this.config.maxConcurrency){var a=this.pendingTasksTick({lowestTier:this.$3?w:y,increaseCounter:!1,tasksToPick:1,tickDelta:0});a=a.candidates;var b=G.getHighestActivePriority();a.length>0&&this.maybeStartTask(a[0].id,b)}};e.runTask=function(a){return this.task(a).run()};e.task=function(a){var b,c=this.$1+":"+a.name+":"+v++;b=(b=a.priority)!=null?b:x;b=this.$11(c,{name:a.name,fn:a.fn,priority:b,customFlags:a.customFlags});this.$4.set(c,b);return b.publicApi};e.$12=function(a){var d=this.$4.get(a);if(d==null)return(h||(h=b("Promise"))).reject(c("err")("Cannot run task from Scheduler:"+this.$1+" Task was already cancelled"));d.publicApi.status=D.SCHEDULED;this.$5.set(a,d);this.$7[d.priority].add(a);this.$13(d.priority);d.metric.addPoint("schedule_start");G.scheduleTimerIfNeeded();this.$10();return d.resolvable.promise};e.$11=function(a,b){var c,e=this,f=new(d("WAResolvable").Resolvable)();c=d("WAPREMetrics").startMetric(d("WAPREList").PRE_METRIC.WORKER_SCHEDULER,{string:{scheduler:this.$1,name:b.name},bool:babelHelpers["extends"]({},(c=b.customFlags)!=null?c:{}),"int":{originalPriority:b.priority}});var g={id:a,name:b.name,tickCounter:0,waitCounter:0,resolvable:f,scheduledTime:Date.now(),startTime:null,fn:b.fn,priority:b.priority,maxTickDelta:0,metric:c,loggingParams:{},publicApi:{id:a,promise:f.promise,name:b.name,status:D.CREATED,cancel:function(){if(g.publicApi.status!==D.CREATED&&g.publicApi.status!==D.SCHEDULED)return!1;e.$14(a,D.CANCELLED);return e.$4["delete"](a)},run:function(){return e.$12(a)},promote:function(a){e.$2.DEV(t(),g.id,g.priority,a);if((g.publicApi.status===D.CREATED||g.publicApi.status===D.SCHEDULED)&&g.priority>a){e.$15(g,a);return!0}return!1}}};return g};e.$14=function(a,b){var c=this.$5.get(a),d=c==null?void 0:c.publicApi.status;if(c==null||d===D.COMPLETED||d===D.FAILED||d===D.STUCK)return;this.$5["delete"](a);this.$6["delete"](a);c.publicApi.status=b;var e=[this.$7[y].size===0,this.$7[x].size===0,this.$7[w].size===0];this.$6.forEach(function(a){e[a]=!1});e[y]&&e[x]&&e[w]&&this.$9.resolve();for(d=y;d<=w;d++)e[d]&&this.$8[d].resolve()};e.maybeStartTask=function(a,b){var c=this.$5.get(a);if(c==null){this.$2.ERROR(s(),a,this.$1);return}if(b==null||this.$3===!0)return this.$16(c);if(b<c.priority)return;return this.$16(c)};e.$16=function(a){var c=this;this.$7[a.priority]["delete"](a.id);this.$6.set(a.id,a.priority);this.$2.LOG(r(),a.id);a.startTime=Date.now();a.publicApi.status=D.RUNNING;a.metric.addPoint("schedule_end",{"int":{waitTicks:a.waitCounter,priorityTier:a.priority}});a.metric.addPoint("run_start",{"int":{startPriority:a.priority}});var e;try{e=a.fn({metric:a.metric,setLoggingParam:function(b,c){var d;a.loggingParams[b]=c;a.metric.addAnnotations({string:(d={},d[b]=c,d)})}})}catch(a){e=(h||(h=b("Promise"))).reject(a)}e.then(function(b){a.resolvable.resolve(b),c.$2.LOG(q(),a.id),a.metric.addPoint("run_end",{"int":{executionTicks:a.tickCounter}}),c.$14(a.id,D.COMPLETED),a.metric.endSuccess({"int":{maxTickDeltaMs:a.maxTickDelta}}),c.$10()})["catch"](function(b){a.resolvable.reject(b),c.$2.WARN(p(),a.id),a.metric.addPoint("run_fail"),u.TAGS(["TASK"]).ERROR(o(),a.name,a.loggingParams,b),c.$14(a.id,D.FAILED),a.metric.endFail("runtime",{"int":{maxTickDeltaMs:a.maxTickDelta},string:{jsError:d("WAGetSafeQPLError").getSafeQPLErrorMessage(b)}}),c.$10()})};e.$13=function(a){for(var b=y;b<=a;b++)this.$8[b].resolveWasCalled()&&(this.$8[b]=new(d("WAResolvable").Resolvable)());this.$9.resolveWasCalled()&&(this.$9=new(d("WAResolvable").Resolvable)())};e.getHighestActivePriority=function(){var a=this,b=null;this.$6.forEach(function(c,d){c=a.$5.get(d);if(c==null){u.ERROR(n(),d,a.$1);a.$6["delete"](d);return}(b==null||b>c.priority)&&(b=c.priority)});return b};e.activeTasksTick=function(a){var b=this,e=null;this.$6.forEach(function(f,g){f=b.$5.get(g);if(f==null){u.ERROR(m(),g,b.$1);b.$6["delete"](g);return}f.tickCounter++;f.maxTickDelta=Math.max(a,f.maxTickDelta);(e==null||e>f.priority)&&(e=f.priority);f.tickCounter>b.config.ticksToStuck&&f.publicApi.status===D.RUNNING&&(u.WARN(l(),f.name),d("WAPREMetrics").startMetric(d("WAPREList").PRE_METRIC.WORKER_SCHEDULER_STUCK).endFail(f.name),b.$14(f.id,D.STUCK),f.resolvable.reject(c("err")("Stuck")),f.metric.endFail("stuck",{"int":{maxTickDeltaMs:f.maxTickDelta}}))});return e};e.$15=function(a,b){function c(){switch(d){case w:return x;case x:return y;default:return y}}var d=a.priority;b=(b=b)!=null?b:c();if(b===d)return;a.metric.addPoint("promote_to_"+b);this.$7[d]["delete"](a.id);a.priority=b;this.$7[b].add(a.id)};e.pendingTasksTick=function(a){var b=this,c=a.increaseCounter,d=a.lowestTier,e=a.tasksToPick,f=a.tickDelta,g=[],h=!0;a=function(a){h&&(h=b.$7[a].size===0),b.$7[a].forEach(function(d){var h=b.$5.get(d);if(h==null){u.ERROR(k(),d,b.$1);b.$7[a]["delete"](d);return}c&&(h.waitCounter++,h.maxTickDelta=Math.max(f,h.maxTickDelta),h.priority>x&&h.waitCounter>=b.config.throttleTicks&&b.$15(h),h.priority===x&&h.waitCounter>=G.maxWaitTicksMultiplierForFinalPromotion*b.config.throttleTicks&&(u.LOG(j(),b.$1,h.name),b.$15(h)));if(g.length>=e)return;if(b.$6.size+g.length>=b.config.maxConcurrency)return;g.push(h)})};for(var i=y;i<=d;i++)a(i);return{candidates:g.map(function(a){return{id:a.id,priority:a.priority}}),isEmpty:h}};e.TEST_ONLY_ignore_delays=function(){this.$3=!0};return a}(),F=function(){function a(){var a=this;this.$1=new Map();this.tickFrequencyMs=z;this.maxThrottleMs=C;this.maxWaitTicksMultiplierForFinalPromotion=B;this.$2=null;this.$3=new(d("WAShiftTimer").ShiftTimer)(function(){var b=!1;try{var c,e=d("WATimeUtils").performanceAbsoluteNow();b=a.$4(e-((c=a.$2)!=null?c:e))}catch(a){u.ERROR(i(),a)}finally{b===!1?(a.$2=d("WATimeUtils").performanceAbsoluteNow(),a.$3.onOrBefore(a.tickFrequencyMs)):a.$2=null}});this.$5=new Map()}var b=a.prototype;b.getHighestActivePriority=function(){var a=null;this.$5.forEach(function(b){b=b.getHighestActivePriority();a!=null&&b!=null&&a<b&&(a=b);a==null&&b!=null&&(a=b)});return a};b.$4=function(a){var b,c=!0,d=null;this.$5.forEach(function(b){b=b.activeTasksTick(a);d!=null&&b!=null&&d<b&&(d=b);d==null&&b!=null&&(d=b)});var e=[[],[],[]];this.$5.forEach(function(b){var d=b.pendingTasksTick({increaseCounter:!0,lowestTier:w,tasksToPick:b.config.concurrency,tickDelta:a}),f=d.candidates;d=d.isEmpty;c&&(c=d);f.forEach(function(a){e[a.priority].push({id:a.id,scheduler:b})})});b=(b=e.find(function(a){return a.length>0}))!=null?b:[];for(var b=b,f=Array.isArray(b),g=0,b=f?b:b[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var h;if(f){if(g>=b.length)break;h=b[g++]}else{g=b.next();if(g.done)break;h=g.value}h=h;var i=h.id;h=h.scheduler;h.maybeStartTask(i,d)}return c};b.scheduleTimerIfNeeded=function(){this.$3.onOrBefore(this.tickFrequencyMs)};b.newScheduler=function(a,b){var c=this.$5.get(a);if(c)return c;c=new E(a,b);this.$5.set(a,c);return c};b.TEST_ONLY_reset=function(){this.$5=new Map(),this.$1=new Map()};return a}(),G=new F();function a(a,b){return G.newScheduler(a,{maxConcurrency:b.maxConcurrency,concurrency:(a=b.concurrency)!=null?a:1,ticksToStuck:Math.round(((a=b.timeToStuckMs)!=null?a:A)/G.tickFrequencyMs),throttleTicks:Math.round(((a=b.maxThrottleMs)!=null?a:G.maxThrottleMs)/G.tickFrequencyMs)})}function e(a){a.tickFrequencyMs!=null&&(G.tickFrequencyMs=a.tickFrequencyMs),a.maxThrottleMs!=null&&(G.maxThrottleMs=a.maxThrottleMs),a.maxWaitTicksMultiplierForFinalPromotion!=null&&(G.maxWaitTicksMultiplierForFinalPromotion=a.maxWaitTicksMultiplierForFinalPromotion)}function f(){G.TEST_ONLY_reset()}g.BACKGROUND_PRIORITY=w;g.REGULAR_PRIORITY=x;g.BLOCKING_PRIORITY=y;g.SchedulerExecutionState=D;g.makeScheduler=a;g.configWorkerScheduler=e;g.TEST_ONLY_reset=f}),98);
__d("MAWDbMsgTypeVersionTxns",["MAWDbAppMeta","MAWDexieTable","emptyFunction"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a){return a.appMeta.get({key:d("MAWDbAppMeta").AppMetaKeysEnum.msgTypeVersion}).then(function(a){return a==null?void 0:a.value.msgTypeVersion})}function b(a,b){return a.appMeta.add({key:d("MAWDbAppMeta").AppMetaKeysEnum.msgTypeVersion,value:{msgTypeVersion:b}})}function e(a,b){return a.appMeta.put({key:d("MAWDbAppMeta").AppMetaKeysEnum.msgTypeVersion,value:{msgTypeVersion:b}})}function f(a,b){return a.appMeta.add({key:d("MAWDbAppMeta").AppMetaKeysEnum.hmacKey,value:{hmacKey:b}})}function i(a){return a.appMeta.get({key:d("MAWDbAppMeta").AppMetaKeysEnum.hmacKey}).then(function(a){return a==null?void 0:a.value.hmacKey})}function j(a,b){return a.appMeta.get({key:b})}function k(a,b){return a.appMeta.put({key:d("MAWDbAppMeta").AppMetaKeysEnum.allowSecurityAlert,value:{allowSecurityAlert:b}}).then(c("emptyFunction"))}function l(a,b){return a.appMeta.put({key:d("MAWDbAppMeta").AppMetaKeysEnum.allowSecurityAlertForSelf,value:{allowSecurityAlertForSelf:b}}).then(c("emptyFunction"))}function m(a){return j(a,d("MAWDbAppMeta").AppMetaKeysEnum.allowSecurityAlert).then(function(a){return(a=a==null?void 0:a.value.allowSecurityAlert)!=null?a:!1})}function n(a){return j(a,d("MAWDbAppMeta").AppMetaKeysEnum.allowSecurityAlertForSelf).then(function(a){return(a=a==null?void 0:a.value.allowSecurityAlertForSelf)!=null?a:!0})}function o(a,b){return a.appMeta.add({key:d("MAWDbAppMeta").AppMetaKeysEnum.hotlikeSticker,value:{hotlikeSticker:b}})}function p(a){return d("MAWDexieTable").dexieAll([n(a),m(a)]).then(function(a){var b=a[0];a=a[1];return{allowSecurityAlertForContact:a,allowSecurityAlertForSelf:b}})}g.MSG_TYPE_VERSION=(h=d("MAWDbAppMeta")).AppMetaKeysEnum.msgTypeVersion;g.ALLOW_SECURITY_ALERT_FOR_CONTACT=h.AppMetaKeysEnum.allowSecurityAlert;g.ALLOW_SECURITY_ALERT_FOR_SELF=h.AppMetaKeysEnum.allowSecurityAlertForSelf;g.HOT_LIKE=h.AppMetaKeysEnum.hotlikeSticker;g.getMsgTypeVersion=a;g.addMsgTypeVersion=b;g.updateMsgTypeVersion=e;g.addHMACKey=f;g.getHMACKey=i;g.getAppMetaValue=j;g.updateSecurityAlertValueForContact=k;g.updateSecurityAlertValueForSelf=l;g.getSecuritySettingForContact=m;g.getSecuritySettingForSelf=n;g.addHotLike=o;g.maybeBulkGetSecuritySetting=p}),98);
__d("MAWHMACKey",["MAWCryptoConsts","MAWDbMsgTypeVersionTxns","MAWIndexedDb","MAWKeychainUtil","MAWSubtleCrypto","MAWTransactionMode","WABase64","tweetnacl-auth"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=d("MAWKeychainUtil").getBufferWithRandomValuesFromLength(d("MAWCryptoConsts").HKDF_SEED_LENGTH_IN_BYTES);return i(a).then(function(a){return d("MAWSubtleCrypto").MAWSubtleCrypto.exportKey("raw",a)})}function a(a,b){a=new TextEncoder().encode(a);b=new Uint8Array(b);a=c("tweetnacl-auth")(a,b);return d("WABase64").encodeB64UrlSafe(a)}function b(){return h().then(function(a){return d("MAWIndexedDb").makeMsgrTransactor({appMeta:d("MAWTransactionMode").READWRITE},"generateAndInsertHMACKey",function(b){return function(){return d("MAWDbMsgTypeVersionTxns").getHMACKey(b).then(function(c){return c!=null?c:d("MAWDbMsgTypeVersionTxns").addHMACKey(b,a).then(function(){return a})})}})()})}function i(a){return d("MAWSubtleCrypto").MAWSubtleCrypto.importKey("raw",a,{hash:"SHA-256",name:"HMAC"},!0,["sign"])}g.genHMACKey=h;g.hmacTweetNaCl=a;g.generateAndInsertHMACKey=b}),98);
__d("MAWMediaUtils",["FBLogger","MAWDbMedia","MAWDexieTable","MAWHMACKey","MAWImageUtils","MAWMediaGalleryM2Utils","MAWMsgType","WABlobToArrayBuffer","WAGlobals","WAHashUtils","WAMsgType","WATimeUtils","asyncToGeneratorRuntime","err","justknobx"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){b===void 0&&(b="media");switch(a){case d("MAWDbMedia").MEDIA_TYPE.IMAGE:return b==="xma-media"?"xma-image":"image";case d("MAWDbMedia").MEDIA_TYPE.VIDEO:return"video";case d("MAWDbMedia").MEDIA_TYPE.PTT:return"ptt";case d("MAWDbMedia").MEDIA_TYPE.GIF:return"gif";case d("MAWDbMedia").MEDIA_TYPE.STICKER:return"sticker";case d("MAWDbMedia").MEDIA_TYPE.DOCUMENT_FILE:return"document";default:throw c("err")("get a wrong media file with type "+a)}}function h(a){try{return d("WABlobToArrayBuffer").blobToArrayBuffer(a).then(i)}catch(a){throw c("err")("Got "+a+" when convert the blob to Uint8Array")}}function i(a){return self.crypto.subtle.digest("SHA-256",a).then(function(a){return new Uint8Array(a)})}function e(a){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=(yield h(a));a=d("WAHashUtils").toPlaintextHash(a);var b=k(a);return[a,b]});return j.apply(this,arguments)}function k(a){var b=d("WAGlobals").getHMACKey();return d("WAHashUtils").toHashedPlaintextHash(d("MAWHMACKey").hmacTweetNaCl(a,b))}function f(a){if(a==null)return null;var b="preview-"+d("WATimeUtils").unixTime().toString()+".jpeg";return l(a,b,"image/jpeg")}function l(a,b,c){return new File([new Blob([new Uint8Array(a)],{type:c})],b,{type:c})}function m(a,b,c){var e=function(){return c!=null?d("MAWDexieTable").dexieResolve(c.filter(function(a){return a.type!==d("WAMsgType").REVOKED&&b.msgIds.includes(a.msgId)})):a.messages.where("msgId").anyOf(b.msgIds).filter(function(a){return a.type!==d("WAMsgType").REVOKED}).toArray()};return e().then(function(a){return o(b,a)})}function n(a){return a.reduce(function(a,b){var c=b.hdType;c!=null&&(a[b.msgId]=c);return a},{})}function o(a,b){b=b.filter(function(b){return b.type!==d("WAMsgType").REVOKED&&a.msgIds.includes(b.msgId)});var e=b.map(function(a){return a.msgId});e=babelHelpers["extends"]({},a,{msgIds:e});var f=b.reduce(function(a,b){a[b.msgId]=d("WATimeUtils").castToMillisTime(b.sortOrderMs!=null?b.sortOrderMs:b.ts*1e3);return a},{});e=babelHelpers["extends"]({},e,{messagesSortOrderMs:f});if(b.every(function(a){return a.type===d("WAMsgType").STICKER})&&c("justknobx")._("2932")&&d("MAWMediaGalleryM2Utils").isMediaGalleryM2Enabled()){f=d("MAWImageUtils").boundHeightWidth(e.previewHeight,e.previewWidth,d("MAWImageUtils").STICKER_THUMBNAIL_MAX_SIZE);var g=f.height;f=f.width;e=babelHelpers["extends"]({},e,{mediaType:d("MAWDbMedia").MEDIA_TYPE.STICKER,previewHeight:g,previewHeightLarge:g,previewWidth:f,previewWidthLarge:f})}g=new Set(b.map(function(a){return a.type}));g.forEach(function(b){if(b===d("MAWMsgType").MSG_TYPE.RAVEN)return;a.mediaType!==p(b)&&c("FBLogger")("messenger_e2ee_web").mustfix("Message and media type mismatch: message with type %s is associated with media with type %s",b,a.mediaType)});return e}function p(a){switch(a){case d("MAWMsgType").MSG_TYPE.IMAGE:return d("MAWDbMedia").MEDIA_TYPE.IMAGE;case d("MAWMsgType").MSG_TYPE.VIDEO:return d("MAWDbMedia").MEDIA_TYPE.VIDEO;case d("MAWMsgType").MSG_TYPE.PTT:return d("MAWDbMedia").MEDIA_TYPE.PTT;case d("MAWMsgType").MSG_TYPE.GIF:return d("MAWDbMedia").MEDIA_TYPE.GIF;case d("MAWMsgType").MSG_TYPE.STICKER:return d("MAWDbMedia").MEDIA_TYPE.STICKER;case d("MAWMsgType").MSG_TYPE.DOCUMENT_FILE:return d("MAWDbMedia").MEDIA_TYPE.DOCUMENT_FILE}}g.getServerMediaTypeFromMediaType=a;g.hashBlob=h;g.hashArrayBuffer=i;g.genBlobHashes=e;g.genHMACPlaintextHash=k;g.convertJpegThumbnailArrayBufferToFile=f;g.getBridgeMediaAnnotatedForDisplay=m;g.createHdTypesForBridgeMedia=n;g.annotateBridgeMediaForDisplay=o;g.getMediaTypeFromMsgType=p}),98);
__d("WAErrorMessage",[],(function(a,b,c,d,e,f){"use strict";var g="NoErrorMessageProvided";function a(a){if(typeof a==="string")return a;if(a instanceof Error)return a.toString();if(typeof a==="object")if(typeof (a==null?void 0:a.description)==="string")return a.description;else if(typeof (a==null?void 0:a.message)==="string")return a.message;return g}f.NO_ERROR_MESSAGE_PROVIDED=g;f.maybeGetMessageFromError=a}),66);
__d("MAWDbChunkTxns",["MAWDexieTable","MAWMediaUtils","MAWODSProxy","WAErrorMessage","WAOdsEnums","WATagsLogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to add chunk. Possible duplicate? Will attempt a retry. For hashedPlaintextHash: ",". Error: ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to add chunk after retry. Error: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to add chunk for hashedPlaintextHash: ",". Error: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Chunk found after retry for hashedPlaintextHash: ",""]);k=function(){return a};return a}var l=d("WATagsLogger").TAGS(["MAWDbChunkTxns"]);b=function(a,b,c,e,f){f===void 0&&(f=0);var g=d("MAWMediaUtils").genHMACPlaintextHash(b);return m(a,b,g,c,e,f)};var m=function a(b,c,e,f,g,m){m===void 0&&(m=0);return b.chunk.where("hashedPlaintextHash").equals(e).first().then(function(n){if(n){m>0&&l.LOG(k(),e);return n}else{var o={blobData:f,hashedPlaintextHash:e,mimetype:g,plaintextHash:c};return b.chunk.add(o).then(function(a){return babelHelpers["extends"]({},o,{chunkId:a})})["catch"](function(k){var n=d("WAErrorMessage").maybeGetMessageFromError(k);if(m>0){l.WARN(j(),e,n);l.ERROR(i(),n);throw k}else{l.WARN(h(),e,n);d("MAWODSProxy").odsBumpEntityKey({amount:1,entity:d("WAOdsEnums").Entity.MAW_MEDIA_DB_DUPLICATE_CHUNK,key:"retry"});return a(b,c,e,f,g,m+1)}})}})},n=function(a,b){return a.chunk.where("hashedPlaintextHash").equals(b)},o=function(a,b){return n(a,b).count().then(function(a){return a>0})};c=function(a,b){return d("MAWDexieTable").dexieAll(b.map(function(b){return o(a,b).then(function(a){return[b,a]})})).then(function(a){return new Map(a)})};e=function(a,b){return n(a,b).first()};f=function(a,b){return a.chunk.where("hashedPlaintextHash").anyOf(b).toArray().then(function(a){return new Map(a.map(function(a){return[a.hashedPlaintextHash,a]}))})};function a(a,b){return a.chunk.bulkGet(b)}var p=function(a,b){b=d("MAWMediaUtils").genHMACPlaintextHash(b);return a.chunk.get({hashedPlaintextHash:b})};g.getOrCreateMediaChunkWithPlaintextHash=b;g.getOrCreateMediaChunkWithHashedPlaintextHash=m;g.hasMediaChunk=o;g.hasMediaChunks=c;g.maybeGetChunkFromHash=e;g.maybeBulkGetChunksFromHash=f;g.bulkGetChunks=a;g.maybeGetChunkByPlaintextHash=p}),98);
__d("MAWLoadReplyMediaTxns",["ExecutionEnvironment","MAWBridgeReceiverFetchInfo","MAWDbChunkTxns","MAWDbMedia","MAWDbMsg","MAWDbXMATxns","MAWDexieTable","MAWIndexedDb","MAWJidUtils","MAWMediaUtils","MAWMsgType","MAWUserJidWrapper","MAWXMAUtils","MWPBumpEntityKey","WAAssertUnreachable","WAJids","WALogger","WAMsgType","WAResultOrError","gkx","justknobx","qex"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Invalid msg for getReplyMediaForReceiverFetch with type: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Missing msgId for getReplyMediaForReceiverFetch"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Unable to convert receiver fetch id to media id: ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["Missing receiverFetchInfo for getReplyMediaForReceiverFetchWithReceiverFetchId"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["Missing receiverFetchId for getReplyMediaForReceiverFetchWithReceiverFetchId"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["Unable to fetch reply media XMA with id ",": ",""]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["Unable to fetch reply media with id ",": ",""]);o=function(){return a};return a}function p(a,b,e){if(c("gkx")("2419")&&e!=null){e=d("MAWMediaUtils").genHMACPlaintextHash(e);return a.media.where("hashedPlaintextHash").equals(e).first()}else return a.media.get(b)}function q(a,b,c){if(c!=null){c=d("MAWMediaUtils").genHMACPlaintextHash(c);return a.media.where("hashedPlaintextHash").equals(c).first().then(function(b){return b==null?[void 0,void 0]:d("MAWDbChunkTxns").maybeGetChunkFromHash(a,b.hashedPlaintextHash).then(function(a){return a==null?[void 0,b]:[a,b]})})}else return a.media.get(b).then(function(b){return b==null?[void 0,void 0]:d("MAWDbChunkTxns").maybeGetChunkFromHash(a,b.hashedPlaintextHash).then(function(a){return a==null?[void 0,b]:[a,b]})})}var r=new Set([(e=d("MAWDbMedia")).MEDIA_TYPE.IMAGE,e.MEDIA_TYPE.GIF,e.MEDIA_TYPE.PTT,e.MEDIA_TYPE.STICKER,e.MEDIA_TYPE.VIDEO,e.MEDIA_TYPE.DOCUMENT_FILE]);function s(a){var b;switch(a.mediaType){case d("MAWDbMedia").MEDIA_TYPE.IMAGE:case d("MAWDbMedia").MEDIA_TYPE.GIF:case d("MAWDbMedia").MEDIA_TYPE.STICKER:b=a.validatedImageInfo;break;case d("MAWDbMedia").MEDIA_TYPE.VIDEO:b=a.validatedVideoInfo;break}a=b||{};var c=a.height,e=a.jpegThumbnailHeight,f=a.jpegThumbnailWidth;a=a.width;return{replyMediaPreviewHeight:(e=e)!=null?e:c,replyMediaPreviewWidth:(e=f)!=null?e:a}}function t(a){switch(a.type){case d("MAWMsgType").MSG_TYPE.IMAGE:case d("MAWMsgType").MSG_TYPE.VIDEO:case d("MAWMsgType").MSG_TYPE.PTT:case d("MAWMsgType").MSG_TYPE.GIF:case d("MAWMsgType").MSG_TYPE.STICKER:case d("MAWMsgType").MSG_TYPE.DOCUMENT_FILE:case d("MAWMsgType").MSG_TYPE.RECEIVER_FETCH:return!0;case d("MAWMsgType").MSG_TYPE.XMA:if(c("gkx")("9921"))return!0;else return d("MAWXMAUtils").isXMAShare_DO_NOT_USE(a.xmaMessageType)||c("justknobx")._("2919")&&d("MAWXMAUtils").isXMAStoryReply(a.xmaMessageType);case d("MAWMsgType").MSG_TYPE.TEXT:case d("MAWMsgType").MSG_TYPE.UNAVAILABLE:case d("MAWMsgType").MSG_TYPE.REVOKED:case d("MAWMsgType").MSG_TYPE.EXPIRED_EPHEMERAL:case d("MAWMsgType").MSG_TYPE.GROUP_INVITE:case d("MAWMsgType").MSG_TYPE.CIPHERTEXT:case d("WAMsgType").NOTE_REPLY:case d("MAWMsgType").MSG_TYPE.BUMP_EXISTING_MESSAGE:case d("MAWMsgType").MSG_TYPE.RAVEN:return!1;default:return c("WAAssertUnreachable")(a.type)}}function u(a,b,e){var f;if(b==null)return d("MAWDexieTable").dexieResolve();f=(f=c("qex")._("237"))!=null?f:!1;f=f?p(a,b,e).then(function(a){if(a==null)return d("WAResultOrError").makeError("reply_media_not_found");if(!r.has(a.mediaType))return d("WAResultOrError").makeError("reply_media_type_unknown");var c=s(a),e=c.replyMediaPreviewHeight;c=c.replyMediaPreviewWidth;b!=null&&a.plaintextHash==null&&d("MWPBumpEntityKey").bumpEntityKeyWithAppId("maw.reply_attachment_media_missing_plaintext_hash","load_reply_media_txns_for_reply_type_unknown}");return d("WAResultOrError").makeResult({replyMediaId:b,replyMediaPreviewHeight:e,replyMediaPreviewWidth:c,replyPlaintextHash:a.plaintextHash})}):q(a,b,e).then(function(a){var c=a[0];a=a[1];if(a==null)return d("WAResultOrError").makeError("reply_media_not_found");if(!r.has(a.mediaType))return d("WAResultOrError").makeError("reply_media_type_unknown");var e=s(a),f=e.replyMediaPreviewHeight;e=e.replyMediaPreviewWidth;var g;c!=null&&(g=c.mimetype);if(b!=null&&a.plaintextHash==null){d("MWPBumpEntityKey").bumpEntityKeyWithAppId("maw.reply_attachment_media_missing_plaintext_hash","load_reply_media_txns_for_reply_type_"+((c=g)!=null?c:"unknown"))}return d("WAResultOrError").makeResult({replyMediaId:b,replyMediaPreviewHeight:f,replyMediaPreviewWidth:e,replyMediaUrlMimeType:g,replyPlaintextHash:a.plaintextHash})});return f.then(function(a){if(a.success!==!0){d("WALogger").ERROR(o(),b,a.error);return}return a.value})}function v(a,b){var e,f=b.defaultPreviewMediaId;if(f==null)return d("MAWDexieTable").dexieResolve({replyXMAId:b.xmaId});e=(e=c("qex")._("237"))!=null?e:!1;e=e?a.media.get(f).then(function(a){if(a==null)return d("WAResultOrError").makeError("reply_xma_media_not_found");if(!r.has(a.mediaType))return d("WAResultOrError").makeError("reply_xma_media_type_unknown");var c=s(a),e=c.replyMediaPreviewHeight;c=c.replyMediaPreviewWidth;return d("WAResultOrError").makeResult({replyMediaPreviewHeight:e,replyMediaPreviewWidth:c,replyPlaintextHash:a.plaintextHash,replyXMAId:b.xmaId})}):q(a,f).then(function(a){var c=a[0];a=a[1];if(c==null||a==null)return d("WAResultOrError").makeError("reply_xma_media_not_found - "+b.targetType);if(!r.has(a.mediaType))return d("WAResultOrError").makeError("reply_xma_media_type_unknown");var e=s(a),f=e.replyMediaPreviewHeight;e=e.replyMediaPreviewWidth;return d("WAResultOrError").makeResult({replyMediaPreviewHeight:f,replyMediaPreviewWidth:e,replyMediaUrlMimeType:c.mimetype,replyPlaintextHash:a.plaintextHash,replyXMAId:b.xmaId})});return e.then(function(a){if(a.success!==!0){d("WALogger").ERROR(n(),b.xmaId,a.error);return}return a.value})}function a(a,b,e){var f,g;e===void 0&&(e=!1);f=((f=b.quote)==null?void 0:f.content)||{};var h=f.author,i=f.externalId,j=f.mediaId,k=f.msgId,l=f.plaintextHash,m=f.type;f=f.xmaMessageType;if(((g=b.quote)==null?void 0:g.content)==null||!t((g=b.quote)==null?void 0:g.content))return d("MAWDexieTable").dexieResolve();g=b.threadJid;b=h===d("MAWUserJidWrapper").getMyUserJid();b=b?d("WAJids").AUTHOR_ME:h;if(c("gkx")("9921")?m===d("MAWMsgType").MSG_TYPE.XMA:d("MAWXMAUtils").isXMAShare_DO_NOT_USE(f))return w(a,d("MAWJidUtils").maybeToProtocolMsgId(b,g,i));return m===d("MAWMsgType").MSG_TYPE.RECEIVER_FETCH?y(a,k):u(a,j,e?null:l)}function w(a,b){return b==null?d("MAWDexieTable").dexieResolve():d("MAWDbXMATxns").maybeGetXMAFromProtocolMsgId(a,b).then(function(b){if(b==null||d("MAWXMAUtils").isXMAExpired(b.isTombstoned,b.targetExpiringAtSec))return;return v(a,b)})}function b(a,b){var c=b.author,e=b.externalId,f=b.mediaId,g=b.plaintextHash,h=b.threadJid,i=b.type,j=b.xmaMessageType;j=d("MAWXMAUtils").isXMAShare_DO_NOT_USE(j);i=i===d("MAWMsgType").MSG_TYPE.RECEIVER_FETCH;if(!d("MAWDbMsg").isMediaMsg(b)&&!j&&!i)return d("MAWDexieTable").dexieResolve();if(j)return w(a,d("MAWJidUtils").maybeToProtocolMsgId(c,h,e));return i?x(a,b.receiverFetchId):u(a,f,g)}function x(a,b,e){if(b==null){d("WALogger").ERROR(m());return d("MAWDexieTable").dexieResolve()}return a.receiverFetchInfo.get({receiverFetchId:b}).then(function(a){if(a==null){d("WALogger").WARN(l());return}try{var b,f=d("MAWDbMedia").convertNumberToMediaId(parseInt(a.receiverFetchId,10));b=(b=c("qex")._("237"))!=null?b:!1;e!=null&&(!b||(h||(h=c("ExecutionEnvironment"))).isInWorker)&&d("MAWIndexedDb").afterTransaction({tag:"NewReceiverFetchInfo",value:d("MAWBridgeReceiverFetchInfo").createBridgeReceiverFetchInfoPayloadFromDbInfo(e,a)});return{replyMediaId:f,replyMediaPreviewHeight:a.previewHeight,replyMediaPreviewWidth:a.previewWidth,replyMediaUrlMimeType:a.mimetype}}catch(a){d("WALogger").ERROR(k(),a);return}})}function y(a,b){if(b==null){d("WALogger").ERROR(j());return d("MAWDexieTable").dexieResolve()}return a.messages.get({msgId:b}).then(function(b){if(b==null||b.type!==d("MAWMsgType").MSG_TYPE.RECEIVER_FETCH||b.receiverFetchId==null){d("WALogger").ERROR(i(),b==null?void 0:b.type);return}return x(a,b.receiverFetchId,b)})}g.getMedia=p;g.getMediaAndChunk=q;g.MSG_MEDIA_TYPE=r;g.getImageAttributes=s;g.isMediaReplyContent=t;g.getReplyMediaForMsgQuote=a;g.getReplyMediaForMsg=b}),98);
__d("WAMsgMap",[],(function(a,b,c,d,e,f){"use strict";a=function(){function a(a){var b=this;this.$1=new Map();a==null?void 0:a.forEach(function(a){var c=a[0];a=a[1];b.set(c,a)})}var b=a.prototype;b.clear=function(){this.$1.clear()};b["delete"]=function(a){var b;(b=this.$1.get(a.externalId))==null?void 0:(b=b.get(a.author))==null?void 0:b["delete"](a.chat)};b.get=function(a){var b;return(b=this.$1.get(a.externalId))==null?void 0:(b=b.get(a.author))==null?void 0:b.get(a.chat)};b.has=function(a){var b;return(b=(b=this.$1.get(a.externalId))==null?void 0:(b=b.get(a.author))==null?void 0:b.has(a.chat))!=null?b:!1};b.set=function(a,b){var c,d;c=(c=this.$1.get(a.externalId))!=null?c:new Map();this.$1.has(a.externalId)||this.$1.set(a.externalId,c);d=(d=c.get(a.author))!=null?d:new Map();c.has(a.author)||c.set(a.author,d);d.set(a.chat,b);return this};b.keys=function(){var a=[],b=this.$1;for(var c=b.keys(),d=Array.isArray(c),e=0,c=d?c:c[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var f,g;if(d){if(e>=c.length)break;g=c[e++]}else{e=c.next();if(e.done)break;g=e.value}g=g;f=(f=b.get(g))!=null?f:new Map();for(var h=f.keys(),i=Array.isArray(h),j=0,h=i?h:h[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var k,l;if(i){if(j>=h.length)break;l=h[j++]}else{j=h.next();if(j.done)break;l=j.value}l=l;k=(k=f.get(l))!=null?k:new Map();for(var k=k.keys(),m=Array.isArray(k),n=0,k=m?k:k[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var o;if(m){if(n>=k.length)break;o=k[n++]}else{n=k.next();if(n.done)break;o=n.value}o=o;a.push({externalId:g,author:l,chat:o})}}}return a};b.entries=function(){var a=[],b=this.$1;for(var c=b.keys(),d=Array.isArray(c),e=0,c=d?c:c[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var f,g;if(d){if(e>=c.length)break;g=c[e++]}else{e=c.next();if(e.done)break;g=e.value}g=g;f=(f=b.get(g))!=null?f:new Map();for(var h=f.keys(),i=Array.isArray(h),j=0,h=i?h:h[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var k,l;if(i){if(j>=h.length)break;l=h[j++]}else{j=h.next();if(j.done)break;l=j.value}l=l;k=(k=f.get(l))!=null?k:new Map();for(var m=k.keys(),n=Array.isArray(m),o=0,m=n?m:m[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var p;if(n){if(o>=m.length)break;p=m[o++]}else{o=m.next();if(o.done)break;p=o.value}p=p;var q=k.get(p);q!=null&&a.push([{externalId:g,author:l,chat:p},q])}}}return a};b.values=function(){return this.entries().map(function(a){return a[1]})};return a}();f.MsgMap=a}),66);
__d("MAWDbMsgUtil",["WAJids","WALogger","WAMsgMap"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Invalid author when converting msg array to map"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Missing jid prevents adding message to array map"]);i=function(){return a};return a}function a(a){return a.reduce(function(a,b){var c=b.threadJid;if(c==null){d("WALogger").ERROR(i());return a}if(b.author==="@system"){d("WALogger").ERROR(h());return a}a.set({author:b.author,chat:c,externalId:b.externalId},b);return a},new(d("WAMsgMap").MsgMap)())}function b(a){return d("WAJids").isAuthorSystem(a.author)||a.threadJid==null?null:{author:a.author,chat:a.threadJid,externalId:a.externalId}}g.convertMsgArrayToMap=a;g.getProtocolMsgIdFromDbMsg=b}),98);
__d("MAWDbUnrenderedMsgTxns",["MAWAckLevel","MAWDbMsg","MAWDbMsgUtil","MAWDexieTable","WAJids","WALogger","WAMsgMap","WAResultOrError"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["bulkUpdateSystemAck on sent message"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["bulkUpdateSystemAck on incoming message"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["updateSystemAckForUnrenderedMsg on non existing message"]);j=function(){return a};return a}function a(a,b){var c=b.author,e=b.chat,f=b.externalId;return a.threads.get({jid:e}).then(function(b){return b==null?d("WAResultOrError").makeError("missing_thread_unrendered_msg"):k(a,f,e,c).then(function(a){return a==null?d("WAResultOrError").makeError("missing_unrendered_msg"):d("WAResultOrError").makeResult(a)})})}function b(a,b){var c=b.map(function(a){a=a.externalId;return a});return a.unrenderedMessages.where("externalId").anyOf(c).toArray().then(function(a){var c=d("MAWDbMsgUtil").convertMsgArrayToMap(a),e=new(d("WAMsgMap").MsgMap)();b.forEach(function(a){var b=c.get(a);b!=null&&e.set(a,b)});return e})}function k(a,b,c,d){return a.unrenderedMessages.where("externalId").equals(b).filter(function(a){return a.author===d&&a.threadJid===c}).first()}function l(a,b){return a+"_"+b}function c(a,b){var c=b.map(function(a){a=a.externalId;return a}),e=Array.from(new Set(b.map(function(a){return a.chat})));return d("MAWDexieTable").dexieAll([a.threads.where("jid").anyOf(e).toArray(),a.unrenderedMessages.where("externalId").anyOf(c).toArray()]).then(function(a){var c=a[0];a=a[1];if(a.length===0||c.length===0)return[];var d=new Map();b.forEach(function(a){var b=a.author,c=a.chat;a=a.externalId;var e=d.get(a)||new Set();e.add(l(b,c));d.set(a,e)});return a.filter(function(a){var b=a.author,c=a.externalId;a=a.threadJid;c=d.get(c);return c!=null&&a!=null&&c.has(l(b,a))})})}function e(a,b,c){return m(a,[{ack:c,msgId:b}]).then(function(a){a=a[0];if(a==null){d("WALogger").LOG(j());return null}return a})}function m(a,b){var c=b.map(function(a){return a.msgId}),e=new Map();b.forEach(function(a){return e.set(a.msgId,{ack:a.ack})});return a.unrenderedMessages.where("msgId").anyOf(c).toArray().then(function(b){if(b.length===0)return b;var c=[],f=[];b.forEach(function(a){var b;if(a.author!==d("WAJids").AUTHOR_ME){d("WALogger").ERROR(i());c.push(a);return}if(a.ack>d("MAWAckLevel").ACK.clock){d("WALogger").LOG(h());c.push(a);return}b=(b=e.get(a.msgId))==null?void 0:b.ack;if(b==null)return null;a=babelHelpers["extends"]({},a,{ack:b});b===d("MAWAckLevel").ACK.sent&&delete a.resendCount;f.push(a)});return a.unrenderedMessages.bulkPut(f).then(function(){return[].concat(f,c)})})}function f(a,b){b=b.map(function(b){return a.unrenderedMessages.get({msgId:b})});return d("MAWDexieTable").dexieAll(b)}function n(a,b){return a.unrenderedMessages.where("msgId").between(d("MAWDbMsg").msgIdsInChatLowerBound(b.chatId),d("MAWDbMsg").msgIdsInChatUpperBound(b.chatId)).last().then(function(a){a=a==null?0:d("MAWDbMsg").getInChatMsgIdFromMsgId(a.msgId);return a+1})}g.maybeGetUnrenderedMsgByProtocolMsgId=a;g.getUnrenderedMsgMapByProtocolMsgId=b;g.maybeGetUnrenderedMsgByExternalId=k;g.getUnrenderedMsgsByProtocolMsgId=c;g.updateSystemAckForUnrenderedMsg=e;g.bulkUpdateSystemAckForUnrenderedMsgs=m;g.getUnrenderedMsgsByMsgIds=f;g.getNextUnrenderedMsgIdNumberForThread=n}),98);
__d("MAWMessageSortOrderUtils",["I64","MAWDbMsg","MAWExtractMsFromExternalId","WALogger"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[sortOrder] externalId is not a valid int64"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[sortOrder] Timestamp bits in externalId not valid"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[sortOrder] ExternalId is not present"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["generateAuthoritativeMessageSortOrder called without ID"]);l=function(){return a};return a}function a(a){var b=a.revokedExternalId!=null?a.revokedExternalId:a.externalId;b==null&&d("WALogger").ERROR(l());b=(h||(h=d("I64"))).of_string_opt(b);if(a.serverTs==null){var c;if(a.sortOrderMs!=null)return a.sortOrderMs;b==null&&d("WALogger").WARN(k());var e=b==null?null:d("MAWExtractMsFromExternalId").extractMsFromExternalId(b);return Math.floor((c=a.originalTs)!=null?c:d("MAWDbMsg").getCanonicalTsFromMsg(a))*1e3+((c=e)!=null?c:0)}if(b!=null){e=d("MAWExtractMsFromExternalId").extractMsFromExternalId(b);if(e!=null){c=a.originalTs!=null?a.originalTs:a.serverTs;return Number(c)*1e3+e}else d("WALogger").WARN(j())}else d("WALogger").WARN(i());return d("MAWDbMsg").getSortOrderWithFallback(a)}g.generateAuthoritativeMessageSortOrder=a}),98);
__d("WAArrayGroupBy",[],(function(a,b,c,d,e,f){"use strict";function a(a,b){var c=new Map();for(var d=0;d<a.length;d++){var e=b(a[d]),f=c.get(e);f==null?c.set(e,[a[d]]):f.push(a[d])}return Array.from(c.entries())}f.groupBy=a}),66);
__d("MAWDbMsgTxns",["EncryptedBackupsUtils","FBLogger","MAWAckLevel","MAWBridgeMsg","MAWDbMsg","MAWDbMsgUtil","MAWDbThreadTxns","MAWDbUnrenderedMsgTxns","MAWDbXMATxns","MAWDexieTable","MAWIndexedDb","MAWJidUtils","MAWLoadReplyMediaTxns","MAWMessageSortOrderUtils","MAWMessagesDirection","MAWMsgType","MAWODSProxy","MAWUpdateThreadMsgMetadataApi","Random","WAArrayGroupBy","WAJids","WALogger","WAMsg","WAMsgMap","WAOdsEnums","WAResultOrError","WATimeUtils","emptyFunction","err","gkx","justknobx","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Successfull deleted "," messages"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["updateMediaId on message "," that already has this mediaId ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Replacing mediaId for message with pre-existing media. type=",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["updateMediaId on message "," that already has this mediaId ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["getFutureproofMsg gets a message "," with unsupported type ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["getMsgsFromOffset() newest msg thread jid is not equal to thread jid.\n            msg.threadJid: ",",\n            thread.jid: ",",\n            thread.chatId: ",",\n            offsetMsgId: ","."]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["getMsgsFromOffset input: offsetMsgId: ",", numMsgs: ",", includeOffset: ",", includeExpired: ",", direction: ",", sortOrderMsLimit: ",""]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["Message was acked by server (serverTs = ","), override sortOrderMs: "," -> ",""]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["bulkUpdateSystemAck: not updating ",""]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["updateSystemAck on non existing message"]);q=function(){return a};return a}function r(){var a=babelHelpers.taggedTemplateLiteralLoose(["[maybeGetMsgByProtocolMsgId] Suspected multiple instances of same message!"]);r=function(){return a};return a}function s(){var a=babelHelpers.taggedTemplateLiteralLoose(["[maybeGetMsgByProtocolMsgId] Can't have "," messages with the same protocolMsgId!"]);s=function(){return a};return a}function t(){var a=babelHelpers.taggedTemplateLiteralLoose(["[CacheDiscrepancy] Thread "," has a discrepancy between the cached and uncached values for field: ",". Cached value: ",", uncached value: ",".\n        Cached msgType: ",", uncached msgType: ",".\n        Cached ts: ",", uncached sortOrderMs: ","."]);t=function(){return a};return a}function a(a,b){return b==null?d("MAWDexieTable").dexieResolve():a.messages.get({msgId:b})}function b(a,b){return a.messages.where("threadJid").equals(b).count().then(function(a){return a===0})}function e(a,b){return a.messages.where("threadJid").equals(b).filter(function(a){return a.type!==d("MAWMsgType").MSG_TYPE.ADMIN}).toArray()}function u(a,b,c,e,f,g){d("WALogger").LOG(t(),a.jid,b,c,e,f==null?void 0:f.type,g==null?void 0:g.type,a.newestMsgTs,g==null?void 0:g.sortOrderMs)}function v(a,b,c,e){return e.then(function(e){if(e==null&&c==null||e===d("WATimeUtils").castToMillisTime(0)||e!=null&&c!=null&&Math.floor(e/1e3)===c/1e3)return;u(a,b,c,e,null,null)})}function w(a){switch(a){case"newestMsgTs":return d("Random").coinflip(c("justknobx")._("2537"))}}function x(a,b){b=w(b);var c=!1;switch(a){case"query_by_sortOrderMs":c=!0;break;case"use_cached_fields":c=!1;break}return{isCacheBypassed:c,isLoggingExpected:b}}function y(a,b,c,d){return a.messages.where(["threadJid","sortOrderMs"]).between([b,Number.MIN_SAFE_INTEGER],[b,Number.MAX_SAFE_INTEGER],c,d)}function z(a,b){return y(a,b,!1,!1).last()}function f(a,b){return z(a,b).then(function(a){return a==null?void 0:a.msgId})}function A(a,b,c){c===void 0&&(c="query_by_sortOrderMs");var e="newestMsgTs";c=x(c,e);var f=c.isCacheBypassed;c=c.isLoggingExpected;var g=b.newestMsgTs;a=z(a,b.jid).then(function(a){return(a==null?void 0:a.sortOrderMs)==null?null:d("WATimeUtils").castToMillisTime(a.sortOrderMs)});c&&v(b,e,g,a);return f?a:d("MAWDexieTable").dexieResolve(g)}function B(a,b,c){return y(a,b,!1,!1).reverse().limit(c).toArray()}function C(a,b){return y(a,b,!1,!1).first()}function D(a,b){return C(a,b).then(function(a){return a==null?void 0:a.msgId})}function E(a,b){return a.messages.where("externalId").equals(b.externalId).filter(function(a){return a.author===b.author&&a.threadJid===b.chat}).toArray().then(G)}function F(a,b){var c=new Set(b.map(function(a){var b=a.author,c=a.chat;a=a.externalId;return d("WAMsg").craftWAMsgIdString({author:b,chat:c,externalId:a})}));return a.messages.where("externalId").anyOf(b.map(function(a){a=a.externalId;return a})).filter(function(a){var b=a.author,e=a.externalId;a=a.threadJid;return c.has(d("WAMsg").craftWAMsgIdString({author:b,chat:a,externalId:e}))}).toArray().then(function(a){return d("WAArrayGroupBy").groupBy(a,function(a){return d("WAMsg").craftWAMsgIdString({author:a.author,chat:a.threadJid,externalId:a.externalId})}).map(function(a){a[0];a=a[1];return G(a)}).filter(Boolean)})}function G(a){if(a.length>1){var b=a.map(function(a){var b;return a.type+":"+((b=a.serverTs)!=null?b:0).toString()+":"+((b=a.ts)!=null?b:0).toString()});b=new Set(b).size===1;!b?d("WALogger").ERROR(s(),a.length):d("WALogger").ERROR(r());(c("gkx")("5039")||d("Random").coinflip(c("justknobx")._("3594")))&&H(a)}return a[0]}function H(a){var b=a.length;if(b<=1)return;var e=b-1,f=a[e],g={editCount:0,mediaId:0,revokedStatus:0,serverTs:0,sortOrderMs:0,ts:0,type:0};a.slice(0,e).forEach(function(a){var b=[];if((a==null?void 0:a.editCount)!==(f==null?void 0:f.editCount)){var e;g.editCount++;b.push("editCount, reference: "+((e=f==null?void 0:f.editCount)!=null?e:"")+", duplicate: "+((e=a==null?void 0:a.editCount)!=null?e:"")+". ")}(a==null?void 0:a.mediaId)!==(f==null?void 0:f.mediaId)&&(g.mediaId++,b.push("mediaId, reference: "+((f==null?void 0:f.mediaId)!=null?String(f.mediaId):"")+", duplicate: "+((a==null?void 0:a.mediaId)!=null?String(a.mediaId):"")+". "));a.sortOrderMs!==f.sortOrderMs&&(g.sortOrderMs++,b.push("sortOrderMs, reference: "+String(f.sortOrderMs)+", duplicate: "+String(a.sortOrderMs)+". "));a.serverTs!==f.serverTs&&(g.serverTs++,b.push("serverTs, reference: "+String(f.serverTs)+", duplicate: "+String(a.serverTs)+". "));a.ts!==f.ts&&(g.ts++,b.push("ts, reference: "+String(f.ts)+", duplicate: "+String(a.ts)+". "));if(a.type!==f.type){(a.type===d("MAWMsgType").MSG_TYPE.REVOKED||f.type===d("MAWMsgType").MSG_TYPE.REVOKED)&&(g.revokedStatus++,c("FBLogger")("MAWDuplicateMessageComparison").info("Revoked duplicate msg conflict, duplicate message, %s, has type: %s, externalId: %s, revokedExternalId: %s, sortOrderMs: %s, serverTs: %s, ts: %s, rowId: %s, reference msg, %s, has type: %s, externalId: %s, revokedExternalId: %s, sortOrderMs: %s, serverTs: %s, ts: %s, rowId: %s",a.msgId,a.type,a.externalId,a.revokedExternalId,a.sortOrderMs,a.serverTs,a.ts,a.rowId,f.msgId,f.type,f.externalId,f.revokedExternalId,a.sortOrderMs,a.serverTs,a.ts,a.rowId));g.type++;b.push("type, reference: "+((e=f.type)!=null?e:"")+", duplicate: "+((e=a.type)!=null?e:"")+". ")}e=b.join("");e.length>0?c("FBLogger")("MAWDuplicateMessageComparison").info("Duplicate msg, %s, has conflicting field values to reference msg, %s: %s",a.msgId,f.msgId,e):c("FBLogger")("MAWDuplicateMessageComparison").info("Duplicate msg, %s, has no conflicting field values to reference msg, %s",a.msgId,f.msgId)});d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.MAW_DUPLICATE_MSGS,key:"sets_of_duplicate_msgs"});Object.keys(g).forEach(function(a){var b=g[a];b>0&&d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.MAW_DUPLICATE_MSGS,key:"sets_of_duplicate_msgs_with_"+a+"_field_differences"})});d("MAWODSProxy").odsBumpEntityKey({amount:b-1,entity:d("WAOdsEnums").Entity.MAW_DUPLICATE_MSGS,key:"number_of_duplicate_msgs"});Object.keys(g).forEach(function(a){var b=g[a];b>0&&d("MAWODSProxy").odsBumpEntityKey({amount:b,entity:d("WAOdsEnums").Entity.MAW_DUPLICATE_MSGS,key:"number_of_duplicate_msgs_with_"+a+"_field_differences"})})}function I(a,b,c,d){d={author:d,chat:c,externalId:b};return E(a,d)}function J(a,b){return a.messages.where("msgId").equals(b).toArray()}function K(a,b){return N(a,b).then(function(a){return a.success?a:a})}function L(a,b){var c=b.map(function(a){a=a.externalId;return a});return a.messages.where("externalId").anyOf(c).toArray().then(function(a){var c=d("MAWDbMsgUtil").convertMsgArrayToMap(a),e=new(d("WAMsgMap").MsgMap)();b.forEach(function(a){var b=c.get(a);b!=null&&e.set(a,b)});return e})}function M(a,b){return a.messages.where("msgId").equals(b).first().then(function(a){return a==null?void 0:a.sortOrderMs})}function N(a,b){var c=b.author,e=b.chat,f=b.externalId;return a.threads.get({jid:e}).then(function(b){return b==null?d("WAResultOrError").makeError("missing_thread_msg"):I(a,f,b.jid,c).then(function(a){return a==null?d("WAResultOrError").makeError("missing_msg"):d("WAResultOrError").makeResult(a)})})}function O(a,b){var c=b.author,d=b.chat,e=b.externalId;return a.threads.get({jid:d}).then(function(b){if(b==null)return;return a.messages.where("revokedExternalId").equals(e).filter(function(a){return a.author===c&&a.threadJid===b.jid&&a.type==="Revoked"}).first()})}function P(a,b,c,e){var f=a.messages.where("revokedExternalId").equals(b).filter(function(a){return a.author===e&&a.threadJid===c&&a.type===d("MAWMsgType").MSG_TYPE.REVOKED}).first();a=d("MAWDbUnrenderedMsgTxns").maybeGetUnrenderedMsgByExternalId(a,b,c,e).then(function(a){if((a==null?void 0:a.type)===d("MAWMsgType").MSG_TYPE.DELETE_FOR_ME)return a});return d("MAWDexieTable").dexieAll([f,a]).then(function(a){var b=a[0];a=a[1];return b!=null||a!=null})}function Q(a,b){var c=new Array(b.length),e=new Set();b.forEach(function(a){c.push(a.externalId),e.add(d("EncryptedBackupsUtils").convertWAMsgIdToStringId(a))});return a.messages.where("externalId").anyOf(c).filter(function(a){return e.has(d("EncryptedBackupsUtils").convertWAMsgIdToStringId({author:a.author,chat:a.threadJid,externalId:a.externalId}))}).toArray()}function R(a,b,c,e,f,g){return S(a,[{ack:c,applicationErrorCode:g,msgId:b,reportingMeta:f,serverTs:e}]).then(function(a){a=a.find(function(a){return a.msgId===b});if(a==null){d("WALogger").LOG(q());return null}return a})}function S(a,b){var e=b.map(function(a){return a.msgId});return d("MAWDbXMATxns").getXMAMsgIdsFromAssociatedMsgIds(a,e).then(function(f){var g=new Map();b.forEach(function(a){g.set(a.msgId,{ack:a.ack,applicationErrorCode:a.applicationErrorCode,reportingMeta:a.reportingMeta,serverTs:a.serverTs});var b=f.get(a.msgId);b!=null&&g.set(b,{ack:a.ack,applicationErrorCode:a.applicationErrorCode,reportingMeta:a.reportingMeta,serverTs:a.serverTs})});var h=Array.from(new Set(e.concat(Array.from(f.values()))));return a.messages.where("msgId").anyOf(h).toArray().then(function(b){if(b.length===0)return b;var e=[],f=[];b.forEach(function(a){var b,h;if(a.author!==d("WAJids").AUTHOR_ME||a.ack>d("MAWAckLevel").ACK.clock){e.push(a);return}b=(b=g.get(a.msgId))==null?void 0:b.ack;h=(h=g.get(a.msgId))==null?void 0:h.serverTs;if(b==null)return null;var i=babelHelpers["extends"]({},a,{ack:b});T(i,h);h=(h=g.get(a.msgId))==null?void 0:h.reportingMeta;h!=null&&(i.reportingMeta=h);h=c("gkx")("7471");if(h){a=(h=g.get(a.msgId))==null?void 0:h.applicationErrorCode;a!=null&&(i.applicationErrorCode=a)}b===d("MAWAckLevel").ACK.sent&&delete i.resendCount;f.push(i)});e.length>0&&d("WALogger").LOG(p(),e.map(function(a){return a.msgId}).toString());return a.messages.bulkPut(f).then(function(){return d("MAWDexieTable").dexieAll(f.map(function(b){return d("MAWLoadReplyMediaTxns").getReplyMediaForMsgQuote(a,b)}))}).then(function(a){f.forEach(function(b,c){d("MAWIndexedDb").afterTransaction({tag:"MsgUpdated",value:d("MAWBridgeMsg").createBridgeMsg(b,void 0,a[c],void 0)})});return[].concat(f,e)})})})}function T(a,b){if(b==null)return;a.serverTs=b;var e=a.sortOrderMs;if(a.type===d("MAWMsgType").MSG_TYPE.REVOKED&&c("justknobx")._("3841"))return;a.sortOrderMs=d("MAWMessageSortOrderUtils").generateAuthoritativeMessageSortOrder(a);d("WALogger").LOG(o(),b,e,a.sortOrderMs)}function U(a,b,e,f){return d("MAWDbThreadTxns").getThread(a,b).then(function(b){if(!b.success||f==null)return;var g=b.value;b=[a.messages.where(["threadJid","sortOrderMs"]).above([g.jid,f]).first(),a.messages.where(["threadJid","sortOrderMs"]).below([g.jid,f]).last()];return d("MAWDexieTable").dexieAll(b).then(function(b){var f=b[0];b=b[1];return d("MAWDbThreadTxns").updateThread(a,babelHelpers["extends"]({},g,{newestMsgTs:(b==null?void 0:b.ts)==null?g.newestMsgTs:d("WATimeUtils").castUnixTimeToMillisTime(b.ts),oldestMsg:g.oldestMsg===e?f==null?void 0:f.msgId:g.oldestMsg})).then(c("emptyFunction"))})})}function V(a,b,e,f){if(b===(e==null?void 0:e.msgId)&&(f==null?void 0:f.ts)==null)return d("MAWDexieTable").dexieResolve();d("MAWIndexedDb").afterTransactionEffect(function(){c("promiseDone")(c("MAWUpdateThreadMsgMetadataApi")(a,b,e,f))})}function aa(a,b,e,f,g,h,i,j){g===void 0&&(g=!1);h===void 0&&(h=!1);i===void 0&&(i="before");j===void 0&&(j=null);return f===0?d("MAWDexieTable").dexieResolve({hasMoreAfter:!1,hasMoreBefore:!1,msgs:[]}):d("MAWDexieTable").dexieAll([a.threads.get({jid:b}),e==null?d("MAWDexieTable").dexieResolve(null):a.messages.get({msgId:e})]).then(function(b){var k=b[0],l=b[1],o=k==null?void 0:k.oldestMsg;if(k==null||e!=null&&l==null)return{hasMoreAfter:!1,hasMoreBefore:!1,msgs:[]};if(!ba(l,j,i))return{hasMoreAfter:!1,hasMoreBefore:!1,msgs:[]};var p=h?function(a){return!0}:function(a){return a.messageExpirationTs==null||a.messageExpirationTs>d("WATimeUtils").unixTime()};b=d("MAWDexieTable").dexieResolve([]);f===1&&g&&l!=null&&(b=d("MAWDexieTable").dexieResolve([l].filter(p)));d("WALogger").LOG(n(),l==null?void 0:l.msgId,f,g,h,i,j);return b.then(function(b){b=b.length>0?d("MAWDexieTable").dexieResolve(b):Z(a,k.jid,l,g,f,p,i,j);var h=c("gkx")("23927");return d("MAWDexieTable").dexieAll([b,z(a,k.jid),C(a,k.jid)]).then(function(a){var b=a[0],c=a[1];a=a[2];V(k,o,a,c);if(b.length===0)return{hasMoreAfter:!1,hasMoreBefore:!1,msgs:[]};var g=b[b.length-1],i=b[0],l=h||j!=null;g=g.msgId===(a==null?void 0:a.msgId);a=i.msgId===(c==null?void 0:c.msgId);c=!g&&(l||b.length===f);g=(h||j!=null)&&!a;i.threadJid!==k.jid&&d("WALogger").ERROR(m(),i.threadJid,k.jid,k.chatId,e);return{hasMoreAfter:g,hasMoreBefore:c,msgs:b}})})})}function ba(a,b,c){b===void 0&&(b=null);return a==null||b==null?!0:d("MAWMessagesDirection").switchOnMAWMessagesDirection(c,{after:d("MAWDbMsg").getSortOrderWithFallback(a)<=b,before:d("MAWDbMsg").getSortOrderWithFallback(a)>=b})}function ca(a){return a.messages.where("altIndex").equals(d("MAWDbMsg").FUTUREPROOF_ALT_INDEX).toArray().then(function(a){var b=[];a.forEach(function(a){if(a.type!==d("MAWMsgType").MSG_TYPE.FUTUREPROOF){d("WALogger").ERROR(l(),a.msgId,a.type);return}b.push(a)});return b})}function W(a){return a.toString()}function da(a,b,e,f){var g=b.mediaId;if(g===e){d("WALogger").LOG(k(),b.msgId,e);return d("MAWDexieTable").dexieResolve()}g=g!=null?a.media.get(g):d("MAWDexieTable").dexieResolve();return g.then(function(g){g&&d("WALogger").ERROR(j(),b.type);g=(g=f)!=null?g:void 0;g=babelHelpers["extends"]({},b,{mediaId:e,plaintextHash:g});return a.messages.put(g).then(c("emptyFunction"))})}function ea(a,b){var e=Array.from(b.keys());return a.messages.where("msgId").anyOf(e).toArray().then(function(e){var f=[];e.map(function(a){var e=b.get(a.msgId),g=a.mediaId;if(g!=null&&g!==e){if(e!=null)throw c("err")("mediaId "+W(g)+" in message "+a.msgId+" is different with the "+W(e)+" in bulkUpdateMediaId");d("WALogger").LOG(i(),a.msgId,e);return}g=babelHelpers["extends"]({},a,{mediaId:e,plaintextHash:a.plaintextHash});f.push(g)});return a.messages.bulkPut(f).then(c("emptyFunction"))})}function fa(a,b){return X(a,[b]).then(c("emptyFunction"))}function X(a,b){return a.messages.where("msgId").anyOf(b).toArray().then(function(b){var c=b.map(function(a){return babelHelpers["extends"]({},a,{isExpiredXmaMsg:!0})});return a.messages.bulkPut(c).then(function(){return c})})}function Y(a,b,c,e){if(e!=null&&e<=0)return d("MAWDexieTable").dexieResolve([]);a=a.messages.where("altIndex").equals(d("MAWDbMsg").craftToBeReadAltIndex(b)).filter(function(a){return d("MAWDbMsg").getSortOrderWithFallback(a)<=c});e!=null&&(a=a.limit(e));return a.toArray()}function ga(a,b,c){return Y(a,b,c).then(function(b){var c=b.map(function(a){return babelHelpers["extends"]({altIndex:null},a)});return a.messages.bulkPut(c).then(function(){return c})})}function ha(a,b){return a.messages["delete"](b)}function ia(a,b){return a.messages.bulkDelete(b)}function ja(a,b,c){var e=b.map(function(a){return a.rowId});b=c!=null?b.map(function(a){a=d("MAWJidUtils").toProtocolMsgId(a);if(!a)return;return babelHelpers["extends"]({},a,{reason:c})}).filter(Boolean):[];return d("MAWDexieTable").dexieAll([a.deletedMessages.bulkAdd(b),a.messages.bulkDelete(e)]).then(function(a){a[0];a=a[1];d("WALogger").LOG(h(),a)})}function ka(a,b){return a.messages.where("msgId").anyOf(b).toArray()}function la(a){return a.messages.where("altIndex").anyOf([d("MAWDbMsg").SPAM_ALT_INDEX,d("MAWDbMsg").FUTUREPROOF_SPAM_ALT_INDEX]).toArray()}function Z(a,b,c,e,f,g,h,i){h===void 0&&(h="before");i===void 0&&(i=null);c=c==null?null:d("MAWDbMsg").getSortOrderWithFallback(c);if(h==="before"){return a.messages.where(["threadJid","sortOrderMs"]).between([b,(h=i)!=null?h:Number.MIN_SAFE_INTEGER],[b,(h=c)!=null?h:Number.MAX_SAFE_INTEGER],!0,e).reverse().filter(g).limit(f).toArray()}else{return a.messages.where(["threadJid","sortOrderMs"]).between([b,(h=c)!=null?h:Number.MIN_SAFE_INTEGER],[b,(a=i)!=null?a:Number.MAX_SAFE_INTEGER],e,!0).filter(g).limit(f).toArray().then(function(a){return a.sort(function(a,b){return b.ts-a.ts})})}}function ma(a,b,c,d){var e=c.msgId;if(d==null){var f;return{oldestMsg:(f=a==null?void 0:a.msgId)!=null?f:e}}f=[a,b,c].filter(Boolean);return{oldestMsg:f.reduce(function(a,b){return $(a,e,d)<$(b,e,d)?a:b}).msgId}}function $(a,b,c){return a.msgId===b?c:d("MAWDbMsg").getSortOrderWithFallback(a)}function na(a,b){return a.messages.where("msgId").between(d("MAWDbMsg").msgIdsInChatLowerBound(b.chatId),d("MAWDbMsg").msgIdsInChatUpperBound(b.chatId)).last().then(function(a){a=a==null?0:d("MAWDbMsg").getInChatMsgIdFromMsgId(a.msgId);return a+1})}g.maybeGetMsg=a;g.getIsThreadEmpty=b;g.getNonAdminMsgs=e;g.getThreadMessagesBySortOrder=y;g.getThreadNewestMessageBySortOrder=z;g.getThreadNewestMessageId=f;g.getThreadNewestMessageTs=A;g.getThreadNewestNumMessagesBySortOrder=B;g.getThreadOldestMessageBySortOrder=C;g.getThreadOldestMessageId=D;g.maybeGetMsgByProtocolMsgId=E;g.getUniqueMsgsByProtocolMsgIds=F;g.maybeGetMsgByExternalId=I;g.maybeGetMsgListByMsgId_I_KNOW_WHAT_I_AM_DOING=J;g.maybeGetMsgResultByProtocolMsgId=K;g.getMsgMapByProtocolMsgId=L;g.getSortOrderFromMsgId=M;g.maybeGetRevokedMsgByProtocolMsgId=O;g.checkIfMsgIsDeletedForMeOrRevoked=P;g.getMsgsByProtocolMsgId=Q;g.updateSystemAck=R;g.bulkUpdateSystemAck=S;g.maybeUpdateThreadMsgsForDeleteForMe=U;g.getMsgsFromOffset=aa;g.getFutureProofMsgs=ca;g.updateMediaId=da;g.bulkUpdateMediaId=ea;g.updateDbMsgXMAExpiration=fa;g.bulkUpdateDbMsgXMAExpired=X;g.getMsgsNeedingRetroactiveReadReceiptsUpTo=Y;g.clearRetroactiveReadReceiptStatusFromMsgsUpTo=ga;g.deleteDbMsg=ha;g.bulkDeleteDbMsg=ia;g.deleteMessages=ja;g.getMsgsByMsgIds=ka;g.getSpamMsgs=la;g.fetchMessagesFromDbWithSortOrderMs=Z;g.calculateOldestMsg=ma;g.getNextMsgIdNumberForThread=na}),98);
__d("MAWDbThreadTxns",["MAWBridgeTypesCreators","MAWDbMsgTxns","MAWDexieTable","MAWFolderTypes","MAWIndexedDb","WAArrayZip","WALogger","WAResultOrError","WATimeUtils","emptyFunction"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["markCutoverThreadAsNotMigratedLocally failed because thread is already unmigrated"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["markThreadAsMigratedLocally failed because thread is already migrated"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["markThreadAsMigratedLocally failed to get the thread"]);j=function(){return a};return a}function a(a,b){return a.threads.get({deduplicationKey:b}).then(function(a){return a==null?d("WAResultOrError").makeError("missing"):d("WAResultOrError").makeResult(a)})}function k(a,b){return a.threads.get({jid:b}).then(function(a){return a==null?d("WAResultOrError").makeError("missing"):d("WAResultOrError").makeResult(a)})}function l(a,b){return a.threads.where("jid").anyOf(b).toArray()}function b(a,b){return a.threads.where("jid").startsWith(b+"@").first().then(function(a){return a==null?d("WAResultOrError").makeError("missing"):d("WAResultOrError").makeResult(a)})}function e(a,b){return a.threads.where("jid").equals(b)["delete"]().then(c("emptyFunction"))}function f(a,b){return a.participants.where("userJid").equals(b).toArray().then(function(b){b=b.map(function(a){return a.threadJid});return l(a,b)})}function m(a,b){return a.participants.where("userJid").anyOf(b).toArray().then(function(b){var c=new Map(),d=new Set();b.forEach(function(a){var b,e=a.userJid;b=(b=c.get(e))!=null?b:[];b.push(a.threadJid);c.set(e,b);d.add(a.threadJid)});return l(a,Array.from(d)).then(function(a){var b=a.reduce(function(a,b){a.set(b.jid,b);return a},new Map());return new Map(Array.from(c.entries()).map(function(a){var c=a[0];a=a[1];return[c,a.map(function(a){return b.get(a)}).filter(Boolean)]}))})})}function n(a,b,c){return(b==null?void 0:b.lastReadMsgReceiptSent)==null?d("MAWDexieTable").dexieResolve(!1):d("MAWDbMsgTxns").getSortOrderFromMsgId(a,b.lastReadMsgReceiptSent).then(function(a){return c.sortOrderMs==null||a==null?!1:c.sortOrderMs<=a})}function o(a,b){return a.threads.get({jid:b.threadJid}).then(function(c){return n(a,c,b)})}function p(a,b){return a.threads.where("jid").anyOf(b.map(function(a){return a.threadJid})).toArray().then(function(c){return d("MAWDexieTable").dexieAll(d("WAArrayZip").zip(b,c).map(function(b){var c=b[0];b=b[1];return n(a,b,c)}))})}function q(a,b,c){return a.threads.where("jid").anyOf(b).toArray().then(function(b){var e=b.filter(Boolean).map(function(a){return babelHelpers["extends"]({},a,{archived:!0,cannotReplyReason:c?"viewer_not_subscribed":a.cannotReplyReason,folder:d("MAWFolderTypes").FOLDER_ID.ARCHIVED})});return a.threads.bulkPut(e).then(function(){e.forEach(function(a){c&&d("WALogger").LOG(["[Occamadillo] Leaving a group thread\n          "+a.jid.toString()+", showing a VIEWER_NOT_SUBSCRIBED composer blocker"]),d("MAWIndexedDb").afterTransaction({tag:"ThreadUpdated",value:d("MAWBridgeTypesCreators").createBridgeUpdatedThread({cannotReplyReason:a.cannotReplyReason,folder:d("MAWFolderTypes").FOLDER_ID.ARCHIVED,threadJid:a.jid})})})})})}function r(a,b){return a.threads.where("jid").anyOf(b).toArray().then(function(b){var c=b.filter(Boolean).map(function(a){return babelHelpers["extends"]({},a,{cannotReplyReason:null})});return a.threads.bulkPut(c).then(function(){c.forEach(function(a){a={cannotReplyReason:null,threadJid:a.jid};d("MAWIndexedDb").afterTransaction({tag:"ThreadUpdated",value:d("MAWBridgeTypesCreators").createBridgeUpdatedThread(a)})})})})}function s(a,b){return a.threads.where("jid").anyOf(b).toArray().then(function(b){var c=b.filter(Boolean).map(function(a){return babelHelpers["extends"]({},a,{archived:!1,cannotReplyReason:a.cannotReplyReason==="viewer_not_subscribed"?a.cannotReplyReason:null,folder:d("MAWFolderTypes").FOLDER_ID.INBOX})});return a.threads.bulkPut(c).then(function(){c.forEach(function(a){d("MAWIndexedDb").afterTransaction({tag:"ThreadUpdated",value:d("MAWBridgeTypesCreators").createBridgeUpdatedThread({cannotReplyReason:a.cannotReplyReason,folder:d("MAWFolderTypes").FOLDER_ID.INBOX,threadJid:a.jid})})})})})}function t(a,b){return a.threads.where("jid").anyOf(b).toArray().then(function(b){var c=b.filter(Boolean).map(function(a){return babelHelpers["extends"]({},a,{cannotReplyReason:"viewer_not_subscribed"})});return a.threads.bulkPut(c).then(function(){c.forEach(function(a){var b={cannotReplyReason:"viewer_not_subscribed",threadJid:a.jid};d("WALogger").LOG(["[Occamadillo] User is unsubscribed from thread\n          "+a.jid.toString()+", showing a VIEWER_NOT_SUBSCRIBED composer blocker"]);d("MAWIndexedDb").afterTransaction({tag:"ThreadUpdated",value:d("MAWBridgeTypesCreators").createBridgeUpdatedThread(b)})})})})}function u(a,b){return k(a,b).then(function(b){if(!b.success){d("WALogger").WARN(j());return}b=b.value;if(b.isMigratedLocally===!0){d("WALogger").WARN(i());return}b=babelHelpers["extends"]({},b,{isMigratedLocally:!0});return a.threads.put(b).then(c("emptyFunction"))})}function v(a,b){if(b.isMigratedLocally===!1){d("WALogger").WARN(h());return d("MAWDexieTable").dexieResolve(b)}var c=babelHelpers["extends"]({},b,{isMigratedLocally:!1});return a.threads.put(c).then(function(){return c})}function w(a,b){return a.threads.put(b).then(c("emptyFunction"))}function x(a,b,c,e,f){return w(a,babelHelpers["extends"]({},b,{newestMsgTs:(f==null?void 0:f.ts)==null?b.newestMsgTs:d("WATimeUtils").castUnixTimeToMillisTime(f.ts),oldestMsg:e==null?void 0:e.msgId}))}g.getThreadByDeduplicationKey=a;g.getThread=k;g.getThreads=l;g.getThreadPrimaryId=b;g.deleteThreadRow=e;g.getAllThreadsForUser=f;g.getAllThreadsForUsers=m;g.needsRetroactiveReadReceiptInThread=o;g.bulkNeedsRetroactiveReadReceiptInThread=p;g.archiveThreads=q;g.subscribeToThreads=r;g.unarchiveThreads=s;g.unsubscribeFromThreads=t;g.markCutoverThreadAsMigratedLocally=u;g.markCutoverThreadAsNotMigratedLocally=v;g.updateThread=w;g.updateThreadMsgsForUndefinedOldestOrNewestMsgs=x}),98);
__d("MAWDbMediaTxns",["MAWDbMsg","MAWDexieTable","MAWMediaUtils","MAWMsgType","WALogger","WAResultOrError","err"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["mediaId is null for media msg with msgId: ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["mediaId is null for media msg with msgId: "," and msg type ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[getMsgMediaPairFromMsgs] msgs: ",""]);j=function(){return a};return a}function a(a,b){return b==null?d("MAWDexieTable").dexieResolve():a.media.get({mediaId:b})}function b(a,b){return b.length===0?d("MAWDexieTable").dexieResolve(new Map()):a.media.bulkGet(b).then(function(a){return new Map(a.filter(Boolean).map(function(a){return[a.mediaId,a]}))})}function k(a,b){return a.media.where("hashedPlaintextHash").equals(b).first()}function e(a,b){b=d("MAWMediaUtils").genHMACPlaintextHash(b);return k(a,b)}function f(a,b){b=b.map(function(a){return d("MAWMediaUtils").genHMACPlaintextHash(a)});return l(a,b)}function l(a,b){return a.media.where("hashedPlaintextHash").anyOf(b).toArray()}function m(a,b){return b==null?d("MAWDexieTable").dexieResolve():n(a,b).then(function(c){c=c==null?void 0:c.mediaId;return c!=null?a.media.get({mediaId:c}):a.media.get({objectId:b})})}function n(a,b){return b==null?d("MAWDexieTable").dexieResolve():a.mediaBackup.get({objectId:b})}function o(a,b){if(b==null)return d("MAWDexieTable").dexieResolve();a=a.mediaBackup.where("msgId").equals(b).toArray();return a}function p(a,b){b=b.filter(d("MAWDbMsg").isMediaMsg);if(b.length===0)return d("MAWDexieTable").dexieResolve([]);d("WALogger").LOG(j(),b.map(function(a){return""+a.msgId}));var e=b.reduce(function(a,b){if(b.mediaId==null){d("WALogger").ERROR(i(),b.msgId,b.type);return a}return a.set(b.mediaId,b)},new Map());b=Array.from(e.keys());return s(a,b).then(function(a){var b=[];a.forEach(function(a){if(a==null)throw c("err")("Error missing media");var d=e.get(a.mediaId);if(d==null)throw c("err")("Error missing media");b.push([d,a])});return b})}function q(a,b){if(b.length===0)return d("MAWDexieTable").dexieResolve([]);b=b.filter(d("MAWDbMsg").isMediaMsg).map(function(a){var b=a.mediaId;if(b==null){d("WALogger").ERROR(h(),a.msgId);throw c("err")("mediaId is missing")}else return b});return s(a,b).then(function(a){var b=[];a.forEach(function(a){a!=null&&b.push(a)});return b})}function r(a,b){if(b.type===d("MAWMsgType").MSG_TYPE.DELETE_FOR_ME||d("MAWDbMsg").isMediaMsg(b)){var c=b.mediaId;return c==null?b.type===d("MAWMsgType").MSG_TYPE.DELETE_FOR_ME?d("MAWDexieTable").dexieResolve(d("WAResultOrError").makeResult()):d("MAWDexieTable").dexieResolve(d("WAResultOrError").makeError("missing")):a.media.get(c).then(function(a){return a==null?d("WAResultOrError").makeError("missing"):d("WAResultOrError").makeResult(a)})}else return d("MAWDexieTable").dexieResolve(d("WAResultOrError").makeResult())}function s(a,b){return a.media.bulkGet(b)}function t(a,b){var c=b.previewMediaIds!=null?s(a,b.previewMediaIds):d("MAWDexieTable").dexieResolve(),e=b.headerMediaId!=null?a.media.get(b.headerMediaId):d("MAWDexieTable").dexieResolve(),f=b.faviconMediaId!=null?a.media.get(b.faviconMediaId):d("MAWDexieTable").dexieResolve();a=b.defaultPreviewMediaId!=null?a.media.get(b.defaultPreviewMediaId):d("MAWDexieTable").dexieResolve();return d("MAWDexieTable").dexieAll([c,e,f,a]).then(function(a){var c=a[0],e=a[1],f=a[2];a=a[3];if(b.headerMediaId!=null&&e==null)return d("WAResultOrError").makeError("missing");if(b.faviconMediaId!=null&&f==null)return d("WAResultOrError").makeError("missing");if(c==null)return d("WAResultOrError").makeError("missing");var g=[];for(var c=c,h=Array.isArray(c),i=0,c=h?c:c[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var j;if(h){if(i>=c.length)break;j=c[i++]}else{i=c.next();if(i.done)break;j=i.value}j=j;if(j==null)return d("WAResultOrError").makeError("missing");else g.push(j)}return d("WAResultOrError").makeResult({defaultPreview:a,favicon:f,header:e,previews:g})})}function u(a,b,c){b=babelHelpers["extends"]({},b,c);return a.media.put(b)}g.maybeGetMediaFromMediaId=a;g.maybeBulkGetMediaFromMediaId=b;g.maybeGetMediaFromHashedPlaintextHash=k;g.maybeGetMediaFromPlaintextHash=e;g.maybeBulkGetMediaFromPlaintextHash=f;g.maybeBulkGetMediaFromHashedPlaintextHash=l;g.maybeGetMediaFromObjectId=m;g.maybeGetMediaBackupRowFromObjectId=n;g.maybeGetMediaBackupRowFromMsgId=o;g.getMsgMediaPairFromMsgs=p;g.getMediaFromMsgs=q;g.getAndCheckMediaFromMsg=r;g.bulkGetMedias=s;g.getMediaForXMA=t;g.updateMedia=u}),98);
__d("MAWDbXMATxns",["MAWDbChunkTxns","MAWDbMediaTxns","MAWDbMsg","MAWDbMsgTxns","MAWDbThreadTxns","MAWDexieTable","MAWJidUtils","MAWXMAUtils","WAResultOrError","gkx"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){return a.xma.bulkGet(b)}function b(a,b){return b==null?d("MAWDexieTable").dexieResolve():a.xma.get({xmaId:b})}function h(a,b){return b==null?d("MAWDexieTable").dexieResolve():a.xma.where("associatedMessageId").equals(b).first()}function i(a,b){return b==null?d("MAWDexieTable").dexieResolve():a.xma.where("externalId").equals(b.externalId).filter(function(a){return a.author===b.author&&a.threadJid===b.chat}).first()}function e(a,b){return i(a,b).then(function(b){return b==null?d("WAResultOrError").makeError("missing"):d("MAWDexieTable").dexieAll([d("MAWDbMediaTxns").getMediaForXMA(a,b),d("MAWDbMsgTxns").maybeGetMsg(a,b.associatedMessageId)]).then(function(a){var c=a[0];a=a[1];if(!c.success)return d("WAResultOrError").makeError("missing");c=c.value;var e=c.defaultPreview,f=c.favicon,g=c.header;c=c.previews;return d("WAResultOrError").makeResult({associatedMessage:a,defaultPreview:e,favicon:f,header:g,previews:c,xma:b})})})}function f(a,b){return h(a,b).then(function(b){if(b==null)return;return d("MAWDbMsgTxns").maybeGetMsg(a,b.msgId)})}function j(a,b){if(b.length===0)return d("MAWDexieTable").dexieResolve([]);b=b.filter(d("MAWDbMsg").isXMAMsg).map(function(a){return d("MAWJidUtils").maybeToProtocolMsgId(a.author,a.threadJid,a.externalId)}).filter(Boolean);b=b.map(function(b){return i(a,b)});return d("MAWDexieTable").dexieAll(b).then(function(a){return a.filter(Boolean)})}function k(a,b){return a.xma.where("associatedMessageId").anyOf(b).toArray().then(function(a){a=a.filter(function(a){return a.msgId!=null&&c("gkx")("9841")?a.targetType!=null:d("MAWXMAUtils").isXMAShare_DO_NOT_USE(a.targetType)});return a.reduce(function(a,b){return b.associatedMessageId!=null&&b.msgId!=null?a.set(b.associatedMessageId,b.msgId):a},new Map())})}function l(a,b){return a.xma.where("associatedMessageId").equals(b).first()}function m(a,b){return a.xma.where("associatedMessageId").equals(b).first().then(function(b){if(b==null)return;b=d("MAWJidUtils").maybeToProtocolMsgId(b.author,b.threadJid,b.externalId);if(b==null)return;return d("MAWDbMsgTxns").maybeGetMsgByProtocolMsgId(a,b)})}function n(a,b){return l(a,b).then(function(b){return b==null?d("WAResultOrError").makeResult():d("MAWDexieTable").dexieAll([d("MAWDbMediaTxns").getMediaForXMA(a,b),d("MAWDbMsgTxns").maybeGetMsg(a,b.associatedMessageId)]).then(function(a){var c=a[0];a=a[1];if(!c.success)return d("WAResultOrError").makeError("missing");c=c.value;var e=c.defaultPreview,f=c.favicon,g=c.header;c=c.previews;return d("WAResultOrError").makeResult({associatedMessage:a,defaultPreview:e,favicon:f,header:g,previews:c,xma:b})})})}function o(a,b,c){return d("MAWDbThreadTxns").getThread(a,c).then(function(c){if(!c.success)return;c=c.value;if(b==null)return d("MAWDexieTable").dexieResolve();c={author:b.author,chat:c.jid,externalId:b.externalId};return d("MAWDbMsgTxns").maybeGetMsgByProtocolMsgId(a,c)})}function p(a,b){return i(a,b).then(function(b){if(b==null)return d("MAWDexieTable").dexieResolve();if(d("MAWXMAUtils").isXMAStoryReply(b.targetType))return;return d("MAWDbMediaTxns").maybeGetMediaFromMediaId(a,b.defaultPreviewMediaId).then(function(c){return c==null?{hasMedia:!1,xma:b}:d("MAWDexieTable").dexieAll([c,d("MAWDbChunkTxns").hasMediaChunk(a,c.hashedPlaintextHash)]).then(function(a){var c=a[0];a=a[1];return{hasMedia:a,previewMedia:c,xma:b}})})})}g.bulkGetXMAs=a;g.maybeGetXMAFromXMAId=b;g.maybeGetXMAFromAssociatedMsgId=h;g.maybeGetXMAFromProtocolMsgId=i;g.maybeGetXMAPayloadFromProtocolMsgId=e;g.getDbXMAMsgFromAssociatedMsgId=f;g.getXMAFromMsgs=j;g.getXMAMsgIdsFromAssociatedMsgIds=k;g.maybeGetDbXMAMsgByAssociatedMsgId=m;g.maybeGetXMAPayloadFromAssociatedMsgId=n;g.maybeGetAssociatedXMAMsg=o;g.maybeGetXMAAndDefaultPreviewMediaFromProtocolMsg=p}),98);
__d("MAWUpdateThreadMsgMetadataApi",["MAWDbThreadTxns","MAWIndexedDb","MAWTransactionMode","WALogger","emptyFunction"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["updated oldestMsg from id "," to id "," when oldestMsg is undefined"]);h=function(){return a};return a}a=d("MAWIndexedDb").makeMsgrTransactor({threads:d("MAWTransactionMode").READWRITE},"updateThreadMsgMetadataApiTransactor",function(a){return function(b,e,f,g){var i=e===(f==null?void 0:f.msgId);i||d("WALogger").ERROR(h(),e,f==null?void 0:f.msgId);return d("MAWDbThreadTxns").updateThreadMsgsForUndefinedOldestOrNewestMsgs(a,b,e,f,g).then(c("emptyFunction"))}});b=a;g["default"]=b}),98);
__d("MAWUnsafeCoerce",[],(function(a,b,c,d,e,f){"use strict";function a(a){return a}f.unsafeCoerce=a}),66);
__d("MAWBulkEditMsgsTxns",["FBLogger","MAWAckLevel","MAWBridgeMsg","MAWDbEditMsgHistory","MAWDbEditMsgHistoryTxns","MAWDexieTable","MAWIndexedDb","MAWJidUtils","MAWLoadReplyMediaTxns","MAWUnsafeCoerce","MAWUserJidWrapper","WAJids","WAMsgMap","WAMsgType","err"],(function(a,b,c,d,e,f,g){"use strict";function h(a,b,e){var f=[];for(var g=0;g<a.length;g++){var h=a[g],i=d("MAWJidUtils").maybeToProtocolMsgId(h.author,h.threadJid,h.originalMsgExternalId);if(i!=null){i=(i=e.get(i))==null?void 0:i.msgId;i!=null?f.push(babelHelpers["extends"]({},h,{editMsgHistoryId:d("MAWDbEditMsgHistory").convertToEditMsgHistoryId64(b[g]),originalMsgId:i})):c("FBLogger")("messenger_e2ee_web").warn("[edit messagehistory] Failed to get the original msgId for a msg that has been edited.")}}d("MAWIndexedDb").afterTransaction({tag:"EditMsgHistoryAdded",value:f})}function a(a,b){var c=new Set(),e=[];b.forEach(function(a){var b=a.chatJid;a=a.msg;c.add(b);e.push(a.originalMsgExternalId)});return d("MAWDexieTable").dexieAll([a.messages.where("externalId").anyOf(e).toArray(),a.messages.where("quoteExternalId").anyOf(e).toArray(),a.editMsgHistory.where("originalMsgExternalId").anyOf(e).toArray()]).then(function(a){var b=a[0],c=a[1];a=a[2];return{editMsgHistory:a,originalMsgs:b,quoteMessages:c}})}function b(a,b,e){var f=e.editMsgHistory,g=e.originalMsgs,i=e.quoteMessages,k=g.reduce(function(a,b){var c=d("MAWJidUtils").toProtocolMsgId(b);return c==null?a:a.set(c,b)},new(d("WAMsgMap").MsgMap)());e=f.reduce(function(a,b){var c=d("MAWJidUtils").toProtocolMsgId(b);return c==null?a:a.set(c,b)},new(d("WAMsgMap").MsgMap)());g=j(b,{messageHistoriesToEdit:e,messagesToEdit:k});var l=g[0],m=g[1],n=g[2];return d("MAWDbEditMsgHistoryTxns").bulkAddEditMsgHistory(a,l,!1).then(function(b){h(l,b,k);var e=new(d("WAMsgMap").MsgMap)();m.entries().forEach(function(a){var b=a[0];a=a[1];var f=k.get(b);if(f==null){c("FBLogger")("messenger_e2ee_web").warn("Cannot find the original msg for the edit action.");return}if(f.type!==d("WAMsgType").MSG_TYPE.TEXT&&f.type!==d("WAMsgType").MSG_TYPE.CIPHERTEXT)throw c("err")("Only text or cipher text can be edited. Original msg type: %s",f.type);f=babelHelpers["extends"]({},f,{editCount:((f=f.editCount)!=null?f:0)+((f=n.get(b))!=null?f:0),msgContent:a.editMsgContent,type:d("WAMsgType").MSG_TYPE.TEXT});e.set(b,f)});var f=i.map(function(a){var b=a.quote,f=a.quoteExternalId,g=a.threadJid;if(b==null){c("FBLogger")("messenger_e2ee_web").warn("[edit message] Failed to get the quoted content for a msg that has been quoted.",a.externalId);return}var h=b.content.author;h=d("MAWJidUtils").maybeToProtocolMsgId(h==="@me"?d("MAWUserJidWrapper").getMyUserJid():h,g,f);if(h==null)return;g=e.get(h);if(g==null)return;return babelHelpers["extends"]({},a,{quote:babelHelpers["extends"]({},b,{content:babelHelpers["extends"]({},b.content,{msgContent:babelHelpers["extends"]({},g.msgContent)})})})}).filter(Boolean);return a.messages.bulkPut(e.values().concat(f)).then(function(){e.values().forEach(function(b){return d("MAWLoadReplyMediaTxns").getReplyMediaForMsgQuote(a,b).then(function(a){d("MAWIndexedDb").afterTransaction({tag:"MsgUpdated",value:d("MAWBridgeMsg").createBridgeMsg(b,void 0,a)})})})}).then(function(){f.forEach(function(a){d("MAWIndexedDb").afterTransaction({tag:"MsgUpdated",value:d("MAWBridgeMsg").createBridgeMsg(a)})})})})}function i(a,b){var e;switch(a.type){case d("WAMsgType").MSG_TYPE.TEXT:case d("WAMsgType").MSG_TYPE.EDIT_ACTION:return{author:a.author,editExternalId:a.externalId,editTs:(e=a.serverTs)!=null?e:a.ts,msgContent:(e=a.editMsgContent)!=null?e:d("MAWUnsafeCoerce").unsafeCoerce(a.msgContent),originalMsgExternalId:(e=a.originalMsgExternalId)!=null?e:a.externalId,sendStatus:d("MAWAckLevel").ACK.sent,specialTextSize:a.specialTextSize,threadJid:b};case d("WAMsgType").MSG_TYPE.CIPHERTEXT:return{author:a.author,editExternalId:a.externalId,editTs:(e=a.serverTs)!=null?e:a.ts,msgContent:{content:""},originalMsgExternalId:a.externalId,sendStatus:d("MAWAckLevel").ACK.sent,specialTextSize:a.specialTextSize,threadJid:b};default:a.type;throw c("err")("MAWBulkEditMsgsTxns::getMessageHistory: Unexpected msg type")}}function j(a,b){var e=b.messageHistoriesToEdit,f=b.messagesToEdit,g=[],h=new(d("WAMsgMap").MsgMap)(),j=new(d("WAMsgMap").MsgMap)();a.forEach(function(a){var b=a.chatJid;a=a.msg;var k=d("MAWJidUtils").maybeToProtocolMsgId(a.author,b,a.originalMsgExternalId);if(k==null)throw c("err")("[protocolMsgId] Cannot get the protocol id for the edit action. isAuthorSystem = %s; chatJid = %s; externalId = %s",d("WAJids").isAuthorSystem(a.author),!!b,!!a.originalMsgExternalId);var l=d("MAWJidUtils").maybeToProtocolMsgId(a.author,b,a.externalId);if(l==null)throw c("err")("[editMsgProtocolMsgId] Cannot get the protocol id for the edit action. isAuthorSystem = %s; chatJid = %s; externalId = %s",d("WAJids").isAuthorSystem(a.author),!!b,!!a.externalId);if(e.get(l)==null){g.push(i(a,b));l=(l=j.get(k))!=null?l:0;var m=f.get(k);j.set(k,l+1);if(e.get(k)==null&&l===0&&m!=null){if(m.type!==d("WAMsgType").MSG_TYPE.TEXT&&m.type!==d("WAMsgType").MSG_TYPE.CIPHERTEXT)throw c("err")("Only text or cipher text can be edited. Original msg type: %s",m.type);g.push(i(m,b))}}l=h.get(k);m=l==null?void 0:l.serverTs;b=a==null?void 0:a.serverTs;(m==null||b==null||m<b)&&h.set(k,a)});return[g,h,j]}g.prepareDataForMessageEdit=a;g.bulkEditMsgs=b;g.getMessageHistory=i}),98);
__d("MAWDbMsgOrReaction",[],(function(a,b,c,d,e,f){"use strict";function g(a,b){var c=b.forMessage;b=b.forReaction;return a.msgId!=null?c(a):b(a)}function a(a,b){var c=b.forMessage,d=b.forNull;b=b.forReaction;return a==null?d():g(a,{forMessage:c,forReaction:b})}f.switchOnMsgOrReaction=g;f.switchOnMsgOrReactionNullish=a}),66);
__d("MAWCalculateBumpTimestampMs",["I64","MAWDbMsgOrReaction","MAWExtractMsFromExternalId","MAWTimeUtils","WALongInt","WATimeUtils","nullthrows"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(a,b){b=b==null?null:d("MAWExtractMsFromExternalId").extractMsFromExternalId(b);return(h||(h=d("I64"))).add(d("MAWTimeUtils").millisTimeToTimestamp(a),h.of_int32((a=b)!=null?a:0))}function j(a){var b=a.msg;a=a.throwIfNoServerTs;a=a?c("nullthrows")(b.serverTs):b.serverTs;return i(d("WATimeUtils").castUnixTimeToMillisTime((a=a)!=null?a:b.ts),(h||(h=d("I64"))).of_string(b.externalId))}function k(a){return a.senderTimestampMs!=null?(h||(h=d("I64"))).of_string(d("WALongInt").longIntToDecimalString(a.senderTimestampMs)):i(d("WATimeUtils").castUnixTimeToMillisTime(a.ts),(h||(h=d("I64"))).of_string(a.externalId))}function a(a){return d("MAWDbMsgOrReaction").switchOnMsgOrReaction(a,{forMessage:function(a){return j({msg:a,throwIfNoServerTs:!0})},forReaction:k})}g.calculateBumpTimestampMs=i;g.calculateBumpTimestampMsForMsg=j;g.calculateBumpTimestampMsForReaction=k;g.calculateBumpTsForMsgOrReaction=a}),98);
__d("MAWDbReaction",["I64","MAWAckLevel","MAWCalculateBumpTimestampMs","MAWUserJidWrapper","WAJids","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a){var b=d("MAWUserJidWrapper").getMyUserJid();if(a.reactToAuthor!=="@me"&&a.reactToAuthor!==b||a.reaction==null)return null;b=a.author==="@me"||a.author==="@system"?null:a.author;return b==null?null:babelHelpers["extends"]({},a,{author:b,reaction:a.reaction,reactToAuthor:"@me"})}function b(a,b,c){var e=d("MAWUserJidWrapper").getMyUserJid();return a.find(function(a){return a.threadJid===b&&d("WAJids").authorToUserId(a.author,e)===d("WAJids").authorToUserId(c,e)})}function c(a){return a}function e(a,b,c,e,f,g,h,i,j,k,l,m,n){m===void 0&&(m=d("MAWAckLevel").ACK.clock);m={ack:m,author:k,externalId:b,groupingKey:g,reaction:f,reactionId:c,reactToAuthor:h,reactToExternalId:e,reactToMsgId:i,senderTimestampMs:n,threadJid:a,ts:j};return l!=null?babelHelpers["extends"]({},m,{rowId:l}):m}function f(a){a=d("MAWCalculateBumpTimestampMs").calculateBumpTimestampMsForReaction(a);return d("WATimeUtils").castToMillisTime((h||(h=d("I64"))).to_float(a))}g.castToIncomingDbReaction=a;g.findMatchingReaction=b;g.reactionIdToMsgId=c;g.formatReactionForDb=e;g.getReactionTimeMs=f}),98);
__d("MAWDbReactionsTxns",["FBLogger","MAWAuthor","MAWBridgeTypesCreators","MAWDbMsg","MAWDbMsgUtil","MAWDexieTable","MAWIndexedDb","WALogger","WAMsgMap","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Deleted "," reactions"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Successfully deleted: "," reactions rows."]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Successfully deleted reaction with id : ","."]);j=function(){return a};return a}var k=function(a){return a};function a(a,b){return a.reactions.put(k(b))}function b(a,b){return a.reactions["delete"](b.rowId).then(function(){var a=b.author,c=b.reactionId,e=b.reactToMsgId,f=b.threadJid;if(e==null)return;d("MAWIndexedDb").afterTransaction({tag:"DeleteReaction",value:d("MAWBridgeTypesCreators").createBridgeDeleteReaction({author:a,chatJid:f,reactToMsgId:e})});d("WALogger").LOG(j(),c)})}function e(a,b){return a.reactions.where("externalId").equals(b.externalId).filter(function(a){return a.author===b.author&&a.threadJid===b.chat}).first()}function f(a,b){var c=d("MAWAuthor").getAuthorUserJid(b.author);return a.reactions.where("reactToExternalId").equals(b.externalId).filter(function(a){return(a.reactToAuthor===c||a.reactToAuthor===b.author)&&a.threadJid===b.chat}).toArray()}function l(a,b){var d=b.reduce(function(a,b){a.set(b.msgId,b);return a},new Map());return a.reactions.where("reactToMsgId").anyOf(b.map(function(a){return a.msgId})).toArray().then(function(a){var b=a.filter(function(a){var b=a.reactToExternalId;a=a.reactToMsgId;return a!=null&&b===((b=d.get(a))==null?void 0:b.externalId)});b.length<a.length&&c("FBLogger")("messenger_e2ee_web").mustfix("Reactions query by reactToMsgId returns reactions with mismatching externalId");return b})}function m(a,b){return a.reactions.where("reactToMsgId").equals(b.msgId).toArray().then(function(a){var d=a.filter(function(a){a=a.reactToExternalId;return a===b.externalId});d.length<a.length&&c("FBLogger")("messenger_e2ee_web").mustfix("Reactions query by reactToMsgId returns reactions with mismatching externalId");return d})}function n(a,b){return l(a,[b])}function o(a,b){var c=b.author,d=b.chat;b=b.externalId;return a.reactions.where("externalId").equals(b).filter(function(a){return a.author===c&&a.threadJid===d}).first()}function p(a,b){var c=b.map(function(a){a=a.externalId;return a});return a.reactions.where("externalId").anyOf(c).toArray().then(function(a){var c=d("MAWDbMsgUtil").convertMsgArrayToMap(a),e=new(d("WAMsgMap").MsgMap)();b.forEach(function(a){var b=c.get(a);b!=null&&e.set(a,b)});return e})}function q(a,b){return d("MAWDexieTable").dexieAll(b.map(function(b){var c=b.author;b=b.externalId;var e=d("MAWAuthor").getAuthorUserJid(c);return a.reactions.where("reactToExternalId").equals(b).filter(function(a){return d("MAWAuthor").getAuthorUserJid(a.reactToAuthor)===e}).toArray()})).then(function(b){b=b.flat();b.forEach(function(a){var b=a.author,c=a.reactToMsgId;a=a.threadJid;if(c==null)return;d("MAWIndexedDb").afterTransaction({tag:"DeleteReaction",value:d("MAWBridgeTypesCreators").createBridgeDeleteReaction({author:b,chatJid:a,reactToMsgId:c})})});if(b.length===0)return;d("WALogger").LOG(i(),b.length);return a.reactions.bulkDelete(b.map(function(a){return a.rowId}))})}function r(a,b){return a.reactions.where("reactToMsgId").anyOf(b.map(function(a){return a.msgId}))["delete"]().then(function(a){d("WALogger").LOG(h(),a)})}function s(a,b){return a.reactions.where("reactionId").between(d("MAWDbMsg").msgIdsInChatLowerBound(b.chatId),d("MAWDbMsg").msgIdsInChatUpperBound(b.chatId)).last().then(function(a){a=a==null?0:d("MAWDbMsg").getInChatMsgIdFromMsgId(a.reactionId);return a+1})}function t(a,b,c,e,f,g,h){e=(e=e==null?void 0:e.ts)!=null?e:d("WATimeUtils").unixTime();return a.reactions.where(["threadJid","ts"]).between([b,(a=d("WATimeUtils").castMillisTimeToUnixTime(c))!=null?a:d("WATimeUtils").castToUnixTime(0)],[b,e],!0,f).reverse().filter(h).limit(g).toArray()}function u(a,b,c,e,f,g){c=c==null?null:c.ts;return a.reactions.where(["threadJid","ts"]).between([b,d("WATimeUtils").castToUnixTime(0)],[b,(a=c)!=null?a:d("WATimeUtils").unixTime()],!0,e).reverse().filter(g).limit(f).toArray()}g.coerceToReaction=k;g.putReaction=a;g.deleteReaction=b;g.getReaction=e;g.getReactionForEcho=f;g.getReactionsFromMessages=l;g.getReactionsForMessage=m;g.getReactionsFromMessage=n;g.maybeGetReactionByProtocolMsgId=o;g.getReactionMapByProtocolMsgId=p;g.deleteReactionsByUniqueMsgIdentifiers=q;g.deleteAllReactionsForMessages=r;g.getNextReactionIdNumberForThread=s;g.fetchReactionsFromDbWithTimestamp=t;g.fetchReactionsFromDbWithTimestamp_DEPRECATED=u}),98);
__d("WAMsgIdToMessageKey",["WAGlobals","WAJids"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=a.author,c=a.externalId;a=a.chat;var e=d("WAJids").isAuthorMe(b),f=d("WAJids").interpretAsGroupJid(a);b=e?d("WAGlobals").getMyUserJid():b;a=a;f=f!=null?b:void 0;return{fromMe:e,id:c,remoteJid:a,participant:f}}g.msgIdToMessageKey=a}),98);
__d("WAAsConsumerApplication",["WAAssertUnreachable","WAConsumerApplication.pb","WAMsgIdToMessageKey","WAMsgType","err"],(function(a,b,c,d,e,f,g){"use strict";b="image/jpeg";e="video/mp4";f="audio/wav";var h="image/gif",i="image/webp";function a(a){switch(a.type){case d("WAMsgType").MSG_TYPE.TEXT:return j(a);case d("WAMsgType").MSG_TYPE.REACTION:return k(a);case d("WAMsgType").MSG_TYPE.REVOKED:return l(a);default:return c("WAAssertUnreachable")(a.type)}}function j(a){var b={payload:{content:{messageText:{mentionedJid:[],text:a.msgContent.content}}}};if(a.specialTextSize!=null){a=a.specialTextSize===1?d("WAConsumerApplication.pb").CONSUMER_APPLICATION_METADATA_SPECIAL_TEXT_SIZE.SMALL:a.specialTextSize===2?d("WAConsumerApplication.pb").CONSUMER_APPLICATION_METADATA_SPECIAL_TEXT_SIZE.MEDIUM:d("WAConsumerApplication.pb").CONSUMER_APPLICATION_METADATA_SPECIAL_TEXT_SIZE.LARGE;b.metadata={specialTextSize:a}}return b}function k(a){if(a.reactToMsgId==null)throw c("err")("cannot send reaction that reacts to no message");var b=d("WAMsgIdToMessageKey").msgIdToMessageKey(a.reactToMsgId);b={groupingKey:a.groupingKey==null?void 0:a.groupingKey,key:b,senderTimestampMs:a.ts,text:a.reaction==null?void 0:a.reaction};return{payload:{content:{reactionMessage:b}}}}function l(a){a={remoteJid:a.id.chat,fromMe:!0,id:a.revokedExternalId};return{payload:{applicationData:{revoke:{key:a}}}}}g.IMAGE_MIME_TYPE=b;g.VIDEO_MIME_TYPE=e;g.AUDIO_MIME_TYPE=f;g.GIF_MIME_TYPE=h;g.STICKER_MIME_TYPE=i;g.asConsumerApplication=a;g.encodeTextMessage=j;g.encodeReactionMessage=k}),98);
__d("WAFrankingTypes",[],(function(a,b,c,d,e,f){"use strict";function a(a){return a}function b(a){return a}f.castToFrankingTag=a;f.castToFrankingKey=b}),66);
__d("WAFranking",["$InternalEnum","WACryptoDependencies","WACryptoHmac","WACryptoUtils","WAFrankingTypes","WAGlobals","WAPREList","WAPREMetrics","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h=32,i=0,j=b("$InternalEnum").Mirrored(["KEEP","DROP"]);function a(){var a=new Uint8Array(h);d("WACryptoDependencies").getCrypto().getRandomValues(a);return d("WAFrankingTypes").castToFrankingKey(a)}function c(a){return(a=a)!=null?a:i}function e(a,b){return d("WACryptoHmac").hmacSha256(a,b).then(function(a){return d("WAFrankingTypes").castToFrankingTag(new Uint8Array(a))})}function k(a,b,c,d){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c,e){switch(e){case void 0:case 0:e=(yield d("WACryptoHmac").hmacSha256(b,a));return d("WACryptoUtils").uint8ArraysEqual(new Uint8Array(e),c);default:return!0}});return l.apply(this,arguments)}function f(a,b){return m.apply(this,arguments)}function m(){m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var c;if(!d("WAGlobals").getConfig().isFrankingEnabled()||a.version==="v3"&&a.type==="instamadillo")return{decision:j.KEEP,updatedReportingMeta:b};var e=d("WAGlobals").getConfig().isFrankingDropOnInvalid();if((b==null?void 0:b.frankingTag)!=null&&((c=a.metadata)==null?void 0:c.frankingKey)==null){b.frankingTag=null;b.reportingTag=null;return{decision:j.KEEP,updatedReportingMeta:b}}if((b==null?void 0:b.frankingTag)!=null&&a.version==="v3"&&a.type==="subprotocol"&&((c=a.metadata)==null?void 0:c.frankingKey)!=null&&a.frankingContent!=null){c=b.frankingTag;var f=a.frankingContent,g=a.metadata.frankingVersion;a=d("WAFrankingTypes").castToFrankingKey(new Uint8Array(a.metadata.frankingKey));var h=d("WAPREMetrics").startMetric(d("WAPREList").PRE_METRIC.FRANKING_VALIDATION);if(a==null){h.endFail("tagButNoKey");return e?{decision:j.DROP,updatedReportingMeta:b}:{decision:j.KEEP,updatedReportingMeta:b}}if(!(yield k(new Uint8Array(f),a,c,g))){h.endFail("tagMismatch");return e?{decision:j.DROP,updatedReportingMeta:b}:{decision:j.KEEP,updatedReportingMeta:b}}b.frankingKey=a;b.reportingContent=f;h.endSuccess();return{decision:j.KEEP,updatedReportingMeta:b}}return d("WAGlobals").getConfig().isFrankingDropOnMissing()?{decision:j.DROP,updatedReportingMeta:b}:{decision:j.KEEP,updatedReportingMeta:b}});return m.apply(this,arguments)}g.FrankingDecision=j;g.createFrankingKey=a;g.getFrankingVersion=c;g.genFrankingTag=e;g.validateFrankingTag=k;g.handleAndValidateFrankingFromIncomingMsg=f}),98);
__d("WAAsMessageApplication",["WAAsConsumerApplication","WAConsumerApplication.pb","WAFranking","WAMsgApplication.pb","encodeProtobuf"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b;switch(a.type){default:b=d("WAAsConsumerApplication").asConsumerApplication(a)}var c=a.forwardingScore!=null?a.forwardingScore:0;a=a.isForwarded!=null?a.isForwarded:!1;c={metadata:{chatEphemeralSetting:null,forwardingScore:c,frankingKey:d("WAFranking").createFrankingKey(),frankingVersion:d("WAFranking").getFrankingVersion(),isForwarded:a,quotedMessage:null}};if(b!=null){a=d("encodeProtobuf").encodeProtobuf(d("WAConsumerApplication.pb").ConsumerApplicationSpec,b);c.payload={subProtocol:{consumerMessage:{payload:a.readBuffer(),version:1}}}}return d("encodeProtobuf").encodeProtobuf(d("WAMsgApplication.pb").MessageApplicationSpec,c).readByteArray()}function b(a){return a}function c(a){return a.buffer}g.asMessageApplication=a;g.castToMessageApplicationBytes=b;g.castMessageApplicationBytesToBytes=c}),98);
__d("MAWParseSubprotocolVersionConsts",[],(function(a,b,c,d,e,f){"use strict";a=2;b=2;c=1;d=2;e=1;var g=1;f.ASSOCIATED_MESSAGE_SUBPROTOCOL_VERSION=a;f.XMA_PREVIEW_SUBPROTOCOL_VERSION=b;f.XMA_FAVICON_SUBPROTOCOL_VERSION=c;f.XMA_HEADER_SUBPROTOCOL_VERSION=d;f.RAVEN_IMAGE_MESSAGE_SUBPROTOCOL_VERSION=e;f.RAVEN_VIDEO_MESSAGE_SUBPROTOCOL_VERSION=g}),66);
__d("MAWEchoToProtobufConversionLoggingUtils",["QPLUserFlow","qpl"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){c("QPLUserFlow").start(c("qpl")._(521484676,"2684"),{annotations:b,instanceKey:a})}function b(a,b,d){c("QPLUserFlow").endFailure(c("qpl")._(521484676,"2684"),b,{annotations:d,instanceKey:a})}function d(a,b){c("QPLUserFlow").endSuccess(c("qpl")._(521484676,"2684"),{annotations:b,instanceKey:a})}function e(a,b,d){d&&c("QPLUserFlow").addAnnotations(c("qpl")._(521484676,"2684"),d,{instanceKey:a}),c("QPLUserFlow").addPoint(c("qpl")._(521484676,"2684"),b,{instanceKey:a})}g.startQplUserFlow=a;g.endFailure=b;g.endSuccess=d;g.addPoint=e}),98);
__d("MAWRavenUtils",["EphemeralMediaViewMode","MAWMsg","RavenMessagingState"],(function(a,b,c,d,e,f,g){"use strict";var h=function(a){switch(a){case d("MAWMsg").MAWRavenMsgEphemeralMediaState.PERMANENT:return c("RavenMessagingState").PERMANENT;case d("MAWMsg").MAWRavenMsgEphemeralMediaState.UNSEEN:return c("RavenMessagingState").UNSEEN;case d("MAWMsg").MAWRavenMsgEphemeralMediaState.SEEN:return c("RavenMessagingState").SEEN;case d("MAWMsg").MAWRavenMsgEphemeralMediaState.REPLAYED:return c("RavenMessagingState").REPLAYED;case d("MAWMsg").MAWRavenMsgEphemeralMediaState.EXPIRED:return c("RavenMessagingState").EXPIRED}},i=function(a){switch(a){case d("MAWMsg").MAWRavenMsgEphemeralType.KEEP_IN_CHAT:return c("EphemeralMediaViewMode").PERMANENT;case d("MAWMsg").MAWRavenMsgEphemeralType.ALLOW_REPLAY:return c("EphemeralMediaViewMode").REPLAYABLE;case d("MAWMsg").MAWRavenMsgEphemeralType.VIEW_ONCE:return c("EphemeralMediaViewMode").READ_ONCE}};b=function(a,b){return{ephemeralMediaState:b,ephemeralMediaViewMode:i(a)}};function a(a,b){switch(b){case d("MAWMsg").MAWRavenMsgEphemeralType.VIEW_ONCE:return a===d("MAWMsg").MAWRavenMsgEphemeralMediaState.UNSEEN?c("RavenMessagingState").SEEN:h(a);case d("MAWMsg").MAWRavenMsgEphemeralType.ALLOW_REPLAY:if(a===d("MAWMsg").MAWRavenMsgEphemeralMediaState.UNSEEN)return c("RavenMessagingState").SEEN;else if(a===d("MAWMsg").MAWRavenMsgEphemeralMediaState.SEEN)return c("RavenMessagingState").REPLAYED;return h(a);case d("MAWMsg").MAWRavenMsgEphemeralType.KEEP_IN_CHAT:return h(a)}}g.getEphemeralMediaState=h;g.getEphemeralMediaViewMode=i;g.deriveRavenSettings=b;g.getNextRavenMessageEphemeralState=a}),98);
__d("WAJobRequirement",["Promise","WALogger"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["JobRequirement[","] blocker errored ",""]);i=function(){return a};return a}c=function(){function a(a){var c=this;this.$1=(h||(h=b("Promise"))).resolve();this.$2=!0;this.$3=null;this.$4=function(){var a=c.$3;if(a!=null){c.$3=null;return(h||(h=b("Promise"))).all(a).then(c.$4)}c.$2=!0};this.name=a}var c=a.prototype;c.addBlocker=function(a){var c=this;a=a["catch"](function(a){d("WALogger").ERROR(i(),c.name,a).sendLogs("job-blocker-rejected")});if(this.$2)this.$2=!1,this.$1=(h||(h=b("Promise"))).all([this.$1,a]).then(this.$4);else{var e=this.$3;e!=null?e.push(a):this.$3=[a]}};c.waitUntilSatisfied=function(){return this.$1};c.isSatisfied=function(){return this.$2};c.isSatisfiable=function(){return!0};return a}();e=function(a){babelHelpers.inheritsLoose(c,a);function c(c){c=a.call(this,c)||this;a.prototype.addBlocker.call(babelHelpers.assertThisInitialized(c),new(h||(h=b("Promise")))(function(){}));return c}var d=c.prototype;d.addBlocker=function(){};d.isSatisfiable=function(){return!1};return c}(c);function a(a,c){var d=a.filter(function(a){return!a.isSatisfiable()});if(d.length>0){var e=d.map(function(a){return a.name});return function(a){c==null?void 0:c("unsatisfiable",e,a);return d[0].waitUntilSatisfied()}}var f=a.map(function(){return(h||(h=b("Promise"))).resolve()}),g=(h||(h=b("Promise"))).resolve(),i=null,j=function c(){if(f.every(function(b,c){return b===a[c].waitUntilSatisfied()})){i=null;return}var d=[],e=a.map(function(a){var b=a.waitUntilSatisfied();a.isSatisfied()||(d.push(a.name),void b.then(function(){var b=d.indexOf(a.name);d.splice(b,1)}));return b});f=e;i=d;return(h||(h=b("Promise"))).all(e).then(c)};return function(a){if(i==null){var b=j();b!=null&&(g=g.then(function(){return b}))}c==null?void 0:c(i==null?"satisfied":"unsatisfied",i,a);return g}}g.JobRequirement=c;g.UnsatisfiableJobRequirement=e;g.joinRequirements=a}),98);
__d("WAPromiseBackoffs",["Promise","err"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b){if(a===0)return 0;var c=o(b.algo);for(var d=1;d<a;d++)c();return j(b,c())}function i(a){var b=a.relativeDelay,c=b===void 0?!1:b,d=null,e=o(a.algo);return function(){var b=d;if(b==null){d=c?Date.now():0;return 0}var f=j(a,e());if(c){var g=Date.now();b=g-b;b>0&&(f=Math.max(0,f-b));d=g}return f}}function d(a){var c=i(a);return function(a){return new(h||(h=b("Promise")))(function(b){var d=c();d>0?setTimeout(b,d,a):b(a)})}}function j(a,b){var c=a.max,d=a.min;a=a.jitter;a=a===void 0?.1:a;b=b;c!=null&&b>c&&(b=c);d!=null&&b<d&&(b=d);a!==0&&(b=Math.ceil(b*(1+a*Math.random())));return b}function k(a){var b=a.second-a.first,c=a.first-b;return function(){var a=b+c;c=b;b=a;return a}}function l(a){var b=a.base,c=b===void 0?2:b,d=a.first;return function(){var a=d;d*=c;return a}}function m(a){var b=a.delay;return function(){return b}}function n(a){var b=a.toMs;a=a.backoff;var c=o(a);return function(){return b(c())}}function o(a){switch(a.type){case"fibonacci":return k(a);case"exponential":return l(a);case"constant":return m(a);case"adjust":return n(a);default:a;throw c("err")("makeTimeFunc unrecognized backoff "+a.type)}}g.getDelay=a;g.createTimer=i;g.createPromiseTimer=d}),98);
__d("WAPersistedJobManager",["Promise","WAJobRequirement","WALogger","WAPromiseBackoffs","WATimeUtils","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose([""," waiting on ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose([""," halting because of ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["waitUntilCompletedNonPersisted not implemented in PersistedJobManager"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["fireAndForgetNonPersisted not implemented in PersistedJobManager"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose([""," has been loaded and is marked as deprecated"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["addPersistedJobImplementation called twice for ",""]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["onJobStarted for "," threw exception ",""]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["",": "," step not found"]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose([""," failed with error ",""]);q=function(){return a};return a}function r(){var a=babelHelpers.taggedTemplateLiteralLoose(["onJobFinished for "," threw exception ",""]);r=function(){return a};return a}function s(){var a=babelHelpers.taggedTemplateLiteralLoose(["",": finished job"]);s=function(){return a};return a}function t(){var a=babelHelpers.taggedTemplateLiteralLoose(["",": Unhandled exception: ",""]);t=function(){return a};return a}function u(){var a=babelHelpers.taggedTemplateLiteralLoose(["",": Unhandled exception. Tried "," times"]);u=function(){return a};return a}function v(){var a=babelHelpers.taggedTemplateLiteralLoose(["",": RetryOnBackoff"]);v=function(){return a};return a}function w(){var a=babelHelpers.taggedTemplateLiteralLoose(["",": requires page"]);w=function(){return a};return a}function x(){var a=babelHelpers.taggedTemplateLiteralLoose(["",": delaying until ",""]);x=function(){return a};return a}function y(){var a=babelHelpers.taggedTemplateLiteralLoose(["",": trim wait from "," to ",""]);y=function(){return a};return a}function z(){var a=babelHelpers.taggedTemplateLiteralLoose(["No implementation for ",".",""]);z=function(){return a};return a}function A(){var a=babelHelpers.taggedTemplateLiteralLoose(["",": removing completed, expired job from db"]);A=function(){return a};return a}function B(){var a=babelHelpers.taggedTemplateLiteralLoose(["",": skew detected, adjusting accordingly"]);B=function(){return a};return a}function C(){var a=babelHelpers.taggedTemplateLiteralLoose(["Running deprecated job ",""]);C=function(){return a};return a}function D(){var a=babelHelpers.taggedTemplateLiteralLoose(["No implementation for deprecated ",", job deleted"]);D=function(){return a};return a}function E(){var a=babelHelpers.taggedTemplateLiteralLoose(["No implementation for ",". Maybe it should have been put to the deprecated list?"]);E=function(){return a};return a}function F(){var a=babelHelpers.taggedTemplateLiteralLoose(["",": InterruptJob"]);F=function(){return a};return a}function G(){var a=babelHelpers.taggedTemplateLiteralLoose(["",": running step"]);G=function(){return a};return a}function H(){var a=babelHelpers.taggedTemplateLiteralLoose(["Persisted job missing for given ID"]);H=function(){return a};return a}function I(){var a=babelHelpers.taggedTemplateLiteralLoose(["No entry for job ",""]);I=function(){return a};return a}function J(){var a=babelHelpers.taggedTemplateLiteralLoose(["",": restarting"]);J=function(){return a};return a}function K(){var a=babelHelpers.taggedTemplateLiteralLoose(["",": stuck on the step ",", aborting the job"]);K=function(){return a};return a}var L=1,M=function(){function a(a){this.feature=a}var b=a.prototype;b.toString=function(){return"RequiresPage: "+this.feature};return a}(),N=function(){function a(a){this.backoffOptions=a}var b=a.prototype;b.toString=function(){return"RetryOnBackoff"};return a}();a=function(a){babelHelpers.inheritsLoose(b,a);function b(){return a.apply(this,arguments)||this}var c=b.prototype;c.toString=function(){return"NonRetryableError"};return b}(babelHelpers.wrapNativeSuper(Error));var O=function(a){this.result=a},P="$unstarted",Q="$finished";c=function(){function a(a){var c=this,e=a.isRestartAfterCrash,f=a.accessors,g=a.unfinishedJobEntries,i=new Map();g=g.then(function(a){var g=[],j=[];a.forEach(function(a){a.stepHardStartCountAfterTimeout>=5?g.push(a):j.push(a)});return(h||(h=b("Promise"))).all(g.map(function(a){d("WALogger").ERROR(K(),S(a),a.step).devConsole(R(a)).sendLogs("job-stuck-"+a.type);return f.deletePersistedJob(a.jobId)})).then(function(){j.forEach(function(a){if(i.has(a.jobId))return;d("WALogger").LOG(J(),R(a));i.set(a.jobId,c.$1(a,e))})})});this.implementationLoaders=new Map();this.implementations=new Map();this.stepBlockers=new WeakMap();this.accessors=f;this.activeJobs=i;this.initialJobsPromise=g;this.listeners=a.listeners;this.deprecatedJobs=a.deprecatedJobs}var c=a.prototype;c.loadAndRunJobFromId=function(a){var b=this.activeJobs.get(a);if(b!=null)return b;b=this.$2(a);this.activeJobs.set(a,b);return b};c.$2=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=this.initialJobsPromise,c=this.accessors;yield b;b=(yield c.readPersistedJob(a));if(!b){d("WALogger").DEV(I(),a);d("WALogger").WARN(H());return null}return this.$1(b,!1)});function c(b){return a.apply(this,arguments)}return c}();c.$3=function(a){var b=this.implementations,c=this.implementationLoaders,d=b.get(a);if(d)return d;d=c.get(a);if(!d)return null;c=d();b.set(a,c);return c};c.$4=function(a,c){if(c==null||c.length===0)return(h||(h=b("Promise"))).resolve();var e=this.stepBlockers,f=e.get(c);f==null&&(f=d("WAJobRequirement").joinRequirements(c.map(function(a){return a()}),U),e.set(c,f));return f(a)};c.$5=function(a,b,c,e){var f=this;c===void 0&&(c=!1);var g=a.step,h=b.findIndex(function(a){return a.stepName===g}),i=b[h].info(a.current,a.original,V(a,c)),j=i.requirements,k=i.code;i=this.$4(a,j);e&&(i=i.then(e));return i.then(function(){d("WALogger").LOG(G(),T(a));return k(a.current,a.original,V(a,c))}).then(function(e){if(e instanceof O){d("WALogger").LOG(F(),T(a));return e.result}var g=h+1;if(g>=b.length)return e;g=b[g];a.step=g.stepName;a.current=e;a.stepHardStartCountAfterTimeout=0;a.stepFirstStartTime=d("WATimeUtils").unixTime();a.stepUnexpectedErrorCount=0;a.waitUntil=null;a.backedOffCount=0;return f.accessors.updatePersistedJob(a).then(function(){return f.$5(a,b,c)})})};c.$1=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c){var e=this,f=this.accessors,g=this.activeJobs,i=this.deprecatedJobs,j=this.listeners,k=j.onJobFinished;j=j.onJobStarted;var l=(yield this.$3(a.type));i=i[a.type];if(!l){if(!i){d("WALogger").ERROR(E(),a.type).sendLogs("missing-job-implementation");yield f.deletePersistedJob(a.jobId);return null}else if(i==="NOOP"){d("WALogger").WARN(D(),a.type);yield f.deletePersistedJob(a.jobId);return null}l=(yield i())}var m=l;i&&d("WALogger").LOG(C(),a.type);var n=(i=a.stepFirstStartTime)!=null?i:d("WATimeUtils").unixTime();a.stepFirstStartTime=n;a.stepUnexpectedErrorCount=a.stepUnexpectedErrorCount||0;a.backedOffCount=a.backedOffCount||0;if(a.step===Q){i=a.waitUntil;var F=d("WATimeUtils").secondsUntil(n);i!=null&&d("WATimeUtils").isInFuture(i)&&F>0&&(d("WALogger").LOG(B(),R(a)),i=d("WATimeUtils").castToUnixTime(i-F),d("WATimeUtils").isInFuture(i)&&(a.stepFirstStartTime=d("WATimeUtils").castToUnixTime(n-F),a.waitUntil=i,yield this.accessors.updatePersistedJob(a)));(i==null||!d("WATimeUtils").isInFuture(i))&&(d("WALogger").LOG(A(),R(a)),yield f.deletePersistedJob(a.jobId));g["delete"](a.jobId);return a.current}F=a.step!==P?l.find(function(b){return b.stepName===a.step}):l[0];if(!F){d("WALogger").ERROR(z(),a.type,a.step).sendLogs("missing-job-step");yield f.deletePersistedJob(a.jobId);return null}a.step=F.stepName;i=function f(){var g=a.waitUntil,i=(h||(h=b("Promise"))).resolve();if(g!=null){var j=d("WATimeUtils").futureUnixTime(d("WATimeUtils").DAY_SECONDS);g>j?(d("WALogger").LOG(y(),T(a),g,j),a.waitUntil=j,i=e.accessors.updatePersistedJob(a).then(function(){return d("WATimeUtils").delayUntil(j)})):(d("WALogger").LOG(x(),T(a),g),i=d("WATimeUtils").delayUntil(g))}return i.then(function(){var g=function(){a.waitUntil=null;d("WATimeUtils").happenedWithin(n,d("WATimeUtils").DAY_SECONDS)||a.stepHardStartCountAfterTimeout++;return e.accessors.updatePersistedJob(a)};return e.$5(a,m,c,g)["catch"](function(c){if(c instanceof M){d("WALogger").LOG(w(),T(a));a.stepHardStartCountAfterTimeout>0&&(--a.stepHardStartCountAfterTimeout,e.accessors.updatePersistedJob(a));return new(h||(h=b("Promise")))(function(){})}else if(c instanceof N){d("WALogger").LOG(v(),T(a));var g=d("WAPromiseBackoffs").getDelay(++a.backedOffCount,c.backoffOptions);a.waitUntil=d("WATimeUtils").futureUnixTime(Math.ceil(g/1e3));a.stepHardStartCountAfterTimeout>0&&--a.stepHardStartCountAfterTimeout;return e.accessors.updatePersistedJob(a).then(f)}else if(a.stepUnexpectedErrorCount<L){d("WALogger").WARN(u(),T(a),a.stepUnexpectedErrorCount);d("WALogger").WARN(t(),T(a),c);a.stepUnexpectedErrorCount++;return e.accessors.updatePersistedJob(a).then(f)}throw c})})};var G=i();l=G.then(function(){var c=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){d("WALogger").LOG(s(),T(a));var c=null;try{c=k(a.jobId,a.type,a.original,b)}catch(b){d("WALogger").ERROR(r(),a.type,b).sendLogs("onJobFinished-threw")}c!=null&&c>0?(a.waitUntil=d("WATimeUtils").futureUnixTime(Math.ceil(c/1e3)),a.step=Q,a.current=b,a.stepFirstStartTime=d("WATimeUtils").unixTime(),yield e.accessors.updatePersistedJob(a)):(yield f.deletePersistedJob(a.jobId),g["delete"](a.jobId))});return function(a){return c.apply(this,arguments)}}(),function(){var e=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){d("WALogger").ERROR(q(),a.type,b).sendLogs("job-threw-exception-"+a.type);b=m.find(function(b){return b.stepName===a.step});if(!b)d("WALogger").ERROR(p(),a.type,a.step);else{b=b.info(a.current,a.original,V(a,c));b.stopRetryIf!=null&&(yield b.stopRetryIf.onStopRetry(a.current,a.original,V(a,c)))}yield f.deletePersistedJob(a.jobId);g["delete"](a.jobId)});return function(a){return e.apply(this,arguments)}}());try{j(a.jobId,a.type,a.original)}catch(b){d("WALogger").ERROR(o(),a.type,b).sendLogs("onJobStarted-threw")}return l.then(function(){return G})});function c(b,c){return a.apply(this,arguments)}return c}();c.addPersistedJobImplementation=function(a,b){var c=this.implementationLoaders,e=this.deprecatedJobs;if(c.has(a)){d("WALogger").ERROR(n(),a).sendLogs("repeat-job-loader");return}e&&e[a]&&d("WALogger").DEV(m(),a);c.set(a,b)};c.fireAndForget=function(a){var b=this;this.accessors.maybeCreateJob(a).then(function(a){a=a.id;return b.loadAndRunJobFromId(a)})};c.waitUntilPersisted=function(a){var b=this;return this.accessors.maybeCreateJob(a).then(function(a){a=a.id;b.loadAndRunJobFromId(a)})};c.waitUntilCompleted=function(a){var b=this;return this.accessors.maybeCreateJob(a).then(function(a){a=a.id;return b.loadAndRunJobFromId(a)})};c.fireAndForgetNonPersisted=function(a){d("WALogger").LOG(l())};c.waitUntilCompletedNonPersisted=function(a){return(h||(h=b("Promise"))).resolve(function(){return d("WALogger").LOG(k())})};return a}();function R(a){return"Job["+a.jobId+"] ("+a.type+")"}function S(a){return"[Job "+a.type+"] "}function T(a){return"Job["+a.jobId+"] ("+a.type+"."+a.step+")"}function U(a,b,c){a==="unsatisfiable"?d("WALogger").LOG(j(),T(c),b):a==="unsatisfied"?d("WALogger").LOG(i(),T(c),b):a}function V(a,b){b===void 0&&(b=!1);return{jobStartTime:a.startTime,afterCrash:b,interruptJob:W}}function W(a){return new O(a)}g.RequiresPage=M;g.RetryOnBackoff=N;g.NonRetryableError=a;g.InterruptJob=O;g.UNSTARTED_JOB=P;g.FINISHED_JOB=Q;g.PersistedJobManager=c}),98);
__d("WAWaitForComms",["WAResolvable"],(function(a,b,c,d,e,f,g){"use strict";var h=new(d("WAResolvable").Resolvable)();function a(){return h.promise}function b(){h.isSettled&&(h=new(d("WAResolvable").Resolvable)())}function c(){h.resolve()}function e(){return!h.resolveWasCalled()}function f(a){return h.reject(a)}g.waitForComms=a;g.commsConnectionLost=b;g.unblockComms=c;g.isStillWaitingForComms=e;g.failComms=f}),98);
__d("WAWaitForUserUnblocked",["WAResolvable","WorkerScheduler"],(function(a,b,c,d,e,f,g){"use strict";f=2*60*1e3;var h=new(d("WAResolvable").Resolvable)(),i=d("WorkerScheduler").makeScheduler("offline-queue",{concurrency:1,maxConcurrency:1,timeToStuckMs:f});function a(){h.resolveWasCalled()&&(h=new(d("WAResolvable").Resolvable)(),j())}function j(){void i.runTask({name:"offline-queue",fn:function(){return h.promise},priority:d("WorkerScheduler").BLOCKING_PRIORITY})}function b(){return h.promise}function c(){h.resolve()}function e(){return!h.resolveWasCalled()}g.maybeResetWaitForUserUnblocked=a;g.markOfflineQueueAsStarted=j;g.waitForUserUnblocked=b;g.unblockUser=c;g.isStillWaitingForUserUnblocked=e}),98);
__d("MAWSupportedDocumentTypes",[],(function(a,b,c,d,e,f){"use strict";var g=["apk","pyc","7z","z","gz","xz","rar","zip","zipx","ace","arc","zpaq","quad","balz","cab","arj","lzh","uue","bz","bz2","bzip2","jar","iso","tar","ade","adp","air","app","application","bas","bat","chm","cmd","com","command","cpl","crt","dll","dmg","dpkg","exe","hlp","hta","inf","ins","isp","jnlp","js","jse","lib","lnk","lua","mde","msc","msi","msp","mst","ocx","pcd","pif","pkg","ps1","reg","scr","sct","sh","shb","shs","sys","term","url","vb","vbe","vbs","vxd","webarchive","wsc","wsf","wsh","xbap"];function a(a){if(a==null)return!1;a=a.includes(".")?a.split(".").pop():null;return a!=null&&!g.includes(a)}f.isAllowedType=a}),66);
__d("WAProtocolMsgId",[],(function(a,b,c,d,e,f){"use strict";function a(a,b){return a.externalId===b.externalId&&a.author===b.author&&a.chat===b.chat}f.equals=a}),66);
__d("MAWEphemeralMsgUtils",[],(function(a,b,c,d,e,f){"use strict";function a(a){return function(b){return!a.has(b.msgId)&&b.ephemeralMsgDisappeared!==!0}}f.filterNonExpiredMsg=a}),66);
__d("MAWThreadUpdateType",[],(function(a,b,c,d,e,f){"use strict";a=0;b=1;c=2;d=3;e=Object.freeze({BUMP_THREAD:c,MARK_THREAD_AS_UNREAD:d,NO_SNIPPET_OR_ACTIVITY_TS_UPDATE:a,SNIPPET_ONLY:b});f.THREAD_UPDATE_TYPE=e}),66);
__d("MAWGetThreadUpdateTypeForAdminMsg",["FBLogger","MAWAdminMsgTypesGrouped","MAWLocalizationType","MAWThreadUpdateType"],(function(a,b,c,d,e,f,g){"use strict";function a(a){a=(a=a.msgContent)==null?void 0:a.adminType;if(a==null){c("FBLogger")("MAWCentralizedThreadUpdate").mustfix("nullAdminType");return d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.NO_SNIPPET_OR_ACTIVITY_TS_UPDATE}if(h(a))return d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.MARK_THREAD_AS_UNREAD;if(i(a))return d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.BUMP_THREAD;if(j(a))return d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.SNIPPET_ONLY;if(k(a))return d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.NO_SNIPPET_OR_ACTIVITY_TS_UPDATE;c("FBLogger")("MAWCentralizedThreadUpdate").mustfix("unsupportedAdminMsgType");return d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.NO_SNIPPET_OR_ACTIVITY_TS_UPDATE}function h(a){return d("MAWAdminMsgTypesGrouped").chatCustomizedByOtherUser.includes(a)||d("MAWAdminMsgTypesGrouped").callActionToNotifyAbout.includes(a)||d("MAWAdminMsgTypesGrouped").twoUsersConnected.includes(a)||d("MAWAdminMsgTypesGrouped").fallbackMsgFromOtherUser.includes(a)||d("MAWAdminMsgTypesGrouped").otherUserBumpsMessage.includes(a)||d("MAWAdminMsgTypesGrouped").otherNonAdminMsgToBeMarkedAsUnread.includes(a)||a===d("MAWLocalizationType").LOCALIZATION_TYPE.REACHABILITY_ERROR}function i(a){return d("MAWAdminMsgTypesGrouped").participantsAddedRemoved.includes(a)||d("MAWAdminMsgTypesGrouped").chatCustomizedByCurrentUser.includes(a)||d("MAWAdminMsgTypesGrouped").callActionNotToNotifyAbout.includes(a)||d("MAWAdminMsgTypesGrouped").fallbackMsgFromCurrentUser.includes(a)||d("MAWAdminMsgTypesGrouped").currentUserBumpsMessage.includes(a)||d("MAWAdminMsgTypesGrouped").otherNonAdminMsgToBeBumped.includes(a)}function j(a){return a===d("MAWLocalizationType").LOCALIZATION_TYPE.CUTOVER_ROLLBACK_ADMIN_MESSAGE||d("MAWAdminMsgTypesGrouped").ephemeralSettingChanges.includes(a)||d("MAWAdminMsgTypesGrouped").groupPermissionsChanged.includes(a)||d("MAWAdminMsgTypesGrouped").participantLeftGroup.includes(a)||d("MAWAdminMsgTypesGrouped").pinnedMessageUpdate.includes(a)}function k(a){return d("MAWAdminMsgTypesGrouped").cutoverAdminMsgs.includes(a)||d("MAWAdminMsgTypesGrouped").deviceChanges.includes(a)||d("MAWAdminMsgTypesGrouped").icdcAlerts.includes(a)||d("MAWAdminMsgTypesGrouped").otherNonAdminMsgToNotTriggerUpdate.includes(a)||a===d("MAWLocalizationType").LOCALIZATION_TYPE.E2EE_THREAD_DESCRIPTION||a===d("MAWLocalizationType").LOCALIZATION_TYPE.EMPTY_SNIPPET||a===d("MAWLocalizationType").LOCALIZATION_TYPE.DEBUG_MSG||a===d("MAWLocalizationType").LOCALIZATION_TYPE.E2EE_THREAD_UK_OSA_ADMIN_MESSAGE}g.getThreadUpdateTypeForAdminMsg=a}),98);
__d("MAWGetThreadUpdateType",["FBLogger","MAWDbMsgOrReaction","MAWGetThreadUpdateTypeForAdminMsg","MAWThreadSnippetUtils","MAWThreadUpdateType","MAWUserJidWrapper","WAJids","err"],(function(a,b,c,d,e,f,g){"use strict";function h(a){c("FBLogger")("MAWCentralizedThreadUpdate").mustfix("GetThreadUpdateType not implemented for message type %s",a.type);return d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.NO_SNIPPET_OR_ACTIVITY_TS_UPDATE}function i(a){var b=a.reaction==null;return k(a,b)}function j(a){return l(a.reactToAuthor)&&!l(a.author)}function k(a,b){if(j(a)&&!b)if(a.senderTimestampMs==null)return d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.SNIPPET_ONLY;else return d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.MARK_THREAD_AS_UNREAD;else return d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.NO_SNIPPET_OR_ACTIVITY_TS_UPDATE}function l(a){return a===d("WAJids").AUTHOR_ME||a===d("MAWUserJidWrapper").getMyUserJid()}function m(a,b){var c=b.me;b=b.other;return d("WAJids").isAuthorMe(a.author)?c:b}function n(a){var b=a.type;switch(b){case"Text":case"ReceiverFetch":case"Sticker":case"Unavailable":case"Video":case"Futureproof":case"DocumentFile":case"EphemeralScreenshotAction":case"Gif":case"Image":case"Ptt":case"RavenAction":case"Raven":case"GroupPollCreate":case"GroupPollUpdate":return m(a,{me:d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.BUMP_THREAD,other:d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.MARK_THREAD_AS_UNREAD});case"XMA":return d("MAWThreadSnippetUtils").shouldIgnoreXMAMsgForSnippet(a)?d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.NO_SNIPPET_OR_ACTIVITY_TS_UPDATE:m(a,{me:d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.BUMP_THREAD,other:d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.MARK_THREAD_AS_UNREAD});case"Revoked":return d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.BUMP_THREAD;case"DeleteForMe":return d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.NO_SNIPPET_OR_ACTIVITY_TS_UPDATE;case"BumpExistingMessage":return d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.BUMP_THREAD;case"EditAction":return m(a,{me:d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.SNIPPET_ONLY,other:d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.NO_SNIPPET_OR_ACTIVITY_TS_UPDATE});case"GroupInvite":return d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.BUMP_THREAD;case"Admin":var e;if(a.type==="Admin")return d("MAWGetThreadUpdateTypeForAdminMsg").getThreadUpdateTypeForAdminMsg(a);throw c("err")("Non-admin msg passed in "+((e=a.type)!=null?e:"UNKNOWN"));case"SenderKeyDistribution":return d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.NO_SNIPPET_OR_ACTIVITY_TS_UPDATE;case"AlertICDC":return d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.BUMP_THREAD;case"Ciphertext":return d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.BUMP_THREAD;case"EphemeralSettingAdmin":case"EphemeralSettingChangeFromCurrentDevice":case"EphemeralSyncResponse":return d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.SNIPPET_ONLY;case"ExpiredEphemeral":return h(a);default:b;throw c("err")("[MAWGetThreadUpdateType] Unexpected message type: "+((e=a.type)!=null?e:"UNKNOWN"))}}function a(a){return d("MAWDbMsgOrReaction").switchOnMsgOrReactionNullish(a,{forMessage:function(a){return n(a)},forNull:function(){return d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.NO_SNIPPET_OR_ACTIVITY_TS_UPDATE},forReaction:function(a){return i(a)}})}g.getThreadUpdateTypeForReaction=i;g.canReactionAffectBump=j;g.getReactionThreadUpdateType=k;g.getThreadUpdateTypeForMsg=n;g.getThreadUpdateTypeForMsgOrReaction=a}),98);
__d("MAWReceiverBumpEligibilityCache",["WAMsg"],(function(a,b,c,d,e,f,g){"use strict";var h=new Set();function a(a){a.forEach(function(a){var b=a.msgData;a=a.stanzaSource;b=d("WAMsg").craftWAMsgIdString(b.id);switch(a){case"wa":h.add(b);break;case"ebrestore":h["delete"](b);break;default:a;break}})}g.RECEIVER_BUMP_ELIGIBILITY_CACHE=h;g.updateReceiverBumpEligibilityCache=a}),98);
__d("MAWUpdateThreadBumpTimestamp",["FBLogger","I64","MAWAckLevel","MAWBridgeTypesCreators","MAWCalculateBumpTimestampMs","MAWDbMsg","MAWDbMsgOrReaction","MAWFolderTypes","MAWIndexedDb","MAWMsgType","MAWODSProxy","MAWReceiverBumpEligibilityCache","MAWThreadBumpType","MAWThreadSnippetUtils","MAWThreadUpdateMiddlewareGatingUtil","MAWThreadUpdateType","WALogger","gkx","nullthrows","qex"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[Occamadillo][Middleware] Downgrading ThreadUpdateType for thread ",": from "," to SNIPPET_ONLY because msg/reaction is not in receiver bump cache from Offline Queue"]);i=function(){return a};return a}function a(a){var b=a.bumpMsgOrReaction,c=a.db,e=a.sentByLocalDevice,f=a.thread,g=a.threadUpdateType,h=a.unbumpTrigger;return d("MAWThreadSnippetUtils").getThreadSnippetFromScratch(c,f.jid).then(function(c){var d;d=n((d=h)!=null?d:b,g,e);if(c==null)return;j(babelHelpers["extends"]({},a,{threadUpdateType:d}),c)})}function j(a,b){var e=a.bumpMsgOrReaction,f=a.isThrottled;f=f===void 0?!1:f;var g=a.odsBumpParams,h=a.sentByLocalDevice,i=a.tableName,j=a.thread,n=a.threadUpdateType;a=a.unbumpTrigger;var p;switch(n){case d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.NO_SNIPPET_OR_ACTIVITY_TS_UPDATE:p=!1;break;case d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.SNIPPET_ONLY:p=!0;l("Updating snippet only since no message is eligible for bump",j,c("nullthrows")(b));break;case d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.MARK_THREAD_AS_UNREAD:case d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.BUMP_THREAD:if(e==null)throw c("FBLogger")("messenger_e2ee_web").mustfixThrow("[Occamadillo][Middleware] Unexpected null bumpMsgOrReaction.");p=!0;a=o(e,a,h,f,i);k(e,a,j);m(e,a,j,n,c("nullthrows")(b));break;default:n;p=!1;break}p&&d("MAWODSProxy").odsBumpEntityKey(g)}function k(a,b,c){var e=d("MAWDbMsgOrReaction").switchOnMsgOrReaction(a,{forMessage:function(){return!0},forReaction:function(){return!1}});if(!e)return;if(b.bumpedByLocalDeviceSend===!0)e="outgoing_message";else if(a.ack===d("MAWAckLevel").ACK.received)e="incoming_message";else return;if(!d("MAWThreadUpdateMiddlewareGatingUtil").isNewMiThreadCreationFlowEnabled("exposure_logging_enabled"))return;d("MAWIndexedDb").afterTransaction({tag:"CreateE2EEMetadataThread",value:{bumpTimestampMs:b.bumpTimestampMs,creationSource:e,folderId:(a=c.folder)!=null?a:d("MAWFolderTypes").INBOX,jid:c.jid,threadKeys:{authoritative:c.authoritativeThreadKey,optimistic:c.optimisticThreadKey}}})}function l(a,b,c){var e;d("MAWIndexedDb").afterTransaction({tag:"CentralizedThreadUpdate",value:d("MAWBridgeTypesCreators").createBridgeCentralizedThreadUpdate({centralizedThreadBumpData:null,centralizedThreadSnippetData:{snippetContactIDs:c.snippetParams.contactIDs,snippetMentionJIDs:(e=c.snippetParams.mentionJIDs)!=null?e:[],snippetParams:c.snippetParams.strings,snippetSenderContactId:c.snippetSenderContactId,snippetType:c.snippetType},description:a,jid:b.jid,threadUpdateType:d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.SNIPPET_ONLY})})}function m(a,b,c,e,f){d("MAWIndexedDb").afterTransaction({tag:"CentralizedThreadUpdate",value:d("MAWBridgeTypesCreators").createBridgeCentralizedThreadUpdate({centralizedThreadBumpData:b,centralizedThreadSnippetData:{snippetContactIDs:f.snippetParams.contactIDs,snippetMentionJIDs:(b=f.snippetParams.mentionJIDs)!=null?b:[],snippetParams:f.snippetParams.strings,snippetSenderContactId:f.snippetSenderContactId,snippetType:f.snippetType},description:d("MAWDbMsgOrReaction").switchOnMsgOrReaction(a,{forMessage:function(a){return"CentralizedThreadUpdate-MsgType:"+a.type},forReaction:function(){return"CentralizedThreadUpdate-Reaction"}}),jid:c.jid,threadUpdateType:e})})}function n(a,b,e){if((a==null?void 0:a.type)===d("MAWMsgType").MSG_TYPE.REVOKED)switch(b){case d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.NO_SNIPPET_OR_ACTIVITY_TS_UPDATE:case d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.SNIPPET_ONLY:return b;case d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.MARK_THREAD_AS_UNREAD:case d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.BUMP_THREAD:return d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.SNIPPET_ONLY;default:b;return d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.NO_SNIPPET_OR_ACTIVITY_TS_UPDATE}if(e||a==null)return b;switch(b){case d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.NO_SNIPPET_OR_ACTIVITY_TS_UPDATE:case d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.SNIPPET_ONLY:return b;case d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.MARK_THREAD_AS_UNREAD:case d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.BUMP_THREAD:if(!d("MAWReceiverBumpEligibilityCache").RECEIVER_BUMP_ELIGIBILITY_CACHE.has(d("MAWDbMsg").getWAMsgId(a))){var f;e=[a.threadJid,b];d("WALogger").LOG(i(),e[0],e[1]);(f=c("FBLogger")("CentralizedThreadUpdate")).info.apply(f,["[Occamadillo][Middleware] Downgrading ThreadUpdateType for thread %s: from %s to SNIPPET_ONLY because msg/reaction is not in receiver bump cache from Offline Queue"].concat(e));d("MAWReceiverBumpEligibilityCache").RECEIVER_BUMP_ELIGIBILITY_CACHE["delete"](d("MAWDbMsg").getWAMsgId(a));return d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.SNIPPET_ONLY}return b;default:b;return d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.NO_SNIPPET_OR_ACTIVITY_TS_UPDATE}}function o(a,b,c,d,e){var f=b!=null;return{author:a.author,bumpedByLocalDeviceSend:c,bumpTimestampMs:q(a),isThrottled:d,isUnbump:f,tableName:e,threadBumpType:p((c=b)!=null?c:a,f)}}function p(a,b){return d("MAWDbMsgOrReaction").switchOnMsgOrReactionNullish(a,{forMessage:function(a){return d("MAWAckLevel").isMsgAuthoritative(a.ack)&&a.serverTs!=null?d("MAWThreadBumpType").THREAD_BUMP_TYPE.LOCAL_AND_SERVER:c("qex")._("1706")?d("MAWThreadBumpType").THREAD_BUMP_TYPE.NO_UPDATE:d("MAWThreadBumpType").THREAD_BUMP_TYPE.LOCAL_ONLY},forNull:function(){return d("MAWThreadBumpType").THREAD_BUMP_TYPE.NO_UPDATE},forReaction:function(){return b&&!c("gkx")("7007")?d("MAWThreadBumpType").THREAD_BUMP_TYPE.LOCAL_ONLY:d("MAWThreadBumpType").THREAD_BUMP_TYPE.LOCAL_AND_SERVER}})}function q(a){return d("MAWDbMsgOrReaction").switchOnMsgOrReactionNullish(a,{forMessage:function(a){return d("MAWCalculateBumpTimestampMs").calculateBumpTimestampMsForMsg({msg:a,throwIfNoServerTs:d("MAWAckLevel").isMsgAuthoritative(a.ack)&&a.serverTs!=null})},forNull:function(){return(h||(h=d("I64"))).zero},forReaction:d("MAWCalculateBumpTimestampMs").calculateBumpTimestampMsForReaction})}g.updateThreadViaCentralizedThreadUpdate=a;g.updateThreadViaValidatedCentralizedThreadUpdate=j;g.updateSnippetViaCentralizedThreadHandler=l;g.getBumpTimestampMs=q}),98);
__d("last",[],(function(a,b,c,d,e,f){"use strict";function a(a){var b=null;if(Array.isArray(a)||typeof a==="string")a.length&&(b={value:a[a.length-1]});else for(var a=a,c=Array.isArray(a),d=0,a=c?a:a[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var e;if(c){if(d>=a.length)break;e=a[d++]}else{d=a.next();if(d.done)break;e=d.value}e=e;b=b||{};b.value=e}return b?b.value:null}f["default"]=a}),66);
__d("MAWThreadNewestMsgOrReactionUtils",["MAWDbMsg","MAWDbMsgTxns","MAWDbReaction","MAWDbReactionsTxns","MAWDexieTable","MAWGetThreadUpdateType","MAWODSProxy","MAWThreadUpdateType","WALogger","WAMsg","WAOdsEnums","WATimeUtils","err","first","gkx","last"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[CentralizedThreadUpdate] No Reaction or Message in "," is eligible for snippet"]);h=function(){return a};return a}function a(a,b){return k(a,b,i)}function i(a,b){switch(a){case d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.BUMP_THREAD:case d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.MARK_THREAD_AS_UNREAD:return b!==!0;case d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.NO_SNIPPET_OR_ACTIVITY_TS_UPDATE:case d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.SNIPPET_ONLY:return!1;default:throw c("err")("[MAWCentralizedThreadUpdate] Unhandled threadUpdateType to create filter function : "+a)}}function b(a,b){return k(a,b,j)}function j(a,b){switch(a){case d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.SNIPPET_ONLY:case d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.BUMP_THREAD:case d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.MARK_THREAD_AS_UNREAD:return b!==!0;case d("MAWThreadUpdateType").THREAD_UPDATE_TYPE.NO_SNIPPET_OR_ACTIVITY_TS_UPDATE:return!1;default:throw c("err")("[MAWCentralizedThreadUpdate] Unhandled threadUpdateType to create filter function : "+a)}}function k(a,b,e){var f=function(f){return c("gkx")("9053")?f==null?d("MAWDexieTable").dexieResolve(null):m(a,b,e,f):n(a,b,e,f!=null?d("MAWDbMsg").getSortOrderWithFallback(f):Number.MIN_SAFE_INTEGER)};return l(a,b,e).then(function(a){return f(a).then(function(c){if(a==null&&c==null){d("WALogger").WARN(h(),b);return null}if(c==null)return a;if(a==null)return c;var e=d("WATimeUtils").castToMillisTime(d("MAWDbMsg").getSortOrderWithFallback(a)),f=d("MAWDbReaction").getReactionTimeMs(c);return e>=f?a:c})})}function l(a,b,e){return d("MAWDbMsgTxns").fetchMessagesFromDbWithSortOrderMs(a,b,null,!0,1,function(a){return e(d("MAWGetThreadUpdateType").getThreadUpdateTypeForMsg(a),a.ephemeralMsgDisappeared===!0)},"before").then(c("first"))}function m(a,b,e,f){var g=d("MAWDbMsg").getSortOrderWithFallback(f),h=function(c,f){return d("MAWDbReactionsTxns").fetchReactionsFromDbWithTimestamp(a,b,d("WATimeUtils").castToMillisTime(g),f,f==null,c,function(a){return e(d("MAWGetThreadUpdateType").getThreadUpdateTypeForReaction(a),!1)&&d("MAWDbReaction").getReactionTimeMs(a)>g})},i=[1,10],j=100,k=new Set();f=function b(e,f){var g;return h((g=i[e])!=null?g:j,f).then(function(f){var g=f.filter(function(a){return!k.has(q(a))});if(g.length===0){d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.MAW_THREAD_GET_NEWEST_REACTION_BATCH_NUM,key:"new."+e});return null}return o(a,g).then(function(a){var g=a.newestReaction;a=a.nullMsgIds;if(g!=null){d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.MAW_THREAD_GET_NEWEST_REACTION_BATCH_NUM,key:"new."+e});return g}a.forEach(function(a){return k.add(a)});return b(e+1,c("last")(f))})})};return f(0,null)}function n(a,b,e,f){f===void 0&&(f=Number.MIN_SAFE_INTEGER);var g=function(c,g){return d("MAWDbReactionsTxns").fetchReactionsFromDbWithTimestamp_DEPRECATED(a,b,g,g==null,c,function(a){return e(d("MAWGetThreadUpdateType").getThreadUpdateTypeForReaction(a),!1)&&d("MAWDbReaction").getReactionTimeMs(a)>f})},h=[1,10],i=100,j=new Set(),k=function b(e,f){var k;return g((k=h[e])!=null?k:i,f).then(function(f){if(f.length===0){d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.MAW_THREAD_GET_NEWEST_REACTION_BATCH_NUM,key:"old."+e});return null}return o(a,f.filter(function(a){return!j.has(q(a))})).then(function(a){var g=a.newestReaction;a=a.nullMsgIds;if(g!=null){d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.MAW_THREAD_GET_NEWEST_REACTION_BATCH_NUM,key:"old."+e});return g}a.forEach(function(a){return j.add(a)});return b(e+1,c("last")(f))})})};return k(0,null)}function o(a,b){return d("MAWDbMsgTxns").getUniqueMsgsByProtocolMsgIds(a,b.map(p)).then(function(a){var c=new Set(a.map(r)),d=new Set(),e=null;b.forEach(function(a){var b=q(a);c.has(b)?e=s(e,a):d.add(b)});return{newestReaction:e,nullMsgIds:d}})}function p(a){return{author:a.reactToAuthor,chat:a.threadJid,externalId:a.reactToExternalId}}function q(a){return d("WAMsg").craftWAMsgIdString(p(a))}function r(a){return d("WAMsg").craftWAMsgIdString({author:a.author,chat:a.threadJid,externalId:a.externalId})}function s(a,b){if(a==null)return b;return b==null?a:d("MAWDbReaction").getReactionTimeMs(a)>d("MAWDbReaction").getReactionTimeMs(b)?a:b}g.getNewestMsgOrReactionForBump=a;g.getNewestMsgOrReactionForSnippet=b;g.getNewestReactionToNonNullMsg=o}),98);
__d("MAWLocalizationUtils",["MAWAckLevel","MAWExternalId","MAWLocalizationType","MAWMsgType","WAJids","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";var h=new Set([(f=d("MAWLocalizationType")).LOCALIZATION_TYPE.CURRENT_USER_CREATED_POLL,f.LOCALIZATION_TYPE.PARTICIPANT_CREATED_POLL,f.LOCALIZATION_TYPE.CURRENT_USER_ADDED_POLL_OPTION,f.LOCALIZATION_TYPE.PARTICIPANT_ADDED_POLL_OPTION,f.LOCALIZATION_TYPE.CURRENT_USER_ADDED_MULTIPLE_POLL_OPTIONS,f.LOCALIZATION_TYPE.PARTICIPANT_ADDED_MULTIPLE_POLL_OPTIONS,f.LOCALIZATION_TYPE.CURRENT_USER_ADDED_POLL_VOTE,f.LOCALIZATION_TYPE.PARTICIPANT_ADDED_POLL_VOTE,f.LOCALIZATION_TYPE.CURRENT_USER_ADDED_MULTIPLE_POLL_VOTES,f.LOCALIZATION_TYPE.PARTICIPANT_ADDED_MULTIPLE_POLL_VOTES,f.LOCALIZATION_TYPE.CURRENT_USER_REMOVED_POLL_VOTE,f.LOCALIZATION_TYPE.PARTICIPANT_REMOVED_POLL_VOTE,f.LOCALIZATION_TYPE.CURRENT_USER_REMOVED_MULTIPLE_POLL_VOTES,f.LOCALIZATION_TYPE.PARTICIPANT_REMOVED_MULTIPLE_POLL_VOTES,f.LOCALIZATION_TYPE.CURRENT_USER_MIXED_POLL_UPDATE,f.LOCALIZATION_TYPE.PARTICIPANT_MIXED_POLL_UPDATE,f.LOCALIZATION_TYPE.CURRENT_USER_CHANGED_POLL_VOTE,f.LOCALIZATION_TYPE.PARTICIPANT_CHANGED_POLL_VOTE,f.LOCALIZATION_TYPE.CURRENT_USER_CHANGED_MULTIPLE_POLL_VOTES,f.LOCALIZATION_TYPE.PARTICIPANT_CHANGED_MULTIPLE_POLL_VOTES,f.LOCALIZATION_TYPE.POLL_UNSENT_UPDATE]);function a(a,b,c,e,f){return{ack:d("MAWAckLevel").ACK.sent,altIndex:(e=e)!=null?e:void 0,author:d("WAJids").AUTHOR_SYSTEM,externalId:d("MAWExternalId").generateExternalId(),msgContent:a,sortOrderMs:f,threadJid:b,ts:(e=c)!=null?e:d("WATimeUtils").unixTime(),type:d("MAWMsgType").MSG_TYPE.ADMIN}}function b(a){if(h.has(a))return!0;switch(a){case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_NAMED_GROUP:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_NAMED_GROUP:case d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_NAMED_GROUP:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_ADDED_ONE_PARTICIPANT:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_ADDED_TWO_PARTICIPANTS:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_ADDED_MORE_THAN_TWO_PARTICIPANTS:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_YOU:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_YOU_AND_ONE_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_YOU_AND_MORE_THAN_ONE_USERS:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_ONE_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_TWO_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_MORE_THAN_TWO_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_REMOVED_ONE_PARTICIPANT:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_REMOVED_TWO_PARTICIPANTS:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_REMOVED_MORE_THAN_TWO_PARTICIPANTS:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REMOVED_YOU:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REMOVED_YOU_AND_ONE_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REMOVED_YOU_AND_MORE_THAN_ONE_USERS:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REMOVED_ONE_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REMOVED_TWO_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REMOVED_MORE_THAN_TWO_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_LEFT_GROUP:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SELF_DEMOTED:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_PROMOTED_PARTICIPANT:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_DEMOTED_PARTICIPANT:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_GOT_PROMOTED:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_GOT_DEMOTED:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_GOT_PROMOTED:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_GOT_DEMOTED:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_PROMOTED_YOU:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_DEMOTED_YOU:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_PROMOTED_PARTICIPANT:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SELF_DEMOTED:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_DEMOTED_PARTICIPANT:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_ADDED_DEVICE:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_DEVICE:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_REMOVED_DEVICE:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REMOVED_DEVICE:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_UPDATED_DEVICE:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_UPDATED_DEVICE:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_CUSTOMIZE_HOTLIKE:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_CUSTOMIZE_NICKNAME:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_CUSTOMIZE_THEME:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_CUSTOMIZE_PHOTO:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_PINNED_MESSAGE:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_UNPINNED_MESSAGE:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_CUSTOMIZE_HOTLIKE:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_CUSTOMIZE_THEME:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_CUSTOMIZE_PHOTO:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_PINNED_MESSAGE:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_UNPINNED_MESSAGE:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_CUSTOMIZE_PARTICIPANT_NICKNAME:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_CLEAR_PARTICIPANT_NICKNAME:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_CUSTOMIZE_CURRENT_USER_NICKNAME:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SET_OWN_NICKNAME:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_CLEAR_OWN_NICKNAME:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_CLEAR_PARTICIPANT_NICKNAME:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SET_OWN_NICKNAME:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_CLEAR_OWN_NICKNAME:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_CLEAR_CURRENT_USER_NICKNAME:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_TURNED_ON_MINUTES:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_CHANGE_MINUTES:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_TURNED_ON_HOURS:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_CHANGE_HOURS:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_TURNED_ON_DAYS:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_CHANGE_DAYS:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_TURNED_OFF:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_TURNED_ON_SECONDS:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_CHANGE_SECONDS:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_TAKE_SCREENSHOT:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_RECORD_SCREEN:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SET_ADD_MODE_ADMIN_ONLY:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SET_ADD_MODE_ALL_MEMBERS:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SET_ADD_MODE_ADMIN_ONLY:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SET_ADD_MODE_ALL_MEMBERS:case d("MAWLocalizationType").LOCALIZATION_TYPE.SERVER_SET_ADD_MODE_ADMIN_ONLY:case d("MAWLocalizationType").LOCALIZATION_TYPE.SERVER_SET_ADD_MODE_ALL_MEMBERS:case d("MAWLocalizationType").LOCALIZATION_TYPE.E2EE_THREAD_UK_OSA_ADMIN_MESSAGE:return!0}return!1}function c(a){switch(a){case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_ADDED_DEVICE:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_REMOVED_DEVICE:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_UPDATED_DEVICE:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_DEVICE:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REMOVED_DEVICE:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_UPDATED_DEVICE:return!0}return!1}function e(a){switch(a){case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_ADDED_ONE_PARTICIPANT:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_ADDED_TWO_PARTICIPANTS:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_ADDED_MORE_THAN_TWO_PARTICIPANTS:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_YOU:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_YOU_AND_ONE_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_YOU_AND_MORE_THAN_ONE_USERS:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_ONE_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_TWO_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_MORE_THAN_TWO_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_ADDED_YOU:case d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_ADDED_YOU_AND_ONE_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_ADDED_YOU_AND_MORE_THAN_ONE_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_ADDED_ONE_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_ADDED_TWO_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_ADDED_MORE_THAN_TWO_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_REMOVED_ONE_PARTICIPANT:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_REMOVED_TWO_PARTICIPANTS:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_REMOVED_MORE_THAN_TWO_PARTICIPANTS:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REMOVED_YOU:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REMOVED_YOU_AND_ONE_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REMOVED_YOU_AND_MORE_THAN_ONE_USERS:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REMOVED_ONE_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REMOVED_TWO_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REMOVED_MORE_THAN_TWO_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_REMOVED_YOU:case d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_REMOVED_YOU_AND_ONE_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_REMOVED_YOU_AND_MORE_THAN_ONE_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_REMOVED_ONE_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_REMOVED_TWO_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_REMOVED_MORE_THAN_TWO_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_LEFT_GROUP:return!0}return!1}g.POLL_ADMIN_MSG_TYPES=h;g.buildUnstoredDbAdminMsg=a;g.isAdminMsgNormalized=b;g.isDeviceChangeAdminMsg=c;g.isParticipantChangeAdminMsg=e}),98);
__d("MAWThreadSnippetForAdminOrEphemeralMsg",["FBLogger","MAWAdminMsgNormalized","MAWLocalizationType","MAWLocalizationUtils"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){var e;e=(e=a.msgContent)==null?void 0:e.adminType;a=(a=a.msgContent)==null?void 0:a.adminMsgContent;if(e==null||a==null){c("FBLogger")("GroupPollsE2EE").mustfix("MAWThreadSnippetForAdminOrEphemeralMsg: snippetType or adminMsgContent is null");return{snippetParams:{contactIDs:[],strings:[]},snippetSenderContactId:b,snippetType:d("MAWLocalizationType").LOCALIZATION_TYPE.UNAVAILABLE_SNIPPET}}a=d("MAWLocalizationUtils").isAdminMsgNormalized(e)?d("MAWAdminMsgNormalized").deconstructContactIdsFromAdminContent(e,a):{contactIds:[],contents:a};var f=a.contactIds;a=a.contents;return{snippetParams:{contactIDs:[].concat(f.map(function(a){return a==="Facebook User"?"0":a})),strings:[].concat(a)},snippetSenderContactId:b,snippetType:e}}g["default"]=a}),98);
__d("MAWThreadSnippetForBumpExistingMessageMsg",["MAWLocalizationType","WAJids","WALogger","WAMsgType"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Bump message sender is null"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Bump message has no quoted author"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Bump message has unavailable content type"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Bumped message can not have AUTHOR_SYSTEM"]);k=function(){return a};return a}function l(a,b,c){return{snippetParams:{contactIDs:(c=c)!=null?c:[],strings:[]},snippetSenderContactId:a,snippetType:b}}var m=function(a){return l(a,d("MAWLocalizationType").LOCALIZATION_TYPE.UNAVAILABLE_SNIPPET)};function a(a,b,c){var e;if(d("WAJids").isAuthorSystem(a.author)){d("WALogger").ERROR(k());return m(b)}e=(e=a.quote)==null?void 0:e.content.type;if(e===d("WAMsgType").UNAVAILABLE){d("WALogger").ERROR(j());return m(b)}e=(e=(e=a.quote)==null?void 0:e.content.author)!=null?e:c;if(e==null){d("WALogger").ERROR(i());return m(b)}if(d("WAJids").isAuthorMe(a.author))return d("WAJids").isAuthorMe(e)?l(b,d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_BUMPED_OWN_MESSAGE):l(b,d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_BUMPED_MESSAGE,[d("WAJids").userIdFromJid(e)]);if(b==null){d("WALogger").ERROR(h());return m(b)}if(d("WAJids").isAuthorMe(e))return l(b,d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_BUMPED_CURRENT_USER_MESSAGE,[b]);return e===a.author?l(b,d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_BUMPED_OWN_MESSAGE,[b]):l(b,d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_BUMPED_PARTICIPANT_MESSAGE,[b,d("WAJids").userIdFromJid(e)])}g["default"]=a}),98);
__d("MAWThreadSnippetForCiphertextMsg",["MAWLocalizationType"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return{snippetParams:{contactIDs:[],strings:[]},snippetSenderContactId:a,snippetType:d("MAWLocalizationType").LOCALIZATION_TYPE.USER_SEND_ENCRYPTED_MESSAGE_FALLBACK}}g["default"]=a}),98);
__d("MAWThreadSnippetForDocumentFileMsg",["MAWLocalizationType","WAJids","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Document file message can not have AUTHOR_SYSTEM"]);h=function(){return a};return a}function a(a,b){var c,e=d("MAWLocalizationType").LOCALIZATION_TYPE.UNAVAILABLE_SNIPPET;c={contactIDs:[],mentionJIDs:(c=a.msgContent)==null?void 0:c.mentionedJids,strings:[]};d("WAJids").isAuthorMe(a.author)?e=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_ATTACHMENT:d("WAJids").isAuthorSystem(a.author)||b==null?d("WALogger").ERROR(h()):(e=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_ATTACHMENT,c.contactIDs.push(b));return{snippetParams:c,snippetSenderContactId:b,snippetType:e}}g["default"]=a}),98);
__d("MAWThreadSnippetForFallbackMessageMsg",["MAWLocalizationType","WAJids"],(function(a,b,c,d,e,f,g){"use strict";function h(a,b,c){return{snippetParams:{contactIDs:(c=c)!=null?c:[],strings:[]},snippetSenderContactId:a,snippetType:b}}function a(a,b){var c=a.author;a=a.msgContent.subtype;if(d("WAJids").isAuthorMe(c))switch(a){case"liveLocationMessage":return h(b,d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_LIVE_LOCATION_FALLBACK);case"locationMessage":return h(b,d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_LOCATION_FALLBACK);case"contactShareMessage":return h(b,d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_CONTACT_SHARE_FALLBACK);case"storyMentionMessage":return h(b,d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_STORY_MENTION_FALLBACK);case"postMentionMessage":return h(b,d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_POST_MENTION_FALLBACK);case"pollCreationMessage":return h(b,d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_POLL_CREATION_FALLBACK);case"bumpMessage":return h(b,d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_BUMPED_MESSAGE);case"stickerReceiverFetchMessage":return h(b,d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_STICKER_RECEIVER_FETCH_MESSAGE_FALLBACK);case"messengerMemory":return h(b,d("MAWLocalizationType").LOCALIZATION_TYPE.MESSENGER_MEMORY_ENCRYPTED_MESSAGE_FALLBACK);default:return h(b,d("MAWLocalizationType").LOCALIZATION_TYPE.UNAVAILABLE_SNIPPET)}else switch(a){case"liveLocationMessage":return h(b,d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_LIVE_LOCATION_FALLBACK);case"locationMessage":return h(b,d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_LOCATION_FALLBACK);case"contactShareMessage":return h(b,d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_CONTACT_SHARE_FALLBACK);case"storyMentionMessage":return h(b,d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_STORY_MENTION_FALLBACK);case"postMentionMessage":return h(b,d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_POST_MENTION_FALLBACK);case"pollCreationMessage":return h(b,d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_POLL_CREATION_FALLBACK);case"bumpMessage":return h(b,d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_BUMPED_PARTICIPANT_MESSAGE);case"metaAiMessage":return h(b,d("MAWLocalizationType").LOCALIZATION_TYPE.META_AI_SEND_MESSAGE_FALLBACK);case"stickerReceiverFetchMessage":return h(b,d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_STICKER_RECEIVER_FETCH_MESSAGE_FALLBACK);case"messengerMemory":return h(b,d("MAWLocalizationType").LOCALIZATION_TYPE.MESSENGER_MEMORY_ENCRYPTED_MESSAGE_FALLBACK);default:return h(b,d("MAWLocalizationType").LOCALIZATION_TYPE.UNAVAILABLE_SNIPPET)}}g["default"]=a}),98);
__d("MAWThreadSnippetForGifMsg",["MAWLocalizationType","WAJids","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Animated message can not have AUTHOR_SYSTEM"]);h=function(){return a};return a}function a(a,b){var c,e=d("MAWLocalizationType").LOCALIZATION_TYPE.UNAVAILABLE_SNIPPET;c={contactIDs:[],mentionJIDs:(c=a.msgContent)==null?void 0:c.mentionedJids,strings:[]};d("WAJids").isAuthorMe(a.author)?e=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_GIF:d("WAJids").isAuthorSystem(a.author)||b==null?d("WALogger").ERROR(h()):(e=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_GIF,c.contactIDs.push(b));return{snippetParams:c,snippetSenderContactId:b,snippetType:e}}g["default"]=a}),98);
__d("MAWThreadSnippetForImageMsg",["MAWLocalizationType","WAJids","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Image message can not have AUTHOR_SYSTEM"]);h=function(){return a};return a}function a(a,b){var c,e=d("MAWLocalizationType").LOCALIZATION_TYPE.UNAVAILABLE_SNIPPET;c={contactIDs:[],mentionJIDs:(c=a.msgContent)==null?void 0:c.mentionedJids,strings:[]};d("WAJids").isAuthorMe(a.author)?e=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_IMAGE:d("WAJids").isAuthorSystem(a.author)||b==null?d("WALogger").ERROR(h()):(e=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_IMAGE,c.contactIDs.push(b));return{snippetParams:c,snippetSenderContactId:b,snippetType:e}}g["default"]=a}),98);
__d("MAWThreadSnippetForPttMsg",["MAWLocalizationType","WAJids","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Ptt message can not have AUTHOR_SYSTEM"]);h=function(){return a};return a}function a(a,b){var c,e=d("MAWLocalizationType").LOCALIZATION_TYPE.UNAVAILABLE_SNIPPET;c={contactIDs:[],mentionJIDs:(c=a.msgContent)==null?void 0:c.mentionedJids,strings:[]};d("WAJids").isAuthorMe(a.author)?e=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_AUDIO:d("WAJids").isAuthorSystem(a.author)||b==null?d("WALogger").ERROR(h()):(e=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_AUDIO,c.contactIDs.push(b));return{snippetParams:c,snippetSenderContactId:b,snippetType:e}}g["default"]=a}),98);
__d("MAWThreadSnippetForRavenMsg",["MAWLocalizationType","MAWMsg","WAJids","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Animated message can not have AUTHOR_SYSTEM"]);h=function(){return a};return a}function a(a,b){var c,e=d("MAWLocalizationType").LOCALIZATION_TYPE.UNAVAILABLE_SNIPPET;c={contactIDs:[],mentionJIDs:(c=a.msgContent)==null?void 0:c.mentionedJids,strings:[]};d("WAJids").isAuthorMe(a.author)?e=a.ravenMediaType===d("MAWMsg").MAWRavenMsgMediaType.IMAGE?d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_IMAGE:d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_VIDEO:d("WAJids").isAuthorSystem(a.author)||b==null?d("WALogger").ERROR(h()):(e=a.ravenMediaType===d("MAWMsg").MAWRavenMsgMediaType.IMAGE?d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_IMAGE:d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_VIDEO,c.contactIDs.push(b));return{snippetParams:c,snippetSenderContactId:b,snippetType:e}}g["default"]=a}),98);
__d("MAWThreadSnippetForMsgUtils",["MAWLocalizationType","WAJids","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Sticker message can not have AUTHOR_SYSTEM"]);h=function(){return a};return a}function a(a,b,c){var e=d("MAWLocalizationType").LOCALIZATION_TYPE.UNAVAILABLE_SNIPPET;b={contactIDs:[],mentionJIDs:b,strings:[]};d("WAJids").isAuthorMe(a)?e=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_STICKER:d("WAJids").isAuthorSystem(a)||c==null?d("WALogger").ERROR(h()):(e=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_STICKER,b.contactIDs.push(c));return{snippetParams:b,snippetSenderContactId:c,snippetType:e}}g.getMAWThreadSnippetForStickerMsg=a}),98);
__d("MAWThreadSnippetForReceiverFetchMsg",["MAWThreadSnippetForMsgUtils"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){return d("MAWThreadSnippetForMsgUtils").getMAWThreadSnippetForStickerMsg(a.author,(a=a.msgContent)==null?void 0:a.mentionedJids,b)}g["default"]=a}),98);
__d("MAWThreadSnippetForRevokedMsg",["MAWLocalizationType","WAJids","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Revoked message can not have AUTHOR_SYSTEM"]);h=function(){return a};return a}function a(a,b){var c,e=d("MAWLocalizationType").LOCALIZATION_TYPE.UNAVAILABLE_SNIPPET;c={contactIDs:[],mentionJIDs:(c=a.msgContent)==null?void 0:c.mentionedJids,strings:[]};d("WAJids").isAuthorMe(a.author)?e=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_UNSENT_MESSAGE:d("WAJids").isAuthorSystem(a.author)||b==null?d("WALogger").ERROR(h()):(e=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_UNSENT_MESSAGE,c.contactIDs.push(b));return{snippetParams:c,snippetSenderContactId:b,snippetType:e}}g["default"]=a}),98);
__d("MAWThreadSnippetForStickerMsg",["MAWThreadSnippetForMsgUtils"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){return d("MAWThreadSnippetForMsgUtils").getMAWThreadSnippetForStickerMsg(a.author,(a=a.msgContent)==null?void 0:a.mentionedJids,b)}g["default"]=a}),98);
__d("MAWThreadSnippetForTextMsg",["MAWLocalizationType","MAWVault","WAJids","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Text message can not have AUTHOR_SYSTEM"]);h=function(){return a};return a}function a(a,b,c){var e=d("MAWLocalizationType").LOCALIZATION_TYPE.UNAVAILABLE_SNIPPET,f={contactIDs:[],mentionJIDs:a.msgContent.mentionedJids,strings:[]};d("WAJids").isAuthorMe(a.author)?e=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_TEXT:d("WAJids").isAuthorSystem(a.author)||b==null?d("WALogger").ERROR(h()):(e=c?d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_TEXT_IN_GROUP:d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_TEXT,f.contactIDs.push(b));if(a.specialTextSize===1||a.specialTextSize===2||a.specialTextSize===3){c=d("MAWVault").unvault(a.msgContent.content);f.strings.push(c==="\ud83d\udc4d"?"(Y)":a.msgContent.content)}else f.strings.push(a.msgContent.content);return{snippetParams:f,snippetSenderContactId:b,snippetType:e}}g["default"]=a}),98);
__d("MAWThreadSnippetForVideoMsg",["MAWLocalizationType","WAJids","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Video message can not have AUTHOR_SYSTEM"]);h=function(){return a};return a}function a(a,b){var c,e=d("MAWLocalizationType").LOCALIZATION_TYPE.UNAVAILABLE_SNIPPET;c={contactIDs:[],mentionJIDs:(c=a.msgContent)==null?void 0:c.mentionedJids,strings:[]};d("WAJids").isAuthorMe(a.author)?e=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_VIDEO:d("WAJids").isAuthorSystem(a.author)||b==null?d("WALogger").ERROR(h()):(e=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_VIDEO,c.contactIDs.push(b));return{snippetParams:c,snippetSenderContactId:b,snippetType:e}}g["default"]=a}),98);
__d("MAWThreadSnippetForXMAMsg",["MAWLocalizationType","WAArmadilloXMA.pb","WAJids","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Encountered unexpected XMAMessageType when building a thread snippet: ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["XMA message can not have AUTHOR_SYSTEM"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["XMA message can not have AUTHOR_SYSTEM"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["XMA message can not have AUTHOR_SYSTEM"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["XMA message can not have AUTHOR_SYSTEM"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["XMA message can not have AUTHOR_SYSTEM"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["XMA message can not have AUTHOR_SYSTEM"]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["XMA message can not have AUTHOR_SYSTEM"]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["XMA message can not have AUTHOR_SYSTEM"]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["XMA story mentions must have a target Jid"]);q=function(){return a};return a}function r(){var a=babelHelpers.taggedTemplateLiteralLoose(["XMA message can not have AUTHOR_SYSTEM"]);r=function(){return a};return a}function s(){var a=babelHelpers.taggedTemplateLiteralLoose(["XMA message can not have AUTHOR_SYSTEM"]);s=function(){return a};return a}function t(){var a=babelHelpers.taggedTemplateLiteralLoose(["XMA message can not have AUTHOR_SYSTEM"]);t=function(){return a};return a}function u(){var a=babelHelpers.taggedTemplateLiteralLoose(["XMA message can not have AUTHOR_SYSTEM"]);u=function(){return a};return a}function v(){var a=babelHelpers.taggedTemplateLiteralLoose(["XMA message can not have AUTHOR_SYSTEM"]);v=function(){return a};return a}function w(){var a=babelHelpers.taggedTemplateLiteralLoose(["XMA message can not have AUTHOR_SYSTEM"]);w=function(){return a};return a}function x(){var a=babelHelpers.taggedTemplateLiteralLoose(["XMA message can not have AUTHOR_SYSTEM"]);x=function(){return a};return a}function y(){var a=babelHelpers.taggedTemplateLiteralLoose(["XMA message can not have AUTHOR_SYSTEM"]);y=function(){return a};return a}function z(){var a=babelHelpers.taggedTemplateLiteralLoose(["XMA message can not have AUTHOR_SYSTEM"]);z=function(){return a};return a}function A(){var a=babelHelpers.taggedTemplateLiteralLoose(["XMA message can not have AUTHOR_SYSTEM"]);A=function(){return a};return a}function B(){var a=babelHelpers.taggedTemplateLiteralLoose(["XMA message can not have AUTHOR_SYSTEM"]);B=function(){return a};return a}function C(){var a=babelHelpers.taggedTemplateLiteralLoose(["XMA message does not have xmaMessageType"]);C=function(){return a};return a}function a(a,b){var c,e=d("MAWLocalizationType").LOCALIZATION_TYPE.UNAVAILABLE_SNIPPET;c={contactIDs:[],mentionJIDs:(c=a.msgContent)==null?void 0:c.mentionedJids,strings:[]};a.xmaMessageType==null&&d("WALogger").ERROR(C());switch(a.xmaMessageType){case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_FEED_SHARE:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_GAMING_CUSTOM_UPDATE:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_RECEIVER_FETCH:d("WAJids").isAuthorMe(a.author)?e=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_ATTACHMENT:d("WAJids").isAuthorSystem(a.author)||b==null?d("WALogger").ERROR(B()):(e=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_ATTACHMENT,c.contactIDs.push(b));break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_EXTERNAL_LINK_SHARE:if(d("WAJids").isAuthorMe(a.author)){var f;if(a.msgContent!=null&&((f=a.msgContent)==null?void 0:f.content)!=null){e=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_TEXT;c.strings.push((f=a.msgContent)==null?void 0:f.content)}else e=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_ATTACHMENT}else if(d("WAJids").isAuthorSystem(a.author)||b==null)d("WALogger").ERROR(A());else{e=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_TEXT;c.contactIDs.push(b);if(a.msgContent!=null&&((f=a.msgContent)==null?void 0:f.content)!=null){c.strings.push((f=a.msgContent)==null?void 0:f.content)}}break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_POST_MENTION:d("WAJids").isAuthorMe(a.author)?e=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_POST_MENTION:e=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_POST_MENTION;break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_MEMORIES_SHARE:d("WAJids").isAuthorMe(a.author)?e=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_MEMORIES_SHARE:e=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_MEMORIES_SHARE;break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_STORY_REPLY:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_PRODUCER_STORY_REPLY:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_STORY_SHARE:d("WAJids").isAuthorMe(a.author)?e=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SENT_STORY:d("WAJids").isAuthorSystem(a.author)||b==null?d("WALogger").ERROR(z()):(e=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SENT_STORY,c.contactIDs.push(b));break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_STORY_MENTION:d("WAJids").isAuthorSystem(a.author)||b==null?d("WALogger").ERROR(y()):d("WAJids").isAuthorMe(a.author)?e=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_STORY_MENTION:e=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_STORY_MENTION;break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_LOCATION_SHARING:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_LOCATION_SHARING_V2:d("WAJids").isAuthorSystem(a.author)||b==null?d("WALogger").ERROR(x()):d("WAJids").isAuthorMe(a.author)?e=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_LOCATION:e=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_LOCATION;break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_CONTACT:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_AI_CONTACT:d("WAJids").isAuthorSystem(a.author)||b==null?d("WALogger").ERROR(w()):d("WAJids").isAuthorMe(a.author)?e=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_CONTACT_SHARE:e=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_CONTACT_SHARE;break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_CLIPS_SHARE:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_SHORT:d("WAJids").isAuthorMe(a.author)?e=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SENT_REEL:d("WAJids").isAuthorSystem(a.author)||b==null?d("WALogger").ERROR(v()):e=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SENT_REEL;break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_FEED_POST_PRIVATE_REPLY:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_MULTIPOST_SHARE:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_SINGLE_IMAGE_POST_SHARE:d("WAJids").isAuthorMe(a.author)?e=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SENT_POST:d("WAJids").isAuthorSystem(a.author)||b==null?d("WALogger").ERROR(u()):e=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SENT_POST;break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_HIGHLIGHTS_TAB_FRIEND_UPDATES_REPLY:d("WAJids").isAuthorMe(a.author)?e=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SENT_POST:d("WAJids").isAuthorSystem(a.author)||b==null?d("WALogger").ERROR(t()):e=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SENT_POST;break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_PHOTO_SHARE:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_VIDEO_SHARE:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_REPLY:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_REACTION:d("WAJids").isAuthorMe(a.author)?e=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SENT_STORY:d("WAJids").isAuthorSystem(a.author)||b==null?d("WALogger").ERROR(s()):(e=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SENT_STORY,c.contactIDs.push(b));break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_PHOTO_HIGHLIGHT_SHARE:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_VIDEO_HIGHLIGHT_SHARE:d("WAJids").isAuthorMe(a.author)?e=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SENT_STORY_HIGHLIGHT:d("WAJids").isAuthorSystem(a.author)||b==null?d("WALogger").ERROR(r()):e=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SENT_STORY_HIGHLIGHT;break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_PHOTO_MENTION:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_VIDEO_MENTION:if(d("WAJids").isAuthorMe(a.author)){e=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_MENTIONED_STORY_IG;f=a.threadJid;var g;f!=null&&(g=d("WAJids").interpretAsUserJid(f));if(g!=null){f=d("WAJids").userIdFromJid(g);c.contactIDs.push(f)}else d("WALogger").ERROR(q())}else d("WAJids").isAuthorSystem(a.author)?d("WALogger").ERROR(p()):e=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_RECEIVED_STORY_MENTION_IG;break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_AUDIO_CALL:d("WAJids").isAuthorMe(a.author)&&b!=null?(e=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_AUDIO_CALLED,c.contactIDs.push(b)):d("WAJids").isAuthorSystem(a.author)||b==null?d("WALogger").ERROR(o()):(e=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_AUDIO_CALLED,c.contactIDs.push(b));break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_VIDEO_CALL:d("WAJids").isAuthorMe(a.author)&&b!=null?(e=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_VIDEO_CALLED,c.contactIDs.push(b)):d("WAJids").isAuthorSystem(a.author)||b==null?d("WALogger").ERROR(n()):(e=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_VIDEO_CALLED,c.contactIDs.push(b));break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_MISSED_AUDIO_CALL:d("WAJids").isAuthorMe(a.author)&&b!=null?(e=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_MISSED_AUDIO_CALL,c.contactIDs.push(b)):d("WAJids").isAuthorSystem(a.author)||b==null?d("WALogger").ERROR(m()):(e=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_MISSED_AUDIO_CALL,c.contactIDs.push(b));break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_MISSED_VIDEO_CALL:d("WAJids").isAuthorMe(a.author)&&b!=null?(e=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_MISSED_VIDEO_CALL,c.contactIDs.push(b)):d("WAJids").isAuthorSystem(a.author)||b==null?d("WALogger").ERROR(l()):(e=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_MISSED_VIDEO_CALL,c.contactIDs.push(b));break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_GROUP_AUDIO_CALL:d("WAJids").isAuthorMe(a.author)&&b!=null?e=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_STARTED_GROUP_AUDIO_CALL:d("WAJids").isAuthorSystem(a.author)||b==null?d("WALogger").ERROR(k()):(e=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_STARTED_GROUP_AUDIO_CALL,c.contactIDs.push(b));break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_GROUP_VIDEO_CALL:d("WAJids").isAuthorMe(a.author)&&b!=null?e=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_STARTED_GROUP_VIDEO_CALL:d("WAJids").isAuthorSystem(a.author)||b==null?d("WALogger").ERROR(j()):(e=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_STARTED_GROUP_VIDEO_CALL,c.contactIDs.push(b));break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_EVENT:d("WAJids").isAuthorMe(a.author)?e=d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SENT_EVENT:d("WAJids").isAuthorSystem(a.author)||b==null?d("WALogger").ERROR(i()):(e=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SENT_EVENT,c.contactIDs.push(b));break;default:d("WALogger").ERROR(h(),a.xmaMessageType)}return{snippetParams:c,snippetSenderContactId:b,snippetType:e}}g["default"]=a}),98);
__d("MAWThreadSnippet",["FBLogger","MAWLocalizationType","MAWMsgType","MAWThreadSnippetForAdminOrEphemeralMsg","MAWThreadSnippetForBumpExistingMessageMsg","MAWThreadSnippetForCiphertextMsg","MAWThreadSnippetForDocumentFileMsg","MAWThreadSnippetForFallbackMessageMsg","MAWThreadSnippetForGifMsg","MAWThreadSnippetForImageMsg","MAWThreadSnippetForPttMsg","MAWThreadSnippetForRavenMsg","MAWThreadSnippetForReceiverFetchMsg","MAWThreadSnippetForRevokedMsg","MAWThreadSnippetForStickerMsg","MAWThreadSnippetForTextMsg","MAWThreadSnippetForVideoMsg","MAWThreadSnippetForXMAMsg","MAWUserJidWrapper","WAJids"],(function(a,b,c,d,e,f,g){"use strict";function h(a){return/^\d+$/.test(a)}function i(a){if(d("WAJids").isAuthorSystem(a))return;a=d("WAJids").isAuthorMe(a)?d("WAJids").userIdFromJid(d("MAWUserJidWrapper").getMyUserJid()):d("WAJids").userIdFromJid(a);if(!h(a)){c("FBLogger")("maw_db").mustfix("[MAWThreadSnippetBuildTxns] Snippet sender contact id is invalid");return}return a}function a(a,b,e){var f=i(a.author);switch(a.type){case d("MAWMsgType").MSG_TYPE.CIPHERTEXT:return c("MAWThreadSnippetForCiphertextMsg")(f);case d("MAWMsgType").MSG_TYPE.TEXT:return c("MAWThreadSnippetForTextMsg")(a,f,b);case d("MAWMsgType").MSG_TYPE.IMAGE:return c("MAWThreadSnippetForImageMsg")(a,f);case d("MAWMsgType").MSG_TYPE.VIDEO:return c("MAWThreadSnippetForVideoMsg")(a,f);case d("MAWMsgType").MSG_TYPE.PTT:return c("MAWThreadSnippetForPttMsg")(a,f);case d("MAWMsgType").MSG_TYPE.ADMIN:case d("MAWMsgType").MSG_TYPE.EPHEMERAL_SETTING_ADMIN:case d("MAWMsgType").MSG_TYPE.EPHEMERAL_SCREENSHOT_ACTION:case d("MAWMsgType").MSG_TYPE.GROUP_POLL_CREATE:case d("MAWMsgType").MSG_TYPE.GROUP_POLL_UPDATE:return c("MAWThreadSnippetForAdminOrEphemeralMsg")(a,f);case d("MAWMsgType").MSG_TYPE.GIF:return c("MAWThreadSnippetForGifMsg")(a,f);case d("MAWMsgType").MSG_TYPE.STICKER:return c("MAWThreadSnippetForStickerMsg")(a,f);case d("MAWMsgType").MSG_TYPE.DOCUMENT_FILE:return c("MAWThreadSnippetForDocumentFileMsg")(a,f);case d("MAWMsgType").MSG_TYPE.REVOKED:return c("MAWThreadSnippetForRevokedMsg")(a,f);case d("MAWMsgType").MSG_TYPE.XMA:return c("MAWThreadSnippetForXMAMsg")(a,f);case d("MAWMsgType").MSG_TYPE.BUMP_EXISTING_MESSAGE:return c("MAWThreadSnippetForBumpExistingMessageMsg")(a,f,e);case d("MAWMsgType").MSG_TYPE.FUTUREPROOF:return c("MAWThreadSnippetForFallbackMessageMsg")(a,f);case d("MAWMsgType").MSG_TYPE.RECEIVER_FETCH:return c("MAWThreadSnippetForReceiverFetchMsg")(a,f);case d("MAWMsgType").MSG_TYPE.RAVEN:return c("MAWThreadSnippetForRavenMsg")(a,f);default:return{snippetParams:{contactIDs:[],strings:[]},snippetSenderContactId:f,snippetType:d("MAWLocalizationType").LOCALIZATION_TYPE.UNAVAILABLE_SNIPPET}}}g.getSnippetContactId=i;g.buildThreadSnippet=a}),98);
__d("MAWThreadSnippetBuildTxns",["FBLogger","MAWDbMsg","MAWDexieTable","MAWJidUtils","MAWLocalizationType","MAWThreadSnippet","MAWThreadSnippetUtils","MAWUserJidWrapper","WAJids","WAProtocolMsgId","WATimeUtils","emptyFunction","justknobx"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,c){return d("MAWDexieTable").dexieResolve(d("WAJids").switchOnMsgrChatJidType(b.threadJid,{group:function(a){return d("MAWThreadSnippet").buildThreadSnippet(b,!0,c)},user:function(a){return d("MAWThreadSnippet").buildThreadSnippet(b,!1,c)}}))}function b(a,b,c){return d("WAJids").switchOnMsgrChatJidType(c,{group:function(c){return h(a,b,!0)},user:function(c){return h(a,b,!1)}})}function h(a,b,e){var f;d("WAJids").isAuthorMe(a)?(c("FBLogger")("maw_db").warn("[MAWThreadSnippetBuildTxns] Reaction snippet author should not be @me"),f=d("WAJids").userIdFromJid(d("MAWUserJidWrapper").getMyUserJid())):f=d("WAJids").userIdFromJid(a);a={contactIDs:[],strings:[]};e=e?d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REACT_MESSAGE_IN_GROUP:d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REACT_MESSAGE;a.contactIDs.push(f);a.strings.push(b);return{snippetParams:a,snippetSenderContactId:f,snippetType:e}}function e(a,b,e,f){var g=e.newestReaction,h=e.reactionsToClear;if(g!=null&&d("WATimeUtils").castUnixTimeToMillisTime(g.ts)>((e=b.snippetMsgTs)!=null?e:0))return d("MAWDexieTable").dexieResolve({newestReaction:g,thread:i(b,g,f)});e=c("justknobx")._("2763")?h!=null&&h.length>0:h!=null;return e&&b.snippetMsg!=null?a.reactions.get({reactionId:b.snippetMsg}).then(function(c){var e=!1;if(c==null)e=!0;else{var f=d("MAWJidUtils").maybeToProtocolMsgId(c.author,c.threadJid,c.reactToExternalId);f!=null&&(e=h.some(function(a){a=d("MAWJidUtils").maybeToProtocolMsgId(a.author,a.threadJid,a.reactToExternalId);return a!=null&&d("WAProtocolMsgId").equals(a,f)}))}return e?j(a,b).then(function(a){return{newestReaction:null,thread:a}}):d("MAWDexieTable").dexieResolve({newestReaction:null,thread:b})}):d("MAWDexieTable").dexieResolve({newestReaction:null,thread:b})}function i(a,b,c){return babelHelpers["extends"]({},a,{snippetMsg:b.reactionId,snippetMsgTs:d("WATimeUtils").castUnixTimeToMillisTime(b.ts)})}function j(a,b){return d("MAWThreadSnippetUtils").recalculateSnippetFromScratch_EXPENSIVE(a,b).then(function(a){if(a==null){c("FBLogger")("MAWCentralizedThreadUpdate").mustfix("[Occamadillo] ThreadUpdated handler called for clear snippet when centralized thread bump is enabled");return babelHelpers["extends"]({},b,{snippetMsg:void 0,snippetMsgTs:void 0})}var e=d("WATimeUtils").castUnixTimeToMillisTime(d("MAWDbMsg").getCanonicalTsFromMsg(a));return babelHelpers["extends"]({},b,{snippetMsg:a.msgId,snippetMsgTs:e})})}function f(a,b){return j(a,b).then(function(b){return a.threads.put(b).then(c("emptyFunction"))})}g.buildThreadSnippet=a;g.buildReactionThreadSnippet=b;g.getReactionSnippetParams=h;g.getThreadChangesetForReactionChanges=e;g.getThreadChangesetForNewReaction=i;g.refreshThreadSnippet=f}),98);
__d("MAWThreadSnippetUtils",["I64","MAWDbMsg","MAWDbReaction","MAWDexieTable","MAWEphemeralMsgUtils","MAWIndexedDb","MAWLocalizationType","MAWLocalizationUtils","MAWMsgType","MAWThreadNewestMsgOrReactionUtils","MAWThreadSnippetBuildTxns","MAWThreadUpdateMiddlewareGatingUtil","MAWUpdateThreadBumpTimestamp","MAWXMAUtils","WALogger"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[MAWCentralizedThreadUpdate] No snippet is found from scratch. jid: ",""]);i=function(){return a};return a}function j(a){var b;if(p(a))return!0;b=((b=a.msgContent)==null?void 0:b.adminType)!=null?d("MAWLocalizationUtils").isDeviceChangeAdminMsg(a.msgContent.adminType):!1;if(a.type!==d("MAWMsgType").MSG_TYPE.ADMIN)return!1;a=a.msgContent.adminType;return a===d("MAWLocalizationType").LOCALIZATION_TYPE.DEBUG_MSG?!0:b}function a(a,b,c){return a.messages.where("[threadJid+sortOrderMs]").between([b.jid,Number.MIN_SAFE_INTEGER],[b.jid,Number.MAX_SAFE_INTEGER],!1,!1).filter(function(a){return(c==null||d("MAWEphemeralMsgUtils").filterNonExpiredMsg(c)(a))&&!j(a)}).reverse().first()}function k(a,b,c,e){e=e!=null?d("MAWDbReaction").castToIncomingDbReaction(e):e;return e!=null&&e.ts>(b!=null?d("MAWDbMsg").getCanonicalTsFromMsg(b):0)?d("MAWDexieTable").dexieResolve(d("MAWThreadSnippetBuildTxns").buildReactionThreadSnippet(e.author,e.reaction,c)):b==null?d("MAWDexieTable").dexieResolve():d("MAWThreadSnippetBuildTxns").buildThreadSnippet(a,b)}var l={snippetParams:{contactIDs:[],mentionJIDs:[],strings:[]},snippetSenderContactId:null,snippetType:d("MAWLocalizationType").LOCALIZATION_TYPE.EMPTY_SNIPPET};function m(a,b){return n(a,b.jid).then(function(a){if(a==null){d("WALogger").WARN(i(),b.jid);return}d("MAWUpdateThreadBumpTimestamp").updateSnippetViaCentralizedThreadHandler("calculateAndUpdateSnippetToUI",b,a)})}function n(a,b){return d("MAWThreadNewestMsgOrReactionUtils").getNewestMsgOrReactionForSnippet(a,b).then(function(c){return c==null?l:k(a,c.msgId!=null?c:null,b,c.reactionId!=null?c:null).then(function(a){return a})})}function o(a){var b=a.jid,c=a.unbumpFromTs;a=a.unbumpToTs;if(c==null||a==null)return;d("MAWIndexedDb").afterTransaction({tag:"UnbumpOnThreadLoad",value:{jid:b,unbumpFromTs:(h||(h=d("I64"))).of_float(c),unbumpToTs:h.of_float(a)}})}function b(a,b,c){c===void 0&&(c=!1);d("MAWThreadUpdateMiddlewareGatingUtil").isPeristedUnbumpEnabled()&&o(b);return c?d("MAWDexieTable").dexieResolve():m(a,b)}function p(a){return d("MAWXMAUtils").isXMAStoryReply(a.xmaMessageType)||d("MAWXMAUtils").isXMAMsgHighlightsTabFriendUpdatesReply(a.xmaMessageType)}g.isDbMsgDisabledForThreadSnippet=j;g.recalculateSnippetFromScratch_EXPENSIVE=a;g.EMPTY_SNIPPET_DATA=l;g.getThreadSnippetFromScratch=n;g.calculateUnbumpAndUpdateToUI=o;g.updateThreadInfoToUIOnPageLoad=b;g.shouldIgnoreXMAMsgForSnippet=p}),98);
__d("isE2EEConversationSearchEnabled",["gkx"],(function(a,b,c,d,e,f,g){"use strict";function a(){return c("gkx")("4741")}g["default"]=a}),98);
__d("isMAWUniversalSearchEnabled",["gkx"],(function(a,b,c,d,e,f,g){"use strict";function a(){return c("gkx")("4741")}g["default"]=a}),98);
__d("Worm",["WAPREList","WAPREMetrics","WATagsLogger","WormReadOnlyStoreAccessor","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Error performing ",": ",""]);h=function(){return a};return a}var i=d("WATagsLogger").TAGS(["WORM"]),j=1e4;a=function(){function a(a){this.$1=a}var c=a.prototype;c.init=function(a){return this.$1.init(a)};c.close=function(){this.$1.close()};c.store=function(a){return new(d("WormReadOnlyStoreAccessor").ReadOnlyStoreAccessor)(this.$1,a)};c.runInTransaction=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c,e){var f;f=d("WAPREMetrics").startMetric(d("WAPREList").PRE_METRIC.WORM,{bool:{isWorm:!0},string:{operationType:(f=e)!=null?f:"unknown_worm_transaction"}},void 0,j);try{a=(yield this.$1.runInTransaction(a,b,c,{eventFlow:f}));f.endSuccess();return a}catch(a){f.endFail("error");i.ERROR(h(),e,a);throw a}});function c(b,c,d,e){return a.apply(this,arguments)}return c}();return a}();g.OP_TIMEOUT_MS=j;g.WormDatabase=a}),98);
__d("WormPromise",["Promise"],(function(a,b,c,d,e,f){"use strict";var g;a=typeof self==="object"?self.Promise:typeof globalThis==="object"?globalThis.Promise:g||b("Promise");f.WormPromise=a}),66);
__d("WormStoreFunctions",["WormPromise","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,c,e){var f=[];return d("WormPromise").WormPromise.all(e.map(function(b){b=b.selector;return a.getByIndex(c,b)})).then(function(c){var g=[],h=[];c.forEach(function(a,c){c=e[c].item;if(a){var d=babelHelpers["extends"]({},c);a=a[b.primaryKey];d[b.primaryKey]=a;g.push(d);f.push(a)}else h.push(c),f.push(null)});return d("WormPromise").WormPromise.all([a.bulkPut(g),a.bulkAdd(h).then(function(a){var b=0;f.forEach(function(c,d){c==null&&(f[d]=a[b++])})})])}).then(function(){return f.filter(Boolean)})}function e(a,b,c,d){return a.readIndex(b,c,babelHelpers["extends"]({},d,{limit:1})).then(function(a){return(a=a[0])!=null?a:null})}var h=function(){function a(a,b,c,d,e){this.query=a,this.cursorBuilder=b,this.order=c,this.filter=e,this.boundaries=d,(d==null?void 0:d.greaterThan)!=null?this.lowerBoundary={greaterThan:d.greaterThan}:(d==null?void 0:d.greaterThanOrEqual)!=null&&(this.lowerBoundary={greaterThanOrEqual:d.greaterThanOrEqual}),(d==null?void 0:d.lessThan)!=null?this.upperBoundary={lessThan:d.lessThan}:(d==null?void 0:d.lessThanOrEqual)!=null&&(this.upperBoundary={lessThanOrEqual:d.lessThanOrEqual})}var d=a.prototype;d.read=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var d=this.order==="asc",e;a==null?e=this.boundaries:d?e=babelHelpers["extends"]({},this.upperBoundary,{greaterThan:a}):e=babelHelpers["extends"]({},this.lowerBoundary,{lessThan:a});d=(yield this.query(e,{filter:this.filter,limit:b+1,order:this.order}));var f;e=null;if(d.length<=b)f=d;else if(d.length===b+1)f=d.slice(0,b),e=d[b];else throw c("err")("unreachable");d=f[0];b=f[f.length-1];return{cursorInfo:{endCursor:b&&this.cursorBuilder(b),hasNext:e!=null,hasPrevious:a!=null,startCursor:d&&this.cursorBuilder(d)},data:f}});function d(b,c){return a.apply(this,arguments)}return d}();return a}();function f(a,b,d,e,f,g){b=b.indexes;if(b==null)throw c("err")("No indexes found");var i=b[d];if(i==null)throw c("err")("Index not found");return new h(function(b,c){return a(d,(b=b)!=null?b:void 0,c)},function(a){return i.fields.map(function(b){return a[b]})},e,f,g)}g.bulkUpsert=a;g.getByIndex=e;g.getIndexRangeIterator=f}),98);
__d("WormReadOnlyStoreAccessor",["WAPREList","WAPREMetrics","WATagsLogger","Worm","WormStoreFunctions","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Error performing ",": ",""]);h=function(){return a};return a}var i=d("WATagsLogger").TAGS(["WORM"]);a=function(){function a(a,b){this.$1=a,this.$2=b}var c=a.prototype;c.$3=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){b=this.$2+"."+b+"_inline";var c=d("WAPREMetrics").startMetric(d("WAPREList").PRE_METRIC.WORM,{bool:{isWorm:!0},string:{operationType:b}},void 0,d("Worm").OP_TIMEOUT_MS);try{a=(yield this.$1.runInTransaction([this.$2],"readonly",a,{eventFlow:c}));c.endSuccess();return a}catch(a){c.endFail("error");i.ERROR(h(),b,a);throw a}});function c(b,c){return a.apply(this,arguments)}return c}();c.bulkGet=function(a){var b=this;return this.$3(function(c){return c.stores[b.$2].bulkGet(a)},"bulkGet")};c.count=function(){var a=this;return this.$3(function(b){return b.stores[a.$2].count()},"count")};c.get=function(a){var b=this;return this.$3(function(c){return c.stores[b.$2].get(a)},"get")};c.getByIndex=function(a,b,c){var d=this;return this.$3(function(e){return e.stores[d.$2].getByIndex(a,b,c)},"getByIndex")};c.getIndexRangeIterator=function(a,b,c,e){var f=this;return d("WormStoreFunctions").getIndexRangeIterator(function(a,b,c){return f.$3(function(d){return d.stores[f.$2].readIndexRange(a,b,c)},"getIndexRangeIterator")},this.$1.getSchema()[this.$2],a,b,c,e)};c.readAll=function(a){var b=this;return this.$3(function(c){return c.stores[b.$2].readAll(a)},"readAll")};c.readByKeyRange=function(a,b){var c=this;return this.$3(function(d){return d.stores[c.$2].readByKeyRange(a,b)},"readByKeyRange")};c.readIndex=function(a,b,c){var d=this;return this.$3(function(e){return e.stores[d.$2].readIndex(a,b,c)},"readIndex")};c.readIndexKeys=function(a,b,c){var d=this;return this.$3(function(e){return e.stores[d.$2].readIndexKeys(a,b,c)},"readIndexKeys")};c.readIndexRange=function(a,b,c){var d=this;return this.$3(function(e){return e.stores[d.$2].readIndexRange(a,b,c)},"readIndexRange")};c.readKeys=function(a){var b=this;return this.$3(function(c){return c.stores[b.$2].readKeys(a)},"readKeys")};c.readKeysByIndexRange=function(a,b,c){var d=this;return this.$3(function(e){return e.stores[d.$2].readKeysByIndexRange(a,b,c)},"readKeysByIndexRange")};return a}();g.ReadOnlyStoreAccessor=a}),98);
__d("WACryptoSha256",["WABase64","WACryptoDependencies"],(function(a,b,c,d,e,f,g){"use strict";function h(a){return d("WACryptoDependencies").getCrypto().subtle.digest({name:"SHA-256"},a)}function i(a){return h(a).then(d("WABase64").encodeB64)}function a(a){return i(j(a))}function j(a){var b=new ArrayBuffer(a.length),c=new Uint8Array(b);for(var d=0,e=a.length;d<e;d++)c[d]=a.charCodeAt(d);return b}g.sha256=h;g.sha256Base64=i;g.sha256Str=a}),98);
__d("WACryptoSha256Builder",["WABinary"],(function(a,b,c,d,e,f,g){"use strict";var h=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],i=64,j=4;a=function(){function a(){this.h0=0,this.h1=0,this.h2=0,this.h3=0,this.h4=0,this.h5=0,this.h6=0,this.h7=0,this.tail=new Uint8Array(0),this.size=0,this.reset()}var b=a.prototype;b.reset=function(){this.h0=1779033703,this.h1=3144134277,this.h2=1013904242,this.h3=2773480762,this.h4=1359893119,this.h5=2600822924,this.h6=528734635,this.h7=1541459225,this.tail=new Uint8Array(0),this.size=0};b.update=function(a){var b=new Uint8Array(this.tail.length+a.length);b.set(this.tail);b.set(a,this.tail.length);this.size+=a.length*8;while(b.length>=i){a=b.subarray(0,i);this.$1(a);b=b.slice(i)}this.tail=b;return this};b.$2=function(){var a=new Uint8Array(64);a.set(this.tail);a.set(new Uint8Array([128]),this.tail.length);if(this.tail.length+9>i){this.$1(a);var b=p(new Uint8Array(0),this.size);this.$1(b)}else{b=p(a,this.size);this.$1(b)}};b.finish=function(){this.$2();var a=new(d("WABinary").Binary)();a.writeUint32(this.h0);a.writeUint32(this.h1);a.writeUint32(this.h2);a.writeUint32(this.h3);a.writeUint32(this.h4);a.writeUint32(this.h5);a.writeUint32(this.h6);a.writeUint32(this.h7);this.reset();return a.readByteArray()};b.$1=function(a){var b=[];for(var c=0;c<16;c++){var d=a.subarray(c*j,j*(c+1));d=d[0]<<24|d[1]<<16|d[2]<<8|d[3];b.push(d)}for(d=16;d<64;d++){a=k(b[d-15]);c=l(b[d-2]);a=b[d-16]+(b[d-7]+a+c)>>>0;b.push(a)}c=this.h0;a=this.h1;d=this.h2;var e=this.h3,f=this.h4,g=this.h5,i=this.h6,n=this.h7;for(var o=0;o<64;o++){var p=m(f,6)^m(f,11)^m(f,25),q=f&g^~f&i,r=m(c,2)^m(c,13)^m(c,22),s=c&a^c&d^a&d;p=n+p+q+h[o]+b[o];q=r+s;n=i;i=g;g=f;f=e+p>>>0;e=d;d=a;a=c;c=p+q>>>0}this.h0=this.h0+c>>>0;this.h1=this.h1+a>>>0;this.h2=this.h2+d>>>0;this.h3=this.h3+e>>>0;this.h4=this.h4+f>>>0;this.h5=this.h5+g>>>0;this.h6=this.h6+i>>>0;this.h7=this.h7+n>>>0};return a}();function k(a){var b=m(a,7),c=m(a,18);a=n(a,3);return b^c^a}function l(a){var b=m(a,17),c=m(a,19);a=n(a,10);return b^c^a}function m(a,b){return a>>>b|a<<32-b}function n(a,b){return a>>>b}function o(a){return new Uint8Array(new Uint32Array([a]).buffer)}function p(a,b){var c=new Uint8Array(i);c.set(a);a=o(b);c.set(a.subarray(0,1),c.length-1);c.set(a.subarray(1,2),c.length-2);c.set(a.subarray(2,3),c.length-3);c.set(a.subarray(3,4),c.length-4);c.set(a.subarray(4,5),c.length-5);c.set(a.subarray(5,6),c.length-6);c.set(a.subarray(6,7),c.length-7);c.set(a.subarray(7,8),c.length-8);return c}g.Sha256Builder=a;g.sigma0=k;g.sigma1=l;g.rotateRight=m;g.shiftRight=n}),98);
__d("WACryptoSha256HmacBuilder",["WACryptoSha256Builder"],(function(a,b,c,d,e,f,g){"use strict";a=function(){function a(a){this.$1=new(d("WACryptoSha256Builder").Sha256Builder)(),this.$2=new Uint8Array(0),this.reset(a)}var b=a.prototype;b.reset=function(a){this.$2=new Uint8Array(64);a.length>64?this.$2.set(new(d("WACryptoSha256Builder").Sha256Builder)().update(a).finish(),0):this.$2.set(a,0);a=this.$2.map(function(a){return a^54});this.$1=new(d("WACryptoSha256Builder").Sha256Builder)().update(a)};b.update=function(a){this.$1.update(a);return this};b.finish=function(){var a=this.$2.map(function(a){return a^92}),b=this.$1.finish();return new(d("WACryptoSha256Builder").Sha256Builder)().update(a).update(b).finish()};return a}();g.Sha256HMacBuilder=a}),98);
__d("WormEncoding",["msgpack-msgpack"],(function(a,b,c,d,e,f,g){"use strict";function a(){var a=new(d("msgpack-msgpack").ExtensionCodec)(),b=0;a.register({decode:function(a){a=d("msgpack-msgpack").decode(a);return a.buffer.slice(a.byteOffset,a.byteLength+a.byteOffset)},encode:function(a){if(a instanceof ArrayBuffer)return d("msgpack-msgpack").encode(new Uint8Array(a))},type:b});b=1;a.register({decode:function(a){a=d("msgpack-msgpack").decode(a);return new Uint8Array(a.buffer.slice(a.byteOffset,a.byteLength+a.byteOffset))},encode:function(a){if(a instanceof Uint8Array)return d("msgpack-msgpack").encode(a)},type:b});return{decode:function(b){return d("msgpack-msgpack").decode(b,{extensionCodec:a})},encode:function(b){return d("msgpack-msgpack").encode(b,{extensionCodec:a,ignoreUndefined:!0})}}}g.createEncoding=a}),98);
__d("WormIDbGetMinMaxKeySelector",[],(function(a,b,c,d,e,f){"use strict";a=-Infinity;var g;b=function(){if(g!=null)return g;try{IDBKeyRange.only([[]]);g=[[]];return g}catch(b){var a=String.fromCharCode(65535);g=a;return a}};f.MIN_KEY=a;f.getMaxSelector=b}),66);
__d("WormEAR",["Promise","WABinary","WACryptoDependencies","WACryptoSha256","WACryptoSha256HmacBuilder","WATagsLogger","WATimeUtils","WormEncoding","WormIDbGetMinMaxKeySelector","asyncToGeneratorRuntime","err","tweetnacl"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Error on keychain initialisation: ","; keyHashCheck:",""]);i=function(){return a};return a}var j="_encryptedContent",k=d("WATagsLogger").TAGS(["WormEAR"]),l=function(b){babelHelpers.inheritsLoose(a,b);function a(a){var c;c=b.call(this,a)||this;c.name="WormEAREncryptionError";c.message=a;return c}return a}(babelHelpers.wrapNativeSuper(Error)),m=function(b){babelHelpers.inheritsLoose(a,b);function a(a,c,d){var e;e=b.call(this,a)||this;e.name="WormEARDecryptionError";e.message=a;e.store=c;e.pk=d;return e}return a}(babelHelpers.wrapNativeSuper(Error));function n(a,b,c){if(typeof a==="number")return a;b=b.encode(a);a=new(d("WACryptoSha256HmacBuilder").Sha256HMacBuilder)(new Uint8Array(c)).update(b).finish();return a.buffer}var o=32,p=2,q=128,r=12,s=256,t=new Uint8Array(0).buffer,u="AES-GCM",v="HKDF",w="SHA-256";a=60*60;e=24*a;var x=0,y=e*30*6;f=function(){function a(a,b,c){this.$6=0;this.$8=!1;this.$9=!1;this.$1=a;this.$7=(a=c==null?void 0:c.encKeyTtl)!=null?a:y;this.$2=d("WormEncoding").createEncoding();this.$3=b;this.$5=crypto.subtle.importKey("raw",b,{name:u},!1,["encrypt","decrypt"]);this.$4=new Map()}var e=a.prototype;e.isSecureStore=function(a){return this.$1[a].secure!==!1};e.$10=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){return(yield d("WACryptoSha256").sha256Base64(this.$3)).substring(0,5)});function c(){return a.apply(this,arguments)}return c}();e.prepareNewKeyVersion=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=d("WACryptoDependencies").getCrypto(),b=a.getRandomValues(new Uint8Array(o)).buffer,c=a.getRandomValues(new Uint8Array(o)).buffer,e=a.getRandomValues(new Uint8Array(r)),f=(yield this.$5);a=(yield a.subtle.encrypt({iv:e,name:u,tagLength:q},f,c));return{clientKey:b,expiration:d("WATimeUtils").castToUnixTime(d("WATimeUtils").unixTime()+this.$7),keyHash:yield this.$10(),salt:d("WABinary").Binary.build(e,a).readBuffer()}});function c(){return a.apply(this,arguments)}return c}();e.init=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c,e){var f=this;this.$4=new Map();this.$6=0;this.$8=c.incorrectVersions;this.$9=c.versionsLoss;var g=d("WACryptoDependencies").getCrypto(),j=(yield this.$10()),l=!0;try{yield (h||(h=b("Promise"))).all(a.map(function(a){l=l&&a.keyHash===j;var c=a.salt,d=c.slice(0,r),e=c.slice(r);return f.$5.then(function(c){return(h||(h=b("Promise"))).all([g.subtle.importKey("raw",a.clientKey,{name:v},!1,["deriveKey"]),g.subtle.decrypt({iv:new Uint8Array(d),name:u,tagLength:q},c,e)])}).then(function(a){var b=a[0];a=a[1];return g.subtle.deriveKey({hash:{name:w},info:t,name:v,salt:a},b,{length:s,name:u},!0,["encrypt","decrypt"])}).then(function(a){return g.subtle.exportKey("raw",a)}).then(function(b){f.$6=Math.max(f.$6,a.version),f.$4.set(a.version,b)})}))}catch(a){k.ERROR(i(),a,l);throw a}finally{e==null?void 0:(c=e.eventFlow)==null?void 0:c.addAnnotations({bool:{keyHashCheck:l}})}});function c(b,c,d){return a.apply(this,arguments)}return c}();e.$11=function(a){if(this.$6===0)throw new l("EAR.Encryption. EAR is not initialised ");var b=this.$4.get(this.$6);if(b==null)throw new l("EAR.Encryption.Key does not exist for version");var c=d("tweetnacl").randomBytes(d("tweetnacl").secretbox.nonceLength);a=d("tweetnacl").secretbox(a,c,new Uint8Array(b));return d("WABinary").Binary.build(x,this.$6,c,a).readBuffer()};e.$12=function(a,b,c){var e=a.slice(0,p);e=new DataView(e).getUint8(1);var f=this.$4.get(e);if(f==null)throw new m("EAR.Decryption.Key does not exist for version: "+e+"; incorrectVersions: "+this.$8.toString()+" versionsLoss: "+this.$9.toString(),b,c);e=a.slice(p,p+d("tweetnacl").secretbox.nonceLength);a=a.slice(p+d("tweetnacl").secretbox.nonceLength);a=d("tweetnacl").secretbox.open(new Uint8Array(a),new Uint8Array(e),new Uint8Array(f));if(a==null)throw new m("EAR.Decryption. Unable to decrypt; incorrectVersions: "+this.$8.toString()+" versionsLoss: "+this.$9.toString(),b,c);return a};e.encryptEntity=function(a,b){b=this.$1[b];var c=new Set();b.autoIncrement!==!0&&c.add(b.primaryKey);var d=b.indexes;if(d!=null)for(var e of Object.keys(d)){var f=d[e];for(f of f.fields)c.add(f)}f={};for(e of c){f[e]=((d=b.nonEncryptedFields)==null?void 0:d.has(e))?a[e]:n(a[e],this.$2,this.$3)}b.autoIncrement===!0&&a[b.primaryKey]!=null&&(f[b.primaryKey]=a[b.primaryKey]);return babelHelpers["extends"]({},f,(c={},c[j]=this.$11(this.$2.encode(a)),c))};e.$13=function(a,b){if(j in a){b=a[this.$1[b].primaryKey];return{encrypted:!0,encryptedEntity:a,pk:b}}else return{encrypted:!1,entity:a}};e.maybeDecrypt=function(a,b,d,e){if(a==null)return a;if(this.isSecureStore(b)===!1)return a;var f=this.$13(a,b);if(!f.encrypted){if(e==null?void 0:e.shouldFailIfEntityIsNotEncrypted)return a;throw c("err")("Attempt to decrypt not encrypted entity")}d==null?void 0:d.addPoint("decrypt_start");e=this.decryptEntity(f.encryptedEntity,b,f.pk);d==null?void 0:d.addPoint("decrypt_end");a=this.$1[b];if(a.autoIncrement===!0){return babelHelpers["extends"]({},e,(d={},d[a.primaryKey]=f.pk,d))}return e};e.maybeEncrypt=function(a,b,c){if(this.isSecureStore(b)===!1)return a;c==null?void 0:c.addPoint("encrypt_start");a=this.encryptEntity(a,b);c==null?void 0:c.addPoint("encrypt_end");return a};e.decryptEntity=function(a,b,c){return this.$2.decode(this.$12(a[j],b,c))};e.hashPk=function(a,b,c){return((a=this.$1[a].nonEncryptedFields)==null?void 0:a.has(b))?c:n(c,this.$2,this.$3)};e.hashSelector=function(a,b,c){var e;a=[].concat(a);e=(c=(e=this.$1[b].indexes)==null?void 0:(e=e[c])==null?void 0:e.fields)!=null?c:[];for(c=0;c<a.length;c++){var f,g=a[c],h=e[c];if(g===d("WormIDbGetMinMaxKeySelector").getMaxSelector())continue;if(g===-Infinity)continue;if((f=this.$1[b].nonEncryptedFields)==null?void 0:f.has(h))continue;a[c]=n(g,this.$2,this.$3)}return a};return a}();g.ENCRYPTED_COLUMN_NAME=j;g.EncryptionError=l;g.DecryptionError=m;g.WormEAR=f}),98);
__d("WormGlobalConfig",[],(function(a,b,c,d,e,f){"use strict";var g={handleNotFoundErrorExperiment:!1,handleUnknownErrorExperiment:!1};function a(){return g}function b(a){g=a}f.getWormGlobalConfig=a;f.setWormGlobalConfig=b}),66);
__d("WormIDbStore",["Promise","WormIDbGetMinMaxKeySelector","WormPromise","WormStoreFunctions","err"],(function(a,b,c,d,e,f,g){"use strict";var h,i=function(){};a=function(){function a(a,b,c,d,e){var f=this;this.readIndexRange=function(a,b,c){return b==null?f.$11(function(){return f.$1.index(a).openCursor(null,(c==null?void 0:c.order)==="desc"?"prev":"next")},c):f.$11(function(){return f.$1.index(a).openCursor(f.$12(b,a),(c==null?void 0:c.order)==="desc"?"prev":"next")},c)};this.$1=b.objectStore(a);this.$2=a;this.$3=d;this.$4=c;this.$5=e}var e=a.prototype;e.$6=function(a,b){var c=this.$4.eventFlow.isActive()?this.$4.eventFlow:null;c==null?void 0:c.addPoint(b+"_start");a=a();c==null?void 0:c.addPoint(b+"_end");return a};e.$7=function(){return this.$3.isSecureStore(this.$2)};e.$8=function(a){var b=this;return!this.$7()?a:this.$6(function(){return b.$3.hashPk(b.$2,b.$5.primaryKey,a)},"hashPk")};e.$9=function(a,b){var c=this;if(!this.$7())return a;return a==null?a:this.$6(function(){return c.$3.hashSelector(a,c.$2,b)},"hashSelector")};e.$10=function(a){var b=this;return new(d("WormPromise").WormPromise)(function(c,d){var e=a();e.onsuccess=function(){try{c(e.result.map(function(a){return b.$3.maybeDecrypt(a,b.$2,b.$4.eventFlow)}))}catch(a){d(a)}};e.onerror=function(){return d(e.error)}})};e.$11=function(a,b){var c=this;return new(d("WormPromise").WormPromise)(function(d,e){var f,g=[],h=(b==null?void 0:b.limit)!=null,i=Math.max(0,(f=b==null?void 0:b.limit)!=null?f:0);if(h&&i===0){d(g);return}var j=a();j.onsuccess=function(){var a=j.result;if(a){var f;try{f=c.$3.maybeDecrypt(a.value,c.$2,c.$4.eventFlow)}catch(a){e(a);return}(!(b==null?void 0:b.filter)||b.filter(f))&&g.push(f);if(h&&i===g.length){d(g);return}a["continue"]()}else d(g)};j.onerror=function(){return e(j.error)}})};e.bulkAdd=function(a){var c=this;return(h||(h=b("Promise"))).all(a.map(function(a){return new(d("WormPromise").WormPromise)(function(b,d){var e=c.$1.add(c.$3.maybeEncrypt(a,c.$2,c.$4.eventFlow));e.onsuccess=function(){c.$5.autoIncrement===!0?b(e.result):b(a[c.$5.primaryKey])};e.onerror=function(){return d(e.error)}})}))};e.bulkPut=function(a){var c=this;return(h||(h=b("Promise"))).all(a.map(function(a){return new(d("WormPromise").WormPromise)(function(b,d){var e=c.$1.put(c.$3.maybeEncrypt(a,c.$2,c.$4.eventFlow));e.onsuccess=b;e.onerror=function(){return d(e.error)}})})).then(i)};e.bulkUpsert=function(a,b){return d("WormStoreFunctions").bulkUpsert(this,this.$5,a,b)};e.bulkGet=function(a){var c=this;return(h||(h=b("Promise"))).all(a.map(function(a){return new(d("WormPromise").WormPromise)(function(b,d){var e=c.$1.get(c.$8(a));e.onsuccess=function(){try{b(c.$3.maybeDecrypt(e.result,c.$2,c.$4.eventFlow))}catch(a){d(a)}};e.onerror=function(){return d(e.error)}})}))};e.get=function(a){return this.bulkGet([a]).then(function(a){return a[0]})};e.getByIndex=function(a,b,c){return d("WormStoreFunctions").getByIndex(this,a,b,c)};e.readByKeyRange=function(a,b){var c=this;return a==null?this.$11(function(){return c.$1.openCursor(null,(b==null?void 0:b.order)==="desc"?"prev":"next")},b):this.$11(function(){return c.$1.openCursor(c.$12(a,c.$5.primaryKey),(b==null?void 0:b.order)==="desc"?"prev":"next")},b)};e.$13=function(a,b,e){if(this.$5.indexes==null)throw c("err")("No indexes found for store");a=this.$5.indexes[a].fields;if(b.length===a.length)return b;a=a.map(function(a,c){return(a=b[c])!=null?a:e==="max"?d("WormIDbGetMinMaxKeySelector").getMaxSelector():d("WormIDbGetMinMaxKeySelector").MIN_KEY});return a};e.$12=function(a,b){var d=b===this.$5.primaryKey;if(a.only!=null){if(this.$5.indexes==null)throw c("err")("No indexes found for store");var e=this.$5.indexes[b].fields;return a.only.length===e.length?IDBKeyRange.only(this.$9(a.only,b)):IDBKeyRange.bound(d?this.$8(a.only):this.$9(this.$13(b,a.only,"min"),b),d?this.$8(a.only):this.$9(this.$13(b,a.only,"max"),b),!0,!0)}if(a.lessThan!=null||a.lessThanOrEqual!=null){e=(e=a.lessThan)!=null?e:a.lessThanOrEqual;if(a.greaterThan!=null||a.greaterThanOrEqual!=null){var f;f=(f=a.greaterThan)!=null?f:a.greaterThanOrEqual;return IDBKeyRange.bound(d?this.$8(f):this.$9(this.$13(b,f,"min"),b),d?this.$8(e):this.$9(this.$13(b,e,"max"),b),a.greaterThan!=null,a.lessThan!=null)}return IDBKeyRange.upperBound(d?this.$8(e):this.$9(this.$13(b,e,"max"),b),a.lessThan!=null)}else{e=(f=a.greaterThan)!=null?f:a.greaterThanOrEqual;if(e!=null)return IDBKeyRange.lowerBound(d?this.$8(e):this.$9(this.$13(b,e,"min"),b),a.greaterThan!=null);else throw c("err")("Invalid range")}};e.readIndex=function(a,b,c){var d=this;return(c==null?void 0:c.filter)==null&&(c==null?void 0:c.order)!=="desc"?this.$10(function(){var e;return d.$1.index(a).getAll(d.$9(b,a),(e=c==null?void 0:c.limit)!=null?e:void 0)}):this.$11(function(){return d.$1.index(a).openCursor(d.$9(b,a),(c==null?void 0:c.order)==="desc"?"prev":"next")},c)};e.readIndexKeys=function(a,b,c){var d=this;return this.readIndex(a,b,c).then(function(a){return a.map(function(a){return a[d.$5.primaryKey]})})};e.readKeysByIndexRange=function(a,b,c){var d=this;return this.readIndexRange(a,b,c).then(function(a){return a.map(function(a){return a[d.$5.primaryKey]})})};e.getIndexRangeIterator=function(a,b,c,e){return d("WormStoreFunctions").getIndexRangeIterator(this.readIndexRange,this.$5,a,b,c,e)};e.readAll=function(a){var b=this;return(a==null?void 0:a.filter)===null&&(a==null?void 0:a.order)!=="desc"?this.$10(function(){var c;return b.$1.getAll((c=a==null?void 0:a.limit)!=null?c:void 0)}):this.$11(function(){return b.$1.openCursor(null,(a==null?void 0:a.order)==="desc"?"prev":"next")},a)};e.readKeys=function(a){var b=this;return this.readAll(a).then(function(a){return a.map(function(a){return a[b.$5.primaryKey]})})};e.bulkDelete=function(a){var c=this;return(h||(h=b("Promise"))).all(a.map(function(a){return new(d("WormPromise").WormPromise)(function(b,d){var e=c.$1["delete"](c.$8(a));e.onsuccess=b;e.onerror=function(){return d(e.error)}})})).then(i)};e["delete"]=function(a){var b=this;return new(d("WormPromise").WormPromise)(function(c,d){var e=b.$1["delete"](b.$8(a));e.onsuccess=function(){return c()};e.onerror=function(){return d(e.error)}})};e.clear=function(){var a=this;return new(d("WormPromise").WormPromise)(function(b,c){var d=a.$1.clear();d.onsuccess=b;d.onerror=function(){return c(d.error)}}).then(i)};e.count=function(){var a=this;return new(d("WormPromise").WormPromise)(function(b,c){var d=a.$1.count();d.onsuccess=function(){return b(d.result)};d.onerror=function(){return c(d.error)}})};return a}();g.WormIDbStore=a}),98);
__d("WormIDbTransaction",["WAResolvable","WormIDbStore"],(function(a,b,c,d,e,f,g){"use strict";var h=function(b){babelHelpers.inheritsLoose(a,b);function a(){var a,c="WormUnknownError";a=b.call(this,c)||this;a.name=c;a.message=c;return a}return a}(babelHelpers.wrapNativeSuper(Error)),i=function(b){babelHelpers.inheritsLoose(a,b);function a(){var a,c="WormUnknownAbortError";a=b.call(this,c)||this;a.name=c;a.message=c;return a}return a}(babelHelpers.wrapNativeSuper(Error));a=function(){function a(a,b,c,e,f){var g=this;this.$1=a;this.$2=new(d("WAResolvable").Resolvable)();this.$1.oncomplete=function(){g.$2.resolve()};this.$1.onerror=function(a){a=(a=(a=(a=a.target)==null?void 0:a.error)!=null?a:g.$1.error)!=null?a:new h();g.$2.reject(a)};this.$1.onabort=function(a){a=(a=(a=(a=a.target)==null?void 0:a.error)!=null?a:g.$1.error)!=null?a:new i();g.$2.reject(a)};this.$3=e.reduce(function(a,e){return babelHelpers["extends"]({},a,(a={},a[e]=new(d("WormIDbStore").WormIDbStore)(e,g.$1,b,c,f[e]),a))},(a=this.$3)!=null?a:{})}var b=a.prototype;b.commit=function(){return this.$2.promise};b.abort=function(){this.$2.isSettled||this.$1.abort()};babelHelpers.createClass(a,[{key:"stores",get:function(){return this.$3}}]);return a}();g.WormIDbTransaction=a}),98);
__d("WormIDbTypes",[],(function(a,b,c,d,e,f){"use strict";a="_worm_db_version_";b="_worm_ear_";c="schema_hash";d="creation_ts";f.DB_VERSION_STORE=a;f.EAR_STORE=b;f.SCHEMA_HASH_KEY=c;f.DB_CREATION_TS=d}),66);
__d("WAIDBTypes",[],(function(a,b,c,d,e,f){"use strict";function a(){return indexedDB}f.idb=a}),66);
__d("WormIDbUtils",["Promise","WAIDBTypes","err"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a){return new(h||(h=b("Promise")))(function(b,c){a.onsuccess=function(){return b(a.result)},a.onerror=function(){return c(a.error)}})}function e(a,e,f){var g=e.onBecomeStale,i=e.onClose,j=e.onError,k=e.onUpgrade;return new(h||(h=b("Promise")))(function(b,e){var h=d("WAIDBTypes").idb().open(a,f);k!=null&&(h.onupgradeneeded=function(){if(h.transaction==null)throw c("err")("Transaction is null on upgradeneeded event");k(h.result,h.transaction)});h.onsuccess=function(){var a=h.result;i!=null&&(a.onclose=i);a.onversionchange=function(){a.close(),g!=null&&g()};b(a)};h.onerror=function(){e(h.error),j!=null&&j(h.error)}})}g.promisifyIDbRequest=a;g.openIDb=e}),98);
__d("WormIDbUpgrade",["WATimeUtils","WormIDbTypes","WormIDbUtils","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(a,b,c){var d=[],e=[],f=new Map(),g=Array.from(Object.keys(c)).map(function(a){return a.toString()});g=new Set(g);for(var h of Object.keys(c))if(!a.objectStoreNames.contains(h))d.push(h);else{var i=c[h];i=(i=i.indexes)!=null?i:{};var j=b.objectStore(h),k=j.indexNames,l=new Set(Object.keys(i)),m=[],n=[];for(var o of l)!k.contains(o)?m.push(o):j.index(o).unique!==i[o].unique&&(m.push(o),n.push(o));for(j=0;j<k.length;j++){o=k[j];l.has(o)||n.push(o)}(m.length>0||n.length>0)&&f.set(h,{indexesToCreate:m,indexesToDelete:n})}for(i=0;i<a.objectStoreNames.length;i++){o=a.objectStoreNames[i];g.has(o)||e.push(o)}return{storesToCreate:d,storesToDelete:e,storesToModify:f}}function a(a,b){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){if(!a.objectStoreNames.contains(d("WormIDbTypes").DB_VERSION_STORE))return{isNewDb:!0,shouldUpgrade:!0};a=a.transaction(d("WormIDbTypes").DB_VERSION_STORE,"readonly");a=(yield d("WormIDbUtils").promisifyIDbRequest(a.objectStore(d("WormIDbTypes").DB_VERSION_STORE).get(d("WormIDbTypes").SCHEMA_HASH_KEY)));return{isNewDb:!1,shouldUpgrade:(a==null?void 0:a.value)!==b}});return i.apply(this,arguments)}function j(a,b,c){for(c of c){var d=b[c],e=a.createObjectStore(c,{autoIncrement:!!d.autoIncrement,keyPath:d.primaryKey});d=d.indexes;if(d==null)continue;for(var f of Object.keys(d)){var g=d[f];e.createIndex(f,g.fields.map(function(a){return a.toString()}),{unique:g.unique})}}}function c(a,b,c,e,f){var g=h(a,b,c),i=g.storesToCreate,k=g.storesToDelete;g=g.storesToModify;j(a,c,i);if(f.onlyCreateNewStores)return;for(i of k)f.safeToDeleteStores.has(i)&&a.deleteObjectStore(i);a=function(a){var d=a[0];k=a[1];a=k.indexesToCreate;var e=k.indexesToDelete;for(e of e)b.objectStore(d).deleteIndex(e);e=c[d].indexes;if(e==null)return"continue";var g=!1;for(a of a){var h=e[a];b.objectStore(d).createIndex(a,h.fields,{unique:h.unique});g=!0}if(g&&c[d].secure===!0&&f.maybeEar!=null){var i=d,j=f.maybeEar,l=b.objectStore(i).getAll();l.onsuccess=function(){var a=l.result;a.forEach(function(a){if(a==null)return;b.objectStore(d).put(j.maybeEncrypt(j.maybeDecrypt(a,i,void 0,{shouldFailIfEntityIsNotEncrypted:!1}),i,void 0))})}}};for(i of g){g=a(i);if(g==="continue")continue}b.objectStore(d("WormIDbTypes").DB_VERSION_STORE).put({key:d("WormIDbTypes").SCHEMA_HASH_KEY,value:e});f.isNewDbInstance&&b.objectStore(d("WormIDbTypes").DB_VERSION_STORE).put({key:d("WormIDbTypes").DB_CREATION_TS,value:d("WATimeUtils").performanceAbsoluteNow()})}g.shouldUpgradeDb=a;g.createNewStores=j;g.upgradeDb=c}),98);
__d("WormIDbDriver",["Promise","WABridge","WACryptoSha256","WAOdsEnums","WAResolvable","WATagsLogger","WATimeUtils","WormGlobalConfig","WormIDbTransaction","WormIDbTypes","WormIDbUpgrade","WormIDbUtils","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["EAR initialization error: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["EAR initialization error: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Unrecoverable error (","): ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["Unexpected error (","): ",""]);l=function(){return a};return a}var m=d("WATagsLogger").TAGS(["WormIDbDriver"]),n={_worm_db_version_:{primaryKey:"key",secure:!1},_worm_ear_:{primaryKey:"version",secure:!1}};a=function(){function a(a,b,c,e,f){var g=this;this.$5=null;this.$8=[];this.$12=function(){d("WABridge").getBridge().fireAndForget("event","odsBumpEntityKey",{entity:d("WAOdsEnums").Entity.WORM,key:g.$3+".error.db_stale"})};this.$13=function(){d("WABridge").getBridge().fireAndForget("event","odsBumpEntityKey",{entity:d("WAOdsEnums").Entity.WORM,key:g.$3+".error.db_close"})};this.$14=function(a){m.ERROR(l(),g.$3,a)};this.$2=a;this.$3=b;this.$4=c;this.$6=(a=f==null?void 0:f.safeToDeleteStores)!=null?a:new Set();this.$9=f==null?void 0:f.blockingErrorThreshold;this.$10=(b=f==null?void 0:f.onBlockingError)!=null?b:function(){};this.$11=(c=f==null?void 0:f.onTransactionError)!=null?c:function(){};this.$7=e}var e=a.prototype;e.getSchema=function(){return this.$4};e.$15=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e,f){this.$5!=null&&(yield this.$5.promise);if(this.$1==null)throw c("err")("IDB is not initialised: "+this.$3);b=new(d("WormIDbTransaction").WormIDbTransaction)(this.$1.transaction(a.map(function(a){return a.toString()}),b,{durability:"relaxed"}),f,this.$7,a,this.$4);f=(yield e(b));yield b.commit();return f});function e(b,c,d,e){return a.apply(this,arguments)}return e}();e.$16=function(a){var b;if(this.$9==null)return;var c=this.$9;a=(b=(b=(b=a==null?void 0:a.name)!=null?b:a==null?void 0:a.message)!=null?b:a==null?void 0:a.toString())!=null?b:"unknown";this.$8.push(a);if(this.$8.length<Math.max(c,1))return;var d=this.$8[this.$8.length-1];b=this.$8.every(function(a){return a===d})?d:"mixed";m.ERROR(k(),this.$3,b);this.$10(b);this.$8=[]};e.$17=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c,e){this.$1==null&&(e.eventFlow.addPoint("db_reinit_start",{bool:{isDbNull:!0}}),yield this.$18(),e.eventFlow.addPoint("db_reinit_end"));var f;try{f=(yield this.$15(a,b,c,e))}catch(i){var g=d("WormGlobalConfig").getWormGlobalConfig(),h=g.handleNotFoundErrorExperiment;g=g.handleUnknownErrorExperiment;if((i==null?void 0:i.name)==="InvalidStateError"||h&&(i==null?void 0:i.name)==="NotFoundError"||g&&(i==null?void 0:i.name)==="UnknownError")e.eventFlow.addPoint("db_reinit_start",{bool:{isDbInvalid:!0}}),yield this.$18({forceUpgrade:h&&(i==null?void 0:i.name)==="NotFoundError"}),e.eventFlow.addPoint("db_reinit_end"),f=(yield this.$15(a,b,c,e));else throw i}return f});function c(b,c,d,e){return a.apply(this,arguments)}return c}();e.runInTransaction=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c,d){var e;try{e=(yield this.$17(a,b,c,d)),this.$8=[]}catch(a){this.$11(a);this.$16(a);throw a}return e});function c(b,c,d,e){return a.apply(this,arguments)}return c}();e.close=function(){var a;(a=this.$1)==null?void 0:a.close()};e.init=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){try{yield this.$18({eventFlow:a==null?void 0:a.eventFlow})}catch(a){if((a==null?void 0:a.name)==="InvalidStateError")yield this.$18();else throw a}});function c(b){return a.apply(this,arguments)}return c}();e.$19=function(a,b){var c=a.version;a.close();return d("WormIDbUtils").openIDb(this.$2,{onBecomeStale:this.$12,onClose:this.$13,onError:this.$14,onUpgrade:function(a,c){return d("WormIDbUpgrade").upgradeDb(a,c,n,b,{isNewDbInstance:!1,maybeEar:null,onlyCreateNewStores:!0,safeToDeleteStores:new Set()})}},c+1)};e.$18=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=this,e=!1;if(this.$5){e=!0;return this.$5.promise}this.$5=new(d("WAResolvable").Resolvable)();var f=!1;this.$1!=null&&(this.$1.close(),this.$1=null,f=!0);var g=!0;try{var h=babelHelpers["extends"]({},this.$4,n),k=JSON.stringify(h);if(k==null)throw c("err")("DB schema cannot be serialized: "+this.$3);var l=(yield d("WACryptoSha256").sha256Str(k));k=null;var o=(yield d("WormIDbUtils").openIDb(this.$2,{onBecomeStale:this.$12,onClose:this.$13,onError:this.$14,onUpgrade:function(a,c){k={isNewDb:!0,shouldUpgrade:!1};return d("WormIDbUpgrade").upgradeDb(a,c,h,l,{isNewDbInstance:!0,maybeEar:null,onlyCreateNewStores:!1,safeToDeleteStores:b.$6})}}));try{if(Object.keys(n).some(function(a){return o.objectStoreNames.contains(a)===!1})){var p;a==null?void 0:(p=a.eventFlow)==null?void 0:p.addPoint("ear_schema_recovery_start");o=(yield this.$19(o,l));a==null?void 0:(p=a.eventFlow)==null?void 0:p.addPoint("ear_schema_recovery_end")}}catch(b){a==null?void 0:(p=a.eventFlow)==null?void 0:p.addPoint("ear_schema_recovery_fail");m.ERROR(j(),b)}this.$1=o;a==null?void 0:(p=a.eventFlow)==null?void 0:p.addPoint("ear_init_start");try{yield this.$20((p=(p=k)==null?void 0:p.isNewDb)!=null?p:!1,{eventFlow:a==null?void 0:a.eventFlow})}catch(b){a==null?void 0:(p=a.eventFlow)==null?void 0:p.addPoint("ear_init_err");m.ERROR(i(),b);throw b}a==null?void 0:(p=a.eventFlow)==null?void 0:p.addPoint("ear_init_end");var q=k!=null?k:yield d("WormIDbUpgrade").shouldUpgradeDb(o,l);g=q.shouldUpgrade||((p=a==null?void 0:a.forceUpgrade)!=null?p:!1);if(g){this.$1=null;p=o.version;o.close();this.$1=(yield d("WormIDbUtils").openIDb(this.$2,{onBecomeStale:this.$12,onClose:this.$13,onError:this.$14,onUpgrade:function(a,c){return d("WormIDbUpgrade").upgradeDb(a,c,h,l,{isNewDbInstance:q.isNewDb,maybeEar:b.$7,onlyCreateNewStores:!1,safeToDeleteStores:b.$6})}},p+1))}(p=this.$5)==null?void 0:p.resolve()}catch(a){(p=this.$5)==null?void 0:p.reject(a);throw a}finally{a==null?void 0:(p=a.eventFlow)==null?void 0:p.addAnnotations({bool:{isClosingDb:f,isCompetingInit:e,shouldUpgrade:g}});this.$5=null}});function e(b){return a.apply(this,arguments)}return e}();e.$20=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e){var f=this,g=(yield this.$7.prepareNewKeyVersion()),i=!1,j=!1,k=(yield new(h||(h=b("Promise")))(function(b,e){if(f.$1==null)throw c("err")("IDB is not initialised: "+f.$3);var h=[],k=f.$1.transaction(d("WormIDbTypes").EAR_STORE,"readwrite");k.oncomplete=function(){return b(h)};k.onerror=k.onabort=function(){return e(k.error)};var l=k.objectStore(d("WormIDbTypes").EAR_STORE),m=l.getAll();m.onsuccess=function(){var c;c=(c=m.result)!=null?c:[];h=c.filter(o);i=c.length!==h.length;h.sort(function(a,b){return a.version-b.version});c=h.length===0||!d("WATimeUtils").isInFuture(h[h.length-1].expiration);if(!c){b(h);return}c=h.length===0?0:h[h.length-1].version;j=!a&&c===0;c=babelHelpers["extends"]({},g,{version:c+1});l.add(c);h.push(c)};m.onerror=function(){return e(m.error)}}));yield this.$7.init(k,{incorrectVersions:i,versionsLoss:j},{eventFlow:e==null?void 0:e.eventFlow})});function e(b,c){return a.apply(this,arguments)}return e}();return a}();function o(a){if(a==null)return!1;if(a.version==null)return!1;if(a.expiration==null)return!1;if(a.clientKey==null||a.clientKey.byteLength===0)return!1;return a.salt==null||a.salt.byteLength===0?!1:!0}g.sysSchema=n;g.WormIDbDriver=a}),98);
__d("WAHandleFailureUtils",["WABridge","WAGlobals"],(function(a,b,c,d,e,f,g){"use strict";c={GENERIC_FAILURE:"400",NOT_AUTHORIZED:"401",TEMP_BANNED:"402",BANNED:"403",CAT_EXPIRED:"413",CAT_INVALID:"414",NOT_FOUND:"415",INTERNAL_ERROR:"500",SERVER_UNAVAILABLE:"503"};function h(){return d("WAGlobals").getDependencies().clearSignalAndTempStores()}function a(){return h().then(function(){d("WABridge").getBridge().fireAndForget("event","logout",{})})}function b(){return h().then(function(){d("WABridge").getBridge().fireAndForget("event","reregisterDevice",{})})}g.FAILURE_CODES=c;g.clearRegistrationAndTempData=h;g.deregisterPhone=a;g.reregisterPhone=b}),98);
__d("WASignalDB",["BrowserLockManager","WAHandleFailureUtils","WAHex","WAIDBTypes","WALogger","WAPREList","WAPREMetrics","WAResolvable","Worm","WormEAR","WormIDbDriver","WormIDbUtils","asyncToGeneratorRuntime","err","justknobx"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[WORM] Error performing initDb: ",""]);h=function(){return a};return a}var i={stanzaQueue:{autoIncrement:!0,primaryKey:"stanzaQueueId",indexes:{"[jid+priority+stanzaId]":{fields:["jid","priority","stanzaId"],unique:!1},"[jid+priority]":{fields:["jid","priority"],unique:!1},priority:{fields:["priority"],unique:!1},jid:{fields:["jid"],unique:!1}},secure:!1},danglingQueue:{autoIncrement:!0,primaryKey:"queueId",secure:!1},identity:{primaryKey:"deviceJid",indexes:{userJid:{fields:["userJid"],unique:!1}}},contacts:{primaryKey:"contactJid"},session:{primaryKey:"id"},senderKeySessions:{primaryKey:"id",indexes:{groupJid:{fields:["groupJid"],unique:!1},userJid:{fields:["userJid"],unique:!1}}},prekey:{primaryKey:"keyId"},prekeyGeneration:{primaryKey:"generationId"},signedPrekey:{primaryKey:"keyId"},meta:{primaryKey:"key"},plaintextMeta:{primaryKey:"key",secure:!1},migration:{secure:!1,primaryKey:"key"},icdcFails:{primaryKey:"contactJid"}},j,k=new(d("WAResolvable").Resolvable)(),l=typeof window!=="undefined"?window:self;function a(a,b,c,d){return m.apply(this,arguments)}function m(){m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e,f,g){var m;m=(m=l.location.origin)!=null?m:"unknown";var n=d("WAPREMetrics").startMetric(d("WAPREList").PRE_METRIC.WORM,{string:{operationType:"initDb",hostname:m},bool:{isWorm:!0,isLockApiSupported:c("BrowserLockManager")!=null}},void 0,c("justknobx")._("3415"));try{yield o(b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var b=d("WAHex").parseHex(e);b=new(d("WormEAR").WormEAR)(i,b);b=new(d("Worm").WormDatabase)(new(d("WormIDbDriver").WormIDbDriver)(a,"signalDb",i,b,{blockingErrorThreshold:f,onBlockingError:g,onTransactionError:function(b){if(b instanceof d("WormEAR").DecryptionError){b=b;if(b.store==="icdcFails")return;void d("WormIDbUtils").promisifyIDbRequest(d("WAIDBTypes").idb().deleteDatabase(a)).then(function(){return d("WAHandleFailureUtils").reregisterPhone()})}}}));j=b;yield b.init({eventFlow:n});k.resolve(b);n.endSuccess()}))}catch(a){n.endFail("error");d("WALogger").ERROR(h(),a);throw a}});return m.apply(this,arguments)}function e(){if(j==null)throw c("err")("Signal Db v3 is not initialized");return j}function f(){return k.promise}function n(a){return"Signal - "+a}function o(a){return c("BrowserLockManager")!=null?c("BrowserLockManager").request("wajs_make_signal_v3_db",a):a()}g.makeSignalDb=a;g.getDb=e;g.getDbPromise=f;g.signalOp=n}),98);
__d("WAPersistedQueueCache",["WAResolvable","WAShiftTimer","WATagsLogger","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Error during flush: ",""]);h=function(){return a};return a}function a(a,c,e){var f=d("WATagsLogger").TAGS(["PersistedQueue",a,"cache"]),g=[],i=new(d("WAResolvable").Resolvable)(),j=(a=e)!=null?a:{},k=new(d("WAShiftTimer").ShiftTimer)(function(){void n()});return{commit:function(){return n()},add:function(a){g.push(a);a=i;l();m();return a.promise},config:function(a){j=a}};function l(){j.cacheSize!=null&&g.length>=j.cacheSize&&void n()}function m(){if(j.maxDelay!=null){var a=j.maxDelay;k.cancel();k.onOrAfter(a)}}function n(){return o.apply(this,arguments)}function o(){o=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){if(g.length===0)return;k.cancel();var a=g;g=[];var b=i;i=new(d("WAResolvable").Resolvable)();try{yield c(a),b.resolve()}catch(a){f.ERROR(h(),a);b.reject(a);throw a}});return o.apply(this,arguments)}}g.makePersistedQueueCache=a}),98);
__d("WAPersistedQueue",["WAGlobals","WALogger","WAPersistedQueueCache","WAPubSub"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[PersistedQueue] flush: ","}"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[PersistedQueue] new entry & commit"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[PersistedQueue] new entry"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[PersistedQueue] addPending is deprecated, please use addAndCommit instead"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["[PersistedQueue] flush: ","}"]);l=function(){return a};return a}var m=function(){function a(a,b,c){var e=this;this.$1=d("WAPubSub").simplePubSub();this.$3=a;this.$4=b;this.$2=d("WAPersistedQueueCache").makePersistedQueueCache(a,function(c){return b.write(a,c).then(function(){d("WALogger").DEV(l(),c.length),e.$1.publish({type:"flush"})})},c)}var b=a.prototype;b.subscribe=function(a){return this.$1.subscribe(a)};b.index=function(a){function b(b){return a.apply(this,arguments)}b.toString=function(){return a.toString()};return b}(function(a){return this.$4.index(this.$3,a)});b.keys=function(){return this.$4.keys(this.$3)};b.read=function(a){return this.$4.read(this.$3,a)};b.addPending=function(a,b,c){d("WAGlobals").getConfig().simplifyPQ()&&d("WALogger").ERROR(k()),d("WALogger").DEV(j()),this.$1.publish({type:"new_entity"}),void this.$2.add(a).then(function(){return b==null?void 0:b()},function(a){return c==null?void 0:c(a)})};b.addAndCommit=function(a){var b=this;d("WALogger").DEV(i());this.$1.publish({type:"new_entity"});if(d("WAGlobals").getConfig().simplifyPQ())return this.$4.write(this.$3,a).then(function(){d("WALogger").DEV(h(),a.length),b.$1.publish({type:"flush"})});else{a.forEach(function(a){return void b.$2.add(a)});return this.$2.commit()}};b.commit=function(){return this.$2.commit()};b.ack=function(a){return this.$4.ack(this.$3,a)};b["delete"]=function(a){return this.$4["delete"](this.$3,a)};b.clear=function(){return this.$4.clear(this.$3)};return a}();function a(a,b,c){return new m(a,b,c)}g.PersistedQueue=m;g.initPersistedQueue=a}),98);
__d("WASortedLists",[],(function(a,b,c,d,e,f){"use strict";function a(){return[]}function b(){return[]}function c(a,b){return a.filter(b)}function d(a,b){return l(a.map(b))}function e(a,b){var c=a.length===b.length;for(var d=0;c&&d<a.length;d++)a[d]!==b[d]&&(c=!1);return c}function g(a,b){for(var c=0;c<a.length;c++)if(a[c]===b)return a;return a.concat([b]).sort()}function h(a,b){if(a.length<b.length)return!1;var c=!0;for(var d=0,e=0;c&&e<b.length;e++)do c=a[d]===b[e];while(!c&&++d<a.length);return c}function i(a,b){var c=[];for(var d=0,e=0;d<a.length;d++){var f=a[d];while(e<b.length&&f>b[e])e++;(e===b.length||f<b[e])&&c.push(f)}return c}function j(a,b){var c=[],d=0,e=0;while(d<a.length&&e<b.length){var f=a[d],g=b[e];f<g?d++:f===g?(c.push(f),d++,e++):e++}return c}function k(a,b){var c=[],d=0,e=0;while(d<a.length&&e<b.length)a[d]<b[e]?c.push(a[d++]):a[d]===b[e]?(c.push(a[d++]),e++):c.push(b[e++]);while(d<a.length)c.push(a[d++]);while(e<b.length)c.push(b[e++]);return c}function l(a){return m(a.slice().sort())}function m(a){var b=!1;for(var c=0;c<a.length-1;c++)a[c]===a[c+1]&&(b=!0);if(!b)return a;c=[];for(b=0;b<a.length-1;b++)a[b]!==a[b+1]&&c.push(a[b]);c.push(a[a.length-1]);return c}function n(a){return Array.from(a).sort()}function o(a){return a.slice().sort()}function p(a,b,c){var d=null;for(var e=0;!d&&e<a.length;e++)a[e]===b&&(d=a.slice(),d[e]=c,d=m(d.sort()));return d||a}function q(a){return[a]}function r(a){return a.length<1}function s(a,b,c){return a.slice(b,c)}f.emptySet=a;f.emptyList=b;f.filter=c;f.map=d;f.areEqual=e;f.addToSet=g;f.contains=h;f.subtract=i;f.intersect=j;f.joinUniq=k;f.sortAndDedupe=l;f.asSortedSet=n;f.sort=o;f.swapIn=p;f.singleElement=q;f.isEmpty=r;f.slice=s}),66);
__d("WAGetAgeBucketForMediaKeyTimestamp",["WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";function a(a){if(a==null)return"Missing";if(d("WATimeUtils").isInFuture(a))switch(!0){case d("WATimeUtils").happenedWithin(a,1*d("WATimeUtils").DAY_SECONDS):return"< 1 day in future";case d("WATimeUtils").happenedWithin(a,7*d("WATimeUtils").DAY_SECONDS):return"1-7 days in future";default:return"> 7 days in future"}switch(!0){case d("WATimeUtils").happenedWithin(a,1*d("WATimeUtils").DAY_SECONDS):return"< 1 day";case d("WATimeUtils").happenedWithin(a,7*d("WATimeUtils").DAY_SECONDS):return"1-7 days";case d("WATimeUtils").happenedWithin(a,14*d("WATimeUtils").DAY_SECONDS):return"7-14 days";case d("WATimeUtils").happenedWithin(a,21*d("WATimeUtils").DAY_SECONDS):return"14-21 days";case d("WATimeUtils").happenedWithin(a,30*d("WATimeUtils").DAY_SECONDS):return"21-30 days";case d("WATimeUtils").happenedWithin(a,40*d("WATimeUtils").DAY_SECONDS):return"30-40 days";case d("WATimeUtils").happenedWithin(a,50*d("WATimeUtils").DAY_SECONDS):return"40-50 days";case d("WATimeUtils").happenedWithin(a,60*d("WATimeUtils").DAY_SECONDS):return"50-60 days";default:return"> 60 days"}}g.getAgeBucketForMediaKeyTimestamp=a}),98);
__d("WAStartMediaDownloadQplFlow",["WAGetPlatformFromStanzaId","WAGetStorageQplAnnotations","WAJids","WAMediaUtils","WAPREList","WAPREMetrics"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=a.downloadEntry,c=a.msgType,e=a.triggerUIView,f=a.protocolMsgId,g=a.isPreview;a=a.xmaMediaType;var h=d("WAPREMetrics").startMetric(d("WAPREList").PRE_METRIC.MEDIA_DOWNLOAD,{bool:{isTransformStreamSupported:d("WAMediaUtils").isTransformStreamSupported()},string:{chat_type:f==null?null:d("WAJids").switchOnMsgrChatJidType(f.chat,{group:function(){return"group"},user:function(){return"user"}}),downloadEntry:g===!0?b+"-preview":b,e2eePlatform:f==null?null:d("WAGetPlatformFromStanzaId").getPlatformFromStanzaId(f.externalId),msgType:c,trigger_ui_view:e,xmaMediaType:(g=a)!=null?g:void 0}},void 0,d("WAPREMetrics").QPL_MEDIA_DOWNLOAD_TIMEOUT_IN_MS);void d("WAGetStorageQplAnnotations").getStorageQplAnnotations().then(function(a){h.addAnnotations(a)});return babelHelpers["extends"]({},h,{downloadEntry:b,triggerUIView:e})}g.startMediaDownloadQplFlow=a}),98);
__d("WAMedia",[],(function(a,b,c,d,e,f){"use strict";a="Image";b="Video";c="Ptt";d="Gif";e="Sticker";var g="DocumentFile",h={IMAGE:a,VIDEO:b,PTT:c,GIF:d,STICKER:e,DOCUMENT_FILE:g};f.IMAGE=a;f.VIDEO=b;f.PTT=c;f.GIF=d;f.STICKER=e;f.DOCUMENT_FILE=g;f.MEDIA_TYPE=h}),66);
__d("WAMessageKey",["WAGlobals","WAJids","WAStanzaUtils","err"],(function(a,b,c,d,e,f,g){"use strict";function h(a){return a===d("WAJids").AUTHOR_ME||a==d("WAGlobals").getMyUserJid()}function a(a,b,e){if(e==null)throw c("err")("messageKey is null");var f=e.id,g=e.remoteJid;if(f==null)throw c("err")("messageKey.id is null");else if(g==null)throw c("err")("messageKey.remoteJid is null");g=d("WAJids").interpretAndValidateJid(g);if(g.jidType==="unknown")throw c("err")("messageKey.remoteJid is invalid");var i,j=d("WAJids").AUTHOR_ME;if(g.jidType==="group"){i=g.groupJid;if(h(b)&&e.fromMe===!0)j=d("WAJids").AUTHOR_ME;else if(e.fromMe==!0)j=b;else{var k=e.participant;if(k==null)throw c("err")("key.participant is null");k=d("WAJids").interpretAndValidateJid(k);if(k.jidType==="msgrUser")j=k.userJid;else throw c("err")("key.participant is invalid")}}else if(g.jidType==="msgrUser"||g.jidType==="msgrDevice"){k=d("WAJids").interpretAndValidateJid(a);if(k.jidType!=="msgrUser")throw c("err")("expected user type jid.");i=k.userJid;h(b)?e.fromMe===!0?j=d("WAJids").AUTHOR_ME:j=k.userJid:e.fromMe===!0&&(j=k.userJid)}else throw c("err")("Unsupported jidtype type");return{chat:i,author:h(j)?d("WAJids").AUTHOR_ME:j,externalId:d("WAStanzaUtils").toStanzaId(f)}}g.extractProtocolMessageId=a}),98);
__d("WAParseConsumerMessagePollCreation",["WAGlobals","WAHex","WAMsgType"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,c,e){a={unstoredMsg:{type:d("WAMsgType").MSG_TYPE.FUTUREPROOF,msgContent:{protobuf:d("WAHex").bytesToBuffer(a),subtype:"pollCreationMessage"},id:b.id,ts:b.ts,sentTs:b.sentTs,serverTs:b.serverTs,ack:b.ack,reportingMeta:c},unstoredMedia:null,unstoredQuotedMedia:null};if(!e||!d("WAGlobals").getConfig().isPollsEnabled())return a;c=e.encKey;var f=e.options,g=e.name;e=e.selectableOptionsCount;var h=b.id,i=b.ts;b=b.ack;if(c==null||g==null||e==null)return a;a=f.map(function(a){return a.optionName}).filter(Boolean);return{unstoredMsg:{ack:b,id:h,ts:i,type:d("WAMsgType").MSG_TYPE.GROUP_POLL_CREATE},unstoredGroupPollCreateInfo:{encKey:c,name:g,selectableOptionsCount:e,options:a},unstoredMedia:null,unstoredQuotedMedia:null}}g["default"]=a}),98);
__d("WAParseConsumerMessagePollUpdate",["WAGlobals","WAMsgType"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,c,e){a=b.id;c=b.ts;b=b.ack;return e==null||!d("WAGlobals").getConfig().isPollsEnabled()?{unstoredMsg:null,unstoredMedia:null,unstoredQuotedMedia:null}:{unstoredMsg:{ack:b,id:a,ts:c,type:d("WAMsgType").MSG_TYPE.GROUP_POLL_UPDATE},unstoredGroupPollUpdateInfo:{pollUpdateMessage:e,type:d("WAMsgType").MSG_TYPE.GROUP_POLL_UPDATE},unstoredMedia:null,unstoredQuotedMedia:null}}g["default"]=a}),98);
__d("WAParseProtocolUtils",["WAGlobals","WALogger","WALongInt","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Unsupported franking version ",""]);h=function(){return a};return a}function a(a,b){b=i(b,a.serverTs);a=b==null?void 0:b.expirationTs;var c=b==null?void 0:b.deleteTs;b=b==null?void 0:b.ephemeralSetting;return{expirationTs:a,deleteTs:c,ephemeralSetting:b}}function b(a,b){b=j(b);b!=null&&(a.reportingMeta=b);return b}function i(a,b){var c;c=a==null?void 0:(c=a.chatEphemeralSetting)==null?void 0:c.ephemeralExpiration;a=a==null?void 0:(a=a.chatEphemeralSetting)==null?void 0:a.ephemeralSettingTimestamp;if(c==null||a==null||c===0||!d("WAGlobals").getConfig().isEphemeralMessagesEnabled())return null;b=d("WATimeUtils").castToUnixTime(b+d("WAGlobals").getDependencies().ephemeralMaxDeletionWindowForUnseenMessage());var e=b,f=null;try{a=d("WALongInt").numberOrThrowIfTooLarge(a)/1e3;f=d("WATimeUtils").castToUnixTime(a)}catch(a){return null}return{expirationTs:b,deleteTs:e,ephemeralSetting:{expirationTs:c,updatedTs:f}}}function j(a){a=a==null?void 0:a.frankingVersion;a!=null&&a!==0&&d("WALogger").ERROR(h(),a);return{frankingKey:void 0,frankingTag:void 0,frankingVersion:a,reportingContent:void 0,reportingTag:void 0}}g.parseEphemerality=a;g.enhanceReportingMeta=b}),98);
__d("WAParseReadOnlyMetadataDataclassToUnsafeObject",["err"],(function(a,b,c,d,e,f,g){"use strict";function a(a){if((a==null?void 0:a.readonlyMetadataDataclass)!=null)try{a=JSON.parse(a==null?void 0:a.readonlyMetadataDataclass);return a}catch(a){throw c("err")("Failed to parse readonly metadata dataclass JSON")}return null}g["default"]=a}),98);
__d("maybeConvertMessageTextMentionsV2ToV1",["WACommon.pb"],(function(a,b,c,d,e,f,g){function a(a){if(a==null||a.text==null||a.mentions==null||a.mentions.length===0)return a;var b=a.text,c=[],e=[],f=0;for(var g=a.mentions,h=Array.isArray(g),i=0,g=h?g:g[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var j;if(h){if(i>=g.length)break;j=g[i++]}else{i=g.next();if(i.done)break;j=i.value}j=j;var k=j.offset,l=j.length,m=j.mentionedJid;j=j.mentionType;if(j!==d("WACommon.pb").MENTION_MENTION_TYPE.PROFILE||k==null||l==null||m==null)continue;e.push(m+"@msgr");c.push(b.substring(f,k));c.push("@"+m+"@msgr");f=k+l}if(e.length===0)return a;c.push(b.substring(f));return babelHelpers["extends"]({},a,{text:c.join(""),mentionedJid:e,mentions:[]})}g["default"]=a}),98);
__d("WAParseConsumerMessageProtocol",["WACommon.pb","WAConsumerApplication.pb","WAGlobals","WAHex","WAJids","WALogger","WAMediaTransport.pb","WAMessageKey","WAMsgType","WAParseConsumerMessagePollCreation","WAParseConsumerMessagePollUpdate","WAParseMediaTransportProtocol","WAParseProtocolUtils","WAParseReadOnlyMetadataDataclassToUnsafeObject","WAResultOrError","WAStanzaUtils","WATimeUtils","decodeProtobuf","err","maybeConvertMessageTextMentionsV2ToV1"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["parseConsumerMessageProtocol error :",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["WAParseConsumerMessageProtocol - ephemeralSetting duration is invalid ",", jidType: ",""]);i=function(){return a};return a}var j=90*d("WATimeUtils").DAY_SECONDS;b=1;e=0;f=1;f=d("WAGlobals").getConfig().armadilloWebProcessFutureproof()?f+1:f;function a(a,b,e,f,g,k){var l;b=d("decodeProtobuf").decodeProtobufWithUnknowns(d("WAConsumerApplication.pb").ConsumerApplicationSpec,b);l=(l=b.payload)==null?void 0:(l=l.applicationData)==null?void 0:(l=l.revoke)==null?void 0:(l=l.key)==null?void 0:l.id;if(l!=null)return{unstoredMsg:{type:d("WAMsgType").MSG_TYPE.REVOKED,id:e.id,ts:e.ts,sentTs:e.sentTs,serverTs:e.serverTs,ack:e.ack,reportingMeta:e.reportingMeta,revokedExternalId:d("WAStanzaUtils").toStanzaId(l),unsendMsgContentDeleteTs:null,msgContent:null,ebTimestampMs:k},unstoredMedia:null,unstoredQuotedMedia:null};var m=(g==null?void 0:g.isForwarded)||!1;l=d("WAParseProtocolUtils").parseEphemerality(e,g);var x=l.expirationTs,y=l.deleteTs,z=l.ephemeralSetting;if(z!=null&&(z.expirationTs<0||z.expirationTs>j)){l=d("WAJids").interpretAndValidateJid(a);l=l.jidType;var A=z.expirationTs;d("WALogger").ERROR(i(),A,l)}var B=d("WAParseProtocolUtils").enhanceReportingMeta(e,g),C=(A=o(g))!=null?A:void 0,D=(l=b.payload)==null?void 0:l.content;if(!D)return{unstoredMsg:null,unstoredMedia:null,unstoredQuotedMedia:null};var E=(A=b.metadata)==null?void 0:A.specialTextSize,F=t(D),G={contentTypeForLogging:F,unstoredMsg:{type:d("WAMsgType").MSG_TYPE.FUTUREPROOF,msgContent:{protobuf:d("WAHex").bytesToBuffer(f),subtype:null},id:e.id,ts:e.ts,sentTs:e.sentTs,serverTs:e.serverTs,ack:e.ack,reportingMeta:B},unstoredMedia:null,unstoredQuotedMedia:null},H=function(a){return babelHelpers["extends"]({},G,{unstoredMsg:babelHelpers["extends"]({},G.unstoredMsg,{msgContent:babelHelpers["extends"]({},G.unstoredMsg.msgContent,{subtype:a})})})};l=function(){try{switch(F){case"messageText":var b,i=c("maybeConvertMessageTextMentionsV2ToV1")(D[F]);if(i==null)throw c("err")("consumerMessage has no messageText");b=((b=i.commands)==null?void 0:b.some(function(a){return a.commandType===d("WACommon.pb").COMMAND_COMMAND_TYPE.AI}))===!0;if(b)return H("metaAiMessage");if(w(g))return H("noteMention");if(i.text==null)throw c("err")("consumerMessage has no messageText");return{unstoredMsg:babelHelpers["extends"]({type:d("WAMsgType").MSG_TYPE.TEXT,msgContent:{content:i.text,mentionedJids:i.mentionedJid.map(d("WAJids").validateUserJid).filter(Boolean),commands:i.commands},quote:C,expirationTs:x,deleteTs:y,ephemeralSetting:z,isForwarded:m},e,{specialTextSize:E,ebTimestampMs:k}),unstoredMedia:null,unstoredQuotedMedia:null};case"reactionMessage":return{unstoredMsg:n(a,e,D[F]),unstoredMedia:null,unstoredQuotedMedia:null};case"imageMessage":b=p(D,e.ts);return{unstoredMsg:babelHelpers["extends"]({type:d("WAMsgType").MSG_TYPE.IMAGE,quote:C,expirationTs:x,deleteTs:y,ephemeralSetting:z,isForwarded:m,mediaId:b.plaintextHash},e,{ebTimestampMs:k}),unstoredMedia:b,unstoredQuotedMedia:null};case"videoMessage":var j,l;i=D[F];if(i==null)throw c("err")("consumerMessage has no videoMessage");b=d("decodeProtobuf").decodeProtobufWithUnknowns(d("WAMediaTransport.pb").VideoTransportSpec,i==null?void 0:(b=i.video)==null?void 0:b.payload);j=b==null?void 0:(j=b.integral)==null?void 0:(j=j.transport)==null?void 0:(j=j.ancillary)==null?void 0:j.mimetype;l=(b==null?void 0:(l=b.ancillary)==null?void 0:l.gifPlayback)===!0&&j==="image/gif";if(l&&!d("WAGlobals").getConfig().isGifEnabled())return G;j=d("WAParseMediaTransportProtocol").parseVideoMsg(b,e.ts,l);if(j==null)throw c("err")("consumerMessage has no video media info");if(v(g)&&((b=i.caption)==null?void 0:b.text)!=null){return{unstoredMsg:babelHelpers["extends"]({type:d("WAMsgType").MSG_TYPE.TEXT,msgContent:{content:(b=i.caption)==null?void 0:b.text,mentionedJids:i.caption.mentionedJid.map(d("WAJids").validateUserJid).filter(Boolean)},quote:C,expirationTs:x,deleteTs:y,ephemeralSetting:z,isForwarded:m},e,{specialTextSize:E,ebTimestampMs:k}),unstoredMedia:null,unstoredQuotedMedia:null}}return{unstoredMsg:l?babelHelpers["extends"]({type:d("WAMsgType").MSG_TYPE.GIF},e,{quote:C,expirationTs:x,deleteTs:y,ephemeralSetting:z,isForwarded:m,reportingMeta:B,mediaId:j.plaintextHash}):babelHelpers["extends"]({type:d("WAMsgType").MSG_TYPE.VIDEO},e,{quote:C,expirationTs:x,deleteTs:y,ephemeralSetting:z,isForwarded:m,mediaId:j.plaintextHash}),unstoredMedia:j,unstoredQuotedMedia:null};case"audioMessage":b=q(D,e.ts);return{unstoredMsg:babelHelpers["extends"]({type:d("WAMsgType").MSG_TYPE.PTT,quote:C,expirationTs:x,deleteTs:y,ephemeralSetting:z,isForwarded:m,mediaId:b.plaintextHash},e,{ebTimestampMs:k}),unstoredMedia:b,unstoredQuotedMedia:null};case"stickerMessage":if(d("WAGlobals").getConfig().isStickerEnabled()){i=r(D);l=d("WAParseMediaTransportProtocol").parseStickerMsg(i,e.ts);j=((j=i.integral)==null?void 0:j.receiverFetchId)!=null||((b=i.ancillary)==null?void 0:b.receiverFetchId)!=null;b=d("WAGlobals").getConfig().isStickerReceiverFetchEnabled();if(l==null){if(j){if(b){j=d("WAParseMediaTransportProtocol").parseStickerReceiverFetchInfo(i);if(j==null)throw c("err")("consumerMessage has no sticker receiver fetch info");return{unstoredMsg:babelHelpers["extends"]({type:d("WAMsgType").MSG_TYPE.RECEIVER_FETCH,quote:C,expirationTs:x,deleteTs:y,ephemeralSetting:z,isForwarded:m,reportingMeta:B},e,{ebTimestampMs:k}),unstoredMedia:null,unstoredQuotedMedia:null,unstoredReceiverFetchInfo:j}}return H("stickerReceiverFetchMessage")}throw c("err")("consumerMessage has no sticker media info")}return{unstoredMsg:babelHelpers["extends"]({type:d("WAMsgType").MSG_TYPE.STICKER,quote:C,expirationTs:x,deleteTs:y,ephemeralSetting:z,isForwarded:m,reportingMeta:B,mediaId:l.plaintextHash},e,{ebTimestampMs:k}),unstoredMedia:l,unstoredQuotedMedia:null}}return G;case"documentMessage":if(d("WAGlobals").getConfig().isDocumentReceiveEnabled()){b=s(D,e.ts);return{unstoredMsg:babelHelpers["extends"]({type:d("WAMsgType").MSG_TYPE.DOCUMENT_FILE,quote:C,expirationTs:x,deleteTs:y,ephemeralSetting:z,isForwarded:m,reportingMeta:B,mediaId:b.plaintextHash},e,{ebTimestampMs:k}),unstoredMedia:b,unstoredQuotedMedia:null}}return G;case"groupInviteMessage":return{unstoredMsg:null,unstoredMedia:null,unstoredQuotedMedia:null,unstoredIncomingGroupInvite:u(e,D)};case"editMessage":i=D[F];j=i==null?void 0:i.message;l=j==null?void 0:j.text;b=i==null?void 0:(b=i.key)==null?void 0:b.id;if(i==null||j==null||l==null)throw c("err")("consumerMessage with editMessage type has no editMessage");if(b==null)throw c("err")("consumerMessage with editMessage type has no original Msg External Id.");i=d("WAStanzaUtils").toStanzaId(b);return{unstoredEditMsg:{type:d("WAMsgType").MSG_TYPE.EDIT_ACTION,editMsgContent:{content:l,mentionedJids:j.mentionedJid.map(d("WAJids").validateUserJid).filter(Boolean),commands:j.commands},originalMsgExternalId:i,id:e.id,ts:e.ts,sentTs:e.sentTs,serverTs:e.serverTs,ack:e.ack,reportingMeta:B,specialTextSize:E},unstoredMsg:null,unstoredMedia:null,unstoredQuotedMedia:null};case"pollCreationMessage":return c("WAParseConsumerMessagePollCreation")(f,e,B,D[F]);case"pollUpdateMessage":return c("WAParseConsumerMessagePollUpdate")(f,e,B,D[F]);case"contactMessage":case"locationMessage":case"extendedTextMessage":case"statusTextMessage":case"contactsArrayMessage":case"liveLocationMessage":case"viewOnceMessage":default:return G}}catch(a){d("WALogger").ERROR(h(),a);return{unstoredMsg:null,unstoredMedia:null,unstoredQuotedMedia:null}}}();return babelHelpers["extends"]({},l,{contentTypeForLogging:F})}function k(a){if(d("WAJids").isAuthorSystem(a))throw c("err")("Got system author");return a}var l=30;function m(a){if(a==null)return d("WAResultOrError").makeResult(null);return a.length>l?d("WAResultOrError").makeError("invalid-reaction-text-length"):d("WAResultOrError").makeResult(a)}function n(a,b,e){if(e==null)throw c("err")("consumerMessage has no reactionMessage");var f=k(b.id.author);a=d("WAMessageKey").extractProtocolMessageId(a,f,e.key);f=e.text;var g=e.groupingKey;e=e.senderTimestampMs;var h=m(f);if(!h.success){throw c("err")('"'+((f=f)!=null?f:"")+'" is not a valid reaction ['+h.error+"]")}return{type:d("WAMsgType").MSG_TYPE.REACTION,ack:b.ack,id:b.id,reactToExternalId:a.externalId,reactToAuthor:a.author,reaction:h.value,groupingKey:g,ts:b.ts,senderTimestampMs:e}}function o(a){var b,e;b=a==null?void 0:(b=a.quotedMessage)==null?void 0:b.stanzaId;e=a==null?void 0:(e=a.quotedMessage)==null?void 0:e.participant;a=a==null?void 0:(a=a.quotedMessage)==null?void 0:a.remoteJid;e=e!=null?d("WAJids").interpretAndValidateJid(e):null;var f;(e==null?void 0:e.jidType)==="msgrUser"&&e.userJid===d("WAGlobals").getMyUserJid()?f=d("WAJids").AUTHOR_ME:(e==null?void 0:e.jidType)==="msgrUser"?f=e.userJid:f=d("WAJids").AUTHOR_ME;if(b==null)return null;e={type:d("WAMsgType").MSG_TYPE.UNAVAILABLE,author:f,externalId:d("WAStanzaUtils").toStanzaId(b),ts:null};if(a!=null){f=d("WAJids").interpretAndValidateJid(a);if(f.jidType==="group")return{remoteJid:f.groupJid,content:e};else throw c("err")("not supported")}else return{remoteJid:null,content:e}}function p(a,b){a=a.imageMessage;if(a==null)throw c("err")("consumerMessage has no imageMessage");return d("WAParseMediaTransportProtocol").decodeImageTransport(a==null?void 0:(a=a.image)==null?void 0:a.payload,b,"image")}function q(a,b){var e;a=a.audioMessage;if(a==null)throw c("err")("consumerMessage has no audioMessage");e=d("decodeProtobuf").decodeProtobufWithUnknowns(d("WAMediaTransport.pb").AudioTransportSpec,a==null?void 0:(e=a.audio)==null?void 0:e.payload);e=d("WAParseMediaTransportProtocol").parseAudioMsg(e,(a==null?void 0:a.ptt)||!1,b);if(e==null)throw c("err")("consumerMessage has no audio media info");return e}function r(a){a=a.stickerMessage;if(a==null)throw c("err")("consumerMessage has no stickerMessage");return d("decodeProtobuf").decodeProtobufWithUnknowns(d("WAMediaTransport.pb").StickerTransportSpec,a==null?void 0:(a=a.sticker)==null?void 0:a.payload)}function s(a,b){var e;a=a.documentMessage;if(a==null)throw c("err")("consumerMessage has no documentMessage");e=d("decodeProtobuf").decodeProtobufWithUnknowns(d("WAMediaTransport.pb").DocumentTransportSpec,a==null?void 0:(e=a.document)==null?void 0:e.payload);a=a==null?void 0:a.fileName;e=d("WAParseMediaTransportProtocol").parseDocumentMsg(e,a,b);if(e==null)throw c("err")("consumerMessage has no document media info");return e}function t(a){var b=Object.keys(a).filter(function(a){return a!=="$$unknownFieldCount"});if(b.length!==1)throw c("err")(JSON.stringify(a)+" consumerMessage payload content should have exactly one field, instead found "+JSON.stringify(b));return b[0]}function u(a,b){b=b.groupInviteMessage;if(b==null)throw c("err")("consumerMessage has no GroupInvite Data");return babelHelpers["extends"]({ack:a.ack,author:a.id.author,externalId:a.id.externalId,ts:a.ts},b)}function v(a){a=c("WAParseReadOnlyMetadataDataclassToUnsafeObject")(a);return(a==null?void 0:(a=a.power_up)==null?void 0:a.power_up_style)!=null}function w(a){a=c("WAParseReadOnlyMetadataDataclassToUnsafeObject")(a);return(a==null?void 0:(a=a.note_metadata)==null?void 0:a.message_type)==="MENTION"}g.MINIMAL_MEDIA_DURATION=b;g.DEFAULT_FILE_SIZE=e;g.SUPPORTED_TYPES_VERSION=f;g.parseConsumerMessageProtocol=a;g.interpretAsNonSystemAuthor=k;g.validReactionMessageText=m;g.parseReactionMessage=n;g.parsedQuotedConsumerMessage=o;g.parseOneOfContentType=t}),98);
__d("WAParseMediaTransportProtocol",["WAConsumerApplication.pb","WAGlobals","WAHashUtils","WALogger","WALongInt","WAMedia","WAMediaHdType","WAMediaTransport.pb","WAMediaUtils","WAMsgMap","WAParseConsumerMessageProtocol","WAProgressiveJpegGetScanLengths","WATimeUtils","decodeProtobuf","err"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["downloadableThumbnail is missing some required fields"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["cannot compose mediaEntry with the media message"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["parseMediaKey error :",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["cannot compose mediaEntry with the media message"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["protobuf msg with no plaintext hash"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["There is unknown fileds in integral of VideoTransport"]);m=function(){return a};return a}function n(a,b,c,e){var f,g,h;if(!((f=a.integral)==null?void 0:f.transport))return null;f=(f=a.integral)==null?void 0:f.transport;if(d("decodeProtobuf").getUnknownFields(f.integral)!=null){d("WALogger").ERROR(m());return null}g=(g=f.integral)==null?void 0:g.fileSha256;if(!g){c||d("WALogger").ERROR(l());return null}c=null;if(((h=a.ancillary)==null?void 0:h.scansSidecar)!=null&&((h=a.ancillary)==null?void 0:h.scanLengths)!=null){c={sidecar:(h=a.ancillary)==null?void 0:h.scansSidecar,scanLengths:(h=a.ancillary)==null?void 0:(a=h.scanLengths)==null?void 0:a.map(d("WAProgressiveJpegGetScanLengths").asProgressiveJpegScanLength)}}if(((h=f.integral)==null?void 0:h.fileSha256)==null||((a=f.integral)==null?void 0:a.fileEncSha256)==null||((h=f.integral)==null?void 0:h.mediaKey)==null||((a=f.integral)==null?void 0:a.directPath)==null||((h=f.integral)==null?void 0:h.mediaKeyTimestamp)==null||((a=f.ancillary)==null?void 0:a.objectId)==null){d("WALogger").ERROR(k());return null}a=(h=f.ancillary)==null?void 0:h.fileLength;h=(h=f.ancillary.thumbnail)==null?void 0:h.downloadableThumbnail;f=d("WAMediaUtils").rawDataToMediaEntry({fileSha256:f.integral.fileSha256,fileEncSha256:f.integral.fileEncSha256,mediaKey:f.integral.mediaKey,directPath:f.integral.directPath,mediaKeyTimestamp:d("WATimeUtils").castLongIntToUnixTime(f.integral.mediaKeyTimestamp),serverMediaType:b,objectId:(b=f.ancillary)==null?void 0:b.objectId,fbid:void 0,downloadableThumbnail:{directPath:h==null?void 0:h.directPath,fileEncSha256:h==null?void 0:h.fileEncSha256,fileSha256:h==null?void 0:h.fileSha256,mediaKey:h==null?void 0:h.mediaKey,mediaKeyTimestamp:(h==null?void 0:h.mediaKeyTimestamp)==null?null:d("WATimeUtils").castLongIntToUnixTime(h==null?void 0:h.mediaKeyTimestamp),objectId:h==null?void 0:h.objectId},filename:e,progressiveJpegDetails:c,size:a==null?a:d("WALongInt").numberOrThrowIfTooLarge(a)});return{size:a==null?d("WAParseConsumerMessageProtocol").DEFAULT_FILE_SIZE:d("WALongInt").numberOrThrowIfTooLarge(a),plaintextHash:d("WAHashUtils").toPlaintextHash(new Uint8Array(g)),mediaEntry:f}}function o(a){switch(a){case d("WAMediaTransport.pb").IMAGE_TRANSPORT_ANCILLARY_HD_TYPE.NONE:return d("WAMediaHdType").HD_TYPE_NONE;case d("WAMediaTransport.pb").IMAGE_TRANSPORT_ANCILLARY_HD_TYPE.LQ_4K:return d("WAMediaHdType").HD_TYPE_LQ_4K;case d("WAMediaTransport.pb").IMAGE_TRANSPORT_ANCILLARY_HD_TYPE.HQ_4K:return d("WAMediaHdType").HD_TYPE_HQ_4K;default:a;return d("WAMediaHdType").HD_TYPE_NONE}}function p(a,b,c){var e;c=n(a,c,!1);if(!c)return null;c=s(c,b);b=(b=a.ancillary)==null?void 0:b.width;e=(e=a.ancillary)==null?void 0:e.height;a.ancillary!=null&&(a.ancillary.width!=null&&a.ancillary.width===4294967295&&(b=void 0),a.ancillary.height!=null&&a.ancillary.height===4294967295&&(e=void 0));b=babelHelpers["extends"]({},c,{mediaType:d("WAMedia").MEDIA_TYPE.IMAGE,validatedVideoInfo:null,validatedImageInfo:{width:b,height:e,jpegThumbnail:(c=a.integral)==null?void 0:(b=c.transport)==null?void 0:(e=b.ancillary)==null?void 0:(c=e.thumbnail)==null?void 0:c.jpegThumbnail,jpegThumbnailHeight:(b=a.integral)==null?void 0:(e=b.transport)==null?void 0:(c=e.ancillary)==null?void 0:(b=c.thumbnail)==null?void 0:b.thumbnailHeight,jpegThumbnailWidth:(e=a.integral)==null?void 0:(c=e.transport)==null?void 0:(b=c.ancillary)==null?void 0:(e=b.thumbnail)==null?void 0:e.thumbnailWidth,hdType:d("WAGlobals").getConfig().isImageHDSupportedEnabled()?o((c=a.ancillary)==null?void 0:c.hdType):void 0},validatedAudioInfo:null,validatedDocumentFileInfo:null});return b}function a(a,b,e){a=d("decodeProtobuf").decodeProtobufWithUnknowns(d("WAMediaTransport.pb").ImageTransportSpec,a);a=p(a,b,e);if(a==null)throw c("err")("consumerMessage has no image media info");return a}function b(a,b,c){var e;if(!((e=a.integral)==null?void 0:e.transport))return null;e=n(a,c?"gif":"video",!1);if(!e)return null;e=s(e,b);b=babelHelpers["extends"]({},e,{accessibilitySummaryText:(b=a.ancillary)==null?void 0:b.accessibilityLabel,mediaType:c?d("WAMedia").MEDIA_TYPE.GIF:d("WAMedia").MEDIA_TYPE.VIDEO,validatedVideoInfo:c?null:{duration:(a==null?void 0:(e=a.ancillary)==null?void 0:e.seconds)!=null&&(a==null?void 0:(b=a.ancillary)==null?void 0:b.seconds)>d("WAParseConsumerMessageProtocol").MINIMAL_MEDIA_DURATION?a==null?void 0:(e=a.ancillary)==null?void 0:e.seconds:d("WAParseConsumerMessageProtocol").MINIMAL_MEDIA_DURATION,width:a==null?void 0:(b=a.ancillary)==null?void 0:b.width,height:a==null?void 0:(e=a.ancillary)==null?void 0:e.height,mimetype:a==null?void 0:(b=a.integral)==null?void 0:(e=b.transport)==null?void 0:(b=e.ancillary)==null?void 0:b.mimetype,jpegThumbnail:(e=a.integral)==null?void 0:(b=e.transport)==null?void 0:(e=b.ancillary)==null?void 0:(b=e.thumbnail)==null?void 0:b.jpegThumbnail,jpegThumbnailHeight:(e=a.integral)==null?void 0:(b=e.transport)==null?void 0:(e=b.ancillary)==null?void 0:(b=e.thumbnail)==null?void 0:b.thumbnailHeight,jpegThumbnailWidth:(e=a.integral)==null?void 0:(b=e.transport)==null?void 0:(e=b.ancillary)==null?void 0:(b=e.thumbnail)==null?void 0:b.thumbnailWidth},validatedImageInfo:c?{width:(e=a.ancillary)==null?void 0:e.width,height:(b=a.ancillary)==null?void 0:b.height,jpegThumbnail:(c=a.integral)==null?void 0:(e=c.transport)==null?void 0:(b=e.ancillary)==null?void 0:(c=b.thumbnail)==null?void 0:c.jpegThumbnail,jpegThumbnailHeight:(e=a.integral)==null?void 0:(b=e.transport)==null?void 0:(c=b.ancillary)==null?void 0:(e=c.thumbnail)==null?void 0:e.thumbnailHeight,jpegThumbnailWidth:(b=a.integral)==null?void 0:(c=b.transport)==null?void 0:(e=c.ancillary)==null?void 0:(a=e.thumbnail)==null?void 0:a.thumbnailWidth}:null,validatedAudioInfo:null,validatedDocumentFileInfo:null});return b}function e(a,b,c){if(!((b=a.integral)==null?void 0:b.transport))return null;b=n(a,"ptt",!1);if(!b)return null;b=s(b,c);b=babelHelpers["extends"]({},b,{mediaType:d("WAMedia").MEDIA_TYPE.PTT,validatedVideoInfo:null,validatedImageInfo:null,validatedDocumentFileInfo:null,validatedAudioInfo:{duration:(a==null?void 0:(c=a.ancillary)==null?void 0:c.seconds)!=null&&(a==null?void 0:(b=a.ancillary)==null?void 0:b.seconds)>d("WAParseConsumerMessageProtocol").MINIMAL_MEDIA_DURATION?a==null?void 0:(c=a.ancillary)==null?void 0:c.seconds:d("WAParseConsumerMessageProtocol").MINIMAL_MEDIA_DURATION,mimetype:a==null?void 0:(b=a.integral)==null?void 0:(c=b.transport)==null?void 0:(a=c.ancillary)==null?void 0:a.mimetype,played:!1}});return b}function f(a,b){var c;if(!((c=a.integral)==null?void 0:c.transport))return null;c=((c=a.integral)==null?void 0:c.receiverFetchId)!=null;c=n(a,"sticker",c);if(!c)return null;c=s(c,b);b=babelHelpers["extends"]({},c,{accessibilitySummaryText:(b=a.ancillary)==null?void 0:b.accessibilityLabel,mediaType:d("WAMedia").MEDIA_TYPE.STICKER,validatedVideoInfo:null,validatedImageInfo:{width:(c=a.ancillary)==null?void 0:c.width,height:(b=a.ancillary)==null?void 0:b.height,jpegThumbnail:(c=a.integral)==null?void 0:(b=c.transport)==null?void 0:(c=b.ancillary)==null?void 0:(b=c.thumbnail)==null?void 0:b.jpegThumbnail,jpegThumbnailHeight:(c=a.integral)==null?void 0:(b=c.transport)==null?void 0:(c=b.ancillary)==null?void 0:(b=c.thumbnail)==null?void 0:b.thumbnailHeight,jpegThumbnailWidth:(c=a.integral)==null?void 0:(b=c.transport)==null?void 0:(a=b.ancillary)==null?void 0:(c=a.thumbnail)==null?void 0:c.thumbnailWidth},validatedAudioInfo:null,validatedDocumentFileInfo:null});return b}function q(a){var b,c,d;if(!((b=a.integral)==null?void 0:b.transport))return null;b=(b=a.ancillary)==null?void 0:b.width;c=(c=a.ancillary)==null?void 0:c.height;d=(d=(d=a.integral)==null?void 0:d.receiverFetchId)!=null?d:(d=a.ancillary)==null?void 0:d.receiverFetchId;a=a==null?void 0:(a=a.integral)==null?void 0:(a=a.transport)==null?void 0:(a=a.ancillary)==null?void 0:a.mimetype;if(b==null||c==null||d==null||a==null)return null;d={receiverFetchId:d,previewWidth:b,previewHeight:c,mimetype:a,type:"sticker"};return d}function r(a,b,c){var e;if(!((e=a.integral)==null?void 0:e.transport))return null;e=n(a,"document",!1,b);if(!e)return null;e=s(e,c);return babelHelpers["extends"]({},e,{mediaType:d("WAMedia").MEDIA_TYPE.DOCUMENT_FILE,validatedVideoInfo:null,validatedImageInfo:null,validatedAudioInfo:null,validatedDocumentFileInfo:{mimetype:a==null?void 0:(c=a.integral)==null?void 0:(e=c.transport)==null?void 0:(a=e.ancillary)==null?void 0:a.mimetype,filename:(c=b)!=null?c:void 0}})}function s(a,b){return{mediaEntry:a.mediaEntry,plaintextHash:a.plaintextHash,size:a.size,msgIds:[],mediaEntries:new(d("WAMsgMap").MsgMap)(),ts:b}}function t(a){a=a.msg;if(a.subprotocolType!=="consumerMessage")return[];a=d("decodeProtobuf").decodeProtobuf(d("WAConsumerApplication.pb").ConsumerApplicationSpec,a.subprotocol);if(a.payload==null||a.payload.content==null)return[];var b=a.payload.content;a=d("WAParseConsumerMessageProtocol").parseOneOfContentType(a.payload.content);try{switch(a){case"imageMessage":a=d("decodeProtobuf").decodeProtobuf(d("WAMediaTransport.pb").ImageTransportSpec,(a=b.imageMessage)==null?void 0:(a=a.image)==null?void 0:a.payload);return u(a,"image");case"videoMessage":a=d("decodeProtobuf").decodeProtobuf(d("WAMediaTransport.pb").VideoTransportSpec,(a=b.videoMessage)==null?void 0:(a=a.video)==null?void 0:a.payload);return u(a,"video");case"audioMessage":a=d("decodeProtobuf").decodeProtobuf(d("WAMediaTransport.pb").AudioTransportSpec,(a=b.audioMessage)==null?void 0:(a=a.audio)==null?void 0:a.payload);return u(a,"ptt");case"stickerMessage":a=d("decodeProtobuf").decodeProtobuf(d("WAMediaTransport.pb").StickerTransportSpec,(a=b.stickerMessage)==null?void 0:(a=a.sticker)==null?void 0:a.payload);return u(a,"sticker");case"documentMessage":a=d("decodeProtobuf").decodeProtobuf(d("WAMediaTransport.pb").DocumentTransportSpec,(a=b.documentMessage)==null?void 0:(b=a.document)==null?void 0:b.payload);return u(a,"document");case"groupInviteMessage":case"editMessage":case"pollCreationMessage":case"pollUpdateMessage":case"messageText":case"reactionMessage":case"contactMessage":case"locationMessage":case"extendedTextMessage":case"statusTextMessage":case"contactsArrayMessage":case"liveLocationMessage":case"viewOnceMessage":default:return[]}}catch(a){d("WALogger").ERROR(j(),a);return[]}}function u(a,b){var c,e;if(!((c=a.integral)==null?void 0:c.transport))return[];c=(c=a.integral)==null?void 0:c.transport;if(c.integral==null||((e=c.integral)==null?void 0:e.fileSha256)==null||((e=c.integral)==null?void 0:e.fileEncSha256)==null||((e=c.integral)==null?void 0:e.mediaKey)==null||((e=c.integral)==null?void 0:e.directPath)==null||((e=c.integral)==null?void 0:e.mediaKeyTimestamp)==null||((e=c.ancillary)==null?void 0:e.objectId)==null){d("WALogger").ERROR(i());return[]}e=c.integral;var f=e.fileSha256,g=e.fileEncSha256,j=e.mediaKey,k=e.directPath;e=e.mediaKeyTimestamp;b={directPath:k,plaintextHash:d("WAHashUtils").toPlaintextHash(f),ciphertextHash:d("WAHashUtils").toCiphertextHash(g),fbid:void 0,fileEncSha256:g,fileSha256:f,mediaKey:j,mediaKeyTimestamp:d("WATimeUtils").castLongIntToUnixTime(e),objectId:(k=c.ancillary)==null?void 0:k.objectId,serverMediaType:b,sidecar:((g=a.ancillary)==null?void 0:g.scansSidecar)||((f=a.ancillary)==null?void 0:f.sidecar),size:d("WALongInt").maybeNumberOrThrowIfTooLarge((j=c.ancillary)==null?void 0:j.fileLength),scanLengths:(e=a.ancillary)==null?void 0:(k=e.scanLengths)==null?void 0:k.map(d("WAProgressiveJpegGetScanLengths").asProgressiveJpegScanLength),uploadToken:void 0};j=(g=c.ancillary)==null?void 0:(f=g.thumbnail)==null?void 0:f.downloadableThumbnail;a=null;if(j!=null&&(j==null?void 0:j.fileSha256)!=null&&(j==null?void 0:j.fileEncSha256)!=null&&(j==null?void 0:j.mediaKey)!=null&&(j==null?void 0:j.directPath)!=null&&(j==null?void 0:j.mediaKeyTimestamp)!=null&&(j==null?void 0:j.objectId)!=null){e=j.fileSha256;k=j.fileEncSha256;c=j.mediaKey;g=j.directPath;f=j.mediaKeyTimestamp;var l=j.objectId;a={ciphertextHash:d("WAHashUtils").toCiphertextHash(k),directPath:g,fileEncSha256:k,fileSha256:e,mediaKey:c,mediaKeyTimestamp:d("WATimeUtils").castLongIntToUnixTime(f),objectId:l,plaintextHash:d("WAHashUtils").toPlaintextHash(e),scanLengths:void 0,serverMediaType:"preview",sidecar:void 0,uploadToken:void 0,size:void 0}}else j!=null&&d("WALogger").ERROR(h());return[b,a].filter(Boolean)}g.getMediaMeta=n;g.decodeImageTransport=a;g.parseVideoMsg=b;g.parseAudioMsg=e;g.parseStickerMsg=f;g.parseStickerReceiverFetchInfo=q;g.parseDocumentMsg=r;g.parseMediaKey=t}),98);
__d("MAWParseXMAProtocol",["ACTSanitizerApiTypes","MAWMsgType","MAWODSProxy","MAWParseSubprotocolVersionConsts","MAWParseXMAFBConfig","MAWXMALoggingUtils","MWXMAV2IsDataclassLiveLocationXMA","WAArmadilloXMA.pb","WAGetPlatformFromStanzaId","WAHex","WAJids","WALogger","WAMedia","WAMsgApplication.pb","WAOdsEnums","WAParseConsumerMessageProtocol","WAParseMediaTransportProtocol","WAParseMessageApplication","WAParseProtocolUtils","WAStanzaUtils","WATimeUtils","decodeProtobuf","err"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["S410301 The url contains RTL characters"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(['S410301 The url is invalid. It contains a colon separator, but not "://"']);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Invalid message text during XMA restore"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Invalid url prefix during XMA restore"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose([""," XMA has invalid native URL for target type: ",". hasNativeUrl: ",". hasActionUrl: ","."]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose([""," XMA has invalid action URL for target type: ",". hasNativeUrl: ",". hasActionUrl: ","."]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose([""," XMA has invalid action and native URL for target type: ",". hasNativeUrl: ",". hasActionUrl: ","."]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["ExternalId: "," textId: ",""]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["\n      received previews version is older than expected ",". "]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["\n    received favicon version is older than expected ",". "]);q=function(){return a};return a}function r(){var a=babelHelpers.taggedTemplateLiteralLoose(["\n    received headerImage version is older than expected ",". "]);r=function(){return a};return a}function s(){var a=babelHelpers.taggedTemplateLiteralLoose(["\n      received associatedMessage version is older than expected "," as expected. "]);s=function(){return a};return a}function t(){var a=babelHelpers.taggedTemplateLiteralLoose(["[XMA] received associated message with incorrect version ",""]);t=function(){return a};return a}var u=new Set([d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_STORY_REPLY]);function v(a,b){return a==null||a.payload==null?void 0:d("WAParseMediaTransportProtocol").decodeImageTransport(a.payload,b,"xma-image")}function aa(a,b,e,f,g){if(b==null||b.payload==null)return null;b.version!==d("MAWParseSubprotocolVersionConsts").ASSOCIATED_MESSAGE_SUBPROTOCOL_VERSION&&d("WALogger").ERROR(t(),b.version);b=d("decodeProtobuf").decodeProtobufWithUnknowns(d("WAMsgApplication.pb").MessageApplicationSpec,b.payload);b=d("WAParseMessageApplication").parseMessageApplication(b);if(b.type==="error")throw c("err")("XMA contains unparseable message application.");b=b;if(b.subprotocolType!=="consumerMessage")throw c("err")("XMA contains incorrect message application type: "+b.subprotocolType);return d("WAParseConsumerMessageProtocol").parseConsumerMessageProtocol(a,b.payload,e,f,g)}var w="https://www.instagram.com/stories/",x="https://www.instagram.com/reel/",y="https://www.instagram.com/tv/",z="https://www.instagram.com/_n/profile_shop?",A="https://www.instagram.com/",B="https://www.alpha.facebook.com/share/",C="https://m.facebook.com/share/",D="https://www.facebook.com/share/",E="https://m.alpha.facebook.com/share/",F="https://facebook.com/share/",G="https://www.alpha.facebook.com/stories/",H="https://www.facebook.com/stories/",I="https://fb.gg/",J="https://www.facebook.com/",K="https://m.facebook.com/",L="https://www.alpha.facebook.com/",M="https://m.alpha.facebook.com/",N="https://facebook.com/",O="https://fb.watch/",P="https://www.facebook.com/l.php",Q="https://m.facebook.com/l.php",R="https://www.alpha.facebook.com/l.php",S="https://m.alpha.facebook.com/l.php",T="https://facebook.com/l.php",U="https://l.facebook.com/l.php",V="https://facebook.com/events/",W="https://www.facebook.com/events/",X="https://www.alpha.facebook.com/events/",ba="https://m.facebook.com/events/",ca="https://m.alpha.facebook.com/events/",Y="fb-messenger://payments/receipt?product_id=",Z="messenger://location_share",da="http://m.me/",ea=":",fa="http://",ga="https://";function a(a,b){var e=a.chat,f=a.content,g=a.ebTimestampMs,h=a.meta,i=a.metadata;a=a.protobuf;f=f.extendedContentMessage;if(f==null)throw c("err")("extendedContentMessage has no content");var j=f.targetType,k=f.xmaDataclass,l=d("WAGetPlatformFromStanzaId").getPlatformFromStanzaId(h.id.externalId),m;try{m=b(f)}catch(a){d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.MAW_XMA_PROTOCOL_PARSING,key:"xma_validation."+l+"."+(j||0)+".error"});throw c("err")("Unexpected error trying to validate XMA content: "+a.message)}if(m===d("ACTSanitizerApiTypes").ACTSanitizerValidationResult.Valid)d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.MAW_XMA_PROTOCOL_PARSING,key:"xma_validation."+l+"."+(j||0)+".valid"});else{d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.MAW_XMA_PROTOCOL_PARSING,key:"xma_validation."+l+"."+(j||0)+".invalid."+m});throw c("err")("extendedContentMessage does not have valid XMA content")}if(f.xmaDataclass!=null){d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.MAW_XMA_PROTOCOL_PARSING,key:"xma_dataclass.exists."+((b=j)!=null?b:"null")})}if(j==null||!d("MAWParseXMAFBConfig").isFBSupportedTargetType({fbTargetType:j,xmaDataclass:k}))return{contentTypeForLogging:"extendedContentMessage",unstoredMedia:null,unstoredMsg:{ack:h.ack,id:h.id,msgContent:{protobuf:d("WAHex").bytesToBuffer(a),subtype:ia(j,k)},reportingMeta:h.reportingMeta,sentTs:h.sentTs,serverTs:h.serverTs,ts:h.ts,type:d("MAWMsgType").MSG_TYPE.FUTUREPROOF},unstoredQuotedMedia:null,unstoredXMA:null,xmaTargetTypeForLogging:j};l=d("WAParseProtocolUtils").parseEphemerality(h,i);b=l.deleteTs;var n=l.ephemeralSetting;l=l.expirationTs;var t=d("WAParseProtocolUtils").enhanceReportingMeta(h,i),w=f.associatedMessage,x=f.commands,y=f.contentRef,z=f.ctas,A=f.favicon,B=f.headerImage,C=f.headerTitle,D=f.maxSubtitleNumOfLines,E=f.maxTitleNumOfLines,F=f.mentionedJid,G=f.messageText,H=f.overlayDescription,I=f.overlayIconGlyph,J=f.overlayTitle,K=f.previews,L=f.sentWithMessageId,M=f.subtitleText,N=f.targetId,O=f.targetUsername,P=f.titleText,Q=f.xmaLayoutType;w!=null&&(w.version==null||w.version<d("MAWParseSubprotocolVersionConsts").ASSOCIATED_MESSAGE_SUBPROTOCOL_VERSION)&&d("WALogger").WARN(s(),d("MAWParseSubprotocolVersionConsts").ASSOCIATED_MESSAGE_SUBPROTOCOL_VERSION);B!=null&&(B.version==null||B.version<d("MAWParseSubprotocolVersionConsts").XMA_HEADER_SUBPROTOCOL_VERSION)&&d("WALogger").WARN(r(),d("MAWParseSubprotocolVersionConsts").XMA_HEADER_SUBPROTOCOL_VERSION);A!=null&&(A.version==null||A.version<d("MAWParseSubprotocolVersionConsts").XMA_FAVICON_SUBPROTOCOL_VERSION)&&d("WALogger").WARN(q(),d("MAWParseSubprotocolVersionConsts").XMA_FAVICON_SUBPROTOCOL_VERSION);K.every(function(a){(a.version==null||a.version<d("MAWParseSubprotocolVersionConsts").XMA_PREVIEW_SUBPROTOCOL_VERSION)&&d("WALogger").WARN(p(),d("MAWParseSubprotocolVersionConsts").XMA_PREVIEW_SUBPROTOCOL_VERSION)});f=f.targetExpiringAtSec!=null?d("WATimeUtils").castLongIntToUnixTime(f.targetExpiringAtSec):void 0;var R=w!=null&&L!=null?[d("WAStanzaUtils").toStanzaId(L),h.id.externalId]:[h.id.externalId,void 0],S=R[0];R=R[1];var T=[];if(K!=null)for(var U=0;U<K.length;U++){var V,W=v(K[U],h.ts);W!=null&&!((j===d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_EXTERNAL_LINK_SHARE||j===d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_FEED_SHARE)&&W.mediaType===d("WAMedia").MEDIA_TYPE.IMAGE&&((V=W.validatedImageInfo)==null?void 0:V.height)===1&&((V=W.validatedImageInfo)==null?void 0:V.width)===1)&&T.push(W)}V=v(B,h.ts);W=v(A,h.ts);K=(U=d("WAParseConsumerMessageProtocol").parsedQuotedConsumerMessage(i))!=null?U:void 0;B=babelHelpers["extends"]({deleteTs:b,ebTimestampMs:g,ephemeralSetting:n,expirationTs:l,id:babelHelpers["extends"]({},h.id,{externalId:S}),quote:K,reportingMeta:t,type:d("MAWMsgType").MSG_TYPE.XMA},h);A=z.map(function(a){a.actionContentBlob;a=babelHelpers.objectWithoutPropertiesLoose(a,["actionContentBlob"]);return a});U=A.slice(1);j===d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_GAMING_CUSTOM_UPDATE&&z.length===1&&(U=A);b=j===d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_CONTACT;t={author:h.id.author,commands:x,contentRef:y,ctas:U,defaultCTA:A[0],externalId:S,faviconMediaId:b?(g=V==null?void 0:V.plaintextHash)!=null?g:void 0:(n=W==null?void 0:W.plaintextHash)!=null?n:void 0,headerMediaId:b?(l=W==null?void 0:W.plaintextHash)!=null?l:void 0:(K=V==null?void 0:V.plaintextHash)!=null?K:void 0,headerTitle:C,isTombstoned:f!=null?d("WATimeUtils").unixTime()>f:!1,maxSubtitleNumOfLines:D,maxTitleNumOfLines:E,mentionedJids:F.map(d("WAJids").validateUserJid).filter(Boolean),overlayDescription:H,overlayIconGlyph:I,overlayTitle:J,previewMediaIds:T.length>0?T.map(function(a){return a.plaintextHash}):void 0,sentWithMessage:G,subtitleText:M,targetExpiringAtSec:f,targetId:N,targetType:j,targetUsername:O,threadJid:e,titleText:P,xmaDataclass:k,xmaLayoutType:Q};var X;if(w!=null&&L==null)throw c("err")("XMA associatedMessage cannot be received without sentWithMessageId field");w!=null&&R!=null&&(X=aa(e,w,h,a,i));y=(x=(z=X)==null?void 0:z.unstoredMedia)!=null?x:null;U=u.has(j);if(y!=null&&!U){A=d("MAWXMALoggingUtils").getXmaTargetTypeStringFromEnum(j);d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.MAW_XMA_PROTOCOL_PARSING,key:"assoc_msg_media_"+((g=A)!=null?g:"unknown")});throw c("err")("XMA associated msg cannot have additioinal dbMedia")}K=(l=(n=X)==null?void 0:n.unstoredMsg)!=null?l:null;R!=null&&K!=null&&(d("WALogger").DEV(o(),S,R),K.id=babelHelpers["extends"]({},K.id,{externalId:R}),B.id=babelHelpers["extends"]({},K.id,{externalId:S}),t.externalId=S);if(U&&y!=null&&((K==null?void 0:K.type)==="Gif"||(K==null?void 0:K.type)==="Sticker"))return{contentTypeForLogging:"extendedContentMessage",unstoredMedia:null,unstoredMsg:B,unstoredQuotedMedia:null,unstoredXMA:{unstoredAssociatedMedia:y!=null?y:void 0,unstoredAssociatedMsg:K!=null?K:void 0,unstoredFavicon:b?T[0]:W,unstoredHeaderMedia:V,unstoredPreviews:T.length>0?T:void 0,xma:t},xmaTargetTypeForLogging:j};if(K!=null&&K.type!=="Text")throw c("err")('XMA associated msg cannot have type different from "Text". Received type: '+K.type);return{contentTypeForLogging:"extendedContentMessage",unstoredMedia:null,unstoredMsg:B,unstoredQuotedMedia:null,unstoredXMA:{unstoredAssociatedMedia:void 0,unstoredAssociatedMsg:K!=null?K:void 0,unstoredFavicon:b?T[0]:W,unstoredHeaderMedia:V,unstoredPreviews:T.length>0&&!b?T:void 0,xma:t},xmaTargetTypeForLogging:j}}function ha(a){var b=a.ebRestore,c=a.hasActionUrl,e=a.hasNativeUrl,f=a.isActionUrlValid,g=a.isNativeUrlValid;a=a.targetType;!g&&!f?d("WALogger").ERROR(n(),b!=null&&b?"[labyrinth_web]":"[S410301][transport]",a,e,c):g&&!f?d("WALogger").ERROR(m(),b!=null&&b?"[labyrinth_web]":"[S410301][transport]",a,e,c):f&&!g&&d("WALogger").ERROR(l(),b!=null&&b?"[labyrinth_web]":"[S410301][transport]",a,e,c)}function b(a,b,c){var d=a.nativeUrl;a=a.actionUrl;var e=$(d,b,c),f=$(a,b,c);ha({ebRestore:c,hasActionUrl:a!=null,hasNativeUrl:d!=null,isActionUrlValid:f,isNativeUrlValid:e,targetType:b});return e&&f}function ia(a,b){if(a==null)return null;switch(a){case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_LOCATION_SHARING:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_LOCATION_SHARING_V2:return d("MWXMAV2IsDataclassLiveLocationXMA").isDataclassLiveLocationXMA(b)?"liveLocationMessage":"locationMessage";case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_CONTACT:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_AI_CONTACT:return"contactShareMessage";case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_STORY_MENTION:return"storyMentionMessage";case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_POST_MENTION:return"postMentionMessage";case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_MEMORIES_SHARE:return"messengerMemory";default:return null}}function $(a,b,c,e){e===void 0&&(e=!1);if(a==null)return!0;if(na(a,b)===!1){c!=null&&c&&!e&&d("WALogger").ERROR(k());return!1}if(!oa(a)){c!=null&&c&&!e&&d("WALogger").ERROR(j());return!1}return!0}function ja(a){return a.startsWith(B)||a.startsWith(C)||a.startsWith(D)||a.startsWith(E)||a.startsWith(F)}function ka(a){return a.startsWith(P)||a.startsWith(Q)||a.startsWith(R)||a.startsWith(S)||a.startsWith(T)||a.startsWith(U)}function la(a){return a.startsWith(J)||a.startsWith(K)||a.startsWith(L)||a.startsWith(M)||a.startsWith(N)}function ma(a){return a.startsWith(V)||a.startsWith(W)||a.startsWith(X)||a.startsWith(ba)||a.startsWith(ca)}function na(a,b){if(a==null)return!0;switch(b){case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_PHOTO_MENTION:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_PHOTO_SHARE:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_VIDEO_SHARE:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_PHOTO_HIGHLIGHT_SHARE:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_VIDEO_HIGHLIGHT_SHARE:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_REPLY:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_HIGHLIGHT_REPLY:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_REACTION:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_HIGHLIGHT_REACTION:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_VIDEO_MENTION:return a.startsWith(w);case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_CLIPS_SHARE:return a.startsWith(x);case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_IGTV_SHARE:return a.startsWith(y);case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_SHOP_SHARE:return a.startsWith(z);case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_SINGLE_IMAGE_POST_SHARE:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_MULTIPOST_SHARE:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_SINGLE_VIDEO_POST_SHARE:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_PROFILE_SHARE:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_IG_MEDIA_SHARE:return a.startsWith(A);case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_STORY_REPLY:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_STORY_SHARE:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_PRODUCER_STORY_REPLY:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_STORY_MENTION:return a.startsWith(H)||a.startsWith(G)||ja(a);case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_GAMING_CUSTOM_UPDATE:return a.startsWith(I);case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_FEED_POST_PRIVATE_REPLY:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_FEED_SHARE:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_SHORT:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_FEED_VIDEO_SHARE:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_HIGHLIGHTS_TAB_FRIEND_UPDATES_REPLY:return(la(a)||a.startsWith(O))&&!ka(a);case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_LOCATION_SHARING:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_LOCATION_SHARING_V2:return a.startsWith(Z);case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_HIGHLIGHTS_TAB_LOCAL_EVENT_REPLY:return ma(a);case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_EVENT:return ma(a)||ja(a);case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_CONTACT:return la(a)||a.startsWith(da);case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_EXTERNAL_LINK:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_EXTERNAL_LINK_SHARE:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_AUDIO_CALL:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_VIDEO_CALL:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_MISSED_AUDIO_CALL:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_MISSED_VIDEO_CALL:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_GROUP_AUDIO_CALL:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_GROUP_VIDEO_CALL:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_MISSED_GROUP_AUDIO_CALL:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_MISSED_GROUP_VIDEO_CALL:if(a.includes(ea)&&(!a.startsWith(fa)&&!a.startsWith(ga))){b=a.indexOf("://");b===-1&&d("WALogger").ERROR(i());return!1}break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_RECEIVER_FETCH:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.DATACLASS_SENDER_COPY:return!0;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_P2P_PAYMENT:return a.startsWith(Y)}return!0}function oa(a){for(var b=0;b<a.length;b++){var c=a.charAt(b);switch(c){case"\u202c":case"\u202d":case"\u202e":d("WALogger").ERROR(h());return!1;default:break}}return!0}g.SUPPORTED_XMA_ASSOC_MEDIA_TARGET_TYPES=u;g.kIGStoryCtaPrefix=w;g.kIGClipsCtaPrefix=x;g.kIGTVCtaPrefix=y;g.kIGShopCtaPrefix=z;g.kIGDefaultCtaPrefix=A;g.kFBStoryCtaPrefix=H;g.kFBGamingCustomUpdateCtaPrefix=I;g.kFBDefaultWWWCtaPrefix=J;g.kFBEventCtaPrefix=V;g.kMSGP2PPaymentUrlPrefix=Y;g.kMessengerLocationSharePrefix=Z;g.kHttpPrefix=fa;g.parseXMAProtocol=a;g.isValidCTA=b;g.getUnsupportedMessageType=ia;g.isURLValid=$}),98);
__d("WAMapContentTypeToFbType",[],(function(a,b,c,d,e,f){"use strict";function a(a){switch(a){case"text":return"text";case"media":return"media";case"reaction":return"reaction";case"live_location":case"pay":case"product_list":case"poll_creation":case"poll_vote":case"scheduled_call":return"text";default:return"text"}}f.mapContentTypeToFbType=a}),66);
__d("WAProtocolQueue",["WAGlobals","WAJids","WALogger","WAMapContentTypeToFbType","WAPersistedQueue","err"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Protocol Queue is already initialized"]);h=function(){return a};return a}var i=5e3,j=null;function a(a){if(j!=null){d("WALogger").WARN(h());return j}a=d("WAPersistedQueue").initPersistedQueue("stanzaQueue",a,{cacheSize:null,maxDelay:i});j=a;return j}function k(){if(!j)throw c("err")("Protocol queue not initialized");return j}var l=function(){function a(){this.$1=[],this.$2=[],this.$3=[]}var b=a.prototype;b.enqueue=function(a,b,c){this.$1.push(a),b&&this.$2.push(b),c&&this.$3.push(c)};b.flush=function(a,b,c,d,e){a=this.$1;var f=this.$2,g=this.$3;this.$1=[];this.$2=[];this.$3=[];return k().addAndCommit(a).then(function(){return f.forEach(function(a){return a()})})["catch"](function(a){return g.forEach(function(b){return b(a)})})};return a}(),m=new l();function b(a){return{flush:function(){return a.commit()}}}function e(a){return a.map(function(a){return a.type==="message"?n(a):babelHelpers["extends"]({},a)})}function n(a){switch(a.subtype){case"unavailable":var b=a,c=d("WAJids").extractUserJid(b.from);c={id:{author:d("WAGlobals").getMyUserJid()===c?"@me":c,chat:b.jid,externalId:b.stanzaId},ts:b.serverTs,type:"UnavailableMsg"};return{incomingType:"wa",jid:b.jid,message:{decrypted:c,details:{count:null,externalId:b.stanzaId,folder:b.fbFolderId,from:d("WAJids").switchOnMsgrChatJidType(b.jid,{group:function(a){return{author:b.from,chat:a,groupJid:a,type:"group"}},user:function(a){return{author:b.from,chat:a,deviceJid:b.from,type:"device"}}}),hideDecryptionFailure:!1,isInstamadillo:!1,offline:b.offline,recipient:b.recipient,reportingMeta:b.reportingMeta,retryCount:b.retryCount,ts:b.serverTs,type:d("WAMapContentTypeToFbType").mapContentTypeToFbType(b.contentType)}},priority:b.priority,stanzaId:b.stanzaId,stanzaQueueId:a.stanzaQueueId,type:b.type};case"armadillo":var e=a;c=d("WAJids").extractUserJid(e.from);c={device:{id:d("WAJids").extractDeviceId(e.from),identity:e.remoteIdentity},folder:e.fbFolderId,id:{author:d("WAGlobals").getMyUserJid()===c?"@me":c,chat:e.jid,externalId:e.stanzaId},msg:e.message,recipientsCount:null,reportingMeta:e.reportingMeta,ts:e.serverTs,type:"IncomingMsg"};return{incomingType:a.incomingType,jid:e.jid,message:{decrypted:c,details:{count:null,externalId:e.stanzaId,folder:e.fbFolderId,from:d("WAJids").switchOnMsgrChatJidType(e.jid,{group:function(a){return{author:e.from,chat:a,groupJid:a,type:"group"}},user:function(a){return{author:e.from,chat:a,deviceJid:e.from,type:"device"}}}),hideDecryptionFailure:!1,isInstamadillo:!1,offline:e.offline,recipient:e.recipient,reportingMeta:e.reportingMeta,retryCount:e.retryCount,ts:e.serverTs,type:d("WAMapContentTypeToFbType").mapContentTypeToFbType(e.contentType)}},priority:e.priority,stanzaId:e.stanzaId,stanzaQueueId:a.stanzaQueueId,type:e.type,ebTimestampMs:e.ebTimestampMs};case"instamadillo":var f=a;c=d("WAJids").extractUserJid(f.from);c={device:{id:d("WAJids").extractDeviceId(f.from),identity:f.remoteIdentity},folder:f.fbFolderId,id:{author:d("WAGlobals").getMyUserJid()===c?"@me":c,chat:f.jid,externalId:f.stanzaId},msg:f.message,recipientsCount:null,reportingMeta:f.reportingMeta,ts:f.serverTs,type:"InstamadilloMsg"};return{incomingType:"wa",jid:f.jid,message:{decrypted:c,details:{count:null,externalId:f.stanzaId,folder:f.fbFolderId,from:d("WAJids").switchOnMsgrChatJidType(f.jid,{group:function(a){return{author:f.from,chat:a,groupJid:a,type:"group"}},user:function(a){return{author:f.from,chat:a,deviceJid:f.from,type:"device"}}}),hideDecryptionFailure:!1,isInstamadillo:!0,offline:f.offline,recipient:f.recipient,reportingMeta:f.reportingMeta,retryCount:f.retryCount,ts:f.serverTs,type:d("WAMapContentTypeToFbType").mapContentTypeToFbType(f.contentType)}},priority:f.priority,stanzaId:f.stanzaId,stanzaQueueId:a.stanzaQueueId,type:f.type};case"ciphertext":c=function(){if(g.contentType==="reaction")return!1;return g.hideDecryptionFailure===!0?!1:!0};var g=a,h=d("WAJids").extractUserJid(g.from);c={createPlaceholder:c(),id:{author:d("WAGlobals").getMyUserJid()===h?"@me":h,chat:g.jid,externalId:g.stanzaId},ts:g.serverTs,type:"IncomingCiphertextMsg"};return{incomingType:"wa",jid:g.jid,message:{decrypted:c,details:{count:null,type:d("WAMapContentTypeToFbType").mapContentTypeToFbType(g.contentType),externalId:g.stanzaId,folder:g.fbFolderId,from:d("WAJids").switchOnMsgrChatJidType(g.jid,{group:function(a){return{author:g.from,chat:a,groupJid:a,type:"group"}},user:function(a){return{author:g.from,chat:a,deviceJid:g.from,type:"device"}}}),hideDecryptionFailure:!1,isInstamadillo:!1,offline:g.offline,recipient:g.recipient,reportingMeta:g.reportingMeta,retryCount:g.retryCount,ts:g.serverTs}},priority:g.priority,stanzaId:g.stanzaId,stanzaQueueId:a.stanzaQueueId,type:g.type};default:a;return babelHelpers["extends"]({},a)}}var o=9,p=7,q=5,r=2;function f(a){return a}function s(a){return a}function t(a){return a}g.initProtocolQueue=a;g.protocolQueue=k;g.PQFlushable=l;g.pqFlushable=m;g.protocolQueueFlushable=b;g.mapProtocolEntriesV2toV1=e;g.mapProcolQueueMessageV2toV1=n;g.WAProtocolQueuePriorityHigh=o;g.WAProtocolQueuePriorityMid=p;g.WAProtocolQueuePriorityLow=q;g.WAProtocolQueuePriorityBackground=r;g.appdataApplicationProtocol=f;g.extractSubProtocolFromAppdataProtocol=s;g.numberToStanzaQueueId=t}),98);
__d("MAWHandleEBRestoreWithHIM",["EBAPIWorkerCheck","EchoMessage","EncryptedBackupsUploadEntity","FBLogger","MAWAckLevel","MAWAsMessageApplication","MAWBulkEditMsgsTxns","MAWConvertXMAGatingTypeToExtendedContentOverlayIconGlyph","MAWConvertXMALayoutTypeToExtendedContentXMLLayoutType","MAWConvertXMATargetTypeToExtendedContentTargetType","MAWDbMsg","MAWEchoToProtobufConversionLoggingUtils","MAWFrontendMediaUtils","MAWHandleEchoMediaMsgsRestoreV2","MAWHandleEchoMsgsRestoreApiUtils","MAWHandleEchoReactionsRestore","MAWHandleEchoXMARestoreV2","MAWJids","MAWMsgType","MAWODSProxy","MAWParseXMAProtocol","MAWUnsafeCoerce","MAWUserJidWrapper","MessageBackupSupplementalKeyGenerator","Random","WAGlobals","WAHashUtils","WAJids","WALogger","WALongInt","WAOdsEnums","WAProtocolQueue","WAResultOrError","WASortedLists","WAStanzaUtils","WATimeUtils","err","justknobx"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Exception when trying to encode reaction supplemental protobuf: ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web][echo2protobuf] Failed to create reaction supplemental key"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Exception when trying to encode edit supplemental protobuf: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web][echo2protobuf] Failed to create edit supplemental key"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web][echo2protobuf] Exception when trying to encode top-level protobuf: ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web][echo2protobuf] Failed to extract UnstoredDbMsg from EchoMessage: unstoredDbMsg missing in UnstoredDbContent"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web][echo2protobuf] Failed to extract UnstoredDbMsg from EchoMessage: ",""]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web][echo2protobuf] One of the mandatory fields is null for Echo message"]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web][echo2protobuf] Failed to decode echo message"]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Failed to convert all echo messages to protobuf. Chat: ",", echo messages count: ",", converted echo messages count: ",""]);q=function(){return a};return a}function r(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Failed to decode echo message: ",""]);r=function(){return a};return a}function s(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Unsupported receiver fetch message type: ",""]);s=function(){return a};return a}function t(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] defautlCTA failed validation check. Echo message origin ",""]);t=function(){return a};return a}function u(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Mandatory XMA Data missing for XMA message"]);u=function(){return a};return a}function v(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Unable to construct downloadableThumbnail from previewMediaData: ",", msg id: ",""]);v=function(){return a};return a}function w(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] downloadableThumbnail was created without metadata, source: protobuf"]);w=function(){return a};return a}function x(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] messageId is null in edit, original externalId: ",""]);x=function(){return a};return a}function y(a,b){if(a==="@me"||a==="@system")return b;else return a}function z(a,b,c,e,f){var g=[];if(a.reactionXOfflineThreadingIds!=null)for(var h=0;h<a.reactionXOfflineThreadingIds.length;++h){var i=d("MAWHandleEchoReactionsRestore").getReactionsForReactionStore(b,c,e,null,f,a);i=i.map(function(a){return{decodedMsg:{unstoredDbMedia:void 0,unstoredDbMsg:void 0,unstoredDbReaction:a,unstoredDbReceiverFetchInfo:void 0},stanza:C(a.externalId,a.ts,y(a.author,c),b,"reaction")}});g.push.apply(g,i)}return g}function A(a,b,c,e,f){return e.map(function(e){if(e.messageId==null){d("WALogger").ERROR(x(),a);f!=null&&d("MAWEchoToProtobufConversionLoggingUtils").addPoint(f,"getUnstoredDbEditsFromEcho_messageId_missing");return null}var g=e.messageId;return{decodedMsg:{unstoredDbEditActionMsg:{ack:d("MAWAckLevel").ACK.sent,author:c,editMsgContent:{content:e.text},externalId:d("WAStanzaUtils").toStanzaId(g),originalMsgExternalId:a,serverTs:d("WATimeUtils").castToUnixTime(e.timestamp),ts:d("WATimeUtils").castToUnixTime(e.timestamp),type:d("MAWMsgType").MSG_TYPE.EDIT_ACTION},unstoredDbMedia:void 0,unstoredDbMsg:void 0,unstoredDbReaction:void 0},stanza:C(d("WAStanzaUtils").toStanzaId(g),d("WATimeUtils").castToUnixTime(e.timestamp),c,b,"text")}}).filter(Boolean)}function a(a,b){return a.map(H).filter(Boolean).map(function(a){return B(a,b)})}function B(a,b){var e,f=d("MAWUserJidWrapper").getMyUserJid(),g=a.from,h=d("MAWHandleEchoMsgsRestoreApiUtils").getDbMsgTypeFromEchoMessage(a);if(g==null||h==null)return[];h=a.xOfflineThreadingId;if(h==null){c("FBLogger")("labyrinth_web").warn("xOfflineThreadingId is null for Echo message");return[]}h=d("WAStanzaUtils").toStanzaId(h);e=d("WATimeUtils").castToUnixTime(((e=a.authoritativeTimestampMs)!=null?e:a.sortOrderMs)/1e3);g=d("MAWJids").toUserJid(g.localKey);var i=G(a,b,f,h,"echo_content");if(i.success===!1)return[];i=i.value;f=z(a,b,f,h,g);var j=a.contentType===d("EchoMessage").EchoMessageContentType.TEXT||a.contentType===d("EchoMessage").EchoMessageContentType.PLACEHOLDER?"text":"media";a=A(h,b,g,a.editHistory);return[{decodedMsg:i,stanza:C(h,e,g,b,j)}].concat(f,a)}function C(a,b,c,e,f){var g={applicationPayload:new Uint8Array(0).buffer,backupDirective:null,icdc:null,metadata:null,protobuf:new Uint8Array(0),subprotocol:new Uint8Array(0),subprotocolType:"consumerMessage",type:"subprotocol",version:"v3"};g={device:{id:d("WAJids").DEFAULT_DEVICE_ID,identity:null},folder:null,id:{author:c,chat:e,externalId:a},msg:g,recipientsCount:null,reportingMeta:null,ts:b,type:"IncomingMsg"};return{incomingType:"ebrestore",jid:e,message:{decrypted:g,details:{count:0,externalId:a,folder:void 0,from:d("WAJids").switchOnMsgrChatJidType(e,{group:function(a){return{author:d("WAJids").defaultDeviceJidForUser(c),chat:a,groupJid:a,type:"group"}},user:function(a){return{author:d("WAJids").defaultDeviceJidForUser(c),chat:a,deviceJid:d("WAJids").defaultDeviceJidForUser(c),type:"device"}}}),hideDecryptionFailure:!0,isInstamadillo:!1,offline:null,recipient:null,reportingMeta:null,retryCount:0,ts:b,type:f}},priority:d("WAProtocolQueue").WAProtocolQueuePriorityLow,stanzaId:a,stanzaQueueId:d("MAWUnsafeCoerce").unsafeCoerce(-1),type:"message"}}function D(a){if(a.mediaData==null)return d("WAResultOrError").makeResult(null);var b=a.previewMediaData,c=a.sortOrderMs,e=a.xOfflineThreadingId,f=a.mediaData,g=f.attachmentObjectId,h=f.backupEntFbid,i=f.directPath,j=f.encryptedHash,k=f.filename,l=f.height,m=f.mediaContentType,n=f.mediaKey,o=f.mediaKeyTimestamp,p=f.mediaPlayableDuration,q=f.plaintextHash,r=f.previewContentHeight,s=f.previewContentWidth,t=f.size;f=f.width;a=a.contentType===d("EchoMessage").EchoMessageContentType.XMA;m=d("MAWFrontendMediaUtils").getMediaTypeAndServerMediaTypeFromBlob(m||"",a);a=m.mediaType;m=m.serverMediaType;var u=d("WAHashUtils").stringToPlaintextHash(d("MAWHandleEchoMediaMsgsRestoreV2").getBase64WithoutPadding(q)),x=null;if(b!=null)try{x=d("MAWHandleEchoMediaMsgsRestoreV2").constructRawDownloadableThumbnail(b),x!=null&&x.objectId==null&&d("WALogger").ERROR(w())}catch(a){d("WALogger").ERROR(v(),a,e)}if(n==null)return d("WAResultOrError").makeError("missing_media_key");if(j==null)return d("WAResultOrError").makeError("missing_encrypted_hash");b=d("MAWHandleEchoMediaMsgsRestoreV2").constructMediaEntry(u,j,n,i,o,m,k,h,g,x,t);e=d("MAWHandleEchoMediaMsgsRestoreV2").getMediaInfo({filename:k,height:l,mediaPlayableDuration:p,mediaType:a,previewContentHeight:r,previewContentWidth:s,width:f});u=e.validatedAudioInfo;j=e.validatedDocumentFileInfo;n=e.validatedImageInfo;i=e.validatedVideoInfo;return d("WAResultOrError").makeResult({mediaEntry:b,mediaType:a,msgIds:d("WASortedLists").asSortedSet(new Set()),plaintextHash:d("WAHashUtils").stringToPlaintextHash(q),size:t||0,ts:o!=null?d("WATimeUtils").castToUnixTime(o):d("WATimeUtils").castMilliSecondsToUnixTime(c),validatedAudioInfo:u,validatedDocumentFileInfo:j,validatedImageInfo:n,validatedVideoInfo:i})}function E(a,b){if(a.xmaData==null||a.from==null||a.xOfflineThreadingId==null)return d("WAResultOrError").makeResult(null);var c=a.from,e=a.serializationOrigin,f=a.xmaData;a=a.xOfflineThreadingId;var g=f.xmaContentRef,h=f.xmaDataclass,i=f.xmaDefaultCTA,j=f.xmaGatingType,k=f.xmaHeaderSubtitle,l=f.xmaHeaderTitle,m=f.xmaIsTombstoned,n=f.xmaLayoutType,o=f.xmaMaxSubtitleNumLines,p=f.xmaMaxTitleNumLines,q=f.xmaSubtitleText,r=f.xmaTargetExpiry,s=f.xmaTargetId,v=f.xmaTargetType,w=f.xmaTargetUsername;f=f.xmaTitleText;if(v==null){d("WALogger").ERROR(u());return d("WAResultOrError").makeError("xma_mandatory_fields_missing")}v=d("MAWConvertXMATargetTypeToExtendedContentTargetType").convertXMATargetTypeToExtendedContentTargetType(v);var x;i!=null&&(x=d("MAWHandleEchoXMARestoreV2").getDefaultCTA(i));if(x!=null&&!d("MAWParseXMAProtocol").isValidCTA(x,v,!0)){d("WALogger").ERROR(t(),e);return d("WAResultOrError").makeError("xma_cta_validation_failure")}var y;j!=null&&(y=d("MAWConvertXMAGatingTypeToExtendedContentOverlayIconGlyph").convertXMAGatingTypeToExtendedContentOverlayIconGlyph(j));var z;r!=null&&(z=d("WATimeUtils").castToUnixTime(r));var A;n!=null&&(A=d("MAWConvertXMALayoutTypeToExtendedContentXMLLayoutType").convertXMALayoutTypeToExtendedContentXMLLayoutType(n));return d("WAResultOrError").makeResult({unstoredDbXMA:{author:d("MAWJids").toUserJid(c.localKey),contentRef:g,ctas:[],defaultCTA:x,externalId:d("WAStanzaUtils").toStanzaId(a),headerTitle:l,isTombstoned:m,maxSubtitleNumOfLines:o,maxTitleNumOfLines:p,overlayDescription:k,overlayIconGlyph:y,overlayTitle:l,subtitleText:q,targetExpiringAtSec:z,targetId:s,targetType:v,targetUsername:w,threadJid:b,titleText:f,xmaDataclass:h,xmaLayoutType:A}})}function F(a){if(a.receiverFetchId==null||a.receiverFetchData==null)return d("WAResultOrError").makeResult(null);var b=a.receiverFetchData;a=a.receiverFetchId;if(b.type!=="sticker"){d("WALogger").ERROR(s(),b.type);return d("WAResultOrError").makeError("unsupported_message_type")}return d("WAResultOrError").makeResult({mimetype:b.mimetype,previewHeight:b.previewHeight,previewWidth:b.previewWidth,receiverFetchId:a,type:b.type})}function G(a,b,c,e,f){c=d("MAWHandleEchoMsgsRestoreApiUtils").getUnstoredDbMessageFromEchoMessage(a,b,c,e,void 0,f);if(c.success===!1)return d("WAResultOrError").makeError(c.error);e=c.value;e.originalTs;e.threadJid;e.unsendMsgContentDeleteTs;f=babelHelpers.objectWithoutPropertiesLoose(e,["originalTs","threadJid","unsendMsgContentDeleteTs"]);f.sortOrderMs=a.sortOrderMs;c=D(a);if(c.success===!1)return c;e=E(a,b);if(e.success===!1)return d("WAResultOrError").makeError(e.error);b=e.value;e=F(a);if(e.success===!1)return d("WAResultOrError").makeError(e.error);a=e.value;return d("WAResultOrError").makeResult({unstoredDbMedia:c.value,unstoredDbMsg:f,unstoredDbReaction:void 0,unstoredDbReceiverFetchInfo:(e=a)!=null?e:void 0,unstoredXMA:(c=b)!=null?c:void 0})}function H(a){try{return d("EchoMessage").decodeEchoMessage(a)}catch(a){d("WALogger").ERROR(r(),a);return null}}function b(a,b){if(!d("EBAPIWorkerCheck").runningInWorker)throw c("err")("convertEchoMessagesToEBProtobufs should be called from the worker thread");var e=a.map(function(a){return I(a,b)}).filter(Boolean);d("MAWODSProxy").odsBumpEntityKey({amount:e.length,entity:d("WAOdsEnums").Entity.EB_RESTORE,key:"echo2protobuf.success"});e.length!==a.length&&(d("WALogger").WARN(q(),b,a.length,e.length),d("MAWODSProxy").odsBumpEntityKey({amount:a.length-e.length,entity:d("WAOdsEnums").Entity.EB_RESTORE,key:"echo2protobuf.fail"}));return e}function I(a,b){var e=c("Random").uint32();d("MAWEchoToProtobufConversionLoggingUtils").startQplUserFlow(e);a=H(a);if(a==null){d("WALogger").ERROR(p());d("MAWEchoToProtobufConversionLoggingUtils").endFailure(e,"echo_decode_failure");return null}var f=d("WAGlobals").getMyUserJid(),g=a.from,q=a.sortOrderMs,r=a.xOfflineThreadingId;q=d("WATimeUtils").castToMillisTime(q);if(r==null||g==null){d("WALogger").ERROR(o());d("MAWEchoToProtobufConversionLoggingUtils").endFailure(e,"mandatory_fields_missing");return null}var s=d("MAWJids").toUserJid(g.localKey),t=d("WAStanzaUtils").toStanzaId(r);g=G(a,b,f,t,"first_edit_content");if(g.success===!1){d("WALogger").ERROR(n(),g.error);d("MAWEchoToProtobufConversionLoggingUtils").endFailure(e,"echo_message_parsing_failure_"+g.error);return null}if(g.value.unstoredDbMsg==null){d("WALogger").ERROR(m());d("MAWEchoToProtobufConversionLoggingUtils").endFailure(e,"unstoredDbMsg_conversion_failure_unstoredDbMsg_missing");return null}r=g.value;g=r.unstoredDbMedia;var u=r.unstoredDbMsg,v=r.unstoredDbReceiverFetchInfo;r=r.unstoredXMA;var w={author:s,chat:b,externalId:t};u!=null&&(u.msgId=d("MAWDbMsg").stanzaIdToMsgId(t));(r==null?void 0:r.unstoredDbXMA)!=null&&(r.unstoredDbXMA.msgId=d("MAWDbMsg").stanzaIdToMsgId(t));g!=null&&(g.msgIds=d("WASortedLists").asSortedSet(new Set([d("MAWDbMsg").stanzaIdToMsgId(t)])));var x;if((r==null?void 0:r.unstoredDbXMA)!=null){var y;x={associatedMessage:null,defaultPreview:(y=g)!=null?y:null,favicon:null,header:(y=g)!=null?y:null,previews:g!=null?[g]:null,xma:r.unstoredDbXMA}}var B={frankingKey:null,frankingTag:null,frankingVersion:null,reportingContent:null,reportingTag:null},C;try{C={decryptedProtobuf:d("EncryptedBackupsUploadEntity").getEbBackupMessageBytesBuffer(d("EncryptedBackupsUploadEntity").encodeBackupMessage({messageApplication:d("MAWAsMessageApplication").encodeMessageApplication(u,g,null,x,b,c("justknobx")._("3632")?v:null),msgId:w,reportingMeta:B,sortOrderMs:q})),protobufTimestampMS:q}}catch(a){d("MAWEchoToProtobufConversionLoggingUtils").endFailure(e,"top_level_protobuf_encoding_failure");d("WALogger").ERROR(l(),a);return null}var D=new Map();y=A(t,b,s,a.editHistory).map(function(a){return(a=a.decodedMsg)==null?void 0:a.unstoredDbEditActionMsg}).filter(Boolean).filter(function(a){return a.externalId!==a.originalMsgExternalId}).map(function(a){return d("MAWBulkEditMsgsTxns").getMessageHistory(a,b)});y.length>0&&d("MAWEchoToProtobufConversionLoggingUtils").addPoint(e,"convert_edits");y.forEach(function(a){var c=a.author,f=a.editTs;c=d("MessageBackupSupplementalKeyGenerator").createEditSupplementalKey(c,d("WATimeUtils").castUnixTimeToMillisTime(f));if(c==null){d("MAWEchoToProtobufConversionLoggingUtils").addPoint(e,"edit_supplemental_key_generation_failure");d("WALogger").ERROR(k());return}try{D.set(c,{decryptedProtobuf:d("EncryptedBackupsUploadEntity").getEbBackupMessageBytesBuffer(d("EncryptedBackupsUploadEntity").encodeBackupMessage({messageApplication:d("MAWAsMessageApplication").encodeEditMessageApplication(a),msgId:{author:s,chat:b,externalId:t},reportingMeta:B,sortOrderMs:d("WATimeUtils").castUnixTimeToMillisTime(a.editTs)})),protobufTimestampMS:d("WATimeUtils").castUnixTimeToMillisTime(f)})}catch(a){d("MAWEchoToProtobufConversionLoggingUtils").addPoint(e,"edit_supplemental_protobuf_encoding_failure"),d("WALogger").ERROR(j(),a)}});r=z(a,b,f,t,s).map(function(a){return(a=a.decodedMsg)==null?void 0:a.unstoredDbReaction}).filter(Boolean);r.length>0&&d("MAWEchoToProtobufConversionLoggingUtils").addPoint(e,"convert_reactions");r.forEach(function(a){var c=a.author,f=a.senderTimestampMs,g=a.ts;f=f!=null?d("WATimeUtils").castToMillisTime(d("WALongInt").numberOrThrowIfTooLarge(f)):d("WATimeUtils").castUnixTimeToMillisTime(g);g=d("MessageBackupSupplementalKeyGenerator").createReactionSupplementalKey(c);if(g==null){d("MAWEchoToProtobufConversionLoggingUtils").addPoint(e,"reaction_supplemental_key_generation_failure");d("WALogger").ERROR(i());return}try{D.set(g,{decryptedProtobuf:d("EncryptedBackupsUploadEntity").getEbBackupMessageBytesBuffer(d("EncryptedBackupsUploadEntity").encodeBackupMessage({messageApplication:d("MAWAsMessageApplication").encodeReactionMessageApplication(a),msgId:{author:s,chat:b,externalId:t},reportingMeta:B,sortOrderMs:f})),protobufTimestampMS:f})}catch(a){d("MAWEchoToProtobufConversionLoggingUtils").addPoint(e,"reaction_supplemental_protobuf_encoding_failure"),d("WALogger").ERROR(h(),a)}});d("MAWEchoToProtobufConversionLoggingUtils").endSuccess(e);return{otid:t,supplementalProtobufs:D,toplevelProtobuf:C}}g.convertEchoMessages=a;g.convertEchoMessagesToEBProtobufs=b}),98);
__d("MAWMediaPreviewDownloadManager",["WAResolvable"],(function(a,b,c,d,e,f,g){"use strict";var h=1e4,i=[],j=new Map();function a(a){if(j.has(a))return;l();var b=new(d("WAResolvable").Resolvable)();j.set(a,b);i.push(a)}function b(a,b){var c=j.get(a);if(c==null)return;c.reject(b);k(a)}function c(a){return j.get(a)}function k(a){j["delete"](a)}function l(){if(i.length>=h){var a=i.shift();a!=null&&j["delete"](a)}}function e(){i=[],j.clear()}g.markMediaPreviewAsDownloading=a;g.markMediaPreviewAsFailed=b;g.getMediaPreviewDownloadingResolvable=c;g.removeMediaPreviewDownloadingResolvable=k;g.clear=e}),98);
__d("MAWHandleMediaPreviewBeforeDownloadApi",["MAWMediaPreviewDownloadManager","Promise"],(function(a,b,c,d,e,f,g){"use strict";var h;a=function(a){d("MAWMediaPreviewDownloadManager").markMediaPreviewAsDownloading(a);return(h||(h=b("Promise"))).resolve()};g.handleMediaPreviewBeforeDownload=a}),98);
__d("WALoggerTag",["$InternalEnum"],(function(a,b,c,d,e,f){"use strict";a=b("$InternalEnum").Mirrored(["CryptoManager","MediaPreview","PrekeyGenerateAndUpload","SignedPrekey","SignedPrekeyRotation","OneTimePrekey"]);c=a;f["default"]=c}),66);
__d("MAWHandleMediaPreviewDownloadApi",["MAWBridgeTypesCreators","MAWDbMediaTxns","MAWDbMsgTxns","MAWDexieTable","MAWIndexedDb","MAWLoggerUtils","MAWMediaAfterTxns","MAWMediaDownloadStatus","MAWMediaDownloadStatusForUI","MAWMediaPreviewDownloadManager","MAWMediaUtils","MAWTransactionMode","WACryptoSha256","WAHashUtils","WALoggerTag","WAResultOrError","WATagsLogger","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Main media for preview is null. Type: ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Handling preview for main hash ","... preview hash ","..."]);i=function(){return a};return a}var j=d("WATagsLogger").TAGS([d("MAWLoggerUtils").Tag.MediaDownload,d("MAWLoggerUtils").Tag.MessageReceive,c("WALoggerTag").MediaPreview]);a=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e,f){var g=d("WAHashUtils").toPlaintextHash(yield d("WACryptoSha256").sha256(b));d("MAWMediaDownloadStatusForUI").sendMediaDownloadStatusToUI({details:"handle_media_download",hash:a,status:c("MAWMediaDownloadStatus").DOWNLOADING,type:"preview"});var h=d("MAWMediaPreviewDownloadManager").getMediaPreviewDownloadingResolvable(a);h!=null&&(h.resolve(new Blob([b],{type:"image/jpeg"})),d("MAWMediaPreviewDownloadManager").removeMediaPreviewDownloadingResolvable(a));return k(a,g,b,e,f)});return function(b,c,d,e){return a.apply(this,arguments)}}();var k=d("MAWIndexedDb").makeMsgrTransactor({chunk:(e=d("MAWTransactionMode")).READWRITE,media:e.READWRITE,messages:e.READONLY,threads:e.READONLY},"handleMediaPreviewDownload",function(a){return function(b,e,f,g,k){return d("MAWDexieTable").dexieAll([d("MAWDbMediaTxns").maybeGetMediaFromPlaintextHash(a,b),d("MAWDbMsgTxns").maybeGetMsgByProtocolMsgId(a,k)]).then(function(k){var l=k[0],m=k[1];j.LOG(i(),d("WAHashUtils").sanitisePlaintextHash(b),d("WAHashUtils").sanitisePlaintextHash(e));if(l==null){d("MAWMediaDownloadStatusForUI").sendMediaDownloadStatusToUI({details:"missing_media_on_save",hash:b,status:c("MAWMediaDownloadStatus").MANUAL_RETRYABLE_FAILURE,type:"preview"});j.WARN(h(),g);return d("WAResultOrError").makeError("missing-media-on-save")}switch(g){case"image":a.media.update(l.mediaId,babelHelpers["extends"]({},l,{validatedImageInfo:babelHelpers["extends"]({},l.validatedImageInfo,{jpegThumbnail:f})}));break;case"video":a.media.update(l.mediaId,babelHelpers["extends"]({},l,{validatedVideoInfo:babelHelpers["extends"]({},l.validatedVideoInfo,{jpegThumbnail:f})}));break;default:g;break}d("MAWMediaDownloadStatusForUI").sendMediaDownloadStatusToUI({details:"handle_media_download_success",hash:b,status:c("MAWMediaDownloadStatus").SUCCESS,type:"preview"});return a.messages.where("msgId").anyOf(l.msgIds).toArray().then(function(b){return a.threads.where("jid").anyOf(b.map(function(a){return a.threadJid})).toArray().then(function(c){c.forEach(function(c){if(c!=null){var e=d("MAWMediaUtils").createHdTypesForBridgeMedia(b);c=d("MAWBridgeTypesCreators").createBridgeMedia({chatJid:c.jid,filteredMsgIds:d("MAWBridgeTypesCreators").getMsgIdsFilteredByJid(b,c.jid),hasMediaForUI:!0,hdTypes:e,media:l,sortOrderMs:m==null?void 0:m.sortOrderMs});d("MAWMediaAfterTxns").handleNewMediaAfterTxnWithBridgeMedia(a,c,b)}});return d("WAResultOrError").makeResult()})})})}});g.handleMediaPreviewDownload=a}),98);
__d("MAWHandleMediaPreviewDownloadAsFailedApi",["MAWMediaPreviewDownloadManager","Promise"],(function(a,b,c,d,e,f,g){"use strict";var h;a=function(a,c){d("MAWMediaPreviewDownloadManager").markMediaPreviewAsFailed(a,c);return(h||(h=b("Promise"))).resolve()};g.handleMediaPreviewDownloadFailed=a}),98);
__d("MAWEBUnstoredDbMsgUtils",["FBLogger","MAWHandleEBRestoreWithHIM","MAWHandleEchoProtobufsRestoreApi","MAWMessageSortOrderUtils","WAJids","WATagsLogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to convert echo message to unstored db message"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to convert protobuf to unstored db message: type: "," error: ",""]);i=function(){return a};return a}var j=d("WATagsLogger").TAGS(["EB","EBRestore","MAWEBUnstoredDbMsgUtils"]);function a(a,b,e,f){var g=e!=null?e:b!=null?d("WAJids").unsafeCoerceToChatJid(b):void 0;if(g==null){c("FBLogger")("labyrinth_web").mustfix("threadId and chatJid are both null - cannot convert protobuf to unstoredDbMsg");return[]}return d("MAWHandleEchoProtobufsRestoreApi").decodeProtobufArray(a,f,void 0,new Set(),new Set(),new Map(),new Map(),new Map(),!0).map(function(a){var b;if((a==null?void 0:(b=a.metadata)==null?void 0:b.messageId)!=null)try{b=d("MAWHandleEchoProtobufsRestoreApi").createUnstoredDbContentFromProtobufObject(a,g,f,new Map(),void 0);if(b!=null&&b.unstoredDbContent.unstoredDbMsg!=null){b=b.unstoredDbContent.unstoredDbMsg;var c=d("MAWMessageSortOrderUtils").generateAuthoritativeMessageSortOrder(b);b.sortOrderMs=c;return b}}catch(b){j.ERROR(i(),a.msgType,b.message)}return null}).filter(Boolean)}function b(b,c,a){return d("MAWHandleEBRestoreWithHIM").convertEchoMessages(b,c).map(function(b){var c;if(b==null||b.length===0||((c=b[0].decodedMsg)==null?void 0:c.unstoredDbMsg)==null){a!=null&&a.ERROR(h());return null}return(c=b[0].decodedMsg)==null?void 0:c.unstoredDbMsg}).filter(Boolean)}g.getUnstoredDbMsgFromProtobuf=a;g.getUnstoredDbMsgFromEcho=b}),98);
__d("WACryptoAesGcm",["WABinary","WACryptoDependencies","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,c,d,e){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c,e,f){f===void 0&&(f=16);b={name:"AES-GCM",iv:k(b),tagLength:f*8};e!=null&&(b.additionalData=k(e));return d("WACryptoDependencies").getCrypto().subtle.encrypt(b,yield j(a),c)});return h.apply(this,arguments)}function c(a,b,c,d,e){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c,e,f){f===void 0&&(f=16);b={name:"AES-GCM",iv:k(b),tagLength:f*8};e!=null&&(b.additionalData=k(e));return d("WACryptoDependencies").getCrypto().subtle.decrypt(b,yield j(a),c)});return i.apply(this,arguments)}function j(a){return d("WACryptoDependencies").getCrypto().subtle.importKey("raw",a,"AES-GCM",!1,["encrypt","decrypt"])}function k(a){if(a instanceof Uint8Array)return a;if(typeof a==="string"){var b=new(d("WABinary").Binary)();b.writeString(a);return b.readByteArray()}return new Uint8Array(a)}g.gcmEncrypt=a;g.gcmDecrypt=c}),98);
__d("WAUseCaseSecret",["$InternalEnum","WABinary","WACryptoHkdf"],(function(a,b,c,d,e,f,g){"use strict";c=b("$InternalEnum")({POLL_VOTE:"Poll Vote",ENC_REACTION:"Enc Reaction",ENC_COMMENT:"Enc Comment",REPORT_TOKEN:"Report Token",EVENT_RESPONSE:"Event Response",EVENT_EDIT_ENCRYPTED:"Event Edit"});var h=32;function a(a){var b=a.messageSecret,c=a.stanzaId,e=a.parentMsgOriginalSender,f=a.modificationSender;a=a.modificationType;c=d("WABinary").Binary.build(c,e,f,a).readBuffer();return d("WACryptoHkdf").extractAndExpand(b instanceof ArrayBuffer?new Uint8Array(b):b,c,h)}g.UseCaseSecretModificationType=c;g.createUseCaseSecret=a}),98);
__d("MAWGroupPollsDualEncryptionUtils",["MAWDbPoll","WABase64","WAConsumerApplication.pb","WACryptoAesGcm","WACryptoSha256","WAResultOrError","WAUseCaseSecret","asyncToGeneratorRuntime","decodeProtobuf","encodeProtobuf"],(function(a,b,c,d,e,f,g){"use strict";function h(a,b,c){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){if(a.encIv==null||a.encPayload==null)return d("WAResultOrError").makeError("invalid_poll_enc_value");var e=a.encIv;a=a.encPayload;try{b=(yield d("WACryptoAesGcm").gcmDecrypt(b,e,a,c));return d("WAResultOrError").makeResult(b)}catch(a){return d("WAResultOrError").makeError("decryption_error",a)}});return i.apply(this,arguments)}function j(a,b,c){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){try{var e=self.crypto.getRandomValues(new Uint8Array(12));b=(yield d("WACryptoAesGcm").gcmEncrypt(b,e,a,c));return d("WAResultOrError").makeResult({encIv:e.buffer,encPayload:b})}catch(a){return d("WAResultOrError").makeError("encryption_error",a)}});return k.apply(this,arguments)}function l(a,b){a=a+"\0"+b;return new TextEncoder().encode(a).buffer}function a(a,b){return m.apply(this,arguments)}function m(){m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var c=b.pollCreationMessageKey,e=b.pollCreationSenderJid,f=b.pollCreationStanzaId,g=b.pollUpdateSenderJid;b=b.pollUpdateStanzaId;c=(yield d("WAUseCaseSecret").createUseCaseSecret({messageSecret:c,modificationSender:g,modificationType:d("WAUseCaseSecret").UseCaseSecretModificationType.POLL_VOTE,parentMsgOriginalSender:e,stanzaId:f}));e=l(b,g);f=d("encodeProtobuf").encodeProtobuf(d("WAConsumerApplication.pb").ConsumerApplication$PollVoteMessageSpec,a).readBuffer();return j(f,c,e)});return m.apply(this,arguments)}function c(a,b){return n.apply(this,arguments)}function n(){n=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var c=b.pollCreationMessageKey,e=b.pollCreationSenderJid,f=b.pollCreationStanzaId,g=b.pollUpdateSenderJid;b=b.pollUpdateStanzaId;c=(yield d("WAUseCaseSecret").createUseCaseSecret({messageSecret:c,modificationSender:g,modificationType:d("WAUseCaseSecret").UseCaseSecretModificationType.POLL_VOTE,parentMsgOriginalSender:e,stanzaId:f}));e=l(b,g);f=(yield h(a,c,e));if(!f.success)return f;try{return d("WAResultOrError").makeResult(d("decodeProtobuf").decodeProtobuf(d("WAConsumerApplication.pb").ConsumerApplication$PollVoteMessageSpec,f.value))}catch(a){return d("WAResultOrError").makeError("protobuf_decode_error",a)}});return n.apply(this,arguments)}function e(a,b){return o.apply(this,arguments)}function o(){o=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var c=b.pollCreationMessageKey,e=b.pollCreationSenderJid,f=b.pollCreationStanzaId,g=b.pollUpdateSenderJid;b=b.pollUpdateStanzaId;c=(yield d("WAUseCaseSecret").createUseCaseSecret({messageSecret:c,modificationSender:g,modificationType:d("WAUseCaseSecret").UseCaseSecretModificationType.POLL_VOTE,parentMsgOriginalSender:e,stanzaId:f}));e=l(b,g);f=d("encodeProtobuf").encodeProtobuf(d("WAConsumerApplication.pb").ConsumerApplication$PollAddOptionMessageSpec,a).readBuffer();return j(f,c,e)});return o.apply(this,arguments)}function f(a,b){return p.apply(this,arguments)}function p(){p=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var c=b.pollCreationMessageKey,e=b.pollCreationSenderJid,f=b.pollCreationStanzaId,g=b.pollUpdateSenderJid;b=b.pollUpdateStanzaId;c=(yield d("WAUseCaseSecret").createUseCaseSecret({messageSecret:c,modificationSender:g,modificationType:d("WAUseCaseSecret").UseCaseSecretModificationType.POLL_VOTE,parentMsgOriginalSender:e,stanzaId:f}));e=l(b,g);f=(yield h(a,c,e));if(!f.success)return f;try{return d("WAResultOrError").makeResult(d("decodeProtobuf").decodeProtobuf(d("WAConsumerApplication.pb").ConsumerApplication$PollAddOptionMessageSpec,f.value))}catch(a){return d("WAResultOrError").makeError("protobuf_decode_error",a)}});return p.apply(this,arguments)}function q(a){return r.apply(this,arguments)}function r(){r=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=(yield d("WACryptoSha256").sha256(new TextEncoder("utf8").encode(a)));return s(a)});return r.apply(this,arguments)}function s(a){return d("MAWDbPoll").convertStringToOptionHash(d("WABase64").encodeB64(a))}g.encryptGroupPollVote=a;g.decryptGroupPollVote=c;g.encryptGroupPollAddOption=e;g.decryptGroupPollAddOption=f;g.getHashForOptionName=q;g.getBase64EncodedHash=s}),98);
__d("MAWRestoreProtobufsFromEncryptedBackupsDeferred",["ExecutionEnvironment","I64","LSDatabaseSingleton","WAJobOrchestratorTypes","asyncToGeneratorRuntime","cr:10036","requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k=c("requireDeferred")("MAWRestoreProtobufsFromEncryptedBackupsNOP").__setRef("MAWRestoreProtobufsFromEncryptedBackupsDeferred");function a(a,e,f,g,l,m,n,o,p,q,r,s,t,u,v){u===void 0&&(u=d("WAJobOrchestratorTypes").JOB_PRIORITY.UI_ACTION);return k.load().then(function(){var k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(k){var w;(j||(j=c("ExecutionEnvironment"))).isInWorker&&b("cr:10036")!=null?(yield b("cr:10036").init(),w=(yield b("cr:10036").getLSStorage())):w=(yield (h||(h=d("LSDatabaseSingleton"))).LSDatabaseSingleton);return w.runInTransaction(function(b){return k.call(b,a,e,f,g,l!=null?(i||(i=d("I64"))).to_float(l):0,m,n!=null?(i||(i=d("I64"))).to_float(n):(i||(i=d("I64"))).to_float((i||(i=d("I64"))).max_int),o,p,q,r,s,t,u,v)},"readwrite")});return function(a){return k.apply(this,arguments)}}())}g.call=a}),98);
__d("MAWThreadIdToChatJidMapping",["I64","MAWAsyncEBPendingQueryPromise","MAWJidUtils","ReQL","WALogger","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Cannot generate ChatJid from threadKey, called from ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Cannot find thread with serverThreadKey ",", called from ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Cannot find MI ACT mapping table entry for threadId ",", called from ",""]);k=function(){return a};return a}var l=new Map();function a(a,b,c){return m.apply(this,arguments)}function m(){m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){if(l.has(b))return l.get(b);var e=d("MAWAsyncEBPendingQueryPromise").getJidFromThreadId(b);if(e!=null){l.set(b,e);return e}e=(yield d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.mi_act_mapping_table.index("jid")).getKeyRange((h||(h=d("I64"))).of_string(b))));if(e==null){d("WALogger").ERROR(k(),b,c);return null}var f=e.serverThreadKey;e=e.jid;a=(yield d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.threads).getKeyRange(f)));if(a==null){d("WALogger").ERROR(j(),(h||(h=d("I64"))).to_string(f),c);return null}f=d("MAWJidUtils").LSJidtoChatJid(e,a.threadType);if(f!=null){l.set(b,f);return f}else{d("WALogger").ERROR(i(),c);return null}});return m.apply(this,arguments)}g.genChatJidFromThreadId=a}),98);
__d("WASignalLocalStorageProtocol.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={};b={};c={};e={};f={};var h={},i={},j={},k={},l={},m={},n={},o={},p={},q={};a.internalSpec={sessionVersion:[1,(d=d("WAProtoConst")).TYPES.UINT32],localIdentityPublic:[2,d.TYPES.BYTES],remoteIdentityPublic:[3,d.TYPES.BYTES],rootKey:[4,d.TYPES.BYTES],previousCounter:[5,d.TYPES.UINT32],senderChain:[6,d.TYPES.MESSAGE,e],receiverChains:[7,d.FLAGS.REPEATED|d.TYPES.MESSAGE,e],pendingKeyExchange:[8,d.TYPES.MESSAGE,c],pendingPreKey:[9,d.TYPES.MESSAGE,b],remoteRegistrationId:[10,d.TYPES.UINT32],localRegistrationId:[11,d.TYPES.UINT32],needsRefresh:[12,d.TYPES.BOOL],aliceBaseKey:[13,d.TYPES.BYTES]};b.internalSpec={preKeyId:[1,d.TYPES.UINT32],signedPreKeyId:[3,d.TYPES.INT32],baseKey:[2,d.TYPES.BYTES]};c.internalSpec={sequence:[1,d.TYPES.UINT32],localBaseKey:[2,d.TYPES.BYTES],localBaseKeyPrivate:[3,d.TYPES.BYTES],localRatchetKey:[4,d.TYPES.BYTES],localRatchetKeyPrivate:[5,d.TYPES.BYTES],localIdentityKey:[7,d.TYPES.BYTES],localIdentityKeyPrivate:[8,d.TYPES.BYTES]};e.internalSpec={senderRatchetKey:[1,d.TYPES.BYTES],senderRatchetKeyPrivate:[2,d.TYPES.BYTES],chainKey:[3,d.TYPES.MESSAGE,h],messageKeys:[4,d.FLAGS.REPEATED|d.TYPES.MESSAGE,f]};f.internalSpec={index:[1,d.TYPES.UINT32],cipherKey:[2,d.TYPES.BYTES],macKey:[3,d.TYPES.BYTES],iv:[4,d.TYPES.BYTES]};h.internalSpec={index:[1,d.TYPES.UINT32],key:[2,d.TYPES.BYTES]};i.internalSpec={currentSession:[1,d.TYPES.MESSAGE,a],previousSessions:[2,d.FLAGS.REPEATED|d.TYPES.MESSAGE,a]};j.internalSpec={id:[1,d.TYPES.UINT32],publicKey:[2,d.TYPES.BYTES],privateKey:[3,d.TYPES.BYTES]};k.internalSpec={id:[1,d.TYPES.UINT32],publicKey:[2,d.TYPES.BYTES],privateKey:[3,d.TYPES.BYTES],signature:[4,d.TYPES.BYTES],timestamp:[5,d.TYPES.FIXED64]};l.internalSpec={publicKey:[1,d.TYPES.BYTES],privateKey:[2,d.TYPES.BYTES]};m.internalSpec={senderKeyId:[1,d.TYPES.UINT32],senderChainKey:[2,d.TYPES.MESSAGE,p],senderSigningKey:[3,d.TYPES.MESSAGE,n],senderMessageKeys:[4,d.FLAGS.REPEATED|d.TYPES.MESSAGE,o]};n.internalSpec={"public":[1,d.TYPES.BYTES],"private":[2,d.TYPES.BYTES]};o.internalSpec={iteration:[1,d.TYPES.UINT32],seed:[2,d.TYPES.BYTES]};p.internalSpec={iteration:[1,d.TYPES.UINT32],seed:[2,d.TYPES.BYTES]};q.internalSpec={senderKeyStates:[1,d.FLAGS.REPEATED|d.TYPES.MESSAGE,m]};g.SessionStructureSpec=a;g.SessionStructure$PendingPreKeySpec=b;g.SessionStructure$PendingKeyExchangeSpec=c;g.SessionStructure$ChainSpec=e;g.SessionStructure$Chain$MessageKeySpec=f;g.SessionStructure$Chain$ChainKeySpec=h;g.RecordStructureSpec=i;g.PreKeyRecordStructureSpec=j;g.SignedPreKeyRecordStructureSpec=k;g.IdentityKeyPairStructureSpec=l;g.SenderKeyStateStructureSpec=m;g.SenderKeyStateStructure$SenderSigningKeySpec=n;g.SenderKeyStateStructure$SenderMessageKeySpec=o;g.SenderKeyStateStructure$SenderChainKeySpec=p;g.SenderKeyRecordStructureSpec=q}),98);
__d("WAXmlParsingFailure",[],(function(a,b,c,d,e,f){"use strict";a=function(){function a(a,b){this.parser=a,this.reason=b}var b=a.prototype;b.toString=function(){return"XmlParsingFailure: "+this.parser+": "+this.reason};return a}();f.XmlParsingFailure=a}),66);
__d("WAParsableXmlNode",["WAHasProperty","WAXmlParsingFailure","err"],(function(a,b,c,d,e,f,g){"use strict";a=function(){function a(a,b){var c=this;this.$1=a;this.$2=b;this.$3=Array.isArray(b.content)?b.content.map(function(b){return new c.constructor(a,b)}):null}var b=a.prototype;b.name=function(){return this.$1};b.node=function(){return this.$2};b.hasAttr=function(a){return c("WAHasProperty")(this.$2.attrs,a)};b.assertTag=function(a){this.$2.tag!==a&&this["throw"]("to be <"+a+">")};b.tag=function(){return this.$2.tag};b.maybeChild=function(a){var b=this.$3;if(!b)return null;for(var c=0;c<b.length;c++)if(b[c].tag()===a)return b[c];return null};b.hasChild=function(a){return!!this.maybeChild(a)};b.child=function(a){var b=this.maybeChild(a);return!b?this["throw"]("to have child <"+a+">"):b};b.assertAttr=function(a,b){var c=this.attrString(a);c!==b&&this["throw"]('to have "'+a+'"="'+b+'", but instead has "'+c+'"')};b.attrString=function(a){return!c("WAHasProperty")(this.$2.attrs,a)?this["throw"]('to have attribute "'+a+'"'):this.decodeAsString(this.$2.attrs[a])};b.forEachAttributeKey=function(a){var b=this.$2.attrs;Object.keys(b).forEach(function(b){return a(b)})};b.maybeAttrString=function(a){return this.hasAttr(a)?this.decodeAsString(this.$2.attrs[a]):null};b.maybeAttrInt=function(a,b,c){return this.hasAttr(a)?this.attrInt(a,b,c):null};b.attrEnumValues=function(a,b,c){b=new Set(b);var d=this.attrString(a);if(!b.has(d)){if(c!=null)return c;c=Array.from(b).join("|");return this["throw"]('to have "'+a+'"={'+c+'} but has value "'+d+'"')}return d};b.attrEnum=function(a,b){var d=this.attrString(a);if(!c("WAHasProperty")(b,d)){var e=Object.keys(b).join("|");return this["throw"]('to have "'+a+'"={'+e+'} but has value "'+d+'"')}return b[d]};b.attrEnumOrNullIfUnknown=function(a,b){a=this.attrString(a);return!c("WAHasProperty")(b,a)?null:b[a]};b.attrEnumOrDefault=function(a,b,c){return this.hasAttr(a)?this.attrEnum(a,b):c};b.attrInt=function(a,b,c){var d=this.attrString(a);return this.$4(d,a,b,c)};b.$4=function(a,b,c,d){var e=parseInt(a,10);if(Number.isNaN(e))return this["throw"]('to have "'+b+'"={integer} but has value "'+a+'"');else if(c!==void 0&&e<c)return this["throw"]('to have "'+b+'"={at least '+c+"} but has value "+e);else if(d!==void 0&&e>=d)return this["throw"]('to have "'+b+'"={below '+d+"} but has value "+e);return e};b.forEachChild=function(a){var b=this.$3;if(b)b.forEach(function(b){return a(b)});else if(this.$2.content!=null)return this["throw"]("to have children")};b.forEachChildWithTag=function(a,b){this.forEachChild(function(c){c.tag()===a&&b(c)})};b.mapChildren=function(a){var b=this.$3;return!b&&this.$2.content!=null?this["throw"]("to have children"):b?b.map(function(b){return a(b)}):[]};b.mapChildrenWithTag=function(a,b){var c=this.$3;return!c&&this.$2.content!=null?this["throw"]("to have children"):c?c.filter(function(b){return b.tag()===a}).map(function(a){return b(a)}):[]};b.mapFirstChild=function(a){var b=this.$3;return!b||b.length===0?this["throw"]("to have children"):a(b[0])};b.hasContent=function(){return!this.$3&&!!this.$2.content};b.hasChildren=function(){return this.$3!=null};b.getChildren=function(){return this.$3};b.mapAttrKeys=function(a){var b=this.getAttrKeys();return b&&b.length?b.map(a):[]};b.getAttrKeys=function(){return Object.keys(this.$2.attrs)};b.hasAttrs=function(){var a=this.$2.attrs?Object.keys(this.$2.attrs):[];return a.length>0};b.getNode=function(){return this.$2};b.unsafeSetChildren=function(a){this.$3=a};b.unsafeSetNodeContent=function(a){this.$2.content=a};b.contentUint=function(a){var b=this.contentBytes(a);return h(b,a)};b.contentBytes=function(a){a===void 0&&(a=-1);if(this.$3)return this["throw"]("to have binary content, but has children instead");else if(this.$2.content!=null){var b=this.$2.content;return a!==-1&&b.length!==a?this["throw"]("to be "+a+" bytes, but got "+b.length+" instead"):b}else return this["throw"]("to have content")};b.contentString=function(){if(this.$3)return this["throw"]("to have string content, but has children instead");else if(this.$2.content!=null)return this.$2.content;else return this["throw"]("to have content")};b.contentInt=function(a,b){var c=this.contentString();return this.$4(c,"content",a,b)};b.contentEnum=function(a){var b=this.contentString();if(!c("WAHasProperty")(a,b)){var d=Object.keys(a).join("|");return this["throw"]("to have content {"+d+'} but has value "'+b+'"')}return a[b]};b.decodeAsString=function(a){if(typeof a!=="string")throw c("err")("decodeAsString: attribute is "+typeof a+" not a string: "+a);return a};b["throw"]=function(a){throw new(d("WAXmlParsingFailure").XmlParsingFailure)(this.$1,"expected <"+this.$2.tag+"> "+a)};b.toString=function(){return this.$2.toString()};return a}();function h(a,b){var c=0;for(var d=0;d<b;d++)c=c*256+a[d];return c}g.ParsableXmlNode=a;g.convertBytesToUint=h}),98);
__d("WASignalOther",["WACryptoDependencies","WACryptoHkdf","WACryptoUtils","WAParsableXmlNode","decodeProtobuf","encodeProtobuf","err"],(function(a,b,c,d,e,f,g){"use strict";var h={name:"AES-CBC"},i={name:"HMAC",hash:"SHA-256"};function j(a,b){if(a.length!==b)throw c("err")("Signal expected "+b+" bytes, given "+a.length);return a}function a(a,b){return j(new Uint8Array(a),b)}function b(a){var b=a.buffer,c=a.byteOffset;a=a.length;return c===0&&a===b.byteLength?b:b.slice(c,c+a)}function e(a,b){return a.readByteArray(b)}function f(a){return new Uint8Array(a)}function k(a,b,d){if(a.length-b<d)throw c("err")("Can not split off "+d+" bytes from index "+b+" of "+a.length+" bytes");return a.slice(b,b+d)}function l(a){a=a==="extendedRange"?(-1>>>1)-1:16380;return d("WACryptoUtils").randomNumberLessThan(a)+1}function m(a){return q(a)}function n(a){return d("WAParsableXmlNode").convertBytesToUint(a,4)}function o(){var a=-1>>>1;return d("WACryptoUtils").randomNumberLessThan(a)+1}function p(a){return q(a)}function q(a,b,d){b===void 0&&(b=0);d===void 0&&(d=4294967296);if(typeof a==="number"&&b<=a&&a<d&&Math.floor(a)===a)return a;else throw c("err")("Expected integer in range ["+b+", "+d+"), given "+String(a))}function r(a,b){return d("encodeProtobuf").encodeProtobuf(a,b).readByteArray()}function s(a,b,c){return c(d("decodeProtobuf").decodeProtobuf(a,b))}function t(a,b,c,e){return d("WACryptoHkdf").extractWithSaltAndExpand(a,b,c,e).then(function(a){return new Uint8Array(a)})}function u(a,b){var c,e;b==="hmac-sha256"?(c=i,e=["sign"]):(b,c=h,e=["encrypt","decrypt"]);return d("WACryptoDependencies").getCrypto().subtle.importKey("raw",a,c,!1,e)}function v(a){return a}function w(a){return a}function x(a,b){return d("WACryptoUtils").arrayBuffersEqual(a,b)}g.AES_CBC=h;g.HMAC_SHA256=i;g.ensureSize=j;g.toBytes=a;g.toBuffer=b;g.readBytes=e;g.makeBytes=f;g.sliceBytes=k;g.makeRegistrationId=l;g.castRegistrationId=m;g.castRegistrationIdFromBytes=n;g.makeSenderKeyId=o;g.castSenderKeyId=p;g.ensureIntInRange=q;g.encodeSignalProto=r;g.decodeSignalProto=s;g.hkdf=t;g.makeCryptoKey=u;g.castToByteEncoded=v;g.castToSessionHash=w;g.areSessionHashesEqual=x}),98);
__d("WASignalKeys",["WACryptoDependencies","WACryptoPrimitives","WALogger","WASignalLocalStorageProtocol.pb","WASignalOther","decodeProtobuf","err"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["deserializePreKey error ",""]);h=function(){return a};return a}var i=5,j=16777215;function k(a,b){return{publicKey:a,privateKey:b}}function a(a){a=d("WACryptoPrimitives").keypairFromSecretKey(a);var b=a.publicKey;a=a.secretKey;return k(d("WASignalOther").ensureSize(b,32),d("WASignalOther").ensureSize(a,32))}function b(a,b){return{publicKey:d("WASignalOther").toBytes(a,32),privateKey:d("WASignalOther").toBytes(b,32)}}function l(){var a=d("WACryptoPrimitives").keyPair(),b=a.publicKey;a=a.secretKey;a[0]&=248;a[31]=64|a[31]&63;return k(d("WASignalOther").ensureSize(b,32),d("WASignalOther").ensureSize(a,32))}function m(a,b){return k(d("WASignalOther").sliceBytes(b,1,32),a)}function n(a,b){return{serializedPubKey:b,privateKey:a}}function e(){var a=l();return n(a.privateKey,o(a))}function o(a){var b=d("WASignalOther").makeBytes(33);b[0]=i;b.set(a.publicKey,1);return b}function f(a){var b=d("WASignalOther").makeBytes(33);b[0]=i;b.set(d("WASignalOther").ensureSize(a,32),1);return b}function p(a){return n(a.privateKey,o(a))}function q(a,b){a=(a-1)%j;a<=0&&(a+=j);var c=[];for(var e=0;e<b;e++){var f=a===j?1:a+1,g=l(),h=d("WASignalOther").encodeSignalProto(d("WASignalLocalStorageProtocol.pb").PreKeyRecordStructureSpec,{id:f,publicKey:o(g),privateKey:g.privateKey});c.push({plainObject:{id:f,keyPair:g},record:h});a=f}return c}function r(a){try{a=d("decodeProtobuf").decodeProtobuf(d("WASignalLocalStorageProtocol.pb").PreKeyRecordStructureSpec,a);var b=a.id,c=a.publicKey;a=a.privateKey;return b==null||c==null||a==null?null:{id:s(b),keyPair:m(d("WASignalOther").toBytes(a,32),u(new Uint8Array(c)))}}catch(a){d("WALogger").DEV(h(),a);return null}}function s(a){return d("WASignalOther").ensureIntInRange(a,1,j)}function t(a){return d("WASignalOther").ensureIntInRange(a,0,j)}function u(a){if(a.length===0||a[0]!==i)throw c("err")("Unrecognized public key type");return d("WASignalOther").ensureSize(a,33)}function v(){var a=d("WASignalOther").makeBytes(32);d("WACryptoDependencies").getCrypto().getRandomValues(a);return a}function w(a,b){return d("WACryptoPrimitives").scalarMult(a,b.subarray(1)).buffer}g.KEY_TYPE=i;g.makeKeyPairFrom=a;g.makeKeyPairFromArrayBuffers=b;g.makeKeyPair=l;g.makeKeyPairFromSerialized=m;g.makeSerializedKeyPairFrom=n;g.makeSerializedKeyPair=e;g.serializePubKey=o;g.serializeIdentity=f;g.toSerializedKeyPair=p;g.makePreKeys=q;g.deserializePreKey=r;g.castToPreKeyId=s;g.castToSignedPreKeyId=t;g.castToSerializedPubKey=u;g.makeRawSenderKey=v;g.ecdh=w}),98);
__d("WACryptoCurve25519Dependencies",["Promise","WACryptoPrimitives","WASignalKeys","WASignalOther"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(){return(h||(h=b("Promise"))).resolve().then(function(){return d("WASignalKeys").makeKeyPair()})}function c(a,c){return(h||(h=b("Promise"))).resolve().then(function(){return d("WACryptoPrimitives").scalarMult(d("WASignalOther").ensureSize(c,32),d("WASignalOther").ensureSize(a,32)).buffer})}e={generateIdentityKeyPair:a,calculateAgreement:c};g.calculateAgreement=c;g.CURVE25519_SIGNAL_DEPENDENCIES=e}),98);
__d("WACryptoEd25519",["WACryptoPrimitives","err"],(function(a,b,c,d,e,f,g){"use strict";var h=null;function i(a){var b=h;h=[];try{return a()}finally{((a=h)!=null?a:[]).forEach(function(a){return void a.fill(0)});h=b}}function j(a,b){if(h==null)throw c("err")("allocate called outside of active scope");return new a(b)}function a(a,b,c){d("WACryptoPrimitives").lowlevel.crypto_hash(a,b,c)}function b(a,b){for(var c=0;c<64;++c)b[c]=a[c],a[c]=0;l(a,b);b.fill(0)}function e(a,b){var c=[k(),k(),k(),k()];d("WACryptoPrimitives").lowlevel.scalarbase(c,b);R(a,c)}function k(a){var b=j(Float64Array,16);if(a){if(a.length>16)throw c("err")("Incorrect initialiser array provided to the fieldElement");for(var d=0;d<a.length;d++)b[d]=a[d]}return b}function l(a,b){d("WACryptoPrimitives").lowlevel.modL(a,b)}var m=function(){return k([0])},n=function(){return k([1])},o=function(){return k([2])},p=function(){return k([41136,18958,6951,50414,58488,44335,6150,12099,55207,15867,153,11085,57099,20417,9344,11139])};function q(){return[k(),k(),k(),k()]}function r(){return[k(),k(),k(),k()]}function s(){return[k(),k(),k()]}function t(a,b){var c=0;b=b;while(b>0){var d=b%65536;a[c]=d;b=(b-d)/65536;c++}}function u(a,b){return T(a,b)?0:1}function v(a){var b=d("WACryptoPrimitives").lowlevel.pack25519,c=j(Uint8Array,32);b(c,a);return c[0]&1}function w(a,b){var c=d("WACryptoPrimitives").lowlevel.S,e=d("WACryptoPrimitives").lowlevel.M,f=o(),g=k();c(g,b);e(a,f,g)}function x(a,b){var c=d("WACryptoPrimitives").lowlevel.S,e=d("WACryptoPrimitives").lowlevel.M,f=d("WACryptoPrimitives").lowlevel.A,g=m(),h=n(),i=k(),j=k(),l=k(),o=k();t(g,486662);c(i,b);e(j,g,b);f(l,i,j);f(o,l,h);e(a,b,o)}function y(a,b,c){c===1&&a.set(b)}var z=new Uint8Array([176,160,14,74,39,27,238,196,120,228,47,173,6,24,67,47,167,215,251,61,153,0,77,43,11,223,193,79,128,36,131,43]);function A(a,b){var c,e=(c=d("WACryptoPrimitives")).lowlevel.unpack25519,f=c.lowlevel.pow2523,g=c.lowlevel.M;c=c.lowlevel.S;var h=k();e(h,z);e=k();f(e,b);f=k();g(f,b,e);e=k();c(e,f);c=k();g(c,f,h);y(f,c,1^u(e,b));a.set(f)}function B(a,b){var c=d("WACryptoPrimitives").lowlevel.Z,e=d("WACryptoPrimitives").lowlevel.A,f=d("WACryptoPrimitives").lowlevel.M,g=n(),h=k(),i=k(),j=k();c(h,b,g);e(i,b,g);S(j,i);f(a,h,j)}function C(a,b){var c=d("WACryptoPrimitives").lowlevel.Z,e=m();c(a,e,b)}function D(a,b){var c=d("WACryptoPrimitives").lowlevel.M;c(a[0],b[0],b[3]);c(a[1],b[1],b[2]);c(a[2],b[2],b[3])}function E(a,b){var c=d("WACryptoPrimitives").lowlevel.M;c(a[0],b[0],b[3]);c(a[1],b[1],b[2]);c(a[2],b[2],b[3]);c(a[3],b[0],b[1])}function F(a,b){var c=d("WACryptoPrimitives").lowlevel.S,e=d("WACryptoPrimitives").lowlevel.A,f=d("WACryptoPrimitives").lowlevel.Z;c(a[0],b[0]);c(a[2],b[1]);w(a[3],b[2]);e(a[1],b[0],b[1]);b=k();c(b,a[1]);e(a[1],a[2],a[0]);f(a[2],a[2],a[0]);f(a[0],b,a[1]);f(a[3],a[3],a[2])}var G=new Uint8Array([6,126,69,255,170,4,110,204,130,26,125,75,209,211,161,197,126,79,252,3,220,8,123,210,187,6,160,96,244,237,38,15]);function H(a,b,c){var e=d("WACryptoPrimitives").lowlevel.unpack25519,f=d("WACryptoPrimitives").lowlevel.M,g=k();e(g,G);e=k();B(e,b);var h=k();x(h,b);var i=k();A(i,h);h=k();f(h,b,g);b=k();S(b,i);g=k();f(g,h,b);i=k();C(i,g);y(g,i,v(g)^c);a[0].set(g);a[1].set(e);a[2].set(n());f(a[3],a[0],a[1])}function I(a,b){a[0].set(b[0]),a[1].set(b[1]),a[2].set(b[2])}function J(a,b){var c=s();I(c,b);F(a,c)}function K(a,b){var c=r(),d=s();J(c,b);D(d,c);F(c,d);D(d,c);F(c,d);E(a,c)}function L(a){var b,c=(b=d("WACryptoPrimitives")).lowlevel.S,e=b.lowlevel.M,f=b.lowlevel.pow2523;b=b.lowlevel.pack25519;var g=k(),h=k(),i=k(),j=k(),l=k();f(g,a);c(h,g);c(i,h);e(j,i,a);e(l,j,a);f=new Uint8Array(32);b(f,l);return 1&f[31]}function M(a,b){C(a[0],b[0]),a[1].set(b[1]),a[2].set(b[2]),C(a[3],b[3])}function f(a,b){var c=q();b=U(c,b);if(b!==0)return-1;M(a,c);return 0}function N(a,b){var c=d("WACryptoPrimitives").lowlevel.M,e=d("WACryptoPrimitives").lowlevel.A;b=b;var f=n(),g=m();t(g,486662);var h=k();w(h,b);b=k();e(b,h,f);h=k();S(h,b);f=k();c(f,h,g);b=k();C(b,f);c=k();x(c,b);h=L(c);f=k([0]);y(f,g,h);c=k();e(c,b,f);g=k();C(g,c);y(c,g,h);a.set(c)}function O(a){var b=d("WACryptoPrimitives").lowlevel.unpack25519;a=d("WACryptoPrimitives").hash(a);var c=(a[31]&128)>>7;a[31]&=127;var e=k();b(e,a);b=k();P(b,e);a=q();H(a,b,c);e=q();K(e,a);return e}function P(a,b){return i(function(){return N(a,b)})}function Q(a){return i(function(){return O(a)})}function R(a,b){var c=k(),e=k(),f=k(),g=d("WACryptoPrimitives").lowlevel.M,h=d("WACryptoPrimitives").lowlevel.pack25519;S(f,b[2]);g(c,b[0],f);g(e,b[1],f);h(a,e);g=new Uint8Array(32);h(g,c);a[31]^=(g[0]&1)<<7}function S(a,b){var c=k();c.set(b);var e=d("WACryptoPrimitives").lowlevel.M,f=d("WACryptoPrimitives").lowlevel.S;for(var g=253;g>=0;--g)f(c,c),g!==2&&g!==4&&e(c,c,b);a.set(c)}function T(a,b){var c=d("WACryptoPrimitives").lowlevel.pack25519,e=d("WACryptoPrimitives").lowlevel.crypto_verify_32,f=new Uint8Array(32),g=new Uint8Array(32);c(f,a);c(g,b);return e(f,0,g,0)}function U(a,b){var c,e=(c=d("WACryptoPrimitives")).lowlevel.set25519,f=c.lowlevel.S,g=c.lowlevel.M,h=c.lowlevel.Z,i=c.lowlevel.A,j=c.lowlevel.D,l=c.lowlevel.unpack25519;c=c.lowlevel.pow2523;var o=k(),q=k(),r=k(),s=k(),t=k(),u=k(),v=k();e(a[2],n());l(a[1],b);f(r,a[1]);g(s,r,j);h(r,r,a[2]);i(s,a[2],s);f(t,s);f(u,t);g(v,u,t);g(o,v,r);g(o,o,s);c(o,o);g(o,o,r);g(o,o,s);g(o,o,s);g(a[0],o,s);f(q,a[0]);g(q,q,s);T(q,r)&&g(a[0],a[0],p());f(q,a[0]);g(q,q,s);if(T(q,r))return-1;V(a[0])===b[31]>>7&&h(a[0],m(),a[0]);g(a[3],a[0],a[1]);return 0}function V(a){var b=d("WACryptoPrimitives").lowlevel.pack25519,c=new Uint8Array(32);b(c,a);return c[0]&1}g.runInAllocationScope=i;g.allocate=j;g.hashSha512=a;g.reduce=b;g.scalarmultBase=e;g.fieldElement=k;g.modL=l;g.p3Element=q;g.unpack=f;g.elligator=P;g.hashToPoint=Q;g.pack=R;g.inv25519=S;g.unpackneg=U}),98);
__d("WADbSignal",[],(function(a,b,c,d,e,f){"use strict";function a(a){return a}function b(a,b,c){return a+"_"+b+"_"+c}c={abProps:"abProps",authKeyPair:"authKeyPair",cat:"cat",certificateChain:"certificateChain",clockSkew:"clockSkew",deviceId:"deviceId",deviceUUID:"deviceUUID",edgeInfo:"edgeInfo",fbid:"fbid",identityKeyPair:"identityKeyPair",lastPrekeyGenerationId:"lastPrekeyGenerationId",lastPrekeyId:"lastPrekeyId",lastSessionDeviceWasLinkedTo:"lastSessionDeviceWasLinkedTo",lastSignedPrekeyId:"lastSignedPrekeyId",regId:"regId",registrationVersion:"registrationVersion",deviceRegUnixTime:"deviceRegUnixTime"};({msgrDeviceId:"msgrDeviceId"});d={registrationHistory:"registrationHistory"};f.unsafeCoerceToSenderKeySessionId=a;f.buildSenderKeySessionId=b;f.MetaKeysEnum=c;f.PlainTextMetaKeysEnum=d}),66);
__d("WADeepEquals",[],(function(a,b,c,d,e,f){"use strict";function g(a,b){if(a===b)return!0;if(!a||!b||typeof a!=="object"&&typeof b!=="object")return!1;var c=Array.isArray(a),d=Array.isArray(b);if(c!==d)return!1;d=!0;if(c){c=a.length;if(c!==b.length)return!1;for(var e=0;d&&e<c;e++)d=g(a[e],b[e]);return d}c=Object.keys(a);for(e=0;d&&e<c.length;e++){var f=c[e];d=b.propertyIsEnumerable(f)&&g(a[f],b[f])}return d&&Object.keys(b).length===c.length}f.deepEqual=g}),66);
__d("WAFrankingNode",["Promise","WAFranking","WALogger"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Can't handle franking version ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Franking key is missing"]);j=function(){return a};return a}function a(a,c,e){if(c==null){d("WALogger").ERROR(j());return(h||(h=b("Promise"))).resolve(null)}if(e!=null&&e!==0){d("WALogger").ERROR(i(),e);return(h||(h=b("Promise"))).resolve(null)}return d("WAFranking").genFrankingTag(c,a)}g.genFrankingTagFromMessageApplicationEncode=a}),98);
__d("WAGenReportingMeta",["WAByteArray","WAFranking","WAFrankingNode","WAGlobals","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,c){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){if(d("WAGlobals").getConfig().isFrankingEnabled()){var e=(yield d("WAFrankingNode").genFrankingTagFromMessageApplicationEncode(a,b,c));return{frankingKey:b,frankingTag:e,frankingVersion:d("WAFranking").getFrankingVersion(c),reportingContent:d("WAByteArray").uint8ArrayToBuffer(a),reportingTag:null}}else return{frankingKey:b,frankingTag:null,frankingVersion:d("WAFranking").getFrankingVersion(c),reportingContent:null,reportingTag:null}});return h.apply(this,arguments)}g.genReportingMeta=a}),98);
__d("WAPushSafeTypes",[],(function(a,b,c,d,e,f){"use strict";function a(a){return a}f.unsafeNotNullable=a}),66);
__d("WASignalSignatures",["Promise","WACryptoDependencies","WACryptoEd25519","WACryptoPrimitives","WAHex","WALogger","WALongInt","WASignalKeys","WASignalLocalStorageProtocol.pb","WASignalOther","decodeProtobuf","err"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["deserializeSignedPreKey error ",""]);i=function(){return a};return a}function j(a,b,c){return d("WACryptoEd25519").runInAllocationScope(function(){var e,f=b.length,g=a.privateKey,h=new Uint8Array(32);(e=d("WACryptoEd25519")).scalarmultBase(h,g);var i=h[31]&128,j=new Uint8Array(f+128);j[0]=254;j.fill(255,1,32);j.set(g,32);j.set(b,64);j.set(c,f+64);var k=e.allocate(Uint8Array,64);e.hashSha512(k,j,f+128);j.set(h,32);h=e.allocate(Float64Array,64);e.reduce(k,h);e.scalarmultBase(j,k);var l=e.allocate(Uint8Array,64);e.hashSha512(l,j,f+64);e.reduce(l,h);for(f=0;f<32;++f)h[f]=k[f];for(f=0;f<32;++f)for(k=0;k<32;++k)h[f+k]+=l[f]*g[k];e.modL(j.subarray(32,64),h);return{pubKeyNegative:i!==0,signedMsg:j}})}function a(a,c){return(h||(h=b("Promise"))).resolve().then(function(){var b=d("WASignalOther").makeBytes(64);d("WACryptoDependencies").getCrypto().getRandomValues(b);return k(a,c,b)})}function e(a,b,c){var e=c[63];return e&96?!1:d("WACryptoEd25519").runInAllocationScope(function(){var f,g,h=(f=d("WACryptoPrimitives")).lowlevel.A,i=f.lowlevel.M,j=f.lowlevel.Z,k=f.lowlevel.pack25519,l=f.lowlevel.unpack25519,m=(g=d("WACryptoEd25519")).allocate(Uint8Array,64);m.set(c);m[63]=e&127;var n=g.fieldElement(),o=g.fieldElement(),p=g.fieldElement(),q=g.fieldElement(),r=g.fieldElement(),s=g.allocate(Uint8Array,32),t=g.fieldElement();t[0]=1;l(n,a.subarray(1));j(o,n,t);h(p,n,t);g.inv25519(q,p);i(r,o,q);k(s,r);s[31]=s[31]&127|e&128;return f.signDetachedVerify(b,m,s)})}function k(a,b,c){a=j(a,b,c);b=d("WASignalOther").sliceBytes(a.signedMsg,0,64);b[63]=b[63]&127|(a.pubKeyNegative?128:0);return b}function l(a,b,e){var f=d("WASignalKeys").makeKeyPair(),g=d("WASignalOther").makeBytes(64);d("WACryptoDependencies").getCrypto().getRandomValues(g);e=k(e,d("WASignalKeys").serializePubKey(f),g);if(!Number.isSafeInteger(b))throw c("err")("Expected timestamp to be a safe integer, given "+String(b));return{id:d("WASignalKeys").castToPreKeyId(a),ts:b,keyPair:f,signature:e}}function f(a,b){var c=d("WASignalOther").makeBytes(64);d("WACryptoDependencies").getCrypto().getRandomValues(c);return k(a,b,c)}function m(a){var b=a.id,c=a.keyPair;return d("WASignalOther").encodeSignalProto(d("WASignalLocalStorageProtocol.pb").SignedPreKeyRecordStructureSpec,{id:b,publicKey:d("WASignalKeys").serializePubKey(c),privateKey:c.privateKey,signature:a.signature,timestamp:a.ts})}function n(a){try{a=d("decodeProtobuf").decodeProtobuf(d("WASignalLocalStorageProtocol.pb").SignedPreKeyRecordStructureSpec,a);var b=a.id,c=a.publicKey,e=a.privateKey,f=a.signature;a=a.timestamp;return b==null||c==null||e==null||f==null||a==null?null:{id:d("WASignalKeys").castToSignedPreKeyId(b),ts:d("WALongInt").numberOrThrowIfTooLarge(a),keyPair:d("WASignalKeys").makeKeyPairFromSerialized(d("WASignalOther").toBytes(e,32),d("WASignalKeys").castToSerializedPubKey(new Uint8Array(c))),signature:d("WASignalOther").toBytes(f,64)}}catch(a){d("WALogger").DEV(i(),a);return null}}function o(a){return new Uint8Array(d("WAHex").parseHex(a))}function p(a){if(a.length===33)return d("WASignalKeys").castToSerializedPubKey(a);else if(a.length===32)return d("WASignalKeys").serializeIdentity(a);else throw c("err")("verifyCertificate publicKey incorrect length")}function q(a,c,d){return(h||(h=b("Promise"))).resolve().then(function(){var b=l(a,c,d),e=m(b);return{plainObject:b,record:e}})}g.signMsg=a;g.verifyMsgSignalVariant=e;g.makeSignature=k;g.makeSignedPreKey=l;g.signSenderKeyMessage=f;g.serializeSignedPreKeyForPrivateStorage=m;g.deserializeSignedPreKey=n;g.convertPublicKeyHexToUint8Array=o;g.convertPublicKeyToSerializedPubKey=p;g.generateSignedPreKey=q}),98);